parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"WNWS":[function(require,module,exports) {
var define;
var global = arguments[3];
var define,global=arguments[3];!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["easemob-emedia"]=t():e["easemob-emedia"]=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/Users/DATA/WORK.HOME/projects/CO./EASEMOB_2016.05.03~/EMedia",n(n.s=13)}([,,function(e,t,n){var r;if(document.documentMode){var i=/\brv[ :]+(\d+)/g.exec(navigator.userAgent)||[],o=parseInt(i[1],10);o||(i=/\bMSIE[ :]+(\d+)/g.exec(navigator.userAgent)||[],o=parseInt(i[1]||"0",10)),logger.error("adapter.ie not required"),r.__browser="IE",r.__browserVersion=o}else r=n(3),function(){function e(e,t){e.srcObject=t}window.attachMediaStream&&!0!==window.attachMediaStream._wrapped&&(window.__attachMediaStream=window.attachMediaStream);window.attachMediaStream=function(t,n,r,i){function o(){r=!!(void 0===r?n._located:r),t.muted=!1,r!==t.muted&&(t.muted=!0)}if(i||(i=window.__attachMediaStream)||(i=e),!t)return;if(!n)return void i(t,n);if(!t.srcObject)return o(),i(t,n),t;if(t.srcObject._located&&n._located&&t.srcObject.id===n.id)return t.srcObject;return o(),i(t,n),t},window.attachMediaStream._wrapped=!0,console&&"function"==typeof console.info&&console.info("Wrap the attachMediaStream ",r.__browser,r.__browserVersion)}();if(r.__browser=r.__browser||r.browserDetails.browser,r.__browserVersion=r.__browserVersion||r.browserDetails.version,console&&"function"==typeof console.info&&console.info("Current browser",r.__browser,r.__browserVersion),"Not a supported browser."===r.__browser)throw"Not a supported browser";e.exports=r},function(e,t){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};!function(r){if("object"===(void 0===t?"undefined":n(t))&&void 0!==e)e.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{("undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:this).adapter=r()}}(function(){return function e(t,n,r){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(o)return o(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code="MODULE_NOT_FOUND",u}var d=n[s]={exports:{}};t[s][0].call(d.exports,function(e){var n=t[s][1][e];return i(n||e)},d,d.exports,e,t,n,r)}return n[s].exports}for(var o="function"==typeof require&&require,s=0;s<r.length;s++)i(r[s]);return i}({1:[function(e,t,n){"use strict";var r=e("sdp");function i(e,t,n,i,o){var s=r.writeRtpDescription(e.kind,t);if(s+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":o||"active"),s+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(i?i.id:"-")+" "+a+"\r\n";s+="a="+c,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),s}function o(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},r=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},i=function(e,t,n,i){var o=r(e.parameters.apt,n),s=r(t.parameters.apt,i);return o&&s&&o.name.toLowerCase()===s.name.toLowerCase()};return e.codecs.forEach(function(r){for(var o=0;o<t.codecs.length;o++){var s=t.codecs[o];if(r.name.toLowerCase()===s.name.toLowerCase()&&r.clockRate===s.clockRate){if("rtx"===r.name.toLowerCase()&&r.parameters&&s.parameters.apt&&!i(r,s,e.codecs,t.codecs))continue;(s=JSON.parse(JSON.stringify(s))).numChannels=Math.min(r.numChannels,s.numChannels),n.codecs.push(s),s.rtcpFeedback=s.rtcpFeedback.filter(function(e){for(var t=0;t<r.rtcpFeedback.length;t++)if(r.rtcpFeedback[t].type===e.type&&r.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var r=0;r<t.headerExtensions.length;r++){var i=t.headerExtensions[r];if(e.uri===i.uri){n.headerExtensions.push(i);break}}}),n}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function a(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function c(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}t.exports=function(e,t){function n(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function u(t,n,r,i){var o=new Event("track");o.track=n,o.receiver=r,o.transceiver={receiver:r},o.streams=i,e.setTimeout(function(){t._dispatchEvent("track",o)})}var d=function(n){var i=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=o[e].bind(o)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw c("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var i="string"==typeof r;return i&&(r=[r]),r=r.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=i?r[0]:r,!!r.length}})}(n.iceServers||[],t),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=r.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};d.prototype.onicecandidate=null,d.prototype.onaddstream=null,d.prototype.ontrack=null,d.prototype.onremovestream=null,d.prototype.onsignalingstatechange=null,d.prototype.oniceconnectionstatechange=null,d.prototype.onconnectionstatechange=null,d.prototype.onicegatheringstatechange=null,d.prototype.onnegotiationneeded=null,d.prototype.ondatachannel=null,d.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},d.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},d.prototype.getConfiguration=function(){return this._config},d.prototype.getLocalStreams=function(){return this.localStreams},d.prototype.getRemoteStreams=function(){return this.remoteStreams},d.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,r={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)r.iceTransport=this.transceivers[0].iceTransport,r.dtlsTransport=this.transceivers[0].dtlsTransport;else{var i=this._createIceAndDtlsTransports();r.iceTransport=i.iceTransport,r.dtlsTransport=i.dtlsTransport}return t||this.transceivers.push(r),r},d.prototype.addTrack=function(t,n){if(this._isClosed)throw c("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var r;if(this.transceivers.find(function(e){return e.track===t}))throw c("InvalidAccessError","Track already exists.");for(var i=0;i<this.transceivers.length;i++)this.transceivers[i].track||this.transceivers[i].kind!==t.kind||(r=this.transceivers[i]);return r||(r=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),r.track=t,r.stream=n,r.rtpSender=new e.RTCRtpSender(t,r.dtlsTransport),r.rtpSender},d.prototype.addStream=function(e){var n=this;if(t>=15025)e.getTracks().forEach(function(t){n.addTrack(t,e)});else{var r=e.clone();e.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)})}},d.prototype.removeTrack=function(t){if(this._isClosed)throw c("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw c("InvalidAccessError","Sender was not created by this connection.");var r=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(r)&&this.localStreams.indexOf(r)>-1&&this.localStreams.splice(this.localStreams.indexOf(r),1),this._maybeFireNegotiationNeeded()},d.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},d.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},d.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},d.prototype._createIceGatherer=function(t,n){var r=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var i=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(i,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;i.state=n?"completed":"gathering",null!==r.transceivers[t].bufferedCandidateEvents&&r.transceivers[t].bufferedCandidateEvents.push(e)},i.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),i},d.prototype._gather=function(t,n){var i=this,o=this.transceivers[n].iceGatherer;if(!o.onlocalcandidate){var s=this.transceivers[n].bufferedCandidateEvents;this.transceivers[n].bufferedCandidateEvents=null,o.removeEventListener("localcandidate",this.transceivers[n].bufferCandidates),o.onlocalcandidate=function(e){if(!(i.usingBundle&&n>0)){var s=new Event("icecandidate");s.candidate={sdpMid:t,sdpMLineIndex:n};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==o.state&&"gathering"!==o.state||(o.state="completed");else{"new"===o.state&&(o.state="gathering"),a.component=1,a.ufrag=o.getLocalParameters().usernameFragment;var u=r.writeCandidate(a);s.candidate=Object.assign(s.candidate,r.parseCandidate(u)),s.candidate.candidate=u,s.candidate.toJSON=function(){return{candidate:s.candidate.candidate,sdpMid:s.candidate.sdpMid,sdpMLineIndex:s.candidate.sdpMLineIndex,usernameFragment:s.candidate.usernameFragment}}}var d=r.getMediaSections(i.localDescription.sdp);d[s.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+s.candidate.candidate+"\r\n",i.localDescription.sdp=r.getDescription(i.localDescription.sdp)+d.join("");var l=i.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==i.iceGatheringState&&(i.iceGatheringState="gathering",i._emitGatheringStateChange()),c||i._dispatchEvent("icecandidate",s),l&&(i._dispatchEvent("icecandidate",new Event("icecandidate")),i.iceGatheringState="complete",i._emitGatheringStateChange())}},e.setTimeout(function(){s.forEach(function(e){o.onlocalcandidate(e)})},0)}},d.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var r=new e.RTCDtlsTransport(n);return r.ondtlsstatechange=function(){t._updateConnectionState()},r.onerror=function(){Object.defineProperty(r,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:r}},d.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlsstatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},d.prototype._transceive=function(e,n,i){var s=o(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:r.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),i&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},d.prototype.setLocalDescription=function(e){var t,n,i=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(c("TypeError",'Unsupported type "'+e.type+'"'));if(!s("setLocalDescription",e.type,i.signalingState)||i._isClosed)return Promise.reject(c("InvalidStateError","Can not set local "+e.type+" in state "+i.signalingState));if("offer"===e.type)t=r.splitSections(e.sdp),n=t.shift(),t.forEach(function(e,t){var n=r.parseRtpParameters(e);i.transceivers[t].localCapabilities=n}),i.transceivers.forEach(function(e,t){i._gather(e.mid,t)});else if("answer"===e.type){t=r.splitSections(i.remoteDescription.sdp),n=t.shift();var a=r.matchPrefix(n,"a=ice-lite").length>0;t.forEach(function(e,t){var s=i.transceivers[t],c=s.iceGatherer,u=s.iceTransport,d=s.dtlsTransport,l=s.localCapabilities,f=s.remoteCapabilities;if(!(r.isRejected(e)&&0===r.matchPrefix(e,"a=bundle-only").length)&&!s.rejected){var p=r.getIceParameters(e,n),h=r.getDtlsParameters(e,n);a&&(h.role="server"),i.usingBundle&&0!==t||(i._gather(s.mid,t),"new"===u.state&&u.start(c,p,a?"controlling":"controlled"),"new"===d.state&&d.start(h));var m=o(l,f);i._transceive(s,m.codecs.length>0,!1)}})}return i.localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?i._updateSignalingState("have-local-offer"):i._updateSignalingState("stable"),Promise.resolve()},d.prototype.setRemoteDescription=function(i){var o=this;if(-1===["offer","answer"].indexOf(i.type))return Promise.reject(c("TypeError",'Unsupported type "'+i.type+'"'));if(!s("setRemoteDescription",i.type,o.signalingState)||o._isClosed)return Promise.reject(c("InvalidStateError","Can not set remote "+i.type+" in state "+o.signalingState));var d={};o.remoteStreams.forEach(function(e){d[e.id]=e});var l=[],f=r.splitSections(i.sdp),p=f.shift(),h=r.matchPrefix(p,"a=ice-lite").length>0,m=r.matchPrefix(p,"a=group:BUNDLE ").length>0;o.usingBundle=m;var v=r.matchPrefix(p,"a=ice-options:")[0];return o.canTrickleIceCandidates=!!v&&v.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(s,c){var u=r.splitLines(s),f=r.getKind(s),v=r.isRejected(s)&&0===r.matchPrefix(s,"a=bundle-only").length,b=u[0].substr(2).split(" ")[2],g=r.getDirection(s,p),_=r.parseMsid(s),y=r.getMid(s)||r.generateIdentifier();if("application"===f&&"DTLS/SCTP"===b||v)o.transceivers[c]={mid:y,kind:f,rejected:!0};else{var S,w,x,C,E,T,I,R,k;!v&&o.transceivers[c]&&o.transceivers[c].rejected&&(o.transceivers[c]=o._createTransceiver(f,!0));var O,M,A=r.parseRtpParameters(s);v||(O=r.getIceParameters(s,p),(M=r.getDtlsParameters(s,p)).role="client"),I=r.parseRtpEncodingParameters(s);var P=r.parseRtcpParameters(s),j=r.matchPrefix(s,"a=end-of-candidates",p).length>0,N=r.matchPrefix(s,"a=candidate:").map(function(e){return r.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===i.type||"answer"===i.type)&&!v&&m&&c>0&&o.transceivers[c]&&(o._disposeIceAndDtlsTransports(c),o.transceivers[c].iceGatherer=o.transceivers[0].iceGatherer,o.transceivers[c].iceTransport=o.transceivers[0].iceTransport,o.transceivers[c].dtlsTransport=o.transceivers[0].dtlsTransport,o.transceivers[c].rtpSender&&o.transceivers[c].rtpSender.setTransport(o.transceivers[0].dtlsTransport),o.transceivers[c].rtpReceiver&&o.transceivers[c].rtpReceiver.setTransport(o.transceivers[0].dtlsTransport)),"offer"!==i.type||v)"answer"!==i.type||v||(w=(S=o.transceivers[c]).iceGatherer,x=S.iceTransport,C=S.dtlsTransport,E=S.rtpReceiver,T=S.sendEncodingParameters,R=S.localCapabilities,o.transceivers[c].recvEncodingParameters=I,o.transceivers[c].remoteCapabilities=A,o.transceivers[c].rtcpParameters=P,N.length&&"new"===x.state&&(!h&&!j||m&&0!==c?N.forEach(function(e){a(S.iceTransport,e)}):x.setRemoteCandidates(N)),m&&0!==c||("new"===x.state&&x.start(w,O,"controlling"),"new"===C.state&&C.start(M)),o._transceive(S,"sendrecv"===g||"recvonly"===g,"sendrecv"===g||"sendonly"===g),!E||"sendrecv"!==g&&"sendonly"!==g?delete S.rtpReceiver:(k=E.track,_?(d[_.stream]||(d[_.stream]=new e.MediaStream),n(k,d[_.stream]),l.push([k,E,d[_.stream]])):(d.default||(d.default=new e.MediaStream),n(k,d.default),l.push([k,E,d.default]))));else{(S=o.transceivers[c]||o._createTransceiver(f)).mid=y,S.iceGatherer||(S.iceGatherer=o._createIceGatherer(c,m)),N.length&&"new"===S.iceTransport.state&&(!j||m&&0!==c?N.forEach(function(e){a(S.iceTransport,e)}):S.iceTransport.setRemoteCandidates(N)),R=e.RTCRtpReceiver.getCapabilities(f),t<15019&&(R.codecs=R.codecs.filter(function(e){return"rtx"!==e.name})),T=S.sendEncodingParameters||[{ssrc:1001*(2*c+2)}];var D,L=!1;if("sendrecv"===g||"sendonly"===g){if(L=!S.rtpReceiver,E=S.rtpReceiver||new e.RTCRtpReceiver(S.dtlsTransport,f),L)k=E.track,_&&"-"===_.stream||(_?(d[_.stream]||(d[_.stream]=new e.MediaStream,Object.defineProperty(d[_.stream],"id",{get:function(){return _.stream}})),Object.defineProperty(k,"id",{get:function(){return _.track}}),D=d[_.stream]):(d.default||(d.default=new e.MediaStream),D=d.default)),D&&(n(k,D),S.associatedRemoteMediaStreams.push(D)),l.push([k,E,D])}else S.rtpReceiver&&S.rtpReceiver.track&&(S.associatedRemoteMediaStreams.forEach(function(t){var n,r,i=t.getTracks().find(function(e){return e.id===S.rtpReceiver.track.id});i&&(n=i,(r=t).removeTrack(n),r.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))}),S.associatedRemoteMediaStreams=[]);S.localCapabilities=R,S.remoteCapabilities=A,S.rtpReceiver=E,S.rtcpParameters=P,S.sendEncodingParameters=T,S.recvEncodingParameters=I,o._transceive(o.transceivers[c],!1,L)}}}),void 0===o._dtlsRole&&(o._dtlsRole="offer"===i.type?"active":"passive"),o.remoteDescription={type:i.type,sdp:i.sdp},"offer"===i.type?o._updateSignalingState("have-remote-offer"):o._updateSignalingState("stable"),Object.keys(d).forEach(function(t){var n=d[t];if(n.getTracks().length){if(-1===o.remoteStreams.indexOf(n)){o.remoteStreams.push(n);var r=new Event("addstream");r.stream=n,e.setTimeout(function(){o._dispatchEvent("addstream",r)})}l.forEach(function(e){var t=e[0],r=e[1];n.id===e[2].id&&u(o,t,r,[n])})}}),l.forEach(function(e){e[2]||u(o,e[0],e[1],[])}),e.setTimeout(function(){o&&o.transceivers&&o.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},d.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},d.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},d.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},d.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},d.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},d.prototype.createOffer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createOffer after close"));var o=n.transceivers.filter(function(e){return"audio"===e.kind}).length,s=n.transceivers.filter(function(e){return"video"===e.kind}).length,a=arguments[0];if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(o=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(s=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(n.transceivers.forEach(function(e){"audio"===e.kind?--o<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});o>0||s>0;)o>0&&(n._createTransceiver("audio"),o--),s>0&&(n._createTransceiver("video"),s--);var u=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.transceivers.forEach(function(i,o){var s=i.track,a=i.kind,c=i.mid||r.generateIdentifier();i.mid=c,i.iceGatherer||(i.iceGatherer=n._createIceGatherer(o,n.usingBundle));var u=e.RTCRtpSender.getCapabilities(a);t<15019&&(u.codecs=u.codecs.filter(function(e){return"rtx"!==e.name})),u.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),i.remoteCapabilities&&i.remoteCapabilities.codecs&&i.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),u.headerExtensions.forEach(function(e){(i.remoteCapabilities&&i.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var d=i.sendEncodingParameters||[{ssrc:1001*(2*o+1)}];s&&t>=15019&&"video"===a&&!d[0].rtx&&(d[0].rtx={ssrc:d[0].ssrc+1}),i.wantReceive&&(i.rtpReceiver=new e.RTCRtpReceiver(i.dtlsTransport,a)),i.localCapabilities=u,i.sendEncodingParameters=d}),"max-compat"!==n._config.bundlePolicy&&(u+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),u+="a=ice-options:trickle\r\n",n.transceivers.forEach(function(e,t){u+=i(e,e.localCapabilities,"offer",e.stream,n._dtlsRole),u+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===n.iceGatheringState||0!==t&&n.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,u+="a="+r.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(u+="a=end-of-candidates\r\n"))});var d=new e.RTCSessionDescription({type:"offer",sdp:u});return Promise.resolve(d)},d.prototype.createAnswer=function(){var n=this;if(n._isClosed)return Promise.reject(c("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==n.signalingState&&"have-local-pranswer"!==n.signalingState)return Promise.reject(c("InvalidStateError","Can not call createAnswer in signalingState "+n.signalingState));var s=r.writeSessionBoilerplate(n._sdpSessionId,n._sdpSessionVersion++);n.usingBundle&&(s+="a=group:BUNDLE "+n.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var a=r.getMediaSections(n.remoteDescription.sdp).length;n.transceivers.forEach(function(e,r){if(!(r+1>a)){if(e.rejected)return"application"===e.kind?s+="m=application 0 DTLS/SCTP 5000\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var c;if(e.stream)"audio"===e.kind?c=e.stream.getAudioTracks()[0]:"video"===e.kind&&(c=e.stream.getVideoTracks()[0]),c&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var u=o(e.localCapabilities,e.remoteCapabilities);!u.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=i(e,u,"answer",e.stream,n._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var u=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(u)},d.prototype.addIceCandidate=function(e){var t,n=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(i,o){if(!n.remoteDescription)return o(c("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var s=e.sdpMLineIndex;if(e.sdpMid)for(var u=0;u<n.transceivers.length;u++)if(n.transceivers[u].mid===e.sdpMid){s=u;break}var d=n.transceivers[s];if(!d)return o(c("OperationError","Can not add ICE candidate"));if(d.rejected)return i();var l=Object.keys(e.candidate).length>0?r.parseCandidate(e.candidate):{};if("tcp"===l.protocol&&(0===l.port||9===l.port))return i();if(l.component&&1!==l.component)return i();if((0===s||s>0&&d.iceTransport!==n.transceivers[0].iceTransport)&&!a(d.iceTransport,l))return o(c("OperationError","Can not add ICE candidate"));var f=e.candidate.trim();0===f.indexOf("a=")&&(f=f.substr(2)),(t=r.getMediaSections(n.remoteDescription.sdp))[s]+="a="+(l.type?f:"end-of-candidates")+"\r\n",n.remoteDescription.sdp=r.getDescription(n.remoteDescription.sdp)+t.join("")}else for(var p=0;p<n.transceivers.length&&(n.transceivers[p].rejected||(n.transceivers[p].iceTransport.addRemoteCandidate({}),(t=r.getMediaSections(n.remoteDescription.sdp))[p]+="a=end-of-candidates\r\n",n.remoteDescription.sdp=r.getDescription(n.remoteDescription.sdp)+t.join(""),!n.usingBundle));p++);i()})},d.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw c("InvalidAccessError","Invalid selector.");return n.getStats()}var r=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&r.push(e[t].getStats())})}),Promise.all(r).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var r=n.prototype.getStats;n.prototype.getStats=function(){return r.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var r;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(r=e[n]).type]||r.type,t.set(n,e[n])}),t})}}});var l=["createOffer","createAnswer"];return l.forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(l=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=d.prototype[e];d.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),d}},{sdp:2}],2:[function(e,t,r){"use strict";var i={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};i.localCName=i.generateIdentifier(),i.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},i.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},i.getDescription=function(e){var t=i.splitSections(e);return t&&t[0]},i.getMediaSections=function(e){var t=i.splitSections(e);return t.shift(),t},i.matchPrefix=function(e,t){return i.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},i.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},i.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},i.parseIceOptions=function(e){return e.substr(14).split(" ")},i.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},i.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},i.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},i.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},i.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},i.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},i.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},i.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},i.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},i.getMid=function(e){var t=i.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},i.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},i.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:i.matchPrefix(e+t,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},i.getIceParameters=function(e,t){var n=i.splitLines(e);return{usernameFragment:(n=n.concat(i.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},i.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},i.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=i.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var o=n[r],s=i.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=i.parseRtpMap(s),c=i.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?i.parseFmtp(c[0]):{},a.rtcpFeedback=i.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(i.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return i.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(i.parseExtmap(e))}),t},i.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=i.writeRtpMap(e),n+=i.writeFmtp(e),n+=i.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=i.writeExtmap(e)}),n},i.parseRtpEncodingParameters=function(e){var t,n=[],r=i.parseRtpParameters(e),o=-1!==r.fecMechanisms.indexOf("RED"),s=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=i.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var d=i.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},i.parseRtcpParameters=function(e){var t={},n=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=i.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=r.length>0,t.compound=0===r.length;var o=i.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},i.parseMsid=function(e){var t,n=i.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=i.matchPrefix(e,"a=ssrc:").map(function(e){return i.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},i.generateSessionId=function(){return Math.random().toString().substr(2,21)},i.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||i.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},i.writeMediaSection=function(e,t,n,r){var o=i.writeRtpDescription(e.kind,t);if(o+=i.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=i.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+i.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+i.localCName+"\r\n"),o},i.getDirection=function(e,t){for(var n=i.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?i.getDirection(t):"sendrecv"},i.getKind=function(e){return i.splitLines(e)[0].split(" ")[0].substr(2)},i.isRejected=function(e){return"0"===e.split(" ",2)[1]},i.parseMLine=function(e){var t=i.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},i.parseOLine=function(e){var t=i.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},"object"===(void 0===t?"undefined":n(t))&&(t.exports=i)},{}],3:[function(e,t,n){(function(n){"use strict";var r=e("./adapter_factory.js");t.exports=r({window:n.window})}).call(this,void 0!==global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(e,t,n){"use strict";var r=e("./utils");t.exports=function(t,n){var i=t&&t.window,o={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);var a=r.log,c=r.detectBrowser(i),u=e("./chrome/chrome_shim")||null,d=e("./edge/edge_shim")||null,l=e("./firefox/firefox_shim")||null,f=e("./safari/safari_shim")||null,p=e("./common_shim")||null,h={browserDetails:c,commonShim:p,extractVersion:r.extractVersion,disableLog:r.disableLog,disableWarnings:r.disableWarnings};switch(c.browser){case"chrome":if(!u||!u.shimPeerConnection||!o.shimChrome)return a("Chrome shim is not included in this adapter release."),h;a("adapter.js shimming chrome."),h.browserShim=u,p.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimMediaStream(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimAddTrackRemoveTrack(i),u.shimGetSendersWithDtmf(i),u.shimSenderReceiverGetStats(i),p.shimRTCIceCandidate(i),p.shimMaxMessageSize(i),p.shimSendThrowTypeError(i);break;case"firefox":if(!l||!l.shimPeerConnection||!o.shimFirefox)return a("Firefox shim is not included in this adapter release."),h;a("adapter.js shimming firefox."),h.browserShim=l,p.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimSourceObject(i),l.shimPeerConnection(i),l.shimOnTrack(i),l.shimRemoveStream(i),l.shimSenderGetStats(i),l.shimReceiverGetStats(i),l.shimRTCDataChannel(i),p.shimRTCIceCandidate(i),p.shimMaxMessageSize(i),p.shimSendThrowTypeError(i);break;case"edge":if(!d||!d.shimPeerConnection||!o.shimEdge)return a("MS edge shim is not included in this adapter release."),h;a("adapter.js shimming edge."),h.browserShim=d,p.shimCreateObjectURL(i),d.shimGetUserMedia(i),d.shimPeerConnection(i),d.shimReplaceTrack(i),p.shimMaxMessageSize(i),p.shimSendThrowTypeError(i);break;case"safari":if(!f||!o.shimSafari)return a("Safari shim is not included in this adapter release."),h;a("adapter.js shimming safari."),h.browserShim=f,p.shimCreateObjectURL(i),f.shimRTCIceServerUrls(i),f.shimCallbacksAPI(i),f.shimLocalStreamsAPI(i),f.shimRemoteStreamsAPI(i),f.shimTrackEventTransceiver(i),f.shimGetUserMedia(i),f.shimCreateOfferLegacy(i),p.shimRTCIceCandidate(i),p.shimMaxMessageSize(i),p.shimSendThrowTypeError(i);break;default:a("Unsupported browser!")}return h}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(e,t,r){"use strict";var i=e("../utils.js"),o=i.log;function s(e,t,n){var r=n?"outbound-rtp":"inbound-rtp",i=new Map;if(null===t)return i;var o=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&o.push(e)}),o.forEach(function(t){e.forEach(function(n){n.type===r&&n.trackId===t.id&&function e(t,n,r){n&&!r.has(n.id)&&(r.set(n.id,n),Object.keys(n).forEach(function(i){i.endsWith("Id")?e(t,t.get(n[i]),r):i.endsWith("Ids")&&n[i].forEach(function(n){e(t,t.get(n),r)})}))}(e,n,i)})}),i}t.exports={shimGetUserMedia:e("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)"RTCRtpTransceiver"in e||i.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||(e.transceiver={receiver:e.receiver}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var n=this;return n._ontrackpoly||(n._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.track.id}):{track:r.track};var o=new Event("track");o.track=r.track,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)}),t.stream.getTracks().forEach(function(r){var i;i=e.RTCPeerConnection.prototype.getReceivers?n.getReceivers().find(function(e){return e.track&&e.track.id===r.id}):{track:r};var o=new Event("track");o.track=r,o.receiver=i,o.transceiver={receiver:i},o.streams=[t.stream],n.dispatchEvent(o)})},n.addEventListener("addstream",n._ontrackpoly)),t.apply(n,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var i=r.apply(this,arguments);return i||(i=t(this,e),this._senders.push(i)),i};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var o=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],o.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],s.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var a=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=a.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var o=e.RTCPeerConnection.prototype.getReceivers;o&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),i.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return s(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var a=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,r,i=arguments[0];return this.getSenders().forEach(function(e){e.track===i&&(t?r=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===i&&(n?r=!0:n=e),e.track===i}),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return a.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"===(void 0===e?"undefined":n(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var r=t.getSenders();n.apply(this,arguments);var i=t.getSenders().filter(function(e){return-1===r.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(i)};var r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var r=t._shimmedLocalStreams[n].indexOf(e);-1!==r&&t._shimmedLocalStreams[n].splice(r,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),i.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var t=i.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=n.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());n._streams[t.id]=i,n._reverseStreams[i.id]=t,t=i}r.apply(n,[t])};var o=e.RTCPeerConnection.prototype.removeStream;function s(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var r=this;if("closed"===r.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var i=[].slice.call(arguments,1);if(1!==i.length||!i[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(r.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");r._streams=r._streams||{},r._reverseStreams=r._reverseStreams||{};var o=r._streams[n.id];if(o)o.addTrack(t),Promise.resolve().then(function(){r.dispatchEvent(new Event("negotiationneeded"))});else{var s=new e.MediaStream([t]);r._streams[n.id]=s,r._reverseStreams[s.id]=n,r.addStream(s)}return r.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var r=s(e,n);t[0].apply(null,[r])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(t){return s(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var r=e._reverseStreams[t],i=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:s(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach(function(r){n._streams[r].getTracks().find(function(t){return e.track===t})&&(t=n._streams[r])}),t&&(1===t.getTracks().length?n.removeStream(n._reverseStreams[t.id]):t.removeTrack(e.track),n.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var t=i.detectBrowser(e);if(!e.RTCPeerConnection&&e.webkitRTCPeerConnection)e.RTCPeerConnection=function(t,n){return o("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,n)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});else{var r=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,n.push(s)):n.push(e.iceServers[o])}e.iceServers=n}return new r(e,t)},e.RTCPeerConnection.prototype=r.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return r.generateCertificate}})}var s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(arguments.length>0&&"function"==typeof e)return s.apply(this,arguments);if(0===s.length&&(0===arguments.length||"function"!=typeof arguments[0]))return s.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return s.apply(this,[function(e){i[1](a(o(e)))},arguments[0]])}return new Promise(function(e,t){s.apply(r,[function(t){e(a(o(t)))},t])}).then(t,n)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,r=new Promise(function(r,i){n.apply(t,[e[0],r,i])});return e.length<2?r:r.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var r=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===n(arguments[0])){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,i){r.apply(e,[n,i,t])})}return r.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}}},{"../utils.js":14,"./getusermedia":6}],6:[function(e,t,r){"use strict";var i=e("../utils.js"),o=i.log;t.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,s=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i="object"===n(e[r])?e[r]:{ideal:e[r]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var o=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var s={};"number"==typeof i.ideal?(s[o("min",r)]=i.ideal,t.optional.push(s),(s={})[o("max",r)]=i.ideal,t.optional.push(s)):(s[o("",r)]=i.ideal,t.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[o("",r)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[o(e,r)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},a=function(e,i){if(t.version>=61)return i(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===n(e.audio)){var a=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};a((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),a(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===n(e.video)){var c=e.video.facingMode;c=c&&("object"===(void 0===c?"undefined":n(c))?c:{ideal:c});var u,d=t.version<66;if(c&&("user"===c.exact||"environment"===c.exact||"user"===c.ideal||"environment"===c.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||d))if(delete e.video.facingMode,"environment"===c.exact||"environment"===c.ideal?u=["back","rear"]:"user"!==c.exact&&"user"!==c.ideal||(u=["front"]),u)return r.mediaDevices.enumerateDevices().then(function(t){var n=(t=t.filter(function(e){return"videoinput"===e.kind})).find(function(e){return u.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!n&&t.length&&-1!==u.indexOf("back")&&(n=t[t.length-1]),n&&(e.video.deviceId=c.exact?{exact:n.deviceId}:{ideal:n.deviceId}),e.video=s(e.video),o("chrome: "+JSON.stringify(e)),i(e)});e.video=s(e.video)}return o("chrome: "+JSON.stringify(e)),i(e)},c=function(e){return{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){a(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(c(e))})})};var u=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:u,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return a(e,function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(c(e))})})}}else r.mediaDevices.getUserMedia=function(e){return u(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){o("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){o("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(e,t,r){"use strict";var i=e("sdp"),o=e("./utils");t.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":n(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var r=new t(e),o=i.parseCandidate(e.candidate),s=Object.assign(r,o);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,o.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===(void 0===e?"undefined":n(e))&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var r=t.createObjectURL.bind(t),i=t.revokeObjectURL.bind(t),s=new Map,a=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++a;return s.set(t,e),o.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return r(e)},t.revokeObjectURL=function(e){i(e),s.delete(e)};var c=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return c.get.apply(this)},set:function(e){return this.srcObject=s.get(e)||null,c.set.apply(this,[e])}});var u=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=s.get(arguments[1])||null),u.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var t=o.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,r,o,s;if(this._sctp=null,o=arguments[0],(s=i.splitSections(o.sdp)).shift(),s.some(function(e){var t=i.parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")})){var a,c=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),u=(e=c,r=65536,"firefox"===t.browser&&(r=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),r),d=function(e,n){var r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);var o=i.matchPrefix(e.sdp,"a=max-message-size:");return o.length>0?r=parseInt(o[0].substr(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],c);a=0===u&&0===d?Number.POSITIVE_INFINITY:0===u||0===d?Math.max(u,d):Math.min(u,d);var l={};Object.defineProperty(l,"maxMessageSize",{get:function(){return a}}),this._sctp=l}return n.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return n(e,this),e},o.wrapPeerConnectionEvent(e,"datachannel",function(e){return n(e.channel,e.target),e})}function n(e,t){var n=e.send;e.send=function(){var r=arguments[0],i=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&i>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}}},{"./utils":14,sdp:2}],8:[function(e,t,n){"use strict";var r=e("../utils"),i=e("./filtericeservers"),o=e("rtcpeerconnection-shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(e){var t=r.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var n=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var s=o(e,t.version);e.RTCPeerConnection=function(e){return e.iceServers&&(e.iceServers=i(e.iceServers)),new s(e)},e.RTCPeerConnection.prototype=s.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(e,t,n){"use strict";var r=e("../utils");t.exports=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&r.deprecated("RTCIceServer.url","RTCIceServer.urls");var o="string"==typeof i;return o&&(i=[i]),i=i.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!n?(n=!0,!0):0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=o?i[0]:i,!!i.length}})}},{"../utils":14}],10:[function(e,t,n){"use strict";t.exports=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(e,t,r){"use strict";var i=e("../utils");t.exports={shimGetUserMedia:e("./getusermedia"),shimOnTrack:function(e){"object"!==(void 0===e?"undefined":n(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}}),"object"===(void 0===e?"undefined":n(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===(void 0===e?"undefined":n(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=i.detectBrowser(e);if("object"===(void 0===e?"undefined":n(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(n,r){if(t.version<38&&n&&n.iceServers){for(var i=[],o=0;o<n.iceServers.length;o++){var s=n.iceServers[o];if(s.hasOwnProperty("urls"))for(var a=0;a<s.urls.length;a++){var c={url:s.urls[a]};0===s.urls[a].indexOf("turn")&&(c.username=s.username,c.credential=s.credential),i.push(c)}else i.push(n.iceServers[o])}n.iceServers=i}return new e.mozRTCPeerConnection(n,r)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,n,r){return s.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)),t.version<53&&!n)try{e.forEach(function(e){e.type=o[e.type]||e.type})}catch(r){if("TypeError"!==r.name)throw r;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:o[t.type]||t.type}))})}return e}).then(n,r)}}},shimSenderGetStats:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n}),i.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;i.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(n){n.track&&-1!==e.getTracks().indexOf(n.track)&&t.removeTrack(n)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}}},{"../utils":14,"./getusermedia":12}],12:[function(e,t,r){"use strict";var i=e("../utils"),o=i.log;t.exports=function(e){var t=i.detectBrowser(e),r=e&&e.navigator,s=e&&e.MediaStreamTrack,a=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},c=function(e,i,s){var c=function(e){if("object"!==(void 0===e?"undefined":n(e))||e.require)return e;var t=[];return Object.keys(e).forEach(function(r){if("require"!==r&&"advanced"!==r&&"mediaSource"!==r){var i=e[r]="object"===n(e[r])?e[r]:{ideal:e[r]};if(void 0===i.min&&void 0===i.max&&void 0===i.exact||t.push(r),void 0!==i.exact&&("number"==typeof i.exact?i.min=i.max=i.exact:e[r]=i.exact,delete i.exact),void 0!==i.ideal){e.advanced=e.advanced||[];var o={};"number"==typeof i.ideal?o[r]={min:i.ideal,max:i.ideal}:o[r]=i.ideal,e.advanced.push(o),delete i.ideal,Object.keys(i).length||delete e[r]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=c(e.audio)),e.video&&(e.video=c(e.video)),o("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,i,function(e){s(a(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){c(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var u=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return u().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var d=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return d(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(a(e))})}}if(!(t.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var l=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},f=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":n(e))&&"object"===n(e.audio)&&(e=JSON.parse(JSON.stringify(e)),l(e.audio,"autoGainControl","mozAutoGainControl"),l(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},s&&s.prototype.getSettings){var p=s.prototype.getSettings;s.prototype.getSettings=function(){var e=p.apply(this,arguments);return l(e,"mozAutoGainControl","autoGainControl"),l(e,"mozNoiseSuppression","noiseSuppression"),e}}if(s&&s.prototype.applyConstraints){var h=s.prototype.applyConstraints;s.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":n(e))&&(e=JSON.parse(JSON.stringify(e)),l(e,"autoGainControl","mozAutoGainControl"),l(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}r.getUserMedia=function(e,n,o){if(t.version<44)return c(e,n,o);i.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(n,o)}}},{"../utils":14}],13:[function(e,t,r){"use strict";var i=e("../utils");t.exports={shimLocalStreamsAPI:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(r){t.call(n,r,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,r=e.getTracks();this.getSenders().forEach(function(e){-1!==r.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){var t=this;this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){e.streams.forEach(function(e){if(t._remoteStreams||(t._remoteStreams=[]),!(t._remoteStreams.indexOf(e)>=0)){t._remoteStreams.push(e);var n=new Event("addstream");n.stream=e,t.dispatchEvent(n)}})})}}))},shimCallbacksAPI:function(e){if("object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,r=t.createOffer,i=t.createAnswer,o=t.setLocalDescription,s=t.setRemoteDescription,a=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],i=r.apply(this,[n]);return t?(i.then(e,t),Promise.resolve()):i},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var c=function(e,t,n){var r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=c,c=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=c,c=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=c}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){for(var r=[],o=0;o<e.iceServers.length;o++){var s=e.iceServers[o];!s.hasOwnProperty("urls")&&s.hasOwnProperty("url")?(i.deprecated("RTCIceServer.url","RTCIceServer.urls"),(s=JSON.parse(JSON.stringify(s))).urls=s.url,delete s.url,r.push(s)):r.push(e.iceServers[o])}e.iceServers=r}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===(void 0===e?"undefined":n(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var r=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&r?"sendrecv"===r.direction?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":"recvonly"===r.direction&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):!0!==e.offerToReceiveAudio||r||n.addTransceiver("audio"),void 0!==e.offerToReceiveAudio&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var i=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&i?"sendrecv"===i.direction?i.setDirection("sendonly"):"recvonly"===i.direction&&i.setDirection("inactive"):!0!==e.offerToReceiveVideo||i||n.addTransceiver("video")}return t.apply(n,arguments)}}}},{"../utils":14}],14:[function(e,t,r){"use strict";var i=!0,o=!0;function s(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}t.exports={extractVersion:s,wrapPeerConnectionEvent:function(e,t,n){if(e.RTCPeerConnection){var r=e.RTCPeerConnection.prototype,i=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return i.apply(this,arguments);var o=function(e){r(n(e))};return this._eventMap=this._eventMap||{},this._eventMap[r]=o,i.apply(this,[e,o])};var o=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return o.apply(this,arguments);var r=this._eventMap[n];return delete this._eventMap[n],o.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(i=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":n(e))+". Please use a boolean."):(o=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===("undefined"==typeof window?"undefined":n(window))){if(i)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){o&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=s(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)n.browser="chrome",n.version=s(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=s(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=s(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}}},{}]},{},[3])(3)})},,,function(e,t,n){n(7)(n(8)),e.exports=window.Zepto},function(e,t){e.exports=function(e){function t(e){"undefined"!=typeof console&&(console.error||console.log)("[Script Loader]",e)}try{"undefined"!=typeof execScript&&"undefined"!=typeof attachEvent&&"undefined"==typeof addEventListener?execScript(e):"undefined"!=typeof eval?eval.call(null,e):t("EvalError: No eval function available")}catch(n){t(n)}}},function(e,t){e.exports="/* Zepto v1.2.0 - zepto event ajax form ie - zeptojs.com/license */\n(function(global, factory) {\n  if (typeof define === 'function' && define.amd)\n    define(function() { return factory(global) })\n  else\n    factory(global)\n}(this, function(window) {\n  var Zepto = (function() {\n  var undefined, key, $, classList, emptyArray = [], concat = emptyArray.concat, filter = emptyArray.filter, slice = emptyArray.slice,\n    document = window.document,\n    elementDisplay = {}, classCache = {},\n    cssNumber = { 'column-count': 1, 'columns': 1, 'font-weight': 1, 'line-height': 1,'opacity': 1, 'z-index': 1, 'zoom': 1 },\n    fragmentRE = /^\\s*<(\\w+|!)[^>]*>/,\n    singleTagRE = /^<(\\w+)\\s*\\/?>(?:<\\/\\1>|)$/,\n    tagExpanderRE = /<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\\w:]+)[^>]*)\\/>/ig,\n    rootNodeRE = /^(?:body|html)$/i,\n    capitalRE = /([A-Z])/g,\n\n    // special attributes that should be get/set via method calls\n    methodAttributes = ['val', 'css', 'html', 'text', 'data', 'width', 'height', 'offset'],\n\n    adjacencyOperators = [ 'after', 'prepend', 'before', 'append' ],\n    table = document.createElement('table'),\n    tableRow = document.createElement('tr'),\n    containers = {\n      'tr': document.createElement('tbody'),\n      'tbody': table, 'thead': table, 'tfoot': table,\n      'td': tableRow, 'th': tableRow,\n      '*': document.createElement('div')\n    },\n    readyRE = /complete|loaded|interactive/,\n    simpleSelectorRE = /^[\\w-]*$/,\n    class2type = {},\n    toString = class2type.toString,\n    zepto = {},\n    camelize, uniq,\n    tempParent = document.createElement('div'),\n    propMap = {\n      'tabindex': 'tabIndex',\n      'readonly': 'readOnly',\n      'for': 'htmlFor',\n      'class': 'className',\n      'maxlength': 'maxLength',\n      'cellspacing': 'cellSpacing',\n      'cellpadding': 'cellPadding',\n      'rowspan': 'rowSpan',\n      'colspan': 'colSpan',\n      'usemap': 'useMap',\n      'frameborder': 'frameBorder',\n      'contenteditable': 'contentEditable'\n    },\n    isArray = Array.isArray ||\n      function(object){ return object instanceof Array }\n\n  zepto.matches = function(element, selector) {\n    if (!selector || !element || element.nodeType !== 1) return false\n    var matchesSelector = element.matches || element.webkitMatchesSelector ||\n                          element.mozMatchesSelector || element.oMatchesSelector ||\n                          element.matchesSelector\n    if (matchesSelector) return matchesSelector.call(element, selector)\n    // fall back to performing a selector:\n    var match, parent = element.parentNode, temp = !parent\n    if (temp) (parent = tempParent).appendChild(element)\n    match = ~zepto.qsa(parent, selector).indexOf(element)\n    temp && tempParent.removeChild(element)\n    return match\n  }\n\n  function type(obj) {\n    return obj == null ? String(obj) :\n      class2type[toString.call(obj)] || \"object\"\n  }\n\n  function isFunction(value) { return type(value) == \"function\" }\n  function isWindow(obj)     { return obj != null && obj == obj.window }\n  function isDocument(obj)   { return obj != null && obj.nodeType == obj.DOCUMENT_NODE }\n  function isObject(obj)     { return type(obj) == \"object\" }\n  function isPlainObject(obj) {\n    return isObject(obj) && !isWindow(obj) && Object.getPrototypeOf(obj) == Object.prototype\n  }\n\n  function likeArray(obj) {\n    var length = !!obj && 'length' in obj && obj.length,\n      type = $.type(obj)\n\n    return 'function' != type && !isWindow(obj) && (\n      'array' == type || length === 0 ||\n        (typeof length == 'number' && length > 0 && (length - 1) in obj)\n    )\n  }\n\n  function compact(array) { return filter.call(array, function(item){ return item != null }) }\n  function flatten(array) { return array.length > 0 ? $.fn.concat.apply([], array) : array }\n  camelize = function(str){ return str.replace(/-+(.)?/g, function(match, chr){ return chr ? chr.toUpperCase() : '' }) }\n  function dasherize(str) {\n    return str.replace(/::/g, '/')\n           .replace(/([A-Z]+)([A-Z][a-z])/g, '$1_$2')\n           .replace(/([a-z\\d])([A-Z])/g, '$1_$2')\n           .replace(/_/g, '-')\n           .toLowerCase()\n  }\n  uniq = function(array){ return filter.call(array, function(item, idx){ return array.indexOf(item) == idx }) }\n\n  function classRE(name) {\n    return name in classCache ?\n      classCache[name] : (classCache[name] = new RegExp('(^|\\\\s)' + name + '(\\\\s|$)'))\n  }\n\n  function maybeAddPx(name, value) {\n    return (typeof value == \"number\" && !cssNumber[dasherize(name)]) ? value + \"px\" : value\n  }\n\n  function defaultDisplay(nodeName) {\n    var element, display\n    if (!elementDisplay[nodeName]) {\n      element = document.createElement(nodeName)\n      document.body.appendChild(element)\n      display = getComputedStyle(element, '').getPropertyValue(\"display\")\n      element.parentNode.removeChild(element)\n      display == \"none\" && (display = \"block\")\n      elementDisplay[nodeName] = display\n    }\n    return elementDisplay[nodeName]\n  }\n\n  function children(element) {\n    return 'children' in element ?\n      slice.call(element.children) :\n      $.map(element.childNodes, function(node){ if (node.nodeType == 1) return node })\n  }\n\n  function Z(dom, selector) {\n    var i, len = dom ? dom.length : 0\n    for (i = 0; i < len; i++) this[i] = dom[i]\n    this.length = len\n    this.selector = selector || ''\n  }\n\n  // `$.zepto.fragment` takes a html string and an optional tag name\n  // to generate DOM nodes from the given html string.\n  // The generated DOM nodes are returned as an array.\n  // This function can be overridden in plugins for example to make\n  // it compatible with browsers that don't support the DOM fully.\n  zepto.fragment = function(html, name, properties) {\n    var dom, nodes, container\n\n    // A special case optimization for a single tag\n    if (singleTagRE.test(html)) dom = $(document.createElement(RegExp.$1))\n\n    if (!dom) {\n      if (html.replace) html = html.replace(tagExpanderRE, \"<$1></$2>\")\n      if (name === undefined) name = fragmentRE.test(html) && RegExp.$1\n      if (!(name in containers)) name = '*'\n\n      container = containers[name]\n      container.innerHTML = '' + html\n      dom = $.each(slice.call(container.childNodes), function(){\n        container.removeChild(this)\n      })\n    }\n\n    if (isPlainObject(properties)) {\n      nodes = $(dom)\n      $.each(properties, function(key, value) {\n        if (methodAttributes.indexOf(key) > -1) nodes[key](value)\n        else nodes.attr(key, value)\n      })\n    }\n\n    return dom\n  }\n\n  // `$.zepto.Z` swaps out the prototype of the given `dom` array\n  // of nodes with `$.fn` and thus supplying all the Zepto functions\n  // to the array. This method can be overridden in plugins.\n  zepto.Z = function(dom, selector) {\n    return new Z(dom, selector)\n  }\n\n  // `$.zepto.isZ` should return `true` if the given object is a Zepto\n  // collection. This method can be overridden in plugins.\n  zepto.isZ = function(object) {\n    return object instanceof zepto.Z\n  }\n\n  // `$.zepto.init` is Zepto's counterpart to jQuery's `$.fn.init` and\n  // takes a CSS selector and an optional context (and handles various\n  // special cases).\n  // This method can be overridden in plugins.\n  zepto.init = function(selector, context) {\n    var dom\n    // If nothing given, return an empty Zepto collection\n    if (!selector) return zepto.Z()\n    // Optimize for string selectors\n    else if (typeof selector == 'string') {\n      selector = selector.trim()\n      // If it's a html fragment, create nodes from it\n      // Note: In both Chrome 21 and Firefox 15, DOM error 12\n      // is thrown if the fragment doesn't begin with <\n      if (selector[0] == '<' && fragmentRE.test(selector))\n        dom = zepto.fragment(selector, RegExp.$1, context), selector = null\n      // If there's a context, create a collection on that context first, and select\n      // nodes from there\n      else if (context !== undefined) return $(context).find(selector)\n      // If it's a CSS selector, use it to select nodes.\n      else dom = zepto.qsa(document, selector)\n    }\n    // If a function is given, call it when the DOM is ready\n    else if (isFunction(selector)) return $(document).ready(selector)\n    // If a Zepto collection is given, just return it\n    else if (zepto.isZ(selector)) return selector\n    else {\n      // normalize array if an array of nodes is given\n      if (isArray(selector)) dom = compact(selector)\n      // Wrap DOM nodes.\n      else if (isObject(selector))\n        dom = [selector], selector = null\n      // If it's a html fragment, create nodes from it\n      else if (fragmentRE.test(selector))\n        dom = zepto.fragment(selector.trim(), RegExp.$1, context), selector = null\n      // If there's a context, create a collection on that context first, and select\n      // nodes from there\n      else if (context !== undefined) return $(context).find(selector)\n      // And last but no least, if it's a CSS selector, use it to select nodes.\n      else dom = zepto.qsa(document, selector)\n    }\n    // create a new Zepto collection from the nodes found\n    return zepto.Z(dom, selector)\n  }\n\n  // `$` will be the base `Zepto` object. When calling this\n  // function just call `$.zepto.init, which makes the implementation\n  // details of selecting nodes and creating Zepto collections\n  // patchable in plugins.\n  $ = function(selector, context){\n    return zepto.init(selector, context)\n  }\n\n  function extend(target, source, deep) {\n    for (key in source)\n      if (deep && (isPlainObject(source[key]) || isArray(source[key]))) {\n        if (isPlainObject(source[key]) && !isPlainObject(target[key]))\n          target[key] = {}\n        if (isArray(source[key]) && !isArray(target[key]))\n          target[key] = []\n        extend(target[key], source[key], deep)\n      }\n      else if (source[key] !== undefined) target[key] = source[key]\n  }\n\n  // Copy all but undefined properties from one or more\n  // objects to the `target` object.\n  $.extend = function(target){\n    var deep, args = slice.call(arguments, 1)\n    if (typeof target == 'boolean') {\n      deep = target\n      target = args.shift()\n    }\n    args.forEach(function(arg){ extend(target, arg, deep) })\n    return target\n  }\n\n  // `$.zepto.qsa` is Zepto's CSS selector implementation which\n  // uses `document.querySelectorAll` and optimizes for some special cases, like `#id`.\n  // This method can be overridden in plugins.\n  zepto.qsa = function(element, selector){\n    var found,\n        maybeID = selector[0] == '#',\n        maybeClass = !maybeID && selector[0] == '.',\n        nameOnly = maybeID || maybeClass ? selector.slice(1) : selector, // Ensure that a 1 char tag name still gets checked\n        isSimple = simpleSelectorRE.test(nameOnly)\n    return (element.getElementById && isSimple && maybeID) ? // Safari DocumentFragment doesn't have getElementById\n      ( (found = element.getElementById(nameOnly)) ? [found] : [] ) :\n      (element.nodeType !== 1 && element.nodeType !== 9 && element.nodeType !== 11) ? [] :\n      slice.call(\n        isSimple && !maybeID && element.getElementsByClassName ? // DocumentFragment doesn't have getElementsByClassName/TagName\n          maybeClass ? element.getElementsByClassName(nameOnly) : // If it's simple, it could be a class\n          element.getElementsByTagName(selector) : // Or a tag\n          element.querySelectorAll(selector) // Or it's not simple, and we need to query all\n      )\n  }\n\n  function filtered(nodes, selector) {\n    return selector == null ? $(nodes) : $(nodes).filter(selector)\n  }\n\n  $.contains = document.documentElement.contains ?\n    function(parent, node) {\n      return parent !== node && parent.contains(node)\n    } :\n    function(parent, node) {\n      while (node && (node = node.parentNode))\n        if (node === parent) return true\n      return false\n    }\n\n  function funcArg(context, arg, idx, payload) {\n    return isFunction(arg) ? arg.call(context, idx, payload) : arg\n  }\n\n  function setAttribute(node, name, value) {\n    value == null ? node.removeAttribute(name) : node.setAttribute(name, value)\n  }\n\n  // access className property while respecting SVGAnimatedString\n  function className(node, value){\n    var klass = node.className || '',\n        svg   = klass && klass.baseVal !== undefined\n\n    if (value === undefined) return svg ? klass.baseVal : klass\n    svg ? (klass.baseVal = value) : (node.className = value)\n  }\n\n  // \"true\"  => true\n  // \"false\" => false\n  // \"null\"  => null\n  // \"42\"    => 42\n  // \"42.5\"  => 42.5\n  // \"08\"    => \"08\"\n  // JSON    => parse if valid\n  // String  => self\n  function deserializeValue(value) {\n    try {\n      return value ?\n        value == \"true\" ||\n        ( value == \"false\" ? false :\n          value == \"null\" ? null :\n          +value + \"\" == value ? +value :\n          /^[\\[\\{]/.test(value) ? $.parseJSON(value) :\n          value )\n        : value\n    } catch(e) {\n      return value\n    }\n  }\n\n  $.type = type\n  $.isFunction = isFunction\n  $.isWindow = isWindow\n  $.isArray = isArray\n  $.isPlainObject = isPlainObject\n\n  $.isEmptyObject = function(obj) {\n    var name\n    for (name in obj) return false\n    return true\n  }\n\n  $.isNumeric = function(val) {\n    var num = Number(val), type = typeof val\n    return val != null && type != 'boolean' &&\n      (type != 'string' || val.length) &&\n      !isNaN(num) && isFinite(num) || false\n  }\n\n  $.inArray = function(elem, array, i){\n    return emptyArray.indexOf.call(array, elem, i)\n  }\n\n  $.camelCase = camelize\n  $.trim = function(str) {\n    return str == null ? \"\" : String.prototype.trim.call(str)\n  }\n\n  // plugin compatibility\n  $.uuid = 0\n  $.support = { }\n  $.expr = { }\n  $.noop = function() {}\n\n  $.map = function(elements, callback){\n    var value, values = [], i, key\n    if (likeArray(elements))\n      for (i = 0; i < elements.length; i++) {\n        value = callback(elements[i], i)\n        if (value != null) values.push(value)\n      }\n    else\n      for (key in elements) {\n        value = callback(elements[key], key)\n        if (value != null) values.push(value)\n      }\n    return flatten(values)\n  }\n\n  $.each = function(elements, callback){\n    var i, key\n    if (likeArray(elements)) {\n      for (i = 0; i < elements.length; i++)\n        if (callback.call(elements[i], i, elements[i]) === false) return elements\n    } else {\n      for (key in elements)\n        if (callback.call(elements[key], key, elements[key]) === false) return elements\n    }\n\n    return elements\n  }\n\n  $.grep = function(elements, callback){\n    return filter.call(elements, callback)\n  }\n\n  if (window.JSON) $.parseJSON = JSON.parse\n\n  // Populate the class2type map\n  $.each(\"Boolean Number String Function Array Date RegExp Object Error\".split(\" \"), function(i, name) {\n    class2type[ \"[object \" + name + \"]\" ] = name.toLowerCase()\n  })\n\n  // Define methods that will be available on all\n  // Zepto collections\n  $.fn = {\n    constructor: zepto.Z,\n    length: 0,\n\n    // Because a collection acts like an array\n    // copy over these useful array functions.\n    forEach: emptyArray.forEach,\n    reduce: emptyArray.reduce,\n    push: emptyArray.push,\n    sort: emptyArray.sort,\n    splice: emptyArray.splice,\n    indexOf: emptyArray.indexOf,\n    concat: function(){\n      var i, value, args = []\n      for (i = 0; i < arguments.length; i++) {\n        value = arguments[i]\n        args[i] = zepto.isZ(value) ? value.toArray() : value\n      }\n      return concat.apply(zepto.isZ(this) ? this.toArray() : this, args)\n    },\n\n    // `map` and `slice` in the jQuery API work differently\n    // from their array counterparts\n    map: function(fn){\n      return $($.map(this, function(el, i){ return fn.call(el, i, el) }))\n    },\n    slice: function(){\n      return $(slice.apply(this, arguments))\n    },\n\n    ready: function(callback){\n      // need to check if document.body exists for IE as that browser reports\n      // document ready when it hasn't yet created the body element\n      if (readyRE.test(document.readyState) && document.body) callback($)\n      else document.addEventListener('DOMContentLoaded', function(){ callback($) }, false)\n      return this\n    },\n    get: function(idx){\n      return idx === undefined ? slice.call(this) : this[idx >= 0 ? idx : idx + this.length]\n    },\n    toArray: function(){ return this.get() },\n    size: function(){\n      return this.length\n    },\n    remove: function(){\n      return this.each(function(){\n        if (this.parentNode != null)\n          this.parentNode.removeChild(this)\n      })\n    },\n    each: function(callback){\n      emptyArray.every.call(this, function(el, idx){\n        return callback.call(el, idx, el) !== false\n      })\n      return this\n    },\n    filter: function(selector){\n      if (isFunction(selector)) return this.not(this.not(selector))\n      return $(filter.call(this, function(element){\n        return zepto.matches(element, selector)\n      }))\n    },\n    add: function(selector,context){\n      return $(uniq(this.concat($(selector,context))))\n    },\n    is: function(selector){\n      return this.length > 0 && zepto.matches(this[0], selector)\n    },\n    not: function(selector){\n      var nodes=[]\n      if (isFunction(selector) && selector.call !== undefined)\n        this.each(function(idx){\n          if (!selector.call(this,idx)) nodes.push(this)\n        })\n      else {\n        var excludes = typeof selector == 'string' ? this.filter(selector) :\n          (likeArray(selector) && isFunction(selector.item)) ? slice.call(selector) : $(selector)\n        this.forEach(function(el){\n          if (excludes.indexOf(el) < 0) nodes.push(el)\n        })\n      }\n      return $(nodes)\n    },\n    has: function(selector){\n      return this.filter(function(){\n        return isObject(selector) ?\n          $.contains(this, selector) :\n          $(this).find(selector).size()\n      })\n    },\n    eq: function(idx){\n      return idx === -1 ? this.slice(idx) : this.slice(idx, + idx + 1)\n    },\n    first: function(){\n      var el = this[0]\n      return el && !isObject(el) ? el : $(el)\n    },\n    last: function(){\n      var el = this[this.length - 1]\n      return el && !isObject(el) ? el : $(el)\n    },\n    find: function(selector){\n      var result, $this = this\n      if (!selector) result = $()\n      else if (typeof selector == 'object')\n        result = $(selector).filter(function(){\n          var node = this\n          return emptyArray.some.call($this, function(parent){\n            return $.contains(parent, node)\n          })\n        })\n      else if (this.length == 1) result = $(zepto.qsa(this[0], selector))\n      else result = this.map(function(){ return zepto.qsa(this, selector) })\n      return result\n    },\n    closest: function(selector, context){\n      var nodes = [], collection = typeof selector == 'object' && $(selector)\n      this.each(function(_, node){\n        while (node && !(collection ? collection.indexOf(node) >= 0 : zepto.matches(node, selector)))\n          node = node !== context && !isDocument(node) && node.parentNode\n        if (node && nodes.indexOf(node) < 0) nodes.push(node)\n      })\n      return $(nodes)\n    },\n    parents: function(selector){\n      var ancestors = [], nodes = this\n      while (nodes.length > 0)\n        nodes = $.map(nodes, function(node){\n          if ((node = node.parentNode) && !isDocument(node) && ancestors.indexOf(node) < 0) {\n            ancestors.push(node)\n            return node\n          }\n        })\n      return filtered(ancestors, selector)\n    },\n    parent: function(selector){\n      return filtered(uniq(this.pluck('parentNode')), selector)\n    },\n    children: function(selector){\n      return filtered(this.map(function(){ return children(this) }), selector)\n    },\n    contents: function() {\n      return this.map(function() { return this.contentDocument || slice.call(this.childNodes) })\n    },\n    siblings: function(selector){\n      return filtered(this.map(function(i, el){\n        return filter.call(children(el.parentNode), function(child){ return child!==el })\n      }), selector)\n    },\n    empty: function(){\n      return this.each(function(){ this.innerHTML = '' })\n    },\n    // `pluck` is borrowed from Prototype.js\n    pluck: function(property){\n      return $.map(this, function(el){ return el[property] })\n    },\n    show: function(){\n      return this.each(function(){\n        this.style.display == \"none\" && (this.style.display = '')\n        if (getComputedStyle(this, '').getPropertyValue(\"display\") == \"none\")\n          this.style.display = defaultDisplay(this.nodeName)\n      })\n    },\n    replaceWith: function(newContent){\n      return this.before(newContent).remove()\n    },\n    wrap: function(structure){\n      var func = isFunction(structure)\n      if (this[0] && !func)\n        var dom   = $(structure).get(0),\n            clone = dom.parentNode || this.length > 1\n\n      return this.each(function(index){\n        $(this).wrapAll(\n          func ? structure.call(this, index) :\n            clone ? dom.cloneNode(true) : dom\n        )\n      })\n    },\n    wrapAll: function(structure){\n      if (this[0]) {\n        $(this[0]).before(structure = $(structure))\n        var children\n        // drill down to the inmost element\n        while ((children = structure.children()).length) structure = children.first()\n        $(structure).append(this)\n      }\n      return this\n    },\n    wrapInner: function(structure){\n      var func = isFunction(structure)\n      return this.each(function(index){\n        var self = $(this), contents = self.contents(),\n            dom  = func ? structure.call(this, index) : structure\n        contents.length ? contents.wrapAll(dom) : self.append(dom)\n      })\n    },\n    unwrap: function(){\n      this.parent().each(function(){\n        $(this).replaceWith($(this).children())\n      })\n      return this\n    },\n    clone: function(){\n      return this.map(function(){ return this.cloneNode(true) })\n    },\n    hide: function(){\n      return this.css(\"display\", \"none\")\n    },\n    toggle: function(setting){\n      return this.each(function(){\n        var el = $(this)\n        ;(setting === undefined ? el.css(\"display\") == \"none\" : setting) ? el.show() : el.hide()\n      })\n    },\n    prev: function(selector){ return $(this.pluck('previousElementSibling')).filter(selector || '*') },\n    next: function(selector){ return $(this.pluck('nextElementSibling')).filter(selector || '*') },\n    html: function(html){\n      return 0 in arguments ?\n        this.each(function(idx){\n          var originHtml = this.innerHTML\n          $(this).empty().append( funcArg(this, html, idx, originHtml) )\n        }) :\n        (0 in this ? this[0].innerHTML : null)\n    },\n    text: function(text){\n      return 0 in arguments ?\n        this.each(function(idx){\n          var newText = funcArg(this, text, idx, this.textContent)\n          this.textContent = newText == null ? '' : ''+newText\n        }) :\n        (0 in this ? this.pluck('textContent').join(\"\") : null)\n    },\n    attr: function(name, value){\n      var result\n      return (typeof name == 'string' && !(1 in arguments)) ?\n        (0 in this && this[0].nodeType == 1 && (result = this[0].getAttribute(name)) != null ? result : undefined) :\n        this.each(function(idx){\n          if (this.nodeType !== 1) return\n          if (isObject(name)) for (key in name) setAttribute(this, key, name[key])\n          else setAttribute(this, name, funcArg(this, value, idx, this.getAttribute(name)))\n        })\n    },\n    removeAttr: function(name){\n      return this.each(function(){ this.nodeType === 1 && name.split(' ').forEach(function(attribute){\n        setAttribute(this, attribute)\n      }, this)})\n    },\n    prop: function(name, value){\n      name = propMap[name] || name\n      return (1 in arguments) ?\n        this.each(function(idx){\n          this[name] = funcArg(this, value, idx, this[name])\n        }) :\n        (this[0] && this[0][name])\n    },\n    removeProp: function(name){\n      name = propMap[name] || name\n      return this.each(function(){ delete this[name] })\n    },\n    data: function(name, value){\n      var attrName = 'data-' + name.replace(capitalRE, '-$1').toLowerCase()\n\n      var data = (1 in arguments) ?\n        this.attr(attrName, value) :\n        this.attr(attrName)\n\n      return data !== null ? deserializeValue(data) : undefined\n    },\n    val: function(value){\n      if (0 in arguments) {\n        if (value == null) value = \"\"\n        return this.each(function(idx){\n          this.value = funcArg(this, value, idx, this.value)\n        })\n      } else {\n        return this[0] && (this[0].multiple ?\n           $(this[0]).find('option').filter(function(){ return this.selected }).pluck('value') :\n           this[0].value)\n      }\n    },\n    offset: function(coordinates){\n      if (coordinates) return this.each(function(index){\n        var $this = $(this),\n            coords = funcArg(this, coordinates, index, $this.offset()),\n            parentOffset = $this.offsetParent().offset(),\n            props = {\n              top:  coords.top  - parentOffset.top,\n              left: coords.left - parentOffset.left\n            }\n\n        if ($this.css('position') == 'static') props['position'] = 'relative'\n        $this.css(props)\n      })\n      if (!this.length) return null\n      if (document.documentElement !== this[0] && !$.contains(document.documentElement, this[0]))\n        return {top: 0, left: 0}\n      var obj = this[0].getBoundingClientRect()\n      return {\n        left: obj.left + window.pageXOffset,\n        top: obj.top + window.pageYOffset,\n        width: Math.round(obj.width),\n        height: Math.round(obj.height)\n      }\n    },\n    css: function(property, value){\n      if (arguments.length < 2) {\n        var element = this[0]\n        if (typeof property == 'string') {\n          if (!element) return\n          return element.style[camelize(property)] || getComputedStyle(element, '').getPropertyValue(property)\n        } else if (isArray(property)) {\n          if (!element) return\n          var props = {}\n          var computedStyle = getComputedStyle(element, '')\n          $.each(property, function(_, prop){\n            props[prop] = (element.style[camelize(prop)] || computedStyle.getPropertyValue(prop))\n          })\n          return props\n        }\n      }\n\n      var css = ''\n      if (type(property) == 'string') {\n        if (!value && value !== 0)\n          this.each(function(){ this.style.removeProperty(dasherize(property)) })\n        else\n          css = dasherize(property) + \":\" + maybeAddPx(property, value)\n      } else {\n        for (key in property)\n          if (!property[key] && property[key] !== 0)\n            this.each(function(){ this.style.removeProperty(dasherize(key)) })\n          else\n            css += dasherize(key) + ':' + maybeAddPx(key, property[key]) + ';'\n      }\n\n      return this.each(function(){ this.style.cssText += ';' + css })\n    },\n    index: function(element){\n      return element ? this.indexOf($(element)[0]) : this.parent().children().indexOf(this[0])\n    },\n    hasClass: function(name){\n      if (!name) return false\n      return emptyArray.some.call(this, function(el){\n        return this.test(className(el))\n      }, classRE(name))\n    },\n    addClass: function(name){\n      if (!name) return this\n      return this.each(function(idx){\n        if (!('className' in this)) return\n        classList = []\n        var cls = className(this), newName = funcArg(this, name, idx, cls)\n        newName.split(/\\s+/g).forEach(function(klass){\n          if (!$(this).hasClass(klass)) classList.push(klass)\n        }, this)\n        classList.length && className(this, cls + (cls ? \" \" : \"\") + classList.join(\" \"))\n      })\n    },\n    removeClass: function(name){\n      return this.each(function(idx){\n        if (!('className' in this)) return\n        if (name === undefined) return className(this, '')\n        classList = className(this)\n        funcArg(this, name, idx, classList).split(/\\s+/g).forEach(function(klass){\n          classList = classList.replace(classRE(klass), \" \")\n        })\n        className(this, classList.trim())\n      })\n    },\n    toggleClass: function(name, when){\n      if (!name) return this\n      return this.each(function(idx){\n        var $this = $(this), names = funcArg(this, name, idx, className(this))\n        names.split(/\\s+/g).forEach(function(klass){\n          (when === undefined ? !$this.hasClass(klass) : when) ?\n            $this.addClass(klass) : $this.removeClass(klass)\n        })\n      })\n    },\n    scrollTop: function(value){\n      if (!this.length) return\n      var hasScrollTop = 'scrollTop' in this[0]\n      if (value === undefined) return hasScrollTop ? this[0].scrollTop : this[0].pageYOffset\n      return this.each(hasScrollTop ?\n        function(){ this.scrollTop = value } :\n        function(){ this.scrollTo(this.scrollX, value) })\n    },\n    scrollLeft: function(value){\n      if (!this.length) return\n      var hasScrollLeft = 'scrollLeft' in this[0]\n      if (value === undefined) return hasScrollLeft ? this[0].scrollLeft : this[0].pageXOffset\n      return this.each(hasScrollLeft ?\n        function(){ this.scrollLeft = value } :\n        function(){ this.scrollTo(value, this.scrollY) })\n    },\n    position: function() {\n      if (!this.length) return\n\n      var elem = this[0],\n        // Get *real* offsetParent\n        offsetParent = this.offsetParent(),\n        // Get correct offsets\n        offset       = this.offset(),\n        parentOffset = rootNodeRE.test(offsetParent[0].nodeName) ? { top: 0, left: 0 } : offsetParent.offset()\n\n      // Subtract element margins\n      // note: when an element has margin: auto the offsetLeft and marginLeft\n      // are the same in Safari causing offset.left to incorrectly be 0\n      offset.top  -= parseFloat( $(elem).css('margin-top') ) || 0\n      offset.left -= parseFloat( $(elem).css('margin-left') ) || 0\n\n      // Add offsetParent borders\n      parentOffset.top  += parseFloat( $(offsetParent[0]).css('border-top-width') ) || 0\n      parentOffset.left += parseFloat( $(offsetParent[0]).css('border-left-width') ) || 0\n\n      // Subtract the two offsets\n      return {\n        top:  offset.top  - parentOffset.top,\n        left: offset.left - parentOffset.left\n      }\n    },\n    offsetParent: function() {\n      return this.map(function(){\n        var parent = this.offsetParent || document.body\n        while (parent && !rootNodeRE.test(parent.nodeName) && $(parent).css(\"position\") == \"static\")\n          parent = parent.offsetParent\n        return parent\n      })\n    }\n  }\n\n  // for now\n  $.fn.detach = $.fn.remove\n\n  // Generate the `width` and `height` functions\n  ;['width', 'height'].forEach(function(dimension){\n    var dimensionProperty =\n      dimension.replace(/./, function(m){ return m[0].toUpperCase() })\n\n    $.fn[dimension] = function(value){\n      var offset, el = this[0]\n      if (value === undefined) return isWindow(el) ? el['inner' + dimensionProperty] :\n        isDocument(el) ? el.documentElement['scroll' + dimensionProperty] :\n        (offset = this.offset()) && offset[dimension]\n      else return this.each(function(idx){\n        el = $(this)\n        el.css(dimension, funcArg(this, value, idx, el[dimension]()))\n      })\n    }\n  })\n\n  function traverseNode(node, fun) {\n    fun(node)\n    for (var i = 0, len = node.childNodes.length; i < len; i++)\n      traverseNode(node.childNodes[i], fun)\n  }\n\n  // Generate the `after`, `prepend`, `before`, `append`,\n  // `insertAfter`, `insertBefore`, `appendTo`, and `prependTo` methods.\n  adjacencyOperators.forEach(function(operator, operatorIndex) {\n    var inside = operatorIndex % 2 //=> prepend, append\n\n    $.fn[operator] = function(){\n      // arguments can be nodes, arrays of nodes, Zepto objects and HTML strings\n      var argType, nodes = $.map(arguments, function(arg) {\n            var arr = []\n            argType = type(arg)\n            if (argType == \"array\") {\n              arg.forEach(function(el) {\n                if (el.nodeType !== undefined) return arr.push(el)\n                else if ($.zepto.isZ(el)) return arr = arr.concat(el.get())\n                arr = arr.concat(zepto.fragment(el))\n              })\n              return arr\n            }\n            return argType == \"object\" || arg == null ?\n              arg : zepto.fragment(arg)\n          }),\n          parent, copyByClone = this.length > 1\n      if (nodes.length < 1) return this\n\n      return this.each(function(_, target){\n        parent = inside ? target : target.parentNode\n\n        // convert all methods to a \"before\" operation\n        target = operatorIndex == 0 ? target.nextSibling :\n                 operatorIndex == 1 ? target.firstChild :\n                 operatorIndex == 2 ? target :\n                 null\n\n        var parentInDocument = $.contains(document.documentElement, parent)\n\n        nodes.forEach(function(node){\n          if (copyByClone) node = node.cloneNode(true)\n          else if (!parent) return $(node).remove()\n\n          parent.insertBefore(node, target)\n          if (parentInDocument) traverseNode(node, function(el){\n            if (el.nodeName != null && el.nodeName.toUpperCase() === 'SCRIPT' &&\n               (!el.type || el.type === 'text/javascript') && !el.src){\n              var target = el.ownerDocument ? el.ownerDocument.defaultView : window\n              target['eval'].call(target, el.innerHTML)\n            }\n          })\n        })\n      })\n    }\n\n    // after    => insertAfter\n    // prepend  => prependTo\n    // before   => insertBefore\n    // append   => appendTo\n    $.fn[inside ? operator+'To' : 'insert'+(operatorIndex ? 'Before' : 'After')] = function(html){\n      $(html)[operator](this)\n      return this\n    }\n  })\n\n  zepto.Z.prototype = Z.prototype = $.fn\n\n  // Export internal API functions in the `$.zepto` namespace\n  zepto.uniq = uniq\n  zepto.deserializeValue = deserializeValue\n  $.zepto = zepto\n\n  return $\n})()\n\nwindow.Zepto = Zepto\nwindow.$ === undefined && (window.$ = Zepto)\n\n;(function($){\n  var _zid = 1, undefined,\n      slice = Array.prototype.slice,\n      isFunction = $.isFunction,\n      isString = function(obj){ return typeof obj == 'string' },\n      handlers = {},\n      specialEvents={},\n      focusinSupported = 'onfocusin' in window,\n      focus = { focus: 'focusin', blur: 'focusout' },\n      hover = { mouseenter: 'mouseover', mouseleave: 'mouseout' }\n\n  specialEvents.click = specialEvents.mousedown = specialEvents.mouseup = specialEvents.mousemove = 'MouseEvents'\n\n  function zid(element) {\n    return element._zid || (element._zid = _zid++)\n  }\n  function findHandlers(element, event, fn, selector) {\n    event = parse(event)\n    if (event.ns) var matcher = matcherFor(event.ns)\n    return (handlers[zid(element)] || []).filter(function(handler) {\n      return handler\n        && (!event.e  || handler.e == event.e)\n        && (!event.ns || matcher.test(handler.ns))\n        && (!fn       || zid(handler.fn) === zid(fn))\n        && (!selector || handler.sel == selector)\n    })\n  }\n  function parse(event) {\n    var parts = ('' + event).split('.')\n    return {e: parts[0], ns: parts.slice(1).sort().join(' ')}\n  }\n  function matcherFor(ns) {\n    return new RegExp('(?:^| )' + ns.replace(' ', ' .* ?') + '(?: |$)')\n  }\n\n  function eventCapture(handler, captureSetting) {\n    return handler.del &&\n      (!focusinSupported && (handler.e in focus)) ||\n      !!captureSetting\n  }\n\n  function realEvent(type) {\n    return hover[type] || (focusinSupported && focus[type]) || type\n  }\n\n  function add(element, events, fn, data, selector, delegator, capture){\n    var id = zid(element), set = (handlers[id] || (handlers[id] = []))\n    events.split(/\\s/).forEach(function(event){\n      if (event == 'ready') return $(document).ready(fn)\n      var handler   = parse(event)\n      handler.fn    = fn\n      handler.sel   = selector\n      // emulate mouseenter, mouseleave\n      if (handler.e in hover) fn = function(e){\n        var related = e.relatedTarget\n        if (!related || (related !== this && !$.contains(this, related)))\n          return handler.fn.apply(this, arguments)\n      }\n      handler.del   = delegator\n      var callback  = delegator || fn\n      handler.proxy = function(e){\n        e = compatible(e)\n        if (e.isImmediatePropagationStopped()) return\n        e.data = data\n        var result = callback.apply(element, e._args == undefined ? [e] : [e].concat(e._args))\n        if (result === false) e.preventDefault(), e.stopPropagation()\n        return result\n      }\n      handler.i = set.length\n      set.push(handler)\n      if ('addEventListener' in element)\n        element.addEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))\n    })\n  }\n  function remove(element, events, fn, selector, capture){\n    var id = zid(element)\n    ;(events || '').split(/\\s/).forEach(function(event){\n      findHandlers(element, event, fn, selector).forEach(function(handler){\n        delete handlers[id][handler.i]\n      if ('removeEventListener' in element)\n        element.removeEventListener(realEvent(handler.e), handler.proxy, eventCapture(handler, capture))\n      })\n    })\n  }\n\n  $.event = { add: add, remove: remove }\n\n  $.proxy = function(fn, context) {\n    var args = (2 in arguments) && slice.call(arguments, 2)\n    if (isFunction(fn)) {\n      var proxyFn = function(){ return fn.apply(context, args ? args.concat(slice.call(arguments)) : arguments) }\n      proxyFn._zid = zid(fn)\n      return proxyFn\n    } else if (isString(context)) {\n      if (args) {\n        args.unshift(fn[context], fn)\n        return $.proxy.apply(null, args)\n      } else {\n        return $.proxy(fn[context], fn)\n      }\n    } else {\n      throw new TypeError(\"expected function\")\n    }\n  }\n\n  $.fn.bind = function(event, data, callback){\n    return this.on(event, data, callback)\n  }\n  $.fn.unbind = function(event, callback){\n    return this.off(event, callback)\n  }\n  $.fn.one = function(event, selector, data, callback){\n    return this.on(event, selector, data, callback, 1)\n  }\n\n  var returnTrue = function(){return true},\n      returnFalse = function(){return false},\n      ignoreProperties = /^([A-Z]|returnValue$|layer[XY]$|webkitMovement[XY]$)/,\n      eventMethods = {\n        preventDefault: 'isDefaultPrevented',\n        stopImmediatePropagation: 'isImmediatePropagationStopped',\n        stopPropagation: 'isPropagationStopped'\n      }\n\n  function compatible(event, source) {\n    if (source || !event.isDefaultPrevented) {\n      source || (source = event)\n\n      $.each(eventMethods, function(name, predicate) {\n        var sourceMethod = source[name]\n        event[name] = function(){\n          this[predicate] = returnTrue\n          return sourceMethod && sourceMethod.apply(source, arguments)\n        }\n        event[predicate] = returnFalse\n      })\n\n      event.timeStamp || (event.timeStamp = Date.now())\n\n      if (source.defaultPrevented !== undefined ? source.defaultPrevented :\n          'returnValue' in source ? source.returnValue === false :\n          source.getPreventDefault && source.getPreventDefault())\n        event.isDefaultPrevented = returnTrue\n    }\n    return event\n  }\n\n  function createProxy(event) {\n    var key, proxy = { originalEvent: event }\n    for (key in event)\n      if (!ignoreProperties.test(key) && event[key] !== undefined) proxy[key] = event[key]\n\n    return compatible(proxy, event)\n  }\n\n  $.fn.delegate = function(selector, event, callback){\n    return this.on(event, selector, callback)\n  }\n  $.fn.undelegate = function(selector, event, callback){\n    return this.off(event, selector, callback)\n  }\n\n  $.fn.live = function(event, callback){\n    $(document.body).delegate(this.selector, event, callback)\n    return this\n  }\n  $.fn.die = function(event, callback){\n    $(document.body).undelegate(this.selector, event, callback)\n    return this\n  }\n\n  $.fn.on = function(event, selector, data, callback, one){\n    var autoRemove, delegator, $this = this\n    if (event && !isString(event)) {\n      $.each(event, function(type, fn){\n        $this.on(type, selector, data, fn, one)\n      })\n      return $this\n    }\n\n    if (!isString(selector) && !isFunction(callback) && callback !== false)\n      callback = data, data = selector, selector = undefined\n    if (callback === undefined || data === false)\n      callback = data, data = undefined\n\n    if (callback === false) callback = returnFalse\n\n    return $this.each(function(_, element){\n      if (one) autoRemove = function(e){\n        remove(element, e.type, callback)\n        return callback.apply(this, arguments)\n      }\n\n      if (selector) delegator = function(e){\n        var evt, match = $(e.target).closest(selector, element).get(0)\n        if (match && match !== element) {\n          evt = $.extend(createProxy(e), {currentTarget: match, liveFired: element})\n          return (autoRemove || callback).apply(match, [evt].concat(slice.call(arguments, 1)))\n        }\n      }\n\n      add(element, event, callback, data, selector, delegator || autoRemove)\n    })\n  }\n  $.fn.off = function(event, selector, callback){\n    var $this = this\n    if (event && !isString(event)) {\n      $.each(event, function(type, fn){\n        $this.off(type, selector, fn)\n      })\n      return $this\n    }\n\n    if (!isString(selector) && !isFunction(callback) && callback !== false)\n      callback = selector, selector = undefined\n\n    if (callback === false) callback = returnFalse\n\n    return $this.each(function(){\n      remove(this, event, callback, selector)\n    })\n  }\n\n  $.fn.trigger = function(event, args){\n    event = (isString(event) || $.isPlainObject(event)) ? $.Event(event) : compatible(event)\n    event._args = args\n    return this.each(function(){\n      // handle focus(), blur() by calling them directly\n      if (event.type in focus && typeof this[event.type] == \"function\") this[event.type]()\n      // items in the collection might not be DOM elements\n      else if ('dispatchEvent' in this) this.dispatchEvent(event)\n      else $(this).triggerHandler(event, args)\n    })\n  }\n\n  // triggers event handlers on current element just as if an event occurred,\n  // doesn't trigger an actual event, doesn't bubble\n  $.fn.triggerHandler = function(event, args){\n    var e, result\n    this.each(function(i, element){\n      e = createProxy(isString(event) ? $.Event(event) : event)\n      e._args = args\n      e.target = element\n      $.each(findHandlers(element, event.type || event), function(i, handler){\n        result = handler.proxy(e)\n        if (e.isImmediatePropagationStopped()) return false\n      })\n    })\n    return result\n  }\n\n  // shortcut methods for `.bind(event, fn)` for each event type\n  ;('focusin focusout focus blur load resize scroll unload click dblclick '+\n  'mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave '+\n  'change select keydown keypress keyup error').split(' ').forEach(function(event) {\n    $.fn[event] = function(callback) {\n      return (0 in arguments) ?\n        this.bind(event, callback) :\n        this.trigger(event)\n    }\n  })\n\n  $.Event = function(type, props) {\n    if (!isString(type)) props = type, type = props.type\n    var event = document.createEvent(specialEvents[type] || 'Events'), bubbles = true\n    if (props) for (var name in props) (name == 'bubbles') ? (bubbles = !!props[name]) : (event[name] = props[name])\n    event.initEvent(type, bubbles, true)\n    return compatible(event)\n  }\n\n})(Zepto)\n\n;(function($){\n  var jsonpID = +new Date(),\n      document = window.document,\n      key,\n      name,\n      rscript = /<script\\b[^<]*(?:(?!<\\/script>)<[^<]*)*<\\/script>/gi,\n      scriptTypeRE = /^(?:text|application)\\/javascript/i,\n      xmlTypeRE = /^(?:text|application)\\/xml/i,\n      jsonType = 'application/json',\n      htmlType = 'text/html',\n      blankRE = /^\\s*$/,\n      originAnchor = document.createElement('a')\n\n  originAnchor.href = window.location.href\n\n  // trigger a custom event and return false if it was cancelled\n  function triggerAndReturn(context, eventName, data) {\n    var event = $.Event(eventName)\n    $(context).trigger(event, data)\n    return !event.isDefaultPrevented()\n  }\n\n  // trigger an Ajax \"global\" event\n  function triggerGlobal(settings, context, eventName, data) {\n    if (settings.global) return triggerAndReturn(context || document, eventName, data)\n  }\n\n  // Number of active Ajax requests\n  $.active = 0\n\n  function ajaxStart(settings) {\n    if (settings.global && $.active++ === 0) triggerGlobal(settings, null, 'ajaxStart')\n  }\n  function ajaxStop(settings) {\n    if (settings.global && !(--$.active)) triggerGlobal(settings, null, 'ajaxStop')\n  }\n\n  // triggers an extra global event \"ajaxBeforeSend\" that's like \"ajaxSend\" but cancelable\n  function ajaxBeforeSend(xhr, settings) {\n    var context = settings.context\n    if (settings.beforeSend.call(context, xhr, settings) === false ||\n        triggerGlobal(settings, context, 'ajaxBeforeSend', [xhr, settings]) === false)\n      return false\n\n    triggerGlobal(settings, context, 'ajaxSend', [xhr, settings])\n  }\n  function ajaxSuccess(data, xhr, settings, deferred) {\n    var context = settings.context, status = 'success'\n    settings.success.call(context, data, status, xhr)\n    if (deferred) deferred.resolveWith(context, [data, status, xhr])\n    triggerGlobal(settings, context, 'ajaxSuccess', [xhr, settings, data])\n    ajaxComplete(status, xhr, settings)\n  }\n  // type: \"timeout\", \"error\", \"abort\", \"parsererror\"\n  function ajaxError(error, type, xhr, settings, deferred) {\n    var context = settings.context\n    settings.error.call(context, xhr, type, error)\n    if (deferred) deferred.rejectWith(context, [xhr, type, error])\n    triggerGlobal(settings, context, 'ajaxError', [xhr, settings, error || type])\n    ajaxComplete(type, xhr, settings)\n  }\n  // status: \"success\", \"notmodified\", \"error\", \"timeout\", \"abort\", \"parsererror\"\n  function ajaxComplete(status, xhr, settings) {\n    var context = settings.context\n    settings.complete.call(context, xhr, status)\n    triggerGlobal(settings, context, 'ajaxComplete', [xhr, settings])\n    ajaxStop(settings)\n  }\n\n  function ajaxDataFilter(data, type, settings) {\n    if (settings.dataFilter == empty) return data\n    var context = settings.context\n    return settings.dataFilter.call(context, data, type)\n  }\n\n  // Empty function, used as default callback\n  function empty() {}\n\n  $.ajaxJSONP = function(options, deferred){\n    if (!('type' in options)) return $.ajax(options)\n\n    var _callbackName = options.jsonpCallback,\n      callbackName = ($.isFunction(_callbackName) ?\n        _callbackName() : _callbackName) || ('Zepto' + (jsonpID++)),\n      script = document.createElement('script'),\n      originalCallback = window[callbackName],\n      responseData,\n      abort = function(errorType) {\n        $(script).triggerHandler('error', errorType || 'abort')\n      },\n      xhr = { abort: abort }, abortTimeout\n\n    if (deferred) deferred.promise(xhr)\n\n    $(script).on('load error', function(e, errorType){\n      clearTimeout(abortTimeout)\n      $(script).off().remove()\n\n      if (e.type == 'error' || !responseData) {\n        ajaxError(null, errorType || 'error', xhr, options, deferred)\n      } else {\n        ajaxSuccess(responseData[0], xhr, options, deferred)\n      }\n\n      window[callbackName] = originalCallback\n      if (responseData && $.isFunction(originalCallback))\n        originalCallback(responseData[0])\n\n      originalCallback = responseData = undefined\n    })\n\n    if (ajaxBeforeSend(xhr, options) === false) {\n      abort('abort')\n      return xhr\n    }\n\n    window[callbackName] = function(){\n      responseData = arguments\n    }\n\n    script.src = options.url.replace(/\\?(.+)=\\?/, '?$1=' + callbackName)\n    document.head.appendChild(script)\n\n    if (options.timeout > 0) abortTimeout = setTimeout(function(){\n      abort('timeout')\n    }, options.timeout)\n\n    return xhr\n  }\n\n  $.ajaxSettings = {\n    // Default type of request\n    type: 'GET',\n    // Callback that is executed before request\n    beforeSend: empty,\n    // Callback that is executed if the request succeeds\n    success: empty,\n    // Callback that is executed the the server drops error\n    error: empty,\n    // Callback that is executed on request complete (both: error and success)\n    complete: empty,\n    // The context for the callbacks\n    context: null,\n    // Whether to trigger \"global\" Ajax events\n    global: true,\n    // Transport\n    xhr: function () {\n      return new window.XMLHttpRequest()\n    },\n    // MIME types mapping\n    // IIS returns Javascript as \"application/x-javascript\"\n    accepts: {\n      script: 'text/javascript, application/javascript, application/x-javascript',\n      json:   jsonType,\n      xml:    'application/xml, text/xml',\n      html:   htmlType,\n      text:   'text/plain'\n    },\n    // Whether the request is to another domain\n    crossDomain: false,\n    // Default timeout\n    timeout: 0,\n    // Whether data should be serialized to string\n    processData: true,\n    // Whether the browser should be allowed to cache GET responses\n    cache: true,\n    //Used to handle the raw response data of XMLHttpRequest.\n    //This is a pre-filtering function to sanitize the response.\n    //The sanitized response should be returned\n    dataFilter: empty\n  }\n\n  function mimeToDataType(mime) {\n    if (mime) mime = mime.split(';', 2)[0]\n    return mime && ( mime == htmlType ? 'html' :\n      mime == jsonType ? 'json' :\n      scriptTypeRE.test(mime) ? 'script' :\n      xmlTypeRE.test(mime) && 'xml' ) || 'text'\n  }\n\n  function appendQuery(url, query) {\n    if (query == '') return url\n    return (url + '&' + query).replace(/[&?]{1,2}/, '?')\n  }\n\n  // serialize payload and append it to the URL for GET requests\n  function serializeData(options) {\n    if (options.processData && options.data && $.type(options.data) != \"string\")\n      options.data = $.param(options.data, options.traditional)\n    if (options.data && (!options.type || options.type.toUpperCase() == 'GET' || 'jsonp' == options.dataType))\n      options.url = appendQuery(options.url, options.data), options.data = undefined\n  }\n\n  $.ajax = function(options){\n    var settings = $.extend({}, options || {}),\n        deferred = $.Deferred && $.Deferred(),\n        urlAnchor, hashIndex\n    for (key in $.ajaxSettings) if (settings[key] === undefined) settings[key] = $.ajaxSettings[key]\n\n    ajaxStart(settings)\n\n    if (!settings.crossDomain) {\n      urlAnchor = document.createElement('a')\n      urlAnchor.href = settings.url\n      // cleans up URL for .href (IE only), see https://github.com/madrobby/zepto/pull/1049\n      urlAnchor.href = urlAnchor.href\n      settings.crossDomain = (originAnchor.protocol + '//' + originAnchor.host) !== (urlAnchor.protocol + '//' + urlAnchor.host)\n    }\n\n    if (!settings.url) settings.url = window.location.toString()\n    if ((hashIndex = settings.url.indexOf('#')) > -1) settings.url = settings.url.slice(0, hashIndex)\n    serializeData(settings)\n\n    var dataType = settings.dataType, hasPlaceholder = /\\?.+=\\?/.test(settings.url)\n    if (hasPlaceholder) dataType = 'jsonp'\n\n    if (settings.cache === false || (\n         (!options || options.cache !== true) &&\n         ('script' == dataType || 'jsonp' == dataType)\n        ))\n      settings.url = appendQuery(settings.url, '_=' + Date.now())\n\n    if ('jsonp' == dataType) {\n      if (!hasPlaceholder)\n        settings.url = appendQuery(settings.url,\n          settings.jsonp ? (settings.jsonp + '=?') : settings.jsonp === false ? '' : 'callback=?')\n      return $.ajaxJSONP(settings, deferred)\n    }\n\n    var mime = settings.accepts[dataType],\n        headers = { },\n        setHeader = function(name, value) { headers[name.toLowerCase()] = [name, value] },\n        protocol = /^([\\w-]+:)\\/\\//.test(settings.url) ? RegExp.$1 : window.location.protocol,\n        xhr = settings.xhr(),\n        nativeSetHeader = xhr.setRequestHeader,\n        abortTimeout\n\n    if (deferred) deferred.promise(xhr)\n\n    if (!settings.crossDomain) setHeader('X-Requested-With', 'XMLHttpRequest')\n    setHeader('Accept', mime || '*/*')\n    if (mime = settings.mimeType || mime) {\n      if (mime.indexOf(',') > -1) mime = mime.split(',', 2)[0]\n      xhr.overrideMimeType && xhr.overrideMimeType(mime)\n    }\n    if (settings.contentType || (settings.contentType !== false && settings.data && settings.type.toUpperCase() != 'GET'))\n      setHeader('Content-Type', settings.contentType || 'application/x-www-form-urlencoded')\n\n    if (settings.headers) for (name in settings.headers) setHeader(name, settings.headers[name])\n    xhr.setRequestHeader = setHeader\n\n    xhr.onreadystatechange = function(){\n      if (xhr.readyState == 4) {\n        xhr.onreadystatechange = empty\n        clearTimeout(abortTimeout)\n        var result, error = false\n        if ((xhr.status >= 200 && xhr.status < 300) || xhr.status == 304 || (xhr.status == 0 && protocol == 'file:')) {\n          dataType = dataType || mimeToDataType(settings.mimeType || xhr.getResponseHeader('content-type'))\n\n          if (xhr.responseType == 'arraybuffer' || xhr.responseType == 'blob')\n            result = xhr.response\n          else {\n            result = xhr.responseText\n\n            try {\n              // http://perfectionkills.com/global-eval-what-are-the-options/\n              // sanitize response accordingly if data filter callback provided\n              result = ajaxDataFilter(result, dataType, settings)\n              if (dataType == 'script')    (1,eval)(result)\n              else if (dataType == 'xml')  result = xhr.responseXML\n              else if (dataType == 'json') result = blankRE.test(result) ? null : $.parseJSON(result)\n            } catch (e) { error = e }\n\n            if (error) return ajaxError(error, 'parsererror', xhr, settings, deferred)\n          }\n\n          ajaxSuccess(result, xhr, settings, deferred)\n        } else {\n          ajaxError(xhr.statusText || null, xhr.status ? 'error' : 'abort', xhr, settings, deferred)\n        }\n      }\n    }\n\n    if (ajaxBeforeSend(xhr, settings) === false) {\n      xhr.abort()\n      ajaxError(null, 'abort', xhr, settings, deferred)\n      return xhr\n    }\n\n    var async = 'async' in settings ? settings.async : true\n    xhr.open(settings.type, settings.url, async, settings.username, settings.password)\n\n    if (settings.xhrFields) for (name in settings.xhrFields) xhr[name] = settings.xhrFields[name]\n\n    for (name in headers) nativeSetHeader.apply(xhr, headers[name])\n\n    if (settings.timeout > 0) abortTimeout = setTimeout(function(){\n        xhr.onreadystatechange = empty\n        xhr.abort()\n        ajaxError(null, 'timeout', xhr, settings, deferred)\n      }, settings.timeout)\n\n    // avoid sending empty string (#319)\n    xhr.send(settings.data ? settings.data : null)\n    return xhr\n  }\n\n  // handle optional data/success arguments\n  function parseArguments(url, data, success, dataType) {\n    if ($.isFunction(data)) dataType = success, success = data, data = undefined\n    if (!$.isFunction(success)) dataType = success, success = undefined\n    return {\n      url: url\n    , data: data\n    , success: success\n    , dataType: dataType\n    }\n  }\n\n  $.get = function(/* url, data, success, dataType */){\n    return $.ajax(parseArguments.apply(null, arguments))\n  }\n\n  $.post = function(/* url, data, success, dataType */){\n    var options = parseArguments.apply(null, arguments)\n    options.type = 'POST'\n    return $.ajax(options)\n  }\n\n  $.getJSON = function(/* url, data, success */){\n    var options = parseArguments.apply(null, arguments)\n    options.dataType = 'json'\n    return $.ajax(options)\n  }\n\n  $.fn.load = function(url, data, success){\n    if (!this.length) return this\n    var self = this, parts = url.split(/\\s/), selector,\n        options = parseArguments(url, data, success),\n        callback = options.success\n    if (parts.length > 1) options.url = parts[0], selector = parts[1]\n    options.success = function(response){\n      self.html(selector ?\n        $('<div>').html(response.replace(rscript, \"\")).find(selector)\n        : response)\n      callback && callback.apply(self, arguments)\n    }\n    $.ajax(options)\n    return this\n  }\n\n  var escape = encodeURIComponent\n\n  function serialize(params, obj, traditional, scope){\n    var type, array = $.isArray(obj), hash = $.isPlainObject(obj)\n    $.each(obj, function(key, value) {\n      type = $.type(value)\n      if (scope) key = traditional ? scope :\n        scope + '[' + (hash || type == 'object' || type == 'array' ? key : '') + ']'\n      // handle data in serializeArray() format\n      if (!scope && array) params.add(value.name, value.value)\n      // recurse into nested objects\n      else if (type == \"array\" || (!traditional && type == \"object\"))\n        serialize(params, value, traditional, key)\n      else params.add(key, value)\n    })\n  }\n\n  $.param = function(obj, traditional){\n    var params = []\n    params.add = function(key, value) {\n      if ($.isFunction(value)) value = value()\n      if (value == null) value = \"\"\n      this.push(escape(key) + '=' + escape(value))\n    }\n    serialize(params, obj, traditional)\n    return params.join('&').replace(/%20/g, '+')\n  }\n})(Zepto)\n\n;(function($){\n  $.fn.serializeArray = function() {\n    var name, type, result = [],\n      add = function(value) {\n        if (value.forEach) return value.forEach(add)\n        result.push({ name: name, value: value })\n      }\n    if (this[0]) $.each(this[0].elements, function(_, field){\n      type = field.type, name = field.name\n      if (name && field.nodeName.toLowerCase() != 'fieldset' &&\n        !field.disabled && type != 'submit' && type != 'reset' && type != 'button' && type != 'file' &&\n        ((type != 'radio' && type != 'checkbox') || field.checked))\n          add($(field).val())\n    })\n    return result\n  }\n\n  $.fn.serialize = function(){\n    var result = []\n    this.serializeArray().forEach(function(elm){\n      result.push(encodeURIComponent(elm.name) + '=' + encodeURIComponent(elm.value))\n    })\n    return result.join('&')\n  }\n\n  $.fn.submit = function(callback) {\n    if (0 in arguments) this.bind('submit', callback)\n    else if (this.length) {\n      var event = $.Event('submit')\n      this.eq(0).trigger(event)\n      if (!event.isDefaultPrevented()) this.get(0).submit()\n    }\n    return this\n  }\n\n})(Zepto)\n\n;(function(){\n  // getComputedStyle shouldn't freak out when called\n  // without a valid element as argument\n  try {\n    getComputedStyle(undefined)\n  } catch(e) {\n    var nativeGetComputedStyle = getComputedStyle\n    window.getComputedStyle = function(element, pseudoElement){\n      try {\n        return nativeGetComputedStyle(element, pseudoElement)\n      } catch(e) {\n        return null\n      }\n    }\n  }\n})()\n  return Zepto\n}))\n"},,,,,function(e,t,n){e.exports=n(14)},function(e,t,n){var r,i=window.emedia=window.emedia||{},o=i.util=n(15),s=n(6);if(i.config=function(e){for(var t in e=o.extend({},e))i.config[t]=e[t],"logLevel"===t&&(i.LOG_LEVEL=e[t]);i.config.loglastConfrCount&&!i._logContext&&(i._logContext=new Array(i.config.loglastConfrCount),i._logContextIndex=-1)},i.config({autoSub:!0,onlyEnter:!1,reconnect:13,reconnectDelay:3e3,getCopyIntervalMillis:3e4,checkConnectIntervalMillis:1e3,iceRebuildCount:3,iceRebuildIntervalMillis:500,enterTimeout:2e4,useRTCCfgIfServerReturn:!1,forceUseRTCCfgIfServerReturnWhenP2P:!0,allowRepeatAudioMixerPublish:!1,getMediaMeterIntervalMillis:400,_useRequestAnimationFrame:!1,meterWithTrackAudioLevel:!1,judgeTalkingByInstantGE:.05,_printSoundData:!1,trackBufferSize:20,allowSendWhenLessThan:4,disableTrack:!1,ctrlCheckIntervalMillis:1e4,ctrlTimeoutMillis:3e4,_printDebugStats:!1,statsSeconds:3,loglastConfrCount:2,consoleLogger:!0}),o.logger.count(),r=n(2),i.browser=r.__browser,i.browserVersion=r.__browserVersion,o.logger.info("Current browser",i.browser,i.browserVersion),i.AudioContext=window.AudioContext||window.webkitAudioContext,i.config.getMediaMeterIntervalMillis){try{"function"==typeof i.AudioContext?(i.__audioContext=new i.AudioContext,i.__usingWebAudio=!0):i.__usingWebAudio=!1}catch(d){i.__usingWebAudio=!1}i.__usingWebAudio&&"suspended"===i.__audioContext.state&&s(function(){var e=function e(){"suspended"===i.__audioContext.state&&i.__audioContext.resume(),o.logger.warn("AudioContext state suspended ->",i.__audioContext.state),setTimeout(function(){"running"===i.__audioContext.state&&(document.body.removeEventListener("touchend",e,!1),document.body.removeEventListener("click",e,!1))},0)};document.body.addEventListener("touchend",e,!1),document.body.addEventListener("click",e,!1)}),i.__usingWebAudio||console.warn("'new AudioContext()' failed. can not know who talking."),i.__audioContext&&"suspended"===i.__audioContext.state&&console.warn("audioContext.state is suspended. can not know who talking. You can resume() emedia.__audioContext, but only in response to a tap.")}window.requestAnimationFrame&&i.config._useRequestAnimationFrame?i.requestAnimationFrame=function(e){window.requestAnimationFrame(e)}:i.requestAnimationFrame=function(e,t){return setTimeout(e,t||i.config.getMediaMeterIntervalMillis)},window.cancelAnimationFrame&&i.config._useRequestAnimationFrame?i.cancelAnimationFrame=function(e){window.cancelAnimationFrame(e)}:i.cancelAnimationFrame=function(e){clearTimeout(e)},i.stopAudioTracks=function(e){e&&e.getAudioTracks().forEach(function(e){e.stop()})},i.stopAndRemoveAudioTracks=function(e){var t=[];e&&e.getAudioTracks().forEach(function(e){e.stop(),t.push(e)}),o.forEach(t,function(t,n){e.removeTrack(n)})},i.stopTracks=function(e){try{if(!e||!1===e.active)return void o.logger.debug("stream tracks had been stoped. it ",e&&e.id);e.getTracks().forEach(function(e){e.stop()}),e._bindAttendee&&(o.removeAttribute(e._bindAttendee._openedRtcMediaStreams,e.id),e._bindAttendee=null),o.logger.info("stream tracks stoped. it ",e)}catch(d){o.logger.error(d)}},i.enableVideoTracks=function(e,t){e&&e.getVideoTracks().forEach(function(e){if("function"==typeof e.enable)return e.enable(),void(e.enabled===t||e.enable(t));e.enabled===t||(e.enabled=t)})},i.enableAudioTracks=function(e,t){e&&e.getAudioTracks().forEach(function(e){if("function"==typeof e.enable)return e.enable(),void(e.enabled===t||e.enable(t));e.enabled===t||(e.enabled=t)})},i.hasEnabledTracks=function(e){if(!e||"function"!=typeof e.getAudioTracks)return!1;if(!e.active)return!1;var t=e.getAudioTracks();if(0===t.length)return!1;for(var n in t)if("function"==typeof t[n].enable&&t[n].enable(),t[n].enabled)return!0;return!1},i.fileReport=function(){if(i._logContext&&i._logContext instanceof Array&&!(void 0===i._logContextIndex||i._logContextIndex<0)){var e=0,t=i._logContextIndex;i._logContextIndex>=i._logContext.length&&(e=i._logContextIndex-i._logContext.length+1);for(var n="",r=e;r<=t;r++){var o=r%i._logContext.length;n+=i._logContext[o].join("\r\n")+"\r\n"}i._logContext.loadlogs&&i._logContext.loadlogs instanceof Array&&(n+="-------------------------------------------------------------\r\n",n+=i._logContext.loadlogs.join("\r\n")+"\r\n");var s=encodeURIComponent(n),a=document.createElement("a");a.style.display="none",a.download="emedia-"+(new Date).toJSON()+".log",a.href="data:text/plain;charset=utf-8,"+s,document.body.appendChild(a),a.click(),a.parentNode.removeChild(a)}};var a=n(16),c=n(21);i.Webrtc=n(24),i.Service=a,i.P2P=n(33),i.XService=a,i.XServiceWithP2P=i.P2P(a),i.mgr=n(34).outer,i.ctrl=n(236),i.CompositeCanvas=n(242),i.pannel||(i.pannel={}),i.pannel.DefaultMouseTrack=n(30),i.pannel.MouseTrack=n(31),i.pannel.KeyboardTrack=n(243);var u=i.PCStats=n(244);if(i.helper=i.helper||{},i.helper.PCStats=u,i.helper.pcstats=u.echo,i.helper.intervalPcstats=u.intervalEcho,i.helper.inboundAudio=u.inboundAudio,i.helper.inboundVideo=u.inboundVideo,i.helper.outboundAudio=u.outboundAudio,i.helper.outboundVideo=u.outboundVideo,i.event=c,i.LOG_LEVEL=0,i.isFirefox="firefox"===i.browser,i.isChrome="chrome"===i.browser,i.isSafari="safari"===i.browser,i.isEdge="edge"===i.browser,i.isElectron=/Electron/.test(navigator.userAgent),i.isElectron)try{n(245)}catch(d){o.logger.error(d)}i.isWebRTC=window.RTCPeerConnection&&/^https\:$/.test(window.location.protocol),(i.isChrome||i.isSafari)&&(i.supportPRAnswer=!0),i.supportPRAnswer=!1,i.config({baseAcptOps:[102,104,105,106,107,300,302,303,304,301,204,206,400,401,1001,100201,100202,100203]}),i.config({clientType:"WEB",version:"2.1.1",userAgent:navigator.userAgent,acptOps:[100230,100205,1003,1004]}),e.exports=i},function(module,exports){var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},CHARS;function Util(){}CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),Math.uuid=function(e,t){var n,r,i=CHARS,o=[];if(t=t||i.length,e)for(n=0;n<e;n++)o[n]=i[0|Math.random()*t];else for(o[8]=o[13]=o[18]=o[23]="-",o[14]="4",n=0;n<36;n++)o[n]||(r=0|16*Math.random(),o[n]=i[19==n?3&r|8:r]);return o.join("")},Math.uuidFast=function(){for(var e,t=CHARS,n=new Array(36),r=0,i=0;i<36;i++)8==i||13==i||18==i||23==i?n[i]="-":14==i?n[i]="4":(r<=2&&(r=33554432+16777216*Math.random()|0),e=15&r,r>>=4,n[i]=t[19==i?3&e|8:e]);return n.join("")},Math.uuidCompact=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},String.prototype.startsWith||(String.prototype.startsWith=function(e,t){return t=t||0,this.indexOf(e,t)===t});var Logger=function(t){var n=this,r=0,i=1,o=2,s=3,a=4,c=5,u=["TRACE","DEBUG","INFO","WARN","ERROR","FATAL"];function d(r,i){try{!function(e,r){if(emedia&&emedia.LOG_LEVEL&&e<emedia.LOG_LEVEL)return;var i=[];i.push(e),t&&i.push(t);for(var o=0;o<r.length;o++)i.push(r[o]&&r[o]._toString?r[o]._toString.call(r[o]):r[o]);n._log.apply(n,i)}(r,i)}catch(e){if(console){if(console.error)return void console.error(e);if(console.log)return void console.log(e)}throw e}}this._log=function(){var t=arguments[0];t=arguments[0]=u[t],emedia._logContext&&function(){try{(function(){if(emedia._logContextIndex<0)return;if(!(emedia._logContext&&emedia._logContext instanceof Array))return;var e=emedia._logContextIndex%emedia._logContext.length,t=emedia._logContext[e];t&&t instanceof Array||(t=emedia._logContext[e]=[]);var n=[];n.push(emedia._logContextIndex);var r=new Date;r.toJSON?n.push(r.toJSON()):r.toISOString?n.push(r.toISOString()):n.push(r+"");for(var i=0;i<arguments.length;i++){var o=arguments[i];"string"!=typeof o?"string"!=typeof o.message?"function"!=typeof o.message?"string"!=typeof o.stack?o.event&&"function"==typeof o.event.toString?n.push(o.event.toString()):o.event&&"function"==typeof o.event.toString?n.push(o.event.toString()):"string"!=typeof o.candidate?"string"!=typeof o.sdp?o&&n.push(JSON.stringify(o)):n.push(o.sdp):n.push(o.candidate):n.push(o.stack):n.push(o.message()):n.push(o.message):n.push(o)}t.push(n.join(" "))}).apply(null,arguments)}catch(e){}}.apply(null,arguments),!0===emedia.config.consoleLogger&&(emedia&&emedia.isElectron?console.log.apply(console,arguments):console&&t&&(console[t.toLowerCase()]||console.warn).apply(console,arguments))},this.log=function(){this._log&&d(o,arguments)},this.trace=function(){this._log&&d(r,arguments)},this.debug=function(){this._log&&d(i,arguments)},this.info=function(){this._log&&d(o,arguments)},this.warn=function(){this._log&&d(s,arguments)},this.error=function(){this._log&&d(a,arguments)},this.fatal=function(){this._log&&d(c,arguments)}};Logger.prototype.count=function(){if(emedia._logContext){emedia._logContextIndex++;var e=emedia._logContextIndex%emedia._logContext.length;0===e&&0!==emedia._logContextIndex&&(emedia._logContext.loadlogs=emedia._logContext[e]),emedia._logContext[e]=[]}},Util.prototype.logger=new Logger,Util.prototype.tagLogger=function(e){return new Logger(e)},Util.prototype.parseJSON=function(e){return JSON.parse(e)};var stringifyJSON=Util.prototype.stringifyJSON=function(e){return JSON.stringify(e)},class2type={},toString=class2type.toString,hasOwn=class2type.hasOwnProperty,fnToString=hasOwn.toString,ObjectFunctionString=fnToString.call(Object),isPlainObject=Util.prototype.isPlainObject=function(e){var t,n;return!(!e||"[object Object]"!==toString.call(e)||"<JSAPI-Auto Javascript Object>"===e.toString()||"[object IFBComJavascriptObject]"===e.toString())&&(!(t=Object.getPrototypeOf(e))||"function"==typeof(n=hasOwn.call(t,"constructor")&&t.constructor)&&fnToString.call(n)===ObjectFunctionString)},e,n,engine;Util.prototype.isArray=Array.isArray,Util.prototype.isEmptyObject=function(e){var t;for(t in e)return!1;return!0},Util.prototype.type=function(e){return null==e?e+"":"object"===(void 0===e?"undefined":_typeof(e))||"function"==typeof e?class2type[toString.call(e)]||"object":void 0===e?"undefined":_typeof(e)},Util.prototype.extend=function(){var e,t,n,r,i,o,s=arguments[0]||{},a=1,c=arguments.length,u=!1;for("boolean"==typeof s&&(u=s,s=arguments[a]||{},a++),"object"===(void 0===s?"undefined":_typeof(s))||this.isFunction(s)||(s={}),a===c&&(s=this,a--);a<c;a++)if(null!=(e=arguments[a]))for(t in e)n=s[t],s!==(r=e[t])&&(u&&r&&(this.isPlainObject(r)||(i=this.isArray(r)))?(i?(i=!1,o=n&&this.isArray(n)?n:[]):o=n&&this.isPlainObject(n)?n:{},s[t]=this.extend(u,o,r)):void 0!==r&&(s[t]=r));return s},Util.prototype.removeAttribute=function(e,t){if(null!=e){var n=e[t];return delete e[t],n}},Util.prototype.prototypeExtend_000=Util.prototype.classExtend=function(){var e,t=this;function n(){for(var e=0;e<arguments.length;e++){var n=arguments[e]||{};t.extend(!0,this,n)}this.__init__&&this.__init__.apply(this,arguments)}for(var r=0;r<arguments.length;r++){var i=arguments[r]||{};"function"==typeof i?e?(i.constructor=e,i.__proto__=e.prototype):e=i:t.extend(!0,n.prototype,i)}return e&&(n.prototype.__proto__=e.prototype),e&&(n.prototype.constructor=e),n.extend||(n.extend=function(e){return t.prototypeExtend(n,e)}),n},Util.prototype.prototypeExtend=Util.prototype.classExtend=function(){var e=this;function t(){for(var t=0;t<arguments.length;t++){var n=arguments[t]||{};e.extend(!0,this,n)}this.__init__&&this.__init__.apply(this,arguments)}for(var n=0;n<arguments.length;n++){var r=arguments[n]||{};"function"==typeof r&&(r=r.prototype),e.extend(!0,t.prototype,r)}return t.extend||(t.extend=function(n){return e.prototypeExtend(t,n)}),t},Util.prototype.hasLocalStorage=function(e){return null!=localStorage.getItem(e)&&"{}"!=localStorage.getItem(e)},Util.prototype.toggleClass=function(e,t){e.hasClass(t)?e.removeClass(t):e.addClass(t)},Util.prototype.setCookie=function(e,t,n){var r=new Date;r.setTime(r.getTime()+60*n*60*1e3),document.cookie=e+"="+escape(t)+";expires="+r.toGMTString()},Util.prototype.getCookie=function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return null!=t?unescape(t[2]):null},Util.prototype.parseURL=function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return null!=n?unescape(n[2]):null},Util.prototype.forEach=function(e,t){if(e&&!(this.isArray(e)&&0===e.length||void 0!==e.length&&0===e.length))if(e.length)for(var n=0;n<e.length;n++)t(n,e[n]);else if(e&&!this.isEmptyObject(e)){e=e||{};var r=this.extend(!1,{},e);for(var i in r)t(i,e[i])}},Util.prototype.isInt=function(e){return Number(e)===e&&e%1==0},Util.prototype.isFloat=function(e){return Number(e)===e&&e%1!=0},Util.prototype.list=function(){return 1===arguments.length?[arguments[0]]:Array.apply(null,arguments)},Util.prototype.addEvent=function(e,t,n){if(e.attachEvent)return e.attachEvent("on"+t,n);if(e.addEventListener)return e.addEventListener(t,n,!1);throw"Handler could not be attached"},Util.prototype.removeEvent=function(e,t,n){if(e.detachEvent)return e.detachEvent("on"+t,n);if(e.removeEventListener)return e.removeEventListener(t,n,!1);throw"Handler could not be removed"},Util.prototype.stopEvent=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1},Util.prototype.getDomPageRect=function(e){var t=e.getBoundingClientRect();return{x:t.left+(window.pageXOffset||window.document.documentElement.scrollLeft),y:t.top+(window.pageYOffset||window.document.documentElement.scrollTop),width:t.width||e.offsetWidth,height:t.height||e.offsetHeight}},Util.prototype.getEventElementXY=function(e,t,n){var r,i,o=(e=e||window.event).changedTouches?e.changedTouches[0]:e.touches?e.touches[0]:e;null!=o.pageX&&null!=o.pageY?(r=o.pageX,i=o.pageY):null!=o.clientX&&null!=o.clientY&&(r=o.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i=o.clientY+document.body.scrollTop+document.documentElement.scrollTop);var s=this.getDomPageRect(t),a=r-s.x,c=i-s.y;return(0===n||null==n)&&(n=1),{x:Math.round(Math.max(Math.min(a,s.width-1),0)/n),y:Math.round(Math.max(Math.min(c,s.height-1),0)/n),width:Math.round(s.width/n),height:Math.round(s.height/n),realX:a,realY:c}},Util.prototype.layoutEngine=(engine={presto:!!window.opera,trident:!!window.ActiveXObject&&(window.XMLHttpRequest?document.querySelectorAll?6:5:4),webkit:function(){try{return!navigator.taintEnabled&&(i.Features.xpath?i.Features.query?525:420:419)}catch(e){return!1}}(),gecko:!(!document.getBoxObjectFor&&null==window.mozInnerScreenX)&&(document.getElementsByClassName?19:18)},engine.webkit&&(engine.webkit=(e=engine,n=(navigator.userAgent.match(/WebKit\/([0-9\.]*) /)||["",e])[1],parseFloat(n,10))),engine),Util.prototype.targetDOM="object"===("undefined"==typeof HTMLElement?"undefined":_typeof(HTMLElement))?function(e){return e instanceof HTMLElement}:function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&1===e.nodeType&&"string"==typeof e.nodeName},Util.prototype.cloneCSS=function(e,t){var n=window.getComputedStyle&&window.getComputedStyle(e,null)||e.currentStyle;for(var r in n){var i=n[r];/^[a-z]/i.test(r)&&[null,"",void 0].indexOf(i)<0&&(t.style[r]=i)}},Util.prototype.canYield=function(){try{return eval("!!Function('yield true;')().next()")}catch(e){return!1}}(),module.exports=new Util},function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(15),o=n(17),s=i.tagLogger("Service"),a=n(20),c=n(22),u=n(21),d=n(28),l=new(n(29))({onExtLoaded:function(){s.info("Share desktop ext. had loaded.")}}),f=n(26),p=n(30);e.exports=i.prototypeExtend({__init__:function(){s.warn("emedia version: ",window._emediaVersion||"unkown"),s.warn("UserAgent: ",navigator.userAgent);var e=i.parseURL("__log_level___");e&&(emedia.LOG_LEVEL=parseInt(e)),this.namespace=Math.uuidFast(),emedia.__easemob_current_mservice=this,void 0===this.useRTCCfg&&(this.useRTCCfg=emedia.config.useRTCCfgIfServerReturn),"string"==typeof this.useRTCCfg&&(this.useRTCCfg=JSON.parse(this.useRTCCfg))},AVPubstream:f.extend({__init__:function(){this.type=0,this._located=!0,this.mutedMuted=!0,this.constaints&&(this.constaints.video||(this.voff=1),this.constaints.audio||(this.aoff=1)),this.constaints||(this.constaints={audio:!0,video:!0}),emedia.config.maxVideoBitrate&&(this.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(this.abitrate=emedia.config.maxAudioBitrate)}}),AudioMixerPubstream:new f.extend({__init__:function(){if(this.type=2,this._located=!0,this.mutedMuted=!0,this.constaints||(this.constaints={audio:!0,video:!1}),this.constaints){var e=!!this.constaints.audio;this.constaints.video||(this.constaints.video=!1),this.constaints.video||(this.voff=1),this.constaints.audio||(this.aoff=1),!1===e&&(this.aoff=1)}emedia.config.maxVideoBitrate&&(this.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(this.abitrate=emedia.config.maxAudioBitrate)},onGotRemoteMediaStream:function(e){if(!this.remotePlayAudioObject){var t="__o_remote_play_audio_"+this.id,n=document.querySelector("#"+t);n||((n=document.createElement("audio")).style.display="none",n.id="__o_remote_play_audio_"+this.id,n.autoplay=!0,n.playsinline=!0,document.body.appendChild(n)),this.remotePlayAudioObject=n}this.remotePlayAudioObject.srcObject=e}}),ShareDesktopPubstream:f.extend({voff:0,__init__:function(){this.type=1,this._located=!0,this.mutedMuted=!0,this.constaints={audio:!this.aoff,video:!0},emedia.config.maxVideoBitrate&&(this.vbitrate=emedia.config.maxVideoBitrate),emedia.config.maxAudioBitrate&&(this.abitrate=emedia.config.maxAudioBitrate)}}),__assertCurrent:function(){if(!this.current)throw s.error("Please call emedia.service.setup(ticket)"),"Please call emedia.service.setup(ticket)";if(this.current.closed)throw s.error("current closed"),"current closed"},hasAudioMixers:function(){for(var e in this.__assertCurrent(),this.current.audioMixers){var t=this.current.audioMixers[e];if(t&&t.located())return!0}},getMediaDevices:function(e,t,n){"function"==typeof e&&(n=t,t=e,e=void 0),navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];o.deviceId,e||r.push(o),e&&e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||s.info("Some other kind of source/device: ",o)}t&&t(r)}).catch(function(e){s.warn("navigator.getUserMedia error: ",e),n&&n(e)})},attachSinkId:function(e,t){void 0!==e.sinkId?e.setSinkId(t).then(function(){s.info("Success, audio output device attached: "+t)}).catch(function(e){var t=e;"SecurityError"===e.name&&(t="You need to use HTTPS for selecting audio output device: "+e),s.warn(t)}):s.warn("Browser does not support output device selection.")},_stopTracks:function(e){emedia.stopTracks(e),e&&s.warn("Stream tracks stop. it = ",e)},_enableVideoTracks:function(e,t){emedia.enableVideoTracks(e,t)},_enableAudioTracks:function(e,t){emedia.enableAudioTracks(e,t)},openUserMedia:function(e){s.debug("begin open user media",e);var t=this;if(!e)throw s.error("require pubS"),"require pubS";return{then:function(n,r){if(e instanceof t.AVPubstream)t._openCamera(e,n,r);else if(e instanceof t.ShareDesktopPubstream)t._openSharedDesktop(e,n,r);else{if(!(e instanceof t.AudioMixerPubstream))throw s.error("Unspported pubS"),"Unspported pubS";t._openCamera(e,n,r)}}}},_openSharedDesktop:function(e,t,n){var o,a=this;function c(e){var i={audio:!0};e.constaints&&("object"===r(e.constaints.audio)&&e.constaints.audio||e.constaints.audio||(i.audio=!1)),a.__getUserMedia(i,function(n,r){var i=new MediaStream;i._located=!0,r&&r.getAudioTracks().forEach(function(e){i.addTrack(e)}),e.localStream&&e.localStream.getVideoTracks().forEach(function(e){i.addTrack(e)}),e.localStream=i,t&&t(a.current,i)},n)}if(e._localMediaStream&&(o=e._localMediaStream.getVideoTracks())&&o.length>0)return e.localStream=e._localMediaStream,void(e.constaints.audio?c(e):t&&t(a.current,stream));l.openDesktopMedia(e.screenOptions||["screen","window","tab"],function(r){if(r instanceof u.OpenDesktopMedia){var o=r.desktopStreamId;s.warn("desktop streamId",o);var d={audio:!1,video:{mandatory:i.extend(e.mandatory||{},{chromeMediaSource:"desktop",chromeMediaSourceId:o}),optional:[]}};a.__getUserMedia(d,function(n,r){e.localStream=r,e.constaints.audio?c(e):t&&t(a.current,r)},n)}else a.current&&a.current.onEvent(new u.ShareDesktopExtensionNotFound({member:a.current})),n&&n(r)})},_openCamera:function(e,t,n){var r=this,i=e.constaints||{audio:!0,video:!0};r.__getUserMedia(i,function(n,i){r.__controlStream(e,i),e.localStream=i,t&&t(r.current,i)}.bind(i),n)},__controlStream:function(e,t){emedia.enableVideoTracks(t,!e.voff),emedia.enableAudioTracks(t,!e.aoff)},__getUserMedia:function(e,t,n){s.debug("Using get user media. constaints",e);var o,a=this;e=i.extend({},e),"object"===r(e.audio)&&e.audio&&(e.audio=!0),a.__sysGetUserMedia(e,function(e){a.current&&!a.current.closed&&(a.current._openedRtcMediaStreams[e.id]=e,e._bindAttendee=a.current,s.info("stream bind attendee.",e.id,a.current.ticket&&a.current.ticket.id||a.current.memName)),emedia.isSafari&&(emedia._isSafariYetPushedStream=!0),o=e;var n=e.getVideoTracks(),r=e.getAudioTracks();n.length>0&&s.debug("Using video device: "+n[0].label),r.length>0&&s.debug("Using audio device: "+r[0].label),e._located=!0,t&&t(a.current,e)},function(e){s.debug("[WebRTC-API] getUserMedia() error: ",e),emedia.stopTracks(o),a.current&&a.current.onEvent(new u.OpenMediaError({member:a.current,event:e})),n&&n(new u.OpenMediaError({member:a.current,event:e}))})},__sysGetUserMedia:function(e,t,n){function r(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t).catch(n)}if(emedia.isSafari){if((e=o.extend({},e)).audio){var i={audio:e.audio};r(i,c.bind(i),u)}if(e.video){var s={video:e.video};r(s,c.bind(s),u)}e.video||e.audio||u("Failed to execute 'getUserMedia' on 'MediaDevices': At least one of audio and video must be requested")}else r(e,t,n);function a(){var n=new MediaStream;e.audioStream&&e.audioStream.getAudioTracks().forEach(function(e){n.addTrack(e)}),e.videoStream&&e.videoStream.getVideoTracks().forEach(function(e){n.addTrack(e)}),t&&t(n)}function c(t){e.failed?emedia.stopTracks(t):(!this.audio||(e.audioStream=t,e.video))&&(!this.video||(e.videoStream=t,e.audio))?e.audioStream&&e.videoStream&&a():a()}function u(t){e.failed||(e.failed=!0,n(t))}},setup:function(e,t){var n=this;s.count(),s.debug("recv ticket",e,t);var r,o,a=t=t||{};if(i.isPlainObject(t))t=JSON.stringify(t);else try{a=JSON.parse(t)}catch(p){}if("string"==typeof e&&(e=JSON.parse(e)),r=o=e.memName,n.current&&!n.current.closed){var l=new u.CurrentCalling;throw n.current.onEvent(l),s.error("confr not close. calling..."),l}var f=(n.Attendee||c).extend(d);return n.current=new f({_service:n,autoSub:emedia.config.autoSub,getCopyIntervalMillis:emedia.config.getCopyIntervalMillis,sysUserId:r,memName:o,resource:n.resource,nickName:n.nickName,ticket:e,ext:t,extObj:a,sessionFactory:function(){return n.newSession(this,e)}},n.listeners||{})},getStreamById:function(e){var t=this.current&&this.current._cacheStreams[e];return t&&i.extend(!1,{},t)},getMemberById:function(e){var t=this.current&&this.current._cacheMembers[e];return t&&i.extend(!1,{},t)},exit:function(e){s.warn("User click exit ",e),this.current&&this.current.exit(e)},join:function(e,t){s.debug("begin join ...");if(this.__assertCurrent(),this.current._memberId)return s.warn("Had joined. igrone it"),void(e&&e(this.memId));this.current._session._sessionId=void 0,this.current.join(e,t)},withpublish:function(e){if(!e||!e.localStream)throw s.error("pubS null or stream not open"),"pubS null or stream not open";return this.__assertCurrent(),this.current._memberId?s.warn("Had joined. igrone it"):this.current._session._sessionId=void 0,this.current.withpublish(e)},push:function(e,t,n){s.debug("begin push ...");if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw s.error("pubS or stream open"),"pubS or stream open";this.__assertCurrent(),this.current.push(e,t,n,!1)},subscribe:function(e,t,n,r){var o=this;if(s.info("begin subscribe ",e,r),t&&i.isPlainObject(t)&&(r=t,t=n=void 0),n&&i.isPlainObject(n)&&(r=n,n=t,t=void 0),emedia.isSafari){var a=function(){try{var e=l.shift();e&&e.onSub&&e.onSub.apply(e,arguments)}finally{u()}},c=function(){try{var e=l.shift();e&&e.subfail&&e.subfail.apply(e,arguments)}finally{u()}},u=function(){l.length>0&&o.__subscribe(l[0].streamId,a,c,l[0].subArgs)},d={streamId:e,onSub:t,subfail:n,subArgs:r},l=o.__safari_subs||(o.__safari_subs=[]);l.push(d),1===l.length&&u()}else o.__subscribe(e,t,n,r)},__subscribe:function(e,t,n,r){this.__assertCurrent(),2==arguments.length&&(n=t,t=void 0),t&&i.isPlainObject(t)&&(r=t,t=void 0),n&&i.isPlainObject(n)&&(r=n,n=void 0),r||(r={subSVideo:!0,subSAudio:!0});this.current._cacheStreams[e];var o=this.current._getWebrtc(e),a=o&&o.isConnected(),c=a&&o.getRemoteStream();if(c&&(a=c.active)){var u=c.getAudioTracks().length,d=c.getVideoTracks().length;(u||!0!==r.subSAudio)&&(d||!0!==r.subSVideo)||(a=!1)}if(s.info("sub stream",e,", use prertcpeer =",a),a)return this.current.subscribeStream(o._rtcId,e,n,r,t),void(t&&t());o&&!o.closed&&this.current.closeWebrtc(o.getRtcId(),!0,!1),this.current.createWebrtcAndSubscribeStream(e,{onGotRemote:function(e){t&&t(e)},onEvent:function(e){n&&n(e)}},void 0,r)},closePubstream:function(e){e.located()&&(emedia.stopTracks(e._localMediaStream),emedia.stopTracks(e.localStream))},hungup:function(e){var t=this.getStreamById(e);try{this._hungup(e)}finally{this.onHungup&&t&&this.onHungup(t)}},_hungup:function(e){this.__assertCurrent();var t=this.current,n=t._cacheStreams[e],r=n&&n.rtcId;if(r&&(t.closeWebrtc(r),n.located()&&(1!==n.type&&n._localMediaStream&&emedia.stopTracks(n._localMediaStream),n.remotePlayAudioObject&&document.body.removeChild(n.remotePlayAudioObject),t._cacheStreams[e]&&t.onRemoveStream(n),i.removeAttribute(t._cacheStreams,e))),n&&!n.located()){if(t._linkedStreams[n.id]&&i.removeAttribute(t._linkedStreams,n.id),s.warn("Hangeup remove from _linkedStreams. stream = ",n.id),!(n=t._cacheStreams[e]))return;var o=new f(n);n.rtcId=o.rtcId=void 0,n._webrtc=o._webrtc=void 0,n.mediaStream=o.mediaStream=void 0,t.onUpdateStream(o,new o.Update(o))}},postMessage:function(e,t,n,r){var i=t;"string"!=typeof t&&(t=JSON.stringify(t)),this.__assertCurrent();var o,s=this.current,a=s._linkedStreams[e];o=a&&a.owner?a.owner.id:e;t=s.newMessage({op:1003,memId:o,arg:t});s.postMessage(t,(n||r)&&function(e){if(r&&r(e,i),0!=e.result){var a=new u.RemoteControlFail({memId:o,failed:e.result,cause:e.msg,type:"postMessage",postMessage:t});return s.onEvent(a),void(n&&n(a,i))}})},torchRemote:function(e,t,n,r){"function"==typeof t&&(r=n,n=t,t=void 0),void 0!==t&&(t=t?1:0),this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var a=o.torch,c={op2:20,streamId:e,tor:t=void 0===t?o.torch?0:1:t},d=i.newMessage({op:1002,memId:o.owner.id,arg:JSON.stringify(c),_reqOps:[100206]});o.torch=t,i.postMessage(d,function(e){if(0!=e.result){var t=new u.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"torch_control"});return i.onEvent(t),o.torch=a,void(r&&r(t,o.torch))}n&&n(o.torch)})},freezeFrameRemote:function(e,t,n){this.__assertCurrent();var r=this.current,i=r._linkedStreams[e];if(!i||i.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var o=!i.freezeFrame,a={op2:20,streamId:e,frz:o?1:0},c=r.newMessage({op:1002,memId:i.owner.id,arg:JSON.stringify(a),_reqOps:[100204]});i.freezeFrame=o,r.postMessage(c,function(e){if(0!=e.result){var o=new u.RemoteControlFail({stream:i,failed:e.result,cause:e.msg,type:"freeze_control"});return r.onEvent(o),i.freezeFrame=!i.freezeFrame,void(n&&n(o,i.freezeFrame))}t&&t(i.freezeFrame)})},base64Img2Blob:function(e){for(var t=e.split(";base64,"),n=t[0].split(":")[1],r=window.atob(t[1]),i=r.length,o=new Uint8Array(i),s=0;s<i;++s)o[s]=r.charCodeAt(s);return new Blob([o],{type:n})},blob2URL:function(e){return URL.createObjectURL(e)},imagesPngContext2URL:function(e){return this.blob2URL(this.blob2URL(e))},downloadFile:function(e,t,n){var r=document.createElement("a");r.style.display="none";var i,o=t?this.base64Img2Blob(t):n;r.download=e,r.href=i=this.blob2URL(o),r.rel="noopener";var s=document.createEvent("HTMLEvents");s.initEvent("click",!1,!1),r.dispatchEvent(s),document.body.appendChild(r),r.click(),r.parentNode.removeChild(r),setTimeout(function(){URL.revokeObjectURL&&URL.revokeObjectURL(i)},4e4)},videoCaptureBase64Context2URL:function(e){return this.imagesPngContext2URL(this.getCaptureBase64Context(e))},getCaptureBase64Context:function(e){var t=document.createElement("canvas");t.id="__capture_video_"+(new Date).getTime();return t.width=e.videoWidth,t.height=e.videoHeight,t.getContext("2d").drawImage(e,0,0,t.width,t.height),t.toDataURL("images/png")},captureVideo:function(e,t,n){var r=this.getCaptureBase64Context(e);return t&&(n=n||"capture_"+(new Date).getTime(),this.downloadFile(n,r)),r},capturePictureRemote:function(e,t,n,r){this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var a={op2:20,streamId:e,pic:1,rspBase64Pic:!0===t},c=i.newMessage({op:1002,memId:o.owner.id,arg:JSON.stringify(a),_reqOps:[100205]});i.postMessage(c,function(e){if(0!=e.result){var s=new u.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"capture_control"});return i.onEvent(s),void(r&&r(s))}if(t)if(e.arg){var a=JSON.parse(e.arg);n&&n(a.pic)}else r&&r(new u.RemoteControlFail({stream:o,failed:e.result,cause:"Not found base64 pic"}));else n&&n()})},zoomRemote:function(e,t,n,r){this.__assertCurrent();var i=this.current,o=i._linkedStreams[e];if(!o||o.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";o._zoom||(o._zoom=1);var a=o._zoom*t;if(!(a<1)){o._zoom=a;var c={op2:20,streamId:e,zoom:Math.round(1e4*a)},d=i.newMessage({op:1002,memId:o.owner.id,arg:JSON.stringify(c),_reqOps:[100201]});i.postMessage(d,function(e){if(0!=e.result){var t=new u.RemoteControlFail({stream:o,failed:e.result,cause:e.msg,type:"zoom_control"});return i.onEvent(t),void(n&&n(t))}r&&r()})}},_getPosition:function(e){for(var t=0,n=0;e;)n+=e.offsetLeft,t+=e.offsetTop,e=e.offsetParent;return{clientX:n,clientY:t}},eventXYAtMedia:function(e,t){var n=i.getDomPageRect(t),r=n.width,o=n.height,s=t.videoWidth,a=t.videoHeight;if(a/s>o/r){var c=s/a;s=(a=o)*c}else{c=a/s;a=(s=r)*c}var u,d,l=e;if((u=i.isFloat(l.x))&&(l.x=l.x*r),(d=i.isFloat(l.y))&&(l.y=l.y*o),!(Math.abs(l.x)<(r-s)/2||r-Math.abs(l.x)<(r-s)/2||Math.abs(l.y)<(o-a)/2||o-Math.abs(l.y)<(o-a)/2))return l.x=l.x<0?Math.floor(l.x+(r-s)/2):Math.floor(l.x-(r-s)/2),l.y=l.y<0?Math.floor(l.y+(o-a)/2):Math.floor(l.y-(o-a)/2),u&&(l.x=l.x/s),d&&(l.y=l.y/a),{x:l.x,y:l.y,width:s,height:a}},eventXYAtVideo:function(e,t){var n,r,o=i.getDomPageRect(t),s=o.width,a=o.height,c=t.videoWidth,u=t.videoHeight;if(u/c>a/s){var d=c/u;c=(u=a)*d}else{d=u/c;u=(c=s)*d}return(n=i.isFloat(e.x))&&(e.x=e.x*c),(r=i.isFloat(e.y))&&(e.y=e.y*u),e.x=e.x<0?Math.floor(e.x-(s-c)/2):Math.floor(e.x+(s-c)/2),e.y=e.y<0?Math.floor(e.y-(a-u)/2):Math.floor(e.y+(a-u)/2),n&&(e.x=e.x/s),r&&(e.y=e.y/a),e},getClickXY:function(e,t){var n=t||window.event,r=document.documentElement.scrollLeft||document.body.scrollLeft,i=document.documentElement.scrollTop||document.body.scrollTop,o=n.pageX||n.clientX+r,a=n.pageY||n.clientY+i,c=this._getPosition(e);s.info("Video tag position ",c.clientX,":",c.clientY);var u=e.videoWidth,d=e.videoHeight;if(d/u>e.offsetHeight/e.offsetWidth){var l=u/d;u=(d=e.offsetHeight)*l,c.clientX+=(e.offsetWidth-u)/2}else{l=d/u;d=(u=e.offsetWidth)*l,c.clientY+=(e.offsetHeight-d)/2}return s.info("Media position ",c.clientX,":",c.clientY),s.info("Media xy ",u,":",d),s.info("Click position ",o,":",a),{mediaWidth:u,mediaHeight:d,x:o-c.clientX,y:a-c.clientY}},focusExpoRemote:function(e,t,n,r,i){var o=n||window.event,a=document.documentElement.scrollLeft||document.body.scrollLeft,c=document.documentElement.scrollTop||document.body.scrollTop,u=o.pageX||o.clientX+a,d=o.pageY||o.clientY+c,l=this._getPosition(t);s.info("Video tag position ",l.clientX,":",l.clientY);var f=t.videoWidth,p=t.videoHeight;if(p/f>t.offsetHeight/t.offsetWidth){var h=f/p;f=(p=t.offsetHeight)*h,l.clientX+=(t.offsetWidth-f)/2}else{h=p/f;p=(f=t.offsetWidth)*h,l.clientY+=(t.offsetHeight-p)/2}s.info("Media position ",l.clientX,":",l.clientY),s.info("Media xy ",f,":",p),s.info("Click position ",u,":",d),this._focusExpo(e,f,p,u-l.clientX,d-l.clientY,r,i)},_focusExpo:function(e,t,n,r,i,o,a){if(!(r<=0||r>t||i<=0||i>n)){this.__assertCurrent();var c=this.current,d=c._linkedStreams[e];if(!d||d.located())throw s.error("not exsits or locate, not connect",e),e+" not exsits or locate, not connect";var l={op2:20,streamId:e,focus:1,expo:1,x:0===t?0:Math.round(1e4*r/t),y:0===n?0:Math.round(1e4*i/n)},f=c.newMessage({op:1002,memId:d.owner.id,arg:JSON.stringify(l),_reqOps:[100202,100203]});c.postMessage(f,function(e){if(0!=e.result){var t=new u.RemoteControlFail({stream:d,failed:e.result,cause:e.msg,type:"focus_expo_control"});return c.onEvent(t),void(o&&o(t))}a&&a()})}},_republish:function(e,t,n){s.info("Republish stream. it = ",e.id);var r,i,o=this;if(e.id){var a=o.current.__getWebrtcFor(e.id);a&&o.current.closeWebrtc(a,!0),r=o.current._getWebrtc(e.id)}switch(e.type){case 0:emedia.stopTracks(e._localMediaStream),i=new o.AVPubstream(e);break;case 1:emedia.stopAndRemoveAudioTracks(e._localMediaStream),i=new o.ShareDesktopPubstream(e);break;case 2:emedia.stopTracks(e._localMediaStream),i=new o.AudioMixerPubstream(e)}setTimeout(function(){o.openUserMedia(i).then(function(){e.localStream=i.localStream,e.isRepublished=!0,e.optimalVideoCodecs=e.optimalVideoCodecs||r&&r.optimalVideoCodecs,o.push(e,t,n)},n)},100)},chanageCamera:function(e,t,n){var i=this;"string"==typeof e?e=i.current._cacheStreams[e]:e.id&&(e=i.current._cacheStreams[e.id]),e.voff?s.warn("Stream id = ",e.id," voff, do not chanage camera."):i.getMediaDevices("videoinput",function(o){if(o.length<=1)s.warn("Only video input. not chanage");else{for(var a=null===e._cameraIndex||void 0===e._cameraIndex?0:e._cameraIndex;a<o.length;){var c=o[a],u=o[a=(a+1)%o.length],d=e._localMediaStream.getVideoTracks();if(!d||0===d.length||u.label!=d[0].label)break}var l=(u=o[a]).label;s.warn("Stream ",e.id,c.label,">>",l),e._cameraIndex=a,e.constaints||(e.constaints={}),e.constaints.video="object"===r(e.constaints.video)?e.constaints.video:{},e.constaints.video.deviceId={exact:u.deviceId},i._republish(e,function(e){n&&n(e)},function(n){n instanceof emedia.event.OpenMediaError&&(e.constaints.video=!1),t&&t(n)})}},t)},_republishByVideoConstaints:function(e,t,n,r){var i=this;"string"==typeof e&&(e=i.current._cacheStreams[e]);var a=(e=o.extend({},e)).voff,c=e.voff=t?0:1;function u(){c!==a?(emedia.enableVideoTracks(e.getMediaStream(),!c),i.current&&i.current.voff(e,c)):s.info("pubstream voff not chanage.")}if(o.isObject(t)&&!o.isEqual(e.constaints.video,t)||t&&!e.constaints.video)return e.constaints.video=t,void i._republish(e,function(e){u(),r&&r(e)},function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.video=!1),n&&n(t)});u(),r&&r(e.getMediaStream())},voff:function(e,t,n,r){var i=this;"string"==typeof e&&(e=i.current._cacheStreams[e]);var o=e.voff;function a(){t!=o?(emedia.enableVideoTracks(e.getMediaStream(),!t),i.current&&i.current.voff(e,t)):s.info("pubstream voff not chanage.")}if(t=t?1:0,e.voff=t,!t&&e.constaints&&!e.constaints.video){var c=e.constaints.video;return e.constaints.video=!0,void i._republish(e,function(e){a(),r&&r(e)},function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.video=c),n&&n(t)})}a(),r&&r(e.getMediaStream())},aoff:function(e,t,n,r){var i=this;"string"==typeof e&&(e=i.current._cacheStreams[e]);var o=e.aoff;function a(){t!=o?(emedia.enableAudioTracks(e.getMediaStream(),!t),i.current&&i.current.aoff(e,t)):s.info("pubstream aoff not chanage.")}if(t=t?1:0,e.aoff=t,!t&&e.constaints&&!e.constaints.audio){var c=e.constaints.audio;return e.constaints.audio=!0,void i._republish(e,function(e){a(),r&&r(e)},function(t){t instanceof emedia.event.OpenMediaError&&(e.constaints.audio=c),n&&n(t)})}a(),r&&r(e.getMediaStream())},iceing:function(e){return i.isPlainObject(this.current._linkedStreams[e])},recording:function(e){return i.isPlainObject(this.current._records[e])},startRecord:function(e,t){var n=this.current._linkedStreams[e];if(!n)throw s.error("not at linked streams",e),e+" not at linked streams";n._webrtc||t&&t(!1),this.current.startRecord(n,t)},stopRecord:function(e,t){var n=this.current._records[e];if(!n)throw s.error("not at recording streams",e),e+" not at recording streams";this.current.stopRecord(n,t)},getCurrentMembers:function(){return this.current.getCurrentMembers()},_onCapturePicture:function(e){var t,n=e.arg.rspBase64Pic,r=e.arg.streamId,i=this.current._cacheStreams[r];if(n){var o;if("function"!=typeof this.getHTMLVideo||!(o=this.getHTMLVideo(r)))return void s.warn("Not support capture picture. caused by htmlVideo not found");t=this.getCaptureBase64Context(o)}else{if("function"!=typeof this.onCapturePicture)return void s.warn("Not support capture picture. caused by onCapturePicture not found");this.onCapturePicture(i)}var a=this.current.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,arg:JSON.stringify(t?{pic:t}:{}),result:0});return this.current.postMessage(a,function(e){s.warn("Send remote control onCapturePicture response. the result = ",e.result,e.msg||"")}),!0},newSession:function(e,t){var n=this;return new(n.Session||a)({ticket:t,owner:e,onTcklC:function(t){e.onTcklC(t.rtcId,t.cands)},onAcptC:function(t){e.onAcptC(t.rtcId,t.sdp,t.cands)},onAnsC:function(t){e.onAnsC(t.rtcId,t.sdp,t.cands)},onTermC:function(t){s.info("Server termc rtc: ",t.rtcId,t.message||t.msg),21===t.endReason||22===t.endReason?i.forEach(e._cacheStreams,function(n,r){var i;r.rtcId===t.rtcId&&(i=21===t.endReason?new emedia.event.SwitchVCodes({stream:r,useVCodes:t.useVCodes}):new emedia.event.SubFailNotSupportVCodes({stream:r}),e.onEvent(i))}):e.closeWebrtc(t.rtcId,!1,!0)},onEnter:function(t){e.onEnter(t.cver,t.mem)},onExit:function(t){e.onExit(t.cver,t.memId,t.reason||0)},onPub:function(t){e.onPub(t.cver,t.memId,t.pubS)},onUnpub:function(t){e.onUnpub(t.cver,t.memId,t.pubSId)},onMems:function(e){},onClose:function(t){e.onClose(t.cver,t.confrId)},onEvent:function(t){e.onEvent(t)},onStreamControl:function(t){e.onStreamControl(t.cver,t.streamId,t.voff,t.aoff,t.sver)},onRoleUpdate:function(t){e._onRoleUpdate(t.role,t.roleToken)},onRemoteControl:function(t){if("string"==typeof t.arg&&(t.arg=JSON.parse(t.arg)),20!==t.arg.op2||!t.arg.pic||!n._onCapturePicture.call(n,t)){if(30===t.arg.op2&&n._onRemotePannelControl)try{return void n._onRemotePannelControl.call(n,t)}catch(i){s.warn(i)}s.warn("Not support remote control");var r=e.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,arg:JSON.stringify(t.arg),result:t&&t.arg&&30===t.arg.op2?-405:-507,msg:"Not support the remote control."});e.postMessage(r,function(e){s.warn("Send remote control response. the result = ",e.result,e.msg||"")})}},onRecvRemoteMessage:function(t){e._onRecvRemoteMessage&&e._onRecvRemoteMessage(t.memId,t.arg,t)}})},_judgeTalking:function(e){return!!e&&e.instant>=emedia.config.judgeTalkingByInstantGE},graffitiVideo:function(e,t,n){var r=this.getStreamById(e),i=new MediaStream;i._located=!0,r._localMediaStream.getAudioTracks().forEach(function(e){i.addTrack(e)}),n.captureStream(25).getVideoTracks().forEach(function(e){i.addTrack(e)}),t.srcObject=i,r.localStream=i,r.isRepublished=!0,r.optimalVideoCodecs=r.optimalVideoCodecs,this.push(r)},resetCanvas:function(e){var t;if(arguments.length>1)for(var n=0;n<arguments.length;n++)"function"==typeof(t=arguments[n])&&t(e),"function"!=typeof t&&i.isPlainObject(t)&&i.forEach(t,function(t,n){s.debug("Canvas set ",t," = ",n),e.setAttribute(t,n)})},_random:function(e){return Math.floor(Math.random()*e)},requestFrame:function(e,t){var n,r=this;if("string"==typeof e)n=this.current._cacheStreams[e];else{if(!e.id)return;n=this.current._cacheStreams[e.id]}function i(){(n.requestFrame(),n.canvas)&&p.prototype.redraw.bind({_canvasContext:n.canvas.getContext("2d")})(3,3)}n&&(t?setTimeout(function(){i(),r.requestFrame(n,t)},t):i())},graffitiCanvas:function(e,t){i.targetDOM(e)&&(t=e,e=!1);var n=this,r=new n.ShareDesktopPubstream({voff:0,aoff:e?0:1});t||(t=document.createElement("canvas")),t.getContext("2d"),r.canvas=t;var o=function(){};return o.prototype.setCanvas=function(e){return this.canvasTag=t,n.resetCanvas(t,e),this},o.prototype.push=function(e,t){this._push(e,t)},o.prototype._push=function(i,o){"function"==typeof i&&(o=i,i=void 0),t.captureStream&&(t.captureStream.enabled=!0);var s=t.captureStream(i||25);function a(n){n.canvas=t,o&&o(n,t,s),e&&n.requestFrame()}function c(e,t){var r=new MediaStream;r._located=!0,e._localMediaStream&&e._localMediaStream.getAudioTracks().forEach(function(e){r.addTrack(e)}),s.getVideoTracks().forEach(function(e){r.addTrack(e)}),e._localMediaStream=r,e.localStream=r,n.push(e,t)}return e?n.__getUserMedia({audio:!0},function(e,t){r._localMediaStream=t,c(r,a)}):c(r,a),this},new o},blobRecorder:function(e,t,n,r){var o=this;i.targetDOM(e)&&(e=e.srcObject),t||(t={mimeType:"video/webm;codecs=vp9"}),MediaRecorder.isTypeSupported(t.mimeType)||(s.info(t.mimeType," is not Supported"),t={mimeType:"video/webm;codecs=vp8"},MediaRecorder.isTypeSupported(t.mimeType)||(s.info(t.mimeType," is not Supported"),t={mimeType:"video/webm"},MediaRecorder.isTypeSupported(t.mimeType)||(s.info(t.mimeType," is not Supported"),t={mimeType:""})));try{var a=new MediaRecorder(e,t)}catch(d){return void s.error("Exception while creating MediaRecorder: ",d)}var c=[];function u(){this.blobs=c}return a.onstop=r||function(e){s.info("Recorder stopped: ",e)},a.ondataavailable=n||function(e){e.data&&e.data.size>0&&c.push(e.data)},u.prototype.start=function(e){a.start(e)},u.prototype.stop=function(){a.stop()},u.prototype.playurl=function(e){var t=new Blob(this.blobs,e||{type:"video/webm"});return window.URL.createObjectURL(t)},u.prototype.download=function(e,t){var n=new Blob(this.blobs,t||{type:"video/webm"});o.downloadFile(e,void 0,n)},new u}})},function(e,t,n){(function(e,n){var r;!function(){var i="object"==typeof self&&self.self===self&&self||"object"==typeof e&&e.global===e&&e||this||{},o=i._,s=Array.prototype,a=Object.prototype,c="undefined"!=typeof Symbol?Symbol.prototype:null,u=s.push,d=s.slice,l=a.toString,f=a.hasOwnProperty,p=Array.isArray,h=Object.keys,m=Object.create,v=function(){},b=function(e){return e instanceof b?e:this instanceof b?void(this._wrapped=e):new b(e)};void 0===t||t.nodeType?i._=b:(void 0!==n&&!n.nodeType&&n.exports&&(t=n.exports=b),t._=b),b.VERSION="1.9.1";var g,_=function(e,t,n){if(void 0===t)return e;switch(null==n?3:n){case 1:return function(n){return e.call(t,n)};case 3:return function(n,r,i){return e.call(t,n,r,i)};case 4:return function(n,r,i,o){return e.call(t,n,r,i,o)}}return function(){return e.apply(t,arguments)}},y=function(e,t,n){return b.iteratee!==g?b.iteratee(e,t):null==e?b.identity:b.isFunction(e)?_(e,t,n):b.isObject(e)&&!b.isArray(e)?b.matcher(e):b.property(e)};b.iteratee=g=function(e,t){return y(e,t,1/0)};var S=function(e,t){return t=null==t?e.length-1:+t,function(){for(var n=Math.max(arguments.length-t,0),r=Array(n),i=0;i<n;i++)r[i]=arguments[i+t];switch(t){case 0:return e.call(this,r);case 1:return e.call(this,arguments[0],r);case 2:return e.call(this,arguments[0],arguments[1],r)}var o=Array(t+1);for(i=0;i<t;i++)o[i]=arguments[i];return o[t]=r,e.apply(this,o)}},w=function(e){if(!b.isObject(e))return{};if(m)return m(e);v.prototype=e;var t=new v;return v.prototype=null,t},x=function(e){return function(t){return null==t?void 0:t[e]}},C=function(e,t){return null!=e&&f.call(e,t)},E=function(e,t){for(var n=t.length,r=0;r<n;r++){if(null==e)return;e=e[t[r]]}return n?e:void 0},T=Math.pow(2,53)-1,I=x("length"),R=function(e){var t=I(e);return"number"==typeof t&&t>=0&&t<=T};b.each=b.forEach=function(e,t,n){var r,i;if(t=_(t,n),R(e))for(r=0,i=e.length;r<i;r++)t(e[r],r,e);else{var o=b.keys(e);for(r=0,i=o.length;r<i;r++)t(e[o[r]],o[r],e)}return e},b.map=b.collect=function(e,t,n){t=y(t,n);for(var r=!R(e)&&b.keys(e),i=(r||e).length,o=Array(i),s=0;s<i;s++){var a=r?r[s]:s;o[s]=t(e[a],a,e)}return o};var k=function(e){return function(t,n,r,i){var o=arguments.length>=3;return function(t,n,r,i){var o=!R(t)&&b.keys(t),s=(o||t).length,a=e>0?0:s-1;for(i||(r=t[o?o[a]:a],a+=e);a>=0&&a<s;a+=e){var c=o?o[a]:a;r=n(r,t[c],c,t)}return r}(t,_(n,i,4),r,o)}};b.reduce=b.foldl=b.inject=k(1),b.reduceRight=b.foldr=k(-1),b.find=b.detect=function(e,t,n){var r=(R(e)?b.findIndex:b.findKey)(e,t,n);if(void 0!==r&&-1!==r)return e[r]},b.filter=b.select=function(e,t,n){var r=[];return t=y(t,n),b.each(e,function(e,n,i){t(e,n,i)&&r.push(e)}),r},b.reject=function(e,t,n){return b.filter(e,b.negate(y(t)),n)},b.every=b.all=function(e,t,n){t=y(t,n);for(var r=!R(e)&&b.keys(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(!t(e[s],s,e))return!1}return!0},b.some=b.any=function(e,t,n){t=y(t,n);for(var r=!R(e)&&b.keys(e),i=(r||e).length,o=0;o<i;o++){var s=r?r[o]:o;if(t(e[s],s,e))return!0}return!1},b.contains=b.includes=b.include=function(e,t,n,r){return R(e)||(e=b.values(e)),("number"!=typeof n||r)&&(n=0),b.indexOf(e,t,n)>=0},b.invoke=S(function(e,t,n){var r,i;return b.isFunction(t)?i=t:b.isArray(t)&&(r=t.slice(0,-1),t=t[t.length-1]),b.map(e,function(e){var o=i;if(!o){if(r&&r.length&&(e=E(e,r)),null==e)return;o=e[t]}return null==o?o:o.apply(e,n)})}),b.pluck=function(e,t){return b.map(e,b.property(t))},b.where=function(e,t){return b.filter(e,b.matcher(t))},b.findWhere=function(e,t){return b.find(e,b.matcher(t))},b.max=function(e,t,n){var r,i,o=-1/0,s=-1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,c=(e=R(e)?e:b.values(e)).length;a<c;a++)null!=(r=e[a])&&r>o&&(o=r);else t=y(t,n),b.each(e,function(e,n,r){((i=t(e,n,r))>s||i===-1/0&&o===-1/0)&&(o=e,s=i)});return o},b.min=function(e,t,n){var r,i,o=1/0,s=1/0;if(null==t||"number"==typeof t&&"object"!=typeof e[0]&&null!=e)for(var a=0,c=(e=R(e)?e:b.values(e)).length;a<c;a++)null!=(r=e[a])&&r<o&&(o=r);else t=y(t,n),b.each(e,function(e,n,r){((i=t(e,n,r))<s||i===1/0&&o===1/0)&&(o=e,s=i)});return o},b.shuffle=function(e){return b.sample(e,1/0)},b.sample=function(e,t,n){if(null==t||n)return R(e)||(e=b.values(e)),e[b.random(e.length-1)];var r=R(e)?b.clone(e):b.values(e),i=I(r);t=Math.max(Math.min(t,i),0);for(var o=i-1,s=0;s<t;s++){var a=b.random(s,o),c=r[s];r[s]=r[a],r[a]=c}return r.slice(0,t)},b.sortBy=function(e,t,n){var r=0;return t=y(t,n),b.pluck(b.map(e,function(e,n,i){return{value:e,index:r++,criteria:t(e,n,i)}}).sort(function(e,t){var n=e.criteria,r=t.criteria;if(n!==r){if(n>r||void 0===n)return 1;if(n<r||void 0===r)return-1}return e.index-t.index}),"value")};var O=function(e,t){return function(n,r,i){var o=t?[[],[]]:{};return r=y(r,i),b.each(n,function(t,i){var s=r(t,i,n);e(o,t,s)}),o}};b.groupBy=O(function(e,t,n){C(e,n)?e[n].push(t):e[n]=[t]}),b.indexBy=O(function(e,t,n){e[n]=t}),b.countBy=O(function(e,t,n){C(e,n)?e[n]++:e[n]=1});var M=/[^\ud800-\udfff]|[\ud800-\udbff][\udc00-\udfff]|[\ud800-\udfff]/g;b.toArray=function(e){return e?b.isArray(e)?d.call(e):b.isString(e)?e.match(M):R(e)?b.map(e,b.identity):b.values(e):[]},b.size=function(e){return null==e?0:R(e)?e.length:b.keys(e).length},b.partition=O(function(e,t,n){e[n?0:1].push(t)},!0),b.first=b.head=b.take=function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[0]:b.initial(e,e.length-t)},b.initial=function(e,t,n){return d.call(e,0,Math.max(0,e.length-(null==t||n?1:t)))},b.last=function(e,t,n){return null==e||e.length<1?null==t?void 0:[]:null==t||n?e[e.length-1]:b.rest(e,Math.max(0,e.length-t))},b.rest=b.tail=b.drop=function(e,t,n){return d.call(e,null==t||n?1:t)},b.compact=function(e){return b.filter(e,Boolean)};var A=function(e,t,n,r){for(var i=(r=r||[]).length,o=0,s=I(e);o<s;o++){var a=e[o];if(R(a)&&(b.isArray(a)||b.isArguments(a)))if(t)for(var c=0,u=a.length;c<u;)r[i++]=a[c++];else A(a,t,n,r),i=r.length;else n||(r[i++]=a)}return r};b.flatten=function(e,t){return A(e,t,!1)},b.without=S(function(e,t){return b.difference(e,t)}),b.uniq=b.unique=function(e,t,n,r){b.isBoolean(t)||(r=n,n=t,t=!1),null!=n&&(n=y(n,r));for(var i=[],o=[],s=0,a=I(e);s<a;s++){var c=e[s],u=n?n(c,s,e):c;t&&!n?(s&&o===u||i.push(c),o=u):n?b.contains(o,u)||(o.push(u),i.push(c)):b.contains(i,c)||i.push(c)}return i},b.union=S(function(e){return b.uniq(A(e,!0,!0))}),b.intersection=function(e){for(var t=[],n=arguments.length,r=0,i=I(e);r<i;r++){var o=e[r];if(!b.contains(t,o)){var s;for(s=1;s<n&&b.contains(arguments[s],o);s++);s===n&&t.push(o)}}return t},b.difference=S(function(e,t){return t=A(t,!0,!0),b.filter(e,function(e){return!b.contains(t,e)})}),b.unzip=function(e){for(var t=e&&b.max(e,I).length||0,n=Array(t),r=0;r<t;r++)n[r]=b.pluck(e,r);return n},b.zip=S(b.unzip),b.object=function(e,t){for(var n={},r=0,i=I(e);r<i;r++)t?n[e[r]]=t[r]:n[e[r][0]]=e[r][1];return n};var P=function(e){return function(t,n,r){n=y(n,r);for(var i=I(t),o=e>0?0:i-1;o>=0&&o<i;o+=e)if(n(t[o],o,t))return o;return-1}};b.findIndex=P(1),b.findLastIndex=P(-1),b.sortedIndex=function(e,t,n,r){for(var i=(n=y(n,r,1))(t),o=0,s=I(e);o<s;){var a=Math.floor((o+s)/2);n(e[a])<i?o=a+1:s=a}return o};var j=function(e,t,n){return function(r,i,o){var s=0,a=I(r);if("number"==typeof o)e>0?s=o>=0?o:Math.max(o+a,s):a=o>=0?Math.min(o+1,a):o+a+1;else if(n&&o&&a)return r[o=n(r,i)]===i?o:-1;if(i!=i)return(o=t(d.call(r,s,a),b.isNaN))>=0?o+s:-1;for(o=e>0?s:a-1;o>=0&&o<a;o+=e)if(r[o]===i)return o;return-1}};b.indexOf=j(1,b.findIndex,b.sortedIndex),b.lastIndexOf=j(-1,b.findLastIndex),b.range=function(e,t,n){null==t&&(t=e||0,e=0),n||(n=t<e?-1:1);for(var r=Math.max(Math.ceil((t-e)/n),0),i=Array(r),o=0;o<r;o++,e+=n)i[o]=e;return i},b.chunk=function(e,t){if(null==t||t<1)return[];for(var n=[],r=0,i=e.length;r<i;)n.push(d.call(e,r,r+=t));return n};var N=function(e,t,n,r,i){if(!(r instanceof t))return e.apply(n,i);var o=w(e.prototype),s=e.apply(o,i);return b.isObject(s)?s:o};b.bind=S(function(e,t,n){if(!b.isFunction(e))throw new TypeError("Bind must be called on a function");var r=S(function(i){return N(e,r,t,this,n.concat(i))});return r}),b.partial=S(function(e,t){var n=b.partial.placeholder,r=function(){for(var i=0,o=t.length,s=Array(o),a=0;a<o;a++)s[a]=t[a]===n?arguments[i++]:t[a];for(;i<arguments.length;)s.push(arguments[i++]);return N(e,r,this,this,s)};return r}),b.partial.placeholder=b,b.bindAll=S(function(e,t){var n=(t=A(t,!1,!1)).length;if(n<1)throw new Error("bindAll must be passed function names");for(;n--;){var r=t[n];e[r]=b.bind(e[r],e)}}),b.memoize=function(e,t){var n=function(r){var i=n.cache,o=""+(t?t.apply(this,arguments):r);return C(i,o)||(i[o]=e.apply(this,arguments)),i[o]};return n.cache={},n},b.delay=S(function(e,t,n){return setTimeout(function(){return e.apply(null,n)},t)}),b.defer=b.partial(b.delay,b,1),b.throttle=function(e,t,n){var r,i,o,s,a=0;n||(n={});var c=function(){a=!1===n.leading?0:b.now(),r=null,s=e.apply(i,o),r||(i=o=null)},u=function(){var u=b.now();a||!1!==n.leading||(a=u);var d=t-(u-a);return i=this,o=arguments,d<=0||d>t?(r&&(clearTimeout(r),r=null),a=u,s=e.apply(i,o),r||(i=o=null)):r||!1===n.trailing||(r=setTimeout(c,d)),s};return u.cancel=function(){clearTimeout(r),a=0,r=i=o=null},u},b.debounce=function(e,t,n){var r,i,o=function(t,n){r=null,n&&(i=e.apply(t,n))},s=S(function(s){if(r&&clearTimeout(r),n){var a=!r;r=setTimeout(o,t),a&&(i=e.apply(this,s))}else r=b.delay(o,t,this,s);return i});return s.cancel=function(){clearTimeout(r),r=null},s},b.wrap=function(e,t){return b.partial(t,e)},b.negate=function(e){return function(){return!e.apply(this,arguments)}},b.compose=function(){var e=arguments,t=e.length-1;return function(){for(var n=t,r=e[t].apply(this,arguments);n--;)r=e[n].call(this,r);return r}},b.after=function(e,t){return function(){if(--e<1)return t.apply(this,arguments)}},b.before=function(e,t){var n;return function(){return--e>0&&(n=t.apply(this,arguments)),e<=1&&(t=null),n}},b.once=b.partial(b.before,2),b.restArguments=S;var D=!{toString:null}.propertyIsEnumerable("toString"),L=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"],V=function(e,t){var n=L.length,r=e.constructor,i=b.isFunction(r)&&r.prototype||a,o="constructor";for(C(e,o)&&!b.contains(t,o)&&t.push(o);n--;)(o=L[n])in e&&e[o]!==i[o]&&!b.contains(t,o)&&t.push(o)};b.keys=function(e){if(!b.isObject(e))return[];if(h)return h(e);var t=[];for(var n in e)C(e,n)&&t.push(n);return D&&V(e,t),t},b.allKeys=function(e){if(!b.isObject(e))return[];var t=[];for(var n in e)t.push(n);return D&&V(e,t),t},b.values=function(e){for(var t=b.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=e[t[i]];return r},b.mapObject=function(e,t,n){t=y(t,n);for(var r=b.keys(e),i=r.length,o={},s=0;s<i;s++){var a=r[s];o[a]=t(e[a],a,e)}return o},b.pairs=function(e){for(var t=b.keys(e),n=t.length,r=Array(n),i=0;i<n;i++)r[i]=[t[i],e[t[i]]];return r},b.invert=function(e){for(var t={},n=b.keys(e),r=0,i=n.length;r<i;r++)t[e[n[r]]]=n[r];return t},b.functions=b.methods=function(e){var t=[];for(var n in e)b.isFunction(e[n])&&t.push(n);return t.sort()};var F=function(e,t){return function(n){var r=arguments.length;if(t&&(n=Object(n)),r<2||null==n)return n;for(var i=1;i<r;i++)for(var o=arguments[i],s=e(o),a=s.length,c=0;c<a;c++){var u=s[c];t&&void 0!==n[u]||(n[u]=o[u])}return n}};b.extend=F(b.allKeys),b.extendOwn=b.assign=F(b.keys),b.findKey=function(e,t,n){t=y(t,n);for(var r,i=b.keys(e),o=0,s=i.length;o<s;o++)if(t(e[r=i[o]],r,e))return r};var U,W,B=function(e,t,n){return t in n};b.pick=S(function(e,t){var n={},r=t[0];if(null==e)return n;b.isFunction(r)?(t.length>1&&(r=_(r,t[1])),t=b.allKeys(e)):(r=B,t=A(t,!1,!1),e=Object(e));for(var i=0,o=t.length;i<o;i++){var s=t[i],a=e[s];r(a,s,e)&&(n[s]=a)}return n}),b.omit=S(function(e,t){var n,r=t[0];return b.isFunction(r)?(r=b.negate(r),t.length>1&&(n=t[1])):(t=b.map(A(t,!1,!1),String),r=function(e,n){return!b.contains(t,n)}),b.pick(e,r,n)}),b.defaults=F(b.allKeys,!0),b.create=function(e,t){var n=w(e);return t&&b.extendOwn(n,t),n},b.clone=function(e){return b.isObject(e)?b.isArray(e)?e.slice():b.extend({},e):e},b.tap=function(e,t){return t(e),e},b.isMatch=function(e,t){var n=b.keys(t),r=n.length;if(null==e)return!r;for(var i=Object(e),o=0;o<r;o++){var s=n[o];if(t[s]!==i[s]||!(s in i))return!1}return!0},U=function(e,t,n,r){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return!1;if(e!=e)return t!=t;var i=typeof e;return("function"===i||"object"===i||"object"==typeof t)&&W(e,t,n,r)},W=function(e,t,n,r){e instanceof b&&(e=e._wrapped),t instanceof b&&(t=t._wrapped);var i=l.call(e);if(i!==l.call(t))return!1;switch(i){case"[object RegExp]":case"[object String]":return""+e==""+t;case"[object Number]":return+e!=+e?+t!=+t:0==+e?1/+e==1/t:+e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object Symbol]":return c.valueOf.call(e)===c.valueOf.call(t)}var o="[object Array]"===i;if(!o){if("object"!=typeof e||"object"!=typeof t)return!1;var s=e.constructor,a=t.constructor;if(s!==a&&!(b.isFunction(s)&&s instanceof s&&b.isFunction(a)&&a instanceof a)&&"constructor"in e&&"constructor"in t)return!1}r=r||[];for(var u=(n=n||[]).length;u--;)if(n[u]===e)return r[u]===t;if(n.push(e),r.push(t),o){if((u=e.length)!==t.length)return!1;for(;u--;)if(!U(e[u],t[u],n,r))return!1}else{var d,f=b.keys(e);if(u=f.length,b.keys(t).length!==u)return!1;for(;u--;)if(d=f[u],!C(t,d)||!U(e[d],t[d],n,r))return!1}return n.pop(),r.pop(),!0},b.isEqual=function(e,t){return U(e,t)},b.isEmpty=function(e){return null==e||(R(e)&&(b.isArray(e)||b.isString(e)||b.isArguments(e))?0===e.length:0===b.keys(e).length)},b.isElement=function(e){return!(!e||1!==e.nodeType)},b.isArray=p||function(e){return"[object Array]"===l.call(e)},b.isObject=function(e){var t=typeof e;return"function"===t||"object"===t&&!!e},b.each(["Arguments","Function","String","Number","Date","RegExp","Error","Symbol","Map","WeakMap","Set","WeakSet"],function(e){b["is"+e]=function(t){return l.call(t)==="[object "+e+"]"}}),b.isArguments(arguments)||(b.isArguments=function(e){return C(e,"callee")});var z=i.document&&i.document.childNodes;"function"!=typeof/./&&"object"!=typeof Int8Array&&"function"!=typeof z&&(b.isFunction=function(e){return"function"==typeof e||!1}),b.isFinite=function(e){return!b.isSymbol(e)&&isFinite(e)&&!isNaN(parseFloat(e))},b.isNaN=function(e){return b.isNumber(e)&&isNaN(e)},b.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"===l.call(e)},b.isNull=function(e){return null===e},b.isUndefined=function(e){return void 0===e},b.has=function(e,t){if(!b.isArray(t))return C(e,t);for(var n=t.length,r=0;r<n;r++){var i=t[r];if(null==e||!f.call(e,i))return!1;e=e[i]}return!!n},b.noConflict=function(){return i._=o,this},b.identity=function(e){return e},b.constant=function(e){return function(){return e}},b.noop=function(){},b.property=function(e){return b.isArray(e)?function(t){return E(t,e)}:x(e)},b.propertyOf=function(e){return null==e?function(){}:function(t){return b.isArray(t)?E(e,t):e[t]}},b.matcher=b.matches=function(e){return e=b.extendOwn({},e),function(t){return b.isMatch(t,e)}},b.times=function(e,t,n){var r=Array(Math.max(0,e));t=_(t,n,1);for(var i=0;i<e;i++)r[i]=t(i);return r},b.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))},b.now=Date.now||function(){return(new Date).getTime()};var $={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},q=b.invert($),G=function(e){var t=function(t){return e[t]},n="(?:"+b.keys(e).join("|")+")",r=RegExp(n),i=RegExp(n,"g");return function(e){return e=null==e?"":""+e,r.test(e)?e.replace(i,t):e}};b.escape=G($),b.unescape=G(q),b.result=function(e,t,n){b.isArray(t)||(t=[t]);var r=t.length;if(!r)return b.isFunction(n)?n.call(e):n;for(var i=0;i<r;i++){var o=null==e?void 0:e[t[i]];void 0===o&&(o=n,i=r),e=b.isFunction(o)?o.call(e):o}return e};var H=0;b.uniqueId=function(e){var t=++H+"";return e?e+t:t},b.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var Y=/(.)^/,J={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},K=/\\|'|\r|\n|\u2028|\u2029/g,X=function(e){return"\\"+J[e]};b.template=function(e,t,n){!t&&n&&(t=n),t=b.defaults({},t,b.templateSettings);var r,i=RegExp([(t.escape||Y).source,(t.interpolate||Y).source,(t.evaluate||Y).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(i,function(t,n,r,i,a){return s+=e.slice(o,a).replace(K,X),o=a+t.length,n?s+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'":r?s+="'+\n((__t=("+r+"))==null?'':__t)+\n'":i&&(s+="';\n"+i+"\n__p+='"),t}),s+="';\n",t.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{r=new Function(t.variable||"obj","_",s)}catch(u){throw u.source=s,u}var a=function(e){return r.call(this,e,b)},c=t.variable||"obj";return a.source="function("+c+"){\n"+s+"}",a},b.chain=function(e){var t=b(e);return t._chain=!0,t};var Z=function(e,t){return e._chain?b(t).chain():t};b.mixin=function(e){return b.each(b.functions(e),function(t){var n=b[t]=e[t];b.prototype[t]=function(){var e=[this._wrapped];return u.apply(e,arguments),Z(this,n.apply(b,e))}}),b},b.mixin(b),b.each(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=s[e];b.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!==e&&"splice"!==e||0!==n.length||delete n[0],Z(this,n)}}),b.each(["concat","join","slice"],function(e){var t=s[e];b.prototype[e]=function(){return Z(this,t.apply(this._wrapped,arguments))}}),b.prototype.value=function(){return this._wrapped},b.prototype.valueOf=b.prototype.toJSON=b.prototype.value,b.prototype.toString=function(){return String(this._wrapped)},void 0===(r=function(){return b}.apply(t,[]))||(n.exports=r)}()}).call(this,n(18),n(19)(e))},function(e,t){var n;n=function(){return this}();try{n=n||Function("return this")()||(0,eval)("this")}catch(r){"object"==typeof window&&(n=window)}e.exports=n},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(15),o=i.tagLogger("Sess"),s=n(21),a=0,c=i.prototypeExtend({setSessId:function(e){return e&&(this.sessId=e),this},setOp:function(e){return e&&(this.op=e),200===e&&(this.res={type:emedia.config.clientType,ver:emedia.config.version,agent:emedia.config.userAgent,ops:emedia.config.acptOps}),this},setTsxId:function(e){return e&&(this.tsxId=e),this},setTicket:function(e){return e&&(this.tkt=e),this},setSdp:function(e){return e&&(this.sdp=e),this},setCands:function(e){return e&&(this.cands=e),this},setSubSId:function(e){return e&&(this.subSId=e),this},setMemId:function(e){return e&&(this.memId=e),this},setPubS:function(e){e&&(this.pubS=i.extend(!1,{},e));var t=this.pubS;return t.ext&&i.isPlainObject(t.ext)&&(t.ext=JSON.stringify(t.ext)),t&&i.forEach(t,function(e,n){(i.isPlainObject(n)||"function"==typeof n)&&i.removeAttribute(t,e)}),t&&i.removeAttribute(t,"localStream"),t&&i.removeAttribute(t,"_localMediaStream"),t&&i.removeAttribute(t,"_webrtc"),this},setRtcId:function(e){return e&&(this.rtcId=e),this},setCver:function(e){return e&&(this.cver=e),this},setEndReason:function(e){return e&&(this.endReason=e),this},setNickName:function(e){return e&&(this.nickName=e),this},setResource:function(e){return e&&(this.resource=e),this},setReason:function(e){return e&&(this.reason=e),this},setConfrId:function(e){return e&&(this.confrId=e),this},setVoff:function(e){return void 0===e||(this.voff=e?1:0),this},setAoff:function(e){return void 0===e||(this.aoff=e?1:0),this},setFlag:function(e){return 0===e&&(this.flag=0),1===e&&(this.flag=1),this},setExt:function(e){return e&&i.isPlainObject(e)&&(e=JSON.stringify(e)),e&&(this.ext=e),this}}),u=emedia.__session_globalCount=0;e.exports=i.prototypeExtend({_events:{0:"onReqP2P",1:"onNewCfr",2:"onDelCfr",3:"onReqTkt",100:"onPing",101:"onPong",102:"onInitC",103:"onReqC",104:"onAcptC",105:"onTcklC",106:"onAnsC",107:"onTermC",300:"onEnter",301:"onExit",302:"onPub",303:"onUnpub",304:"onMems",204:"onClose",400:"onStreamControl",401:"onJoin",412:"onRoleUpdate",1002:"onRemoteControl",1003:"onRecvRemoteMessage"},__init__:function(){var e=this;e._bufferedMessages=[],e._callbacks={},navigator.onLine?e.online=!0:e.online=!1,window.addEventListener("online",function(t){e.online=!0,o.warn("online online online"),e.closed||e._reconnect(emedia.config.reconnect)},!0),window.addEventListener("offline",function(t){e.online=!1,o.warn("offline offline offline"),e.__checkConnectIntervalId&&clearTimeout(e.__checkConnectIntervalId),e.__retryConnectIntervalId&&clearTimeout(e.__retryConnectIntervalId),e.__retryConnectIntervalId&&delete e.__retryConnectIntervalId,e._websocket&&e._websocket.close(1e3)},!0),o.info("online status = ",e.online)},_nextWsUri:function(){var e=this.ticket.url;if("function"==typeof emedia.convertWebsocketURLOfTicket){var t=e;e=emedia.convertWebsocketURLOfTicket(e),o.warn(t,"--\x3e",e)}if(e.startsWith("/")){if(emedia.config.wsorigin)e=emedia.config.wsorigin+e;else{var n=window.location.href,r=n.startsWith("https")?"wss://":"ws://",i=n.indexOf("://")+3,s=n.indexOf("/",i);e=r+n.substring(i,s)+e}o.warn("websocket url. update. {} -> {}",this.ticket.url,e)}else emedia.config.wsorigin&&o.warn("emedia.config.wsorigin invalidate. causeby server url {}",e);return e.indexOf("?")>=0?e+="&"+a++:e+="?"+a++,this.ticket.confrId&&(e+="&"+encodeURIComponent(this.ticket.confrId)),e},_reconnect:function(e){var t=this;function n(){o.warn("Reconnected. at ",e,t._websocket.url),t.__retryConnectIntervalId&&clearTimeout(t.__retryConnectIntervalId),t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId;var n=t.newMessage().setOp(200).setSessId(t._sessionId).setTicket(t.ticket).setNickName(t.nickName||t.ticket.memName).setResource(t.resource).setExt(t.owner.ext);t.postMessage(n,function(e){if(0==e.result)t.onEvent(new s.EnterSuccess),t.owner.onMembers(e.cver,e.mems),t.owner.onStreams(e.cver,e.streams),t.notifyNewMessage();else try{t.onEvent(new s.EnterFail({me:t.owner,cause:new s.RspFail({request:n,response:e})}))}finally{-9527!==e.result&&t.onEvent(new s.ServerRefuseEnter({failed:e.result,msg:e.msg}))}})}t.connect(n,function r(i){if(e<=0)return o.warn("Reconnect end. but fail.",i.url,e),void(t.__retryConnectIntervalId&&delete t.__retryConnectIntervalId);e&&(t.__retryConnectIntervalId=setTimeout(function(){t.connect(n,r,--e)},emedia.config.reconnectDelay))},--e)},__checkConnect:function(){var e=this;e.__checkConnectIntervalId&&clearTimeout(e.__checkConnectIntervalId),emedia.config.checkConnectIntervalMillis&&(e.__checkConnectIntervalId=setTimeout(function(){try{e.online&&!e.connected()&&(e.__retryConnectIntervalId&&o.debug("online, reconnecting..."),e.__retryConnectIntervalId||o.debug("online, but disconnect. will reconnect"),e.__retryConnectIntervalId||e._reconnect(emedia.config.reconnect))}finally{e.__checkConnect()}},emedia.config.checkConnectIntervalMillis))},connect:function(e,t,n){var r=this,a=r.thisWsUri=r._nextWsUri();void 0!==n&&o.warn("begin connect... at retry = ",n,a),function(e,t,n){var r=this;function a(e,i){try{r.onWebsocketEvent(new s.WSClose({url:r.thisWsUri,retry:n,online:r.online,cause:e,event:i,session:r}))}finally{t&&t(new s.WSClose({url:r.thisWsUri,retry:n,online:r.online,cause:e,event:i,session:r}))}}function u(e){if(r.connected(r.thisWsUri)){if(i.isPlainObject(e)&&!(e instanceof c))throw o.error("message not a Messages"),"message not a Messages";r.sessId&&e.sessId!=r.sessId?o.warn("self.sessId && message.sessId != self.sessId",e):(r.thisWsUri===r._websocket.url&&r._websocket.send(JSON.stringify(e)),r.thisWsUri===r._websocket.url&&o.debug("Done send: req:",e,r._websocket.url),r.thisWsUri===r._websocket.url||o.debug("Donot send(url not equal): req:",e,r._websocket.url))}else o.debug("current dont connect. the message = ",e)}if(r.connected(r.thisWsUri))return e&&e(r),o.info("Session connected. dont continue connect"),void(r.notifyNewMessage&&r.notifyNewMessage());if(r.online){r.notifyNewMessage=function(){if(r.connected(r.thisWsUri)){if(0===r._bufferedMessages.length)return;for(var e,t=[];e=r._bufferedMessages.shift();)if(e.sessId||r.sessId||200==e.op){if(200===e.op){u(e);break}r.sessId&&!e.sessId&&(e.sessId=r.sessId);var s=u(e);s&&t.push(s)}else t.push(e),o.warn("tmp store message, util enter success!",e);t.length>0&&Array.prototype.push.apply(r._bufferedMessages,t)}else if(0!==n&&r.online)r.connected();else{var a=i.extend(!1,{},r._callbacks),c=[];for(var d in a){var l=a[d];n>0&&!r.online?c.push(l):r.onMessage({op:1001,tsxId:d,result:-9527,msg:"sdk rsp fail. retry fail or online = "+r.online})}r._bufferedMessages=r._bufferedMessages||[],c.length>0&&Array.prototype.push.apply(r._bufferedMessages,c)}},o.info("Session begin connect.");var d=r._websocket;d&&(o.warn("will close. websocket state",d.readyState,d.url,r.thisWsUri),d.close(1e3));try{o.info("Connecting",r.thisWsUri,n),d=r._websocket=new WebSocket(r.thisWsUri)}catch(l){return o.warn(l),void a(l)}d.onopen=function(n){var i=this.url;if(i===r.thisWsUri)try{o.info("websocket connected:",i),t&&(t=null),e&&e(r),r.onWebsocketEvent(new s.WSConnected({event:n,session:r}))}finally{}else o.warn("ignore the onopen. caused by websocket url not ",r.thisWsUri,i)},d.onmessage=function(e){var t=this.url;if(t===r.thisWsUri){o.debug("recv data",e.data);var n=JSON.parse(e.data);n&&1001==n.op&&o.debug("recv message: rsp:",n),n&&1001!=n.op&&o.debug("recv message: evt:",n),r.onMessage(n)}else o.warn("ignore recv data. caused by websocket url not ",r.thisWsUri,t,e.data)},d.onclose=function(e){var t=this.url;o.info("Disconnected:",t,r.thisWsUri,e),t===r.thisWsUri?(r.notifyNewMessage(),1e3!==e.code&&a(void 0,e)):o.warn("ignore onclose. caused by websocket url not ",r.thisWsUri,t)},d.onerror=function(e){o.info("On error:",e),r.onWebsocketEvent(new s.WSError({event:e,online:r.online,session:r,url:this.url}))}}else a()}.call(r,function(){try{e.apply(r,arguments)}finally{r.__checkConnect()}},function(e){try{t.apply(r,arguments)}finally{n||e.url!==a||r.onEvent(new s.ServerRefuseEnter({failed:-95270,msg:"sdk reconnect fail. "+a+"|"+e.url}))}},n)},connected:function(e){return this.online&&this._websocket&&(!e||e===this._websocket.url)&&this._websocket.readyState==WebSocket.OPEN},onWebsocketEvent:function(e){this.onEvent(e)},register:function(e){if("object"===(void 0===e?"undefined":r(e)))for(var t in e)this.bind(t,e[t])},bind:function(e,t){var n;if(!(n=this._events[e]))throw o.error("Not supported event = ",e),"Not supported event = "+e;this[n]=t},getSessionId:function(){return this._sessionId},newMessage:function(e){return new c(e)},__modifyMessage:function(e){if(e&&e.sdp&&("string"==typeof e.sdp&&(e.sdp=i.parseJSON(e.sdp)),e.sdp.type&&(e.sdp.type=e.sdp.type.toLowerCase()),e.cctx&&(e.sdp.cctx=e.cctx)),e&&e.cands){"string"==typeof e.cands&&(e.cands=i.parseJSON(e.cands));for(var t=0;t<e.cands.length;t++)"string"==typeof e.cands[t]&&(e.cands[t]=i.parseJSON(e.cands[t])),e.cands[t].sdpMLineIndex=e.cands[t].mlineindex,e.cands[t].sdpMid=e.cands[t].mid,delete e.cands[t].mlineindex,delete e.cands[t].mid,e.cctx&&(e.cands[t].cctx=e.cctx)}if(e&&e.mems){if(!i.isArray(e.mems))return;var n=e.mems;e.mems={},i.forEach(n,function(t,n){n.name&&(n.memName=n.name),e.mems[n.id]=n;var r=n.acptOps={};if(i.forEach(emedia.config.baseAcptOps,function(e,t){r[t]=!0}),n.res&&i.forEach(n.res.ops,function(e,t){r[t]=!0}),n&&n.ext)try{e.mems[n.id].ext=JSON.parse(n.ext)}catch(s){o.debug(s)}})}if(e&&e.mem){e.mem.name&&(e.mem.memName=e.mem.name);var r=e.mem.acptOps={};if(i.forEach(emedia.config.baseAcptOps,function(e,t){r[t]=!0}),e.mem.res&&i.forEach(e.mem.res.ops,function(e,t){r[t]=!0}),e.mem&&e.mem.ext)try{e.mem.ext=JSON.parse(e.mem.ext)}catch(a){o.debug(a)}}if(e&&e.streams){if(!i.isArray(e.streams))return;var s=e.streams;e.streams={},i.forEach(s,function(t,n){if(e.streams[n.id]=n,n&&n.ext)try{e.streams[n.id].ext=JSON.parse(n.ext)}catch(a){o.debug(a)}})}if(e&&e.pubS&&e.pubS&&e.pubS.ext)try{e.pubS.ext=JSON.parse(e.pubS.ext)}catch(a){o.debug(a)}if(e&&e.ext)try{e.ext=JSON.parse(e.ext)}catch(a){o.debug(a)}return e},onMessage:function(e){var t=this;function n(e){var n,r=e.op;(n=t._events[r])&&(n=t[n])?n.call(t,e):o.warn("Not supported event = ",e)}if(1001!=e.op&&!e.sessId)throw o.error("message sessId error. server evt data error"),"message sessId error. server evt data error";if(1001!=e.op&&t._sessionId&&t._sessionId!=e.sessId)throw o.error("message sessId error. server and local not equal"),"message sessId error. server and local not equal";if(1004!==e.op){e=t.__modifyMessage(e);var r=i.removeAttribute(t._callbacks,e.tsxId);if(r&&200===r.op)if(t._sessionId=e.sessId,0===e.result){for(var a in t._bufferedMessages){var c=t._bufferedMessages[a];c.sessId||200===c.op||(c.sessId=e.sessId)}setTimeout(function(){t.notifyNewMessage()},100)}else for(var u;u=t._bufferedMessages.shift();)200!==u.op&&t.onMessage({op:1001,tsxId:u.tsxId,result:-9527,msg:"sdk enter fail. sdk callback. enter result = "+e.result});t.owner&&t.owner.closed?o.warn("self closed. me is "+t.owner.getMemberId()+", session_id = "+t.getSessionId()+". drop message",e):(t.onEvent(new s.RecvResponse({request:r,response:e})),r&&r.__callback__&&1004!==e.op?r.__callback__(e):e.op&&1001!=e.op?n(e):o.debug("Igron message. caused by op not found.",e))}else n(e)},__modifyMessageForPost:function(e){if(e.cands){for(var t=[],n=e.cands,r=0;r<n.length;r++){var o;0==r&&n[r].cctx&&(e.cctx=n[r].cctx),o="string"==typeof n[r]?{type:"candidate",candidate:n[r],mlineindex:0,mid:"audio"}:{type:"candidate",candidate:n[r].candidate,mlineindex:n[r].sdpMLineIndex,mid:n[r].sdpMid},t.push(JSON.stringify(o))}e.cands=t}if(e.sdp&&"string"!=typeof e.sdp){var s={type:e.sdp.type,sdp:e.sdp.sdp};e.sdp.cctx&&(e.cctx=e.sdp.cctx),e.sdp=s,e.sdp.type=e.sdp.type.toUpperCase(),e.sdp=i.stringifyJSON(e.sdp)}return e.pubS&&i.removeAttribute(e.pubS,"_located"),e.pubS&&i.removeAttribute(e.pubS,"mutedMuted"),e.pubS&&i.removeAttribute(e.pubS,"mediaStream"),e.pubS&&i.removeAttribute(e.pubS,"isRepublished"),e.pubS&&i.removeAttribute(e.pubS,"optimalVideoCodecs"),"function"==typeof e.post&&i.removeAttribute(e,"post"),e},postMessage:function(e,t,n){var r=this;if(e.tsxId||(e.tsxId="MSG"+Date.now()+"-"+u++),e.memId){var s=r.owner._cacheMembers[e.memId];if(!s)return o.warn("Member not found at local. memberId = "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not found at local. memberId = "+e.memId}));var a=e._reqOps;for(var c in a||(a=[]).push(e.op),a){var d=a[c];if(!s.acptOps[d])return o.warn("Member not accept op "+d+", "+e.memId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-507,msg:" member not accept op "+d+", "+e.memId}))}}if(i.removeAttribute(e,"_reqOps"),r._sessionId&&r._sessionId!=e.sessId)return o.warn("sessionId not excepted. self._sessionId = "+r._sessionId,e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"sessionId not excepted."}));if(r.closed)return o.warn("session closed.",e),void(t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"session closed"}));var l=i.extend({},e);if(!(e=r.__modifyMessageForPost(e)))return o.warn("Message drop. callback success.",e),void(t&&t({op:1001,tsxId:l.tsxId,result:0,msg:"Message drop. callback success."}));200===e.op?(r._bufferedMessages.unshift(e),t&&setTimeout(function(){r._callbacks[e.tsxId]&&(o.error("Enter timeout. fail."),r.onMessage({op:1001,tsxId:e.tsxId,result:-9527,msg:"enter timeout. millis = "+emedia.config.enterTimeout}))},emedia.config.enterTimeout)):r._bufferedMessages.push(e),t&&(r._callbacks[e.tsxId]=i.extend(e,{__callback__:t.bind(r.owner)})),r.notifyNewMessage&&r.notifyNewMessage(),n&&t&&setTimeout(function(){var e=r._callbacks[e.tsxId];e&&e.__callback__&&e.__callback__({op:1001,tsxId:l.tsxId,result:-408,msg:"Message request timeout."}),i.removeAttribute(r._callbacks,e.tsxId)},n)},close:function(e){o.warn("sessiong closing, reason = ",e);this.notifyNewMessage&&this.notifyNewMessage(),this.closed=!0,this.seqno=0,this._websocket&&(0==e||100==e?this._websocket.close(1e3):this._websocket.close()),this.__retryConnectIntervalId&&clearTimeout(this.__retryConnectIntervalId),this.__retryConnectIntervalId&&delete this.__retryConnectIntervalId,this.__checkConnectIntervalId&&clearTimeout(this.__checkConnectIntervalId),this.__checkConnectIntervalId&&delete this.__checkConnectIntervalId,this.owner=null,this._bufferedMessages=[],this._callbacks={},o.warn("session closed")}})},function(e,t,n){var r=n(15),i=(r.logger,r.prototypeExtend({msg:"",__init__:function(){this.day=new Date},execTime:function(){var e=this.day.getHours();e<10&&(e="0"+e);var t=this.day.getMinutes();t<10&&(t="0"+t);var n=this.day.getSeconds();return n<10&&(n="0"+n),e+":"+t+":"+n}})),o=i.extend({_webrtcDesc:function(){this.webrtc;return this.webrtc.getRtcId()}});e.exports={Exception:i.extend(),WSClose:i.extend({message:function(){var e=this.execTime()+" WSClose: Websocket close ("+(this.retry||0)+").";return this.online||(e+=" offline."),this.event&&(e+=" wscode: "+this.event.code),this.cause&&(e+=" cause: "+this.cause.message),this.url&&(e+=" url: "+this.url),e+=" retry: "+(this.retry||0),this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),e}}),WSError:i.extend({message:function(){var e=this.execTime()+" WSError: Websocket error. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState)+". online = "+this.online;return this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),this.url&&(e+=" url: "+this.url),e}}),WSConnected:i.extend({message:function(){var e=this.execTime()+" WSConnected: Websocket success. ready state:"+(this.event.srcElement&&this.event.srcElement.readyState||this.event.currentTarget.readyState);return this.session&&this.session.getSessionId()&&(e=e+", sess = "+this.session.getSessionId()),e}}),ICEChanage:o.extend({message:function(){return this.execTime()+" ICEChanage: "+this._webrtcDesc()+" state: "+this.state}}),AddIceCandError:o.extend({message:function(){return this.execTime()+" AddIceCandError: "+this._webrtcDesc()+", add cand error"}}),ICEConnectFail:o.extend({message:function(){return this.execTime()+" ICEConnectFail: "+this._webrtcDesc()+" failed"}}),ICEConnected:o.extend({message:function(){return this.execTime()+" ICEConnected: "+this._webrtcDesc()+" connected"}}),ICEDisconnected:o.extend({message:function(){return this.execTime()+" ICEDisconnected: "+this._webrtcDesc()+" disconnected"}}),ICEClosed:o.extend({message:function(){return this.execTime()+" ICEClosed: "+this._webrtcDesc()+" closed"}}),ICERemoteMediaStream:o.extend({message:function(){return this.execTime()+" ICERemoteMediaStream: "+this._webrtcDesc()+" got remote stream"}}),StreamState:i.extend({message:function(){return this.execTime()+" StreamState:  stream "+this.stream.id+" state: "+this.state+" "+this.msg},iceFail:function(){this.state=1,this.msg="network anomaly. media lost"}}),OpenMediaError:i.extend({message:function(){return this.execTime()+" OpenMediaError:  open media error. caused by "+this.event.toString()}}),Hangup:i.extend({message:function(){return this.self?"hangup id = "+(this.self.id||"--")+" reason："+(this.reason||0):this.execTime()+" Hangup: "+(this.parnter&&(this.parnter.name||this.parnter.id||" ")||"")+" hangup, reason："+(this.reason||0)}}),ServerRefuseEnter:i.extend({message:function(){return this.execTime()+" ServerRefuseEnter: server refuse, cause："+this.failed+", msg:"+(this.msg||"")}}),RspFail:i.extend({__init__:function(){this.day=new Date,this.failed=this.response.result,this.msg=this.response.msg||this.response.message||"--"},message:function(){return this.execTime()+" RspFail: "+this.request.tsxId+", "+(this.response.sessId||"--")+" op: "+this.request.op+", cause: "+this.failed+" "+this.msg}}),RecvResponse:i.extend({__init__:function(){this.day=new Date,this.failed=this.response.result,this.msg=this.response.msg},message:function(){return this.request?this.execTime()+" RecvResponse: "+(this.request&&this.request.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.request&&this.request.op)+", cause: "+this.failed+" "+this.msg:this.execTime()+" RecvMessage: "+(this.response&&this.response.tsxId)+", "+(this.response.sessId||"--")+" op: "+(this.response&&this.response.op)+" "+this.msg}}),EnterFail:i.extend({message:function(){return this.execTime()+" EnterFail: enter fail："+(this.cause?this.cause.message():"unkown")}}),EnterSuccess:i.extend({message:function(){return this.execTime()+" EnterSuccess: enter success"}}),PushSuccess:i.extend({message:function(){return this.execTime()+" PushSuccess: push success, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId}}),PushFail:i.extend({message:function(){return this.execTime()+" PushFail: push fail, streamId = "+this.stream.id+", "+this.stream.optimalVideoCodecs+", webrtc = "+this.stream.rtcId+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),RemoteControlFail:i.extend({message:function(){return this.execTime()+" RemoteControlFail: "+(this.type||"remote control")+" fail, "+(this.stream?this.stream.id:"")+" failed = "+this.failed+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubSuccess:i.extend({message:function(){return this.execTime()+" SubSuccess: sub success, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId}}),SubFail:i.extend({message:function(){return this.execTime()+" SubFail: sub fail, streamId = "+this.stream.id+", "+this.stream.vcodes+", webrtc = "+this.stream.rtcId+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubFailNotSupportVCodes:i.extend({message:function(){return this.execTime()+" SubFailNotSupportVCodes: sub fail, streamId = "+this.stream.id+" cause："+(this.cause?this.cause.message?this.cause.message():this.cause:"unkown")}}),SubFailSafariNotAllowSubBeforePub:i.extend({message:function(){return this.execTime()+" SubFailSafariNotAllowSubBeforePub: sub fail, streamId = "+this.stream.id+" cause：Safari without access to capture devices, WebKit only exposes Server Reflexive and TURN ICE candidates, which expose IPs that could already be gathered by websites."}}),SwitchVCodes:i.extend({message:function(){return this.execTime()+" SwitchVCodes: pub streamId = "+this.stream.id}}),CurrentCalling:i.extend({message:function(){return this.execTime()+" CurrentCalling: warn! current calling..."}}),OpenDesktopMedia:i.extend({message:function(){return this.execTime()+" OpenDesktopMedia: shared desktop, desktopStreamId = "+desktopStreamId}}),OpenDesktopMediaAccessDenied:i.extend({message:function(){return this.execTime()+" OpenDesktopMediaAccessDenied: shared desktop not allow"}}),ShareDesktopExtensionNotFound:i.extend({message:function(){return this.execTime()+" ShareDesktopExtensionNotFound: shared desktop plugin required"}}),OtherDeviceAnswer:i.extend({message:function(){return this.execTime()+" other device answer, webrtc = "+this.rtcId}}),AudioMixerStreamNotAllowSub:i.extend({message:function(){return this.execTime()+" audio mixer stream not allow sub, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}),AudioMixerStreamNotAllowOnlySubVideo:i.extend({message:function(){return this.execTime()+" audio mixer stream not allow only sub video, webrtc = "+this.rtcId+", streamId = "+this.stream.id}}),AudioMixerStreamRepeatPublish:i.extend({message:function(){return this.execTime()+" audio mixer stream repeat publish"}})}},function(e,t,n){var r=n(15),i=r.tagLogger("Me"),o=n(23),s=n(21),a=n(26),c=o.extend({__init__:function(){if(this._session||this.sessionFactory&&(this._session=this.sessionFactory()),!this._session)throw i.error("Require session"),"Require session";this._cver=0,this._cacheMembers={},this._cacheStreams={},this._mediaMeters={},this._openedRtcMediaStreams={},this._linkedStreams={},this._maybeNotExistStreams={},this._records={},this._ices={},this.audioMixers={},this.closed=!1,this._nextStreamSeqno=0,this.getMediaMeterIntervalMillis=this.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis},getCurrentMembers:function(){var e=[];return r.forEach(this._cacheMembers,function(t,n){var i=r.extend(!0,{},n);e.push(i)}),e},newStream:function(e){var t=this;return new a(e,{__init__:function(){if(this.rtcId||this._webrtc&&(this.rtcId=this._webrtc.getRtcId()),this._webrtc||this.rtcId&&(this._webrtc=t._ices[this.rtcId]),this.__create_id=t._nextStreamSeqno++,this.memId&&!this.owner&&(this.owner=r.extend({},t._cacheMembers[this.memId]),!this.owner&&!this.located()))throw i.error("Remote stream, not owner. it = ",this.id),"Remote stream, not owner. it = "+this.id}})},getConfrId:function(){return this.ticket.confrId},isCaller:function(){return this.isP2P()&&this.ticket.caller==this.ticket.memName},isCallee:function(){return this.isP2P()&&this.ticket.callee==this.ticket.memName},isP2P:function(){return this.ticket&&("P2P"==this.ticket.type||"p2p"==this.ticket.type)},isConfr:function(){return this.ticket&&("CONFR"==this.ticket.type||"confr"==this.ticket.type)},onEvent:function(e){},join:function(e,t){i.debug("begin join ...");var n,r=this;if(r._memberId)return i.warn("Had joined. igrone it"),void(e&&e(r.memId));function o(e){try{if(e instanceof s.WSClose&&e.retry)return;e instanceof s.EnterFail||(e=new s.EnterFail({attendee:r,cause:e})),r.onEvent(e),t&&t(e)}finally{}}function a(t){if(0==t.result){r.reflushSupportVCodes(t.vcodes),r.setMemberId(t.memId),r.role=t.role,r.onEvent(new s.EnterSuccess),e&&e(t.memId);try{r.__rtc_cfg=t.rtcCfg,"string"==typeof t.rtcCfg&&(r.__rtc_cfg=JSON.parse(t.rtcCfg))}finally{r.onMembers(t.cver,t.mems),r.onStreams(t.cver,t.streams)}}else try{o(new s.RspFail({request:n,response:t}))}finally{-9527!==t.result&&r.onEvent(new s.ServerRefuseEnter({failed:t.result,msg:t.msg}))}}r.connect(function(){n=r.newMessage().setOp(200).setTicket(r.ticket).setNickName(r.nickName||r.ticket.memName).setResource(r.resource).setExt(r.ext),r.postMessage(n,a)},o),i.debug("join",r.ticket.url)},withpublish:function(e){var t,n=this;if(!e||!e.localStream)throw i.error("pubS null or stream not open"),"pubS null or stream not open";var r,o=e&&e.localStream;return{join:function(a,c){if(1===arguments.length&&(c=a,a=void 0),n._memberId)return i.warn("Had joined. igrone it"),void(a&&a(n.memId));function u(e){try{if(e instanceof s.WSClose&&e.retry)return;e instanceof s.EnterFail||(e=new s.EnterFail({attendee:n,cause:e})),n.onEvent(e),c&&c(e)}finally{emedia.stopTracks(o),r&&n.closeWebrtc(r.getRtcId())}}var d=n.getOptimalVideoCodecs();function l(o){if(0==o.result){n.reflushSupportVCodes(o.vcodes),n.setMemberId(o.memId),n.role=o.role,n.onEvent(new s.EnterSuccess);var c=n.newStream(e);c._localMediaStream=e.localStream,c.rtcId=r.getRtcId(),c._webrtc=r,c.id=o.streamId,c.csrc=o.csrc,c.owner={id:o.memId,nickName:n.nickName,name:n.sysUserId,ext:n.extObj},c.optimalVideoCodecs=d,a&&a(o.memId,c),n.onEvent(new s.PushSuccess({stream:c,hidden:!0})),o.sdp&&n.ansC(r.getRtcId(),o.sdp),o.cands&&n.tcklC(r.getRtcId(),o.cands);try{n.__rtc_cfg=o.rtcCfg,"string"==typeof o.rtcCfg&&(n.__rtc_cfg=JSON.parse(o.rtcCfg)),n.__rtc_cfg&&n.__rtc_cfg.iceServers&&n.__rtc_cfg.iceServers.length>0&&(i.warn("Server rsp one rtc cfg. publish will republish"),n._service&&setTimeout(function(){n._service._republish(c)},200))}finally{n.onMembers(o.cver,o.mems),n.onStreams(o.cver,o.streams)}}else try{u(new s.RspFail({request:t,response:o}))}finally{-9527!==o.result&&n.onEvent(new s.ServerRefuseEnter({failed:o.result,msg:o.msg}))}}n.connect(function(){i.debug("enter and pubs");var o,s,a=e.localStream;2===e.type&&(o={offerToReceiveAudio:!0,offerToReceiveVideo:!1},s={subSVideo:!1,subSAudio:!0}),r=n.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:d,offerOptions:o,subArgs:s,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),n.setLocalStream(a,r.getRtcId()),n.doOffer(r.getRtcId(),function(i){t=n.newMessage().setOp(200).setTicket(n.ticket).setNickName(n.nickName||n.ticket.memName).setResource(n.resource).setSdp(i).setRtcId(r.getRtcId()).setPubS(e).setExt(n.ext),n.postMessage(t,l)})},u),i.debug("join",n.ticket.url)}}},push:function(e,t,n,r){i.debug("begin push ...");var o,a=this;if(2===arguments.length&&(n=t,t=void 0),!e||!e.localStream)throw i.error("pubS or stream open"),"pubS or stream open";var c,u=e.localStream;function d(t){try{var i=a.newStream(e);i._localMediaStream=e.localStream,i._webrtc=c,i.rtcId=c&&c.getRtcId(),i.owner={id:a.getMemberId(),nickName:a.nickName,name:a.sysUserId,ext:a.extObj};t=new s.PushFail({stream:i,cause:t,hidden:r&&!0===t.hidden});a.onEvent(t),t.hidden||n&&n(t)}finally{u&&!0!==t.hidden&&emedia.stopTracks(u),c&&a.closeWebrtc(c.getRtcId(),!0===t.hidden)}}if(e.rtcId||2!==e.type||emedia.config.allowRepeatAudioMixerPublish||!a._service.hasAudioMixers()){var l=e.optimalVideoCodecs||a.getOptimalVideoCodecs();!function(e){i.debug("pubs");var t,n,r=e.localStream;2===e.type&&(t={offerToReceiveAudio:!0,offerToReceiveVideo:!1},n={subSVideo:!1,subSAudio:!0}),c=a.createWebrtc({_rtcId:e.rtcId,optimalVideoCodecs:l,offerOptions:t,subArgs:n,vbitrate:e.vbitrate||e.constaints&&e.constaints.video&&e.constaints.video.bitrate,abitrate:e.abitrate||e.constaints&&e.constaints.audio&&e.constaints.audio.bitrate},e.iceRebuildCount),a.setLocalStream(r,c.getRtcId()),a.doOffer(c.getRtcId(),function(t){o=a.newMessage().setOp(102).setRtcId(c.getRtcId()).setSdp(t).setPubS(e),a.postMessage(o,function(e){f(c,e)})})}(e),i.debug("push",a.ticket.url)}else d(new s.AudioMixerStreamRepeatPublish);function f(n,r){if(0==r.result){var i=a.newStream(e);i._localMediaStream=e.localStream,i._webrtc=n,i.rtcId=n.getRtcId(),i.id=r.streamId,i.csrc=r.csrc,i.owner={id:a.getMemberId(),nickName:a.nickName,name:a.sysUserId,ext:a.extObj},i.optimalVideoCodecs=l,i.id&&2===i.type&&(a.audioMixers[i.id]=i);try{a.onEvent(new s.PushSuccess({stream:i,hidden:!0}))}finally{r.sdp&&a.ansC(n.getRtcId(),r.sdp),r.cands&&a.tcklC(n.getRtcId(),r.cands),t&&t(i)}}else d(new s.RspFail({request:o,response:r,hidden:!0===r.retrying}))}},isSafari:function(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)},isSafariButNotPushStream:function(e,t){var n=this;return!(!n.isSafari()||emedia._isSafariYetPushedStream)&&(!0===n.__tryingOpenMedia?(n.__tryingOpenMediaWaitSuceess=n.__tryingOpenMediaWaitSuceess||[],n.__tryingOpenMediaWaitFail=n.__tryingOpenMediaWaitFail||[],"function"==typeof e&&n.__tryingOpenMediaWaitSuceess.push(e),"function"==typeof t&&n.__tryingOpenMediaWaitFail.push(t)):(n.__tryingOpenMedia=!0,n._service.__getUserMedia({audio:!0},function(t,i){emedia._isSafariYetPushedStream=!0,emedia.stopAudioTracks(i),setTimeout(function(){n.__tryingOpenMedia=!1,e&&e.apply(n),n.__tryingOpenMediaWaitSuceess&&r.forEach(n.__tryingOpenMediaWaitSuceess,function(e,t){t.apply(n)}),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]},300)},function(e){n.__tryingOpenMedia=!1,i.error("Safari must getUserMedia, gather cands. now try get audio. fail. subfail"),t&&t.call(n,e),n.__tryingOpenMediaWaitFail&&r.forEach(n.__tryingOpenMediaWaitFail,function(t,r){r.call(n,e)}),n.__tryingOpenMediaWaitSuceess=[],n.__tryingOpenMediaWaitFail=[]})),!0)},createWebrtcAndSubscribeStream:function(e,t,n,o){var a=this;t||(t={});var c=a._cacheStreams[e],u=a._cacheMembers[c.memId],d=c;function l(n){i.warn("sub stream error",e,n),v&&d._webrtc&&d._webrtc.setSubArgs(v),v&&(d.subArgs=v),n=new s.SubFail({stream:d,hidden:!0===n.hidden,cause:n}),t&&t.onEvent&&t.onEvent(n),a.onEvent&&a.onEvent(n)}o=o||d.subArgs||{subSVideo:!0,subSAudio:2!==c.type};var f=c.vcodes||[],p=u&&u.vcodes||[],h=a.supportVCodes,m=a._getOptimalVideoCodecsSubset(f,p,h);o=o||d.subArgs;var v=d.subArgs,b=!(d.vcodes&&d.vcodes.length>0);emedia.isSafari&&(b=b||!!d.voff);var g={offerToReceiveAudio:!0,offerToReceiveVideo:o.subSVideo&&!b};g.offerToReceiveAudio||g.offerToReceiveVideo||i.warn("offerToReceiveAudio == false and offerToReceiveVideo == false");var _=a.createWebrtc({iceServerConfig:n,optimalVideoCodecs:m,offerOptions:g,onGotMediaStream:function(e){var n=new s.SubSuccess({stream:d,hidden:!0});t.onGotRemote&&t.onGotRemote(d),a.onEvent&&a.onEvent(n)}},d.iceRebuildCount),y=_.getRtcId();i.warn(y," sub stream ",e,m),d._webrtc=_,d.rtcId=y,d.owner=r.extend({},u),o&&d._webrtc&&d._webrtc.setSubArgs(o),o&&(d.subArgs=o),a.isSafariButNotPushStream(function(){a.offerCall(y,null,e,l,function(){})},function(t){i.error("Safari must getUserMedia, gather cands. now try get audio. fail. subfail",y,e),l(t)})||a.offerCall(y,null,e,l,function(){})},_getOptimalVideoCodecsSubset:function(e,t,n){var i=this,o=[];if(e&&e.length>0&&n[e[0]]&&o.push(e[0]),0==o.length)for(var s=0;s<i._orderVCodes.length;s++)r.forEach(t,function(e,t){t==i._orderVCodes[s]&&o.push(t)});return o},subscribeStream:function(e,t,n,i,o){var a=this,c=a._ices[e],u=a._cacheStreams[t],d=a._cacheMembers[u.memId],l=u;l._webrtc=c,l.rtcId=e,l.owner=r.extend({},d);var f=l.subArgs;if(i=i||{subSVideo:!0,subSAudio:!0},l.subArgs=l.subArgs||{subSVideo:!0,subSAudio:!0},l._webrtc&&(l._webrtc.subArgs=l._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!l.subArgs.subSVideo&&i.subSVideo&&!l.voff){var p=u.vcodes,h=d.vcodes,m=a.supportVCodes;a._getOptimalVideoCodecsSubset(p,h,m)}i&&l._webrtc&&l._webrtc.setSubArgs(i),i&&(l.subArgs=i);var v=a.newMessage().setOp(205).setRtcId(e).setSubSId(t);i&&r.extend(v,i),a.postMessage(v,function(e){if(0!=e.result){f&&l._webrtc&&l._webrtc.setSubArgs(f),f&&(l.subArgs=f);var t=new s.SubFail({stream:l,cause:new s.RspFail({request:v,response:e})});return n&&n(t),void a.onEvent(t)}t=new s.SubSuccess({stream:l,hidden:!0});a._updateRemoteStream(l,l._webrtc.getRemoteStream()),a.onEvent(t),"function"==typeof o&&o()})},unsubscribeStream:function(e){var t=this._cacheStreams[e],n=t._webrtc&&t._webrtc.getRtcId();if(n){try{var r=this.newMessage().setOp(206).setRtcId(n).setSubSId(e);this.postMessage(r)}finally{this.closeWebrtc(n)}return n}},onEnter:function(e,t){var n=this;if(e&&(n._cver=e),t&&!n._cacheMembers[t.id]){n._cacheMembers[t.id]=t;var i={};t.res&&t.res.vcodes&&t.res.vcodes.length>0&&r.forEach(t.res.vcodes,function(e,t){i[t]||(i[t]=!0,n.supportVCodes[t]&&n.supportVCodes[t]++)}),n.onAddMember(r.extend({},t))}},_onFinally:function(){this._cacheMembers={},this._cacheStreams={},this._linkedStreams={},this._ices={},this._maybeNotExistStreams={};var e=[];if(r.forEach(this._openedRtcMediaStreams,function(t,n){!1!==n.active&&e.push(n)}),e.length>0)for(var t=0;t<e.length;t++)try{var n=e[t];i.info("exit, close stream = ",n.id),emedia.stopTracks(n)}catch(o){i.error(o)}i.warn("finally. all clean.")},_onRoleUpdate:function(e,t){i.info("Role ",e," <-",this.role),i.info(t),this.role=e,this.roleToken=t,this.onRoleUpdate&&this.onRoleUpdate(e,t)},onExit:function(e,t,n){var o=this;if(e&&(o._cver=e),t!=o.getMemberId()){var a=o._cacheMembers[t];a&&(a.res&&a.res.vcodes&&a.res.vcodes.length>0&&r.forEach(a.res.vcodes,function(e,t){o.supportVCodes[t]--}),o._onRemoveMember(a,n),o.onEvent(new s.Hangup({reason:n,parnter:a})))}else{i.warn("Me exit. ",n,t);try{o.closed||o.close(n)}catch(c){o.onEvent(new s.Hangup({reason:n,self:{id:o._memberId}})),o.onMeExit&&o.onMeExit(n),i.warn(c)}}},onPub:function(e,t,n){if(!this._cacheMembers[t])throw i.error("No found member. when pub"),"No found member. when pub";var o=this.newStream(n),s=this._cacheStreams[n.id];if(e&&(this._cver=e),s&&o.sver!==s.sver)return i.info("Onpub. the steam ",s.id," republish. sver ",s.sver,o.sver),!o||o.aoff===s.aoff&&o.voff==s.voff||this.onStreamControl(void 0,n.id,o.voff,o.aoff),r.extend(s,o),void this._onRepublishStream(s);var a=o;return a.owner=this._cacheMembers[t],this._cacheStreams[n.id]=a,this._onAddStream(this.newStream(a)),this.autoSub&&this.createWebrtcAndSubscribeStream(n.id,{onGotRemote:function(e){}}),a},onUnpub:function(e,t,n){var r=this._cacheStreams[n];this._onRemovePubstream(this._cacheMembers[t],r),e&&(this._cver=e)},onClose:function(e,t,n){try{this.close(n||0)}finally{this.onConfrClose&&this.onConfrClose(t,n)}},__getWebrtcFor:function(e){var t=this._cacheStreams[e]&&this._cacheStreams[e]._webrtc;return t&&t.getRtcId()},_getWebrtc:function(e){return this._cacheStreams[e]&&this._cacheStreams[e]._webrtc},_updateRemoteStream:function(e,t){e.located()&&2===e.type?emedia.enableAudioTracks(t,!0):emedia.enableAudioTracks(t,!(e.aoff||e.subArgs&&!1===e.subArgs.subSAudio)),emedia.enableVideoTracks(t,!(e.voff||e.subArgs&&!1===e.subArgs.subSVideo))},onStreamControl:function(e,t,n,r,i){(s=this._cacheStreams[t]).voff=n,s.aoff=r;var o=s._webrtc;o&&o._remoteStream&&this._updateRemoteStream(s,o._remoteStream);var s=this.newStream(s);this.onUpdateStream&&this.onUpdateStream(s,new s.Update({voff:n,aoff:r})),e&&(this._cver=e),i&&(s.sver=i)},aoff:function(e,t,n){var r=this.__getWebrtcFor(e.id);if(!r)throw i.error("pubS not publish",e.id),"pubS not publish"+e.id;this._linkedStreams[e.id].aoff=e.aoff=t;var o=this.newMessage().setOp(400).setRtcId(r).setVoff(e.voff).setAoff(t);this.postMessage(o,n),this.onUpdateStream&&this.onUpdateStream(e,new e.Update({aoff:t}))},voff:function(e,t,n){var r=this.__getWebrtcFor(e.id);if(!r)throw i.error("pubS not publish",e.id),"pubS not publish"+e.id;this._linkedStreams[e.id].voff=e.voff=t;var o=this.newMessage().setOp(400).setRtcId(r).setVoff(t).setAoff(e.aoff);this.postMessage(o,n),this.onUpdateStream&&this.onUpdateStream(e,new e.Update({voff:t}))},startRecord:function(e,t){var n=this,o=e.rtcId,s=n.newMessage().setOp(500).setRtcId(o).setFlag(1);n.postMessage(s,function(s){i.warn("record ",o,s.result,s.msg),t&&t(0===s.result),0===s.result&&(n._records[e.id]=r.extend(!1,{},e))})},stopRecord:function(e,t){var n=e.rtcId,o=this.newMessage().setOp(500).setRtcId(n).setFlag(0);this.postMessage(o,function(e){i.warn("stop record ",n,e.result,e.msg),t&&t(0===e.result)}),this._records[e.id]&&r.removeAttribute(this._records,e.id)},onMembers:function(e,t){var n=this,i=[];r.forEach(n._cacheMembers,function(e,n){t[e]||i.push(n)}),r.forEach(i,function(e,t){n.onExit(void 0,t.id)});var o=[];r.forEach(t,function(e,t){e!=n.getMemberId()&&(n._cacheMembers[e]||o.push(t),n._cacheMembers[e]&&r.extend(n._cacheMembers[e],t))}),r.forEach(o,function(e,t){n.onEnter(void 0,t)}),e&&(n._cver=e)},onStreams:function(e,t){var n=this,i=[];r.forEach(n._cacheStreams,function(e,n){n.located()||t[e]||i.push(n)}),r.forEach(i,function(e,t){n.onUnpub(void 0,t.memId,t.id)});var o=[];r.forEach(t,function(e,t){t.memId!=n.getMemberId()&&(n._cacheStreams[e]||o.push(t),n._cacheStreams[e]&&r.extend(n._cacheStreams[e],t))}),r.forEach(o,function(e,t){n.onPub(void 0,t.memId,t)}),r.forEach(n._cacheStreams,function(e,i){var o;i.located()||(o=t[e]),!o||o.aoff===i.aoff&&o.voff==i.voff||n.onStreamControl(void 0,e,o.voff,o.aoff),o&&o.sver!==i.sver&&(r.extend(i,o),n._onRepublishStream(i))}),e&&(n._cver=e)},_onRemoveMember:function(e,t){var n=this;i.info("remove",e,t);var o=[];r.forEach(n._cacheStreams,function(t,n){(n.memId||n.owner&&n.owner.id)===e.id&&o.push(n)}),r.forEach(o,function(e,r){n._onRemovePubstream(r.owner,r,t)}),r.removeAttribute(n._cacheMembers,e.id),n.onRemoveMember&&n.onRemoveMember(e,t)},_onAddStream:function(e){i.info("add stream ",e.id),i.debug("add stream ",e);this.onAddStream(e)},_onRemovePubstream:function(e,t){var n=this;if(t&&0!=t.id)try{var i=r.removeAttribute(n._mediaMeters,t.id);i&&i._finally()}finally{!function(e){2===e.type&&(r.removeAttribute(n.audioMixers,e.id),e.remotePlayAudioObject&&document.body.removeChild(e.remotePlayAudioObject)),n.unsubscribeStream(e.id),r.removeAttribute(n._cacheStreams,e.id),n._monitSoundChanagedStreams&&r.removeAttribute(n._monitSoundChanagedStreams,e.id),n.onRemoveStream&&(e=n.newStream(e),n.onRemoveStream(e))}(t)}},_onRepublishStream:function(e){if(!this._ices[e.rtcId]&&!emedia.subscribed(e)||this._maybeNotExistStreams[e.id])this.onUpdateStream(e);else{this.unsubscribeStream(e.id);this.createWebrtcAndSubscribeStream(e.id,{onGotRemote:function(e){}})}},_onRecvRemoteMessage:function(e,t,n){i.debug("Recv remote message",e,t);var r,o=this._cacheMembers[e];try{r=JSON.parse(t)}catch(s){}this.onRecvRemoteMessage&&this.onRecvRemoteMessage(o||e,r||t,n)},_onSoundChanage:function(e,t,n){emedia.config._printSoundData&&i.info("Stream id "+t.id+", meter "+(n&&n.instant.toFixed(2)+" "+n.slow.toFixed(2)+" "+n.clip.toFixed(2)+" "+(n.trackAudioLevel||"--")+" "+(n.trackTotalAudioEnergy||"--"))),n||(n={instant:0,slow:0,clip:0});0===n.instant&&(n.instant=n.trackAudioLevel||n.trackTotalAudioEnergy||0),this.onSoundChanage(e,t,n),this._service._judgeTalking(n)&&this.onTalking(e,t,n)},onAddMember:function(e){},onRemoveMember:function(e,t){},onAddStream:function(e){},onRemoveStream:function(e){},onUpdateStream:function(e,t){},onRecvRemoteMessage:function(e,t){},onSoundChanage:function(e,t,n){},onTalking:function(e,t,n){}});e.exports=c},function(e,t,n){var r=n(15),i=r.tagLogger("Member"),o=n(21),s=n(24);e.exports=r.prototypeExtend({__init__:function(){if(!this._session)throw i.error("Require session"),"Require session";this.closed=!1,this._ices={},this.supportVCodes={},this.audioMixers={}},reflushSupportVCodes:function(e){var t=this;t.supportVCodes={},t._orderVCodes=e,e&&0!=e.length?r.forEach(e,function(e,n){t.supportVCodes[n]=1}):i.warn("Not config support vcodes")},getOptimalVideoCodecs:function(){if(!this._orderVCodes||0==this._orderVCodes.length)return/Chrome/.test(navigator.userAgent)?"VP8":/Safari/.test(navigator.userAgent)?"H264":"VP8";var e=0;r.forEach(this._cacheMembers,function(){e++});for(var t,n=0,i=0;i<this._orderVCodes.length;i++){var o=this._orderVCodes[i];if(0==n&&(n=this.supportVCodes[o]),this.supportVCodes[o]>e)return o;this.supportVCodes[o]>n&&(n=this.supportVCodes[o],t=o)}return t},setMemberId:function(e){this._memberId=e},getMemberId:function(){return this._memberId||this.id},createWebrtc:function(e,t){var n=this;e||(e={}),r.extend(e,{_rebuildCount:t||0}),!0===n._service.useRTCCfg&&n.__rtc_cfg?e.iceServerConfig=r.extend(!0,{},n.__rtc_cfg):r.isPlainObject(n._service.useRTCCfg)&&(e.iceServerConfig=r.extend(!0,{},n._service.useRTCCfg));var a=new s({onIceStateChange:function(e){var t=e;i.debug("evt.target ice state",t);try{if("failed"==t)return n.onEvent(new o.ICEConnectFail({webrtc:a})),void(a.onEvent&&a.onEvent(new o.ICEConnectFail({webrtc:a})));if("connected"==t)return n.onEvent(new o.ICEConnected({webrtc:a})),void(a.onEvent=null);if("closed"==t)return n.onEvent(new o.ICEClosed({webrtc:a})),void(a.onEvent&&a.onEvent(new o.ICEClosed({webrtc:a})));if("disconnected"==t)return n.onEvent(new o.ICEDisconnected({webrtc:a})),void(a.onEvent&&a.onEvent(new o.ICEDisconnected({webrtc:a})))}finally{n._onIceStateChange&&n._onIceStateChange(a,e)}},onIceCandidate:function(e){n._onIceCandidate&&e&&n._onIceCandidate(a,e)},onGotRemoteStream:function(e){i.info("got stream.",a,e),a.onGotMediaStream&&a.onGotMediaStream(e),n.onEvent(new o.ICERemoteMediaStream({webrtc:a}))},onAddIceCandidateError:function(e){n.onEvent(new o.AddIceCandError({webrtc:a,event:e}))},onSetSessionDescriptionError:function(e){i.warn("onSetSessionDescriptionError : Failed to set session description: "+e.toString()),n.onEvent&&n.onEvent(new o.ICEConnectFail({webrtc:a,event:e}))},onCreateSessionDescriptionError:function(e){i.warn("Failed to create session description: "+e.toString()),n.onEvent&&n.onEvent(new o.ICEConnectFail({webrtc:a,event:e}))}},e);return n._ices||(n._ices={}),n._ices[a.getRtcId()]&&n._howDoWebrtcWhenCrtExsitsWebrtc(a),n._ices[a.getRtcId()]=a,n._ices[a.__id]=a,n._iceCreateRtcPeerConnection(a.getRtcId()),i.debug("create rtc ",a),a},_howDoWebrtcWhenCrtExsitsWebrtc:function(e){this.closeWebrtc(e.getRtcId(),!0,!1)},connect:function(e,t){this._session.connect(e,t)},connected:function(){return this._session.connected()},newMessage:function(e){var t=this,n=t._session.newMessage(e);return n.post=function(e,n){t.postMessage(this,e,n)},n},message:function(e){var t=this,n=t._session.newMessage(e);return n.post=function(e,n){t.postMessage(this,e,n)},n},postMessage:function(e,t,n){try{e.sessId||(e.sessId=this._session._sessionId),this._session.postMessage(e,t,n)}catch(r){t&&t({op:1001,tsxId:e.tsxId,result:-9527,msg:"post message. exception"}),i.warn(r)}},onEvent:function(e){},_onIceStateChange:function(e,t){i.info(e.getRtcId(),t),this.onEvent(new o.ICEChanage({webrtc:e,state:t}))},_onIceCandidate:function(e,t){var n,i=this;r.isArray(t)?n=t:(n=[]).push(t);var s=i.newMessage().setOp(105).setRtcId(e.getRtcId()).setCands(n);i.postMessage(s,function(e){0==e.result||i.onEvent(new o.RspFail({request:s,response:e}))})},_initC:function(e,t,n,s,a,c){var u=this;if(t&&t.rtcId!==e.getRtcId())throw i.error("stream and webrtc rtcId not equal."),"stream and webrtc rtcId not equal.";var d=u.newMessage().setOp(102).setRtcId(e.getRtcId()).setSdp(n).setSubSId(s);e.subArgs&&r.extend(d,e.subArgs),t&&t.located()&&d.setPubS(t),u.postMessage(d,function(n){if(0!=n.result)return u.onEvent(new o.RspFail({request:d,response:n})),void(a&&a(new o.RspFail({request:d,response:n,hidden:!0===n.retrying})));t&&!t.id&&n.streamId&&(t.id=n.streamId);try{c&&c()}catch(r){i.warn(r)}n.sdp&&u.ansC(e.getRtcId(),n.sdp,n.cands),n.mems&&u.onMembers&&u.onMembers(n.cver,n.mems),n.streams&&u.onStreams&&u.onStreams(n.cver,n.streams)})},_acptC:function(e,t,n){var r=this,i=r.newMessage().setOp(104).setRtcId(e.getRtcId()).setSdp(t);r.postMessage(i,function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:i,response:e})),void(n&&n(new o.RspFail({request:i,response:e})))})},_ansCAndPubstream:function(e,t,n,s,a){var c=this,u=c.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(n);e.subArgs&&r.extend(u,e.subArgs),t&&t.located()&&(t=r.extend({},t),r.removeAttribute(t,"mutedMuted"),r.removeAttribute(t,"_located"),u.setPubS(t)),c.postMessage(u,function(e){if(0!=e.result)return c.onEvent(new o.RspFail({request:u,response:e})),void(s&&s(new o.RspFail({request:u,response:e,hidden:!0===e.retrying})));t&&!t.id&&e.streamId&&(t.id=e.streamId);try{a&&a()}catch(n){i.warn(n)}})},_ansC:function(e,t,n){var r=this,i=r.newMessage().setOp(106).setRtcId(e.getRtcId()).setSdp(t);r.postMessage(i,function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:i,response:e})),void(n&&n(new o.RspFail({request:i,response:e})))})},_termC:function(e,t,n){var r=this,i="string"==typeof e?e:e.getRtcId(),s=r.newMessage().setOp(107).setRtcId(i).setEndReason(t);r.postMessage(s,function(e){if(0!=e.result)return r.onEvent(new o.RspFail({request:s,response:e})),void(n&&n(new o.RspFail({request:s,response:e})))})},_iceCreateRtcPeerConnection:function(e){this._ices[e].createRtcPeerConnection(),i.debug("create rtc peer connection",e)},doOffer:function(e,t,n){this._ices[e].createOffer(function(e){t(e)})},offerCall:function(e,t,n,r,i){var o=this,s=o._ices[e];s.createOffer(function(e){o._initC&&o._initC(s,t,e,n,r,i)})},accept:function(e,t){var n=this,r=n._ices[e];r.createPRAnswer(function(e){n._acptC&&n._acptC(r,e,t)})},answerCall:function(e,t,n,r){var i=this,o=i._ices[e];o.createAnswer(function(e){i._ansCAndPubstream&&i._ansCAndPubstream(o,t,e,n,r)})},answer:function(e,t){var n=this,r=n._ices[e];r.createAnswer(function(e){n._ansC&&n._ansC(r,e,t)})},onTcklC:function(e,t){this._addIceCandidate(t,e)},onAcptC:function(e,t,n){this._iceSetRemoteSDP(t,e),n&&this._addIceCandidate(n,e)},onAnsC:function(e,t,n){this._iceSetRemoteSDP(t,e),n&&this._addIceCandidate(n,e)},_addIceCandidate:function(e,t){if(e&&0!=e.length){var n=this._ices[t];n&&n.addIceCandidate(e)}else i.warn("drop cands",e)},closeWebrtc:function(e,t,n){var o=this,s=o._ices[e];if(r.forEach(o._cacheStreams,function(t,n){if(n.rtcId===e&&!n.located())try{var s=r.removeAttribute(o._mediaMeters,t);s&&s._finally()}catch(a){i.warn(a)}n.rtcId===e&&2===n.type&&r.removeAttribute(o.audioMixers,n.id)}),!s||s.closed)return i.warn("Webrtc not exsits or closed",s&&s.closed),n&&s&&r.forEach(o._cacheStreams,function(t,n){n.rtcId===e&&(r.removeAttribute(o._linkedStreams,t),i.warn("Webrtc close, remvoe from _linkedStreams",t))}),void(n||o._termC(e,0));if(o._records){r.forEach(o._records,function(t,n){n.rtcId===e&&function(e){try{o.stopRecord(e)}catch(t){i.warn(t)}finally{r.removeAttribute(o._records,e.id)}}(n)})}try{n||s&&o._termC(s,t&&s._localStream?-10:0)}finally{s&&s.close(t),s&&o.onWebrtcTermC&&o.onWebrtcTermC(s),t||s&&r.forEach(o._cacheStreams,function(t,s){s.rtcId===e&&(s.located()&&(emedia.stopTracks(s._localMediaStream),o._cacheStreams[t]&&o._linkedStreams[t]&&o.onRemoveStream(s),r.removeAttribute(o._cacheStreams,t),o._monitSoundChanagedStreams&&r.removeAttribute(o._monitSoundChanagedStreams,t),i.info("Webrtc close. Remove stream",t,". from cache")),n&&(r.removeAttribute(o._linkedStreams,t),i.info("Webrtc close. Remove stream",t,". from _linkedStreams")))})}return s},__close:function(e){i.warn("closing, reason = ",e);if(!this.closed){if(this.closed=!0,this.__getCopyInterval&&(clearInterval(this.__getCopyInterval),i.warn("Stop interval get copy")),this._ices)for(var t in this._ices)this.closeWebrtc(t,!1);var n=this.newMessage().setOp(201).setReason(e||0);this.postMessage(n)}},exit:function(e){var t=this;e?(e&&t._closeMyConfr(11),setTimeout(function(){t.close(0)},100)):t.close(0)},_closeMyConfr:function(e){var t=this.newMessage().setOp(204).setReason(e||0);this.postMessage(t,function(e){i.warn("Close confr ",e.result,e.msg)})},close:function(e,t){var n=this;if(!n.closed)try{r.forEach(n._cacheStreams||{},function(e,t){t.located()&&t._localMediaStream&&emedia.stopTracks(t._localMediaStream)}),n.__close(e),r.forEach(n._cacheStreams,function(e,t){n.onRemoveStream(t)}),r.forEach(n._cacheMembers,function(e,t){n.onRemoveMember(t)})}finally{try{setTimeout(function(){n._session&&n._session.close(e)},500),n.onEvent(new o.Hangup({reason:e,failed:t,self:{id:n._memberId}})),n.onMeExit&&n.onMeExit(e,t)}catch(s){i.error(s)}finally{n._onFinally&&n._onFinally()}}},webrtcState:function(e){return this._ices[e].iceConnectionState()},_iceSetRemoteSDP:function(e,t){this._ices[t].setRemoteDescription(e)},setLocalStream:function(e,t){this._ices[t].setLocalStream(e)},onWebrtcTermC:function(e){}})},function(e,t,n){var r=n(15),i=r.tagLogger("Webrtc"),o=(n(21),n(25)),s={headerSection:null,audioSection:null,videoSection:null,_parseHeaderSection:function(e,t,n){var r=t;return-1===n||(r=-1===t?n:Math.min(t,n)),r>=0?e.slice(0,r):e},_parseAudioSection:function(e,t,n){var r=t;if(r>=0)return e.slice(r,n<r?e.length:n)},_parseVideoSection:function(e,t,n){var r=n;if(r>=0)return e.slice(r,t<r?e.length:t)},spiltSection:function(e){this._preSDP=e;var t=this._preAudioIndex=e.indexOf("m=audio"),n=this._preVideoIndex=e.indexOf("m=video");this.headerSection=this._parseHeaderSection(e,t,n),this.audioSection=this._parseAudioSection(e,t,n),this.videoSection=this._parseVideoSection(e,t,n)},setVideoBitrate:function(e){e&&this.videoSection&&(this.videoSection=this.setBitrate(this.videoSection,e))},setAudioBitrate:function(e){e&&this.audioSection&&(this.audioSection=this.setBitrate(this.audioSection,e))},setBitrate:function(e,t){return(e=e.replace(/(b=)(?:AS|TIAS)(\:)\d+/g,"$1AS$2"+t)).indexOf("b=AS")<0&&(e=e.replace(/(m=(?:audio|video)[^\r\n]+)([\r\n]+)/g,"$1$2b=AS:"+t+"$2")),e},updateVideoSection:function(e,t){this.videoSection&&(this.videoSection=this.videoSection.replace(e,t))},updateAudioSection:function(e,t){this.audioSection&&(this.audioSection=this.audioSection.replace(e,t))},updateVideoSendonly:function(){this.videoSection&&(this.videoSection=this.videoSection.replace(/sendrecv/g,"sendonly"))},updateVideoRecvonly:function(){this.videoSection&&(this.videoSection=this.videoSection.replace(/sendrecv/g,"recvonly"))},updateAudioSendonly:function(){this.audioSection&&(this.audioSection=this.audioSection.replace(/sendrecv/g,"sendonly"))},updateAudioRecvonly:function(){this.audioSection&&(this.audioSection=this.audioSection.replace(/sendrecv/g,"recvonly"))},updateVCodes:function(e){if(e&&this.videoSection){if("string"==typeof e)(n=[]).push(e),e=n;for(var t={},n=this._parseLine(this.videoSection,/a=rtpmap:(\d+) ([A-Za-z0-9]+)\/.*/gi),o=0;o<n.length;o++){var s=n[++o];t[n[++o]]=s}var a=this._parseLine(this.videoSection,/a=fmtp:(\d+) .*profile-level-id=42e01f;?.*/gi);a&&a.length>=2&&(t.H264=a[1]);var c=[];for(o=0;o<e.length;o++){var u=t[e[o]];u&&c.push(u)}0==c.length&&(i.warn("Not found vcodes map",e),this._webrtc&&i.warn("Not found vcodes map",e,this._webrtc._rtcId,this._webrtc.__id));var d=this.videoSection.indexOf("\r"),l=this.videoSection.substring(0,d),f=l.split(" ");Array.prototype.push.apply(c,f.slice(3));var p=[],h={};r.forEach(c,function(e,t){0==p.length?(p.push(t),h[t]=!0):h[t]||(p.push(t),h[t]=!0)}),f.splice(3,f.length-3,p.join(" ")),l=f.join(" "),this._webrtc&&i.warn(l,this._webrtc._rtcId,this._webrtc.__id),this.videoSection=l+this.videoSection.substring(d)}},removeSSRC:function(e){for(var t=[],n=e.split(/a=ssrc:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},removeField_msid:function(e){for(var t=[],n=e.split(/a=msid:[^\n]+/g),r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);e=t.join("\n"),t=[],n=e.split(/[\n]+/g);for(r=0;r<n.length;r++)"\n"!=n[r]&&t.push(n[r]);return t.join("\n")},updateHeaderMsidSemantic:function(e){var t="a=msid-semantic: WMS "+e,n=this.headerSection.split(/a=msid\-semantic: WMS.*/g),r=[];switch(n.length){case 1:r.push(n[0]);break;case 2:r.push(n[0]),r.push(t),r.push("\n");break;case 3:r.push(n[0]),r.push(t),r.push("\n"),r.push(n[2]),r.push("\n")}return this.headerSection=r.join("")},updateAudioSSRCSection:function(e,t,n,r){this.audioSection&&(this.audioSection=this.removeSSRC(this.audioSection)),this.audioSection&&(this.audioSection=this.removeField_msid(this.audioSection)),this.audioSection&&(this.audioSection=this.audioSection+this.ssrcSection(e,t,n,r))},updateVideoSSRCSection:function(e,t,n,r){this.videoSection&&(this.videoSection=this.removeSSRC(this.videoSection)),this.videoSection&&(this.videoSection=this.removeField_msid(this.videoSection)),this.videoSection&&(this.videoSection=this.videoSection+this.ssrcSection(e,t,n,r))},getUpdatedSDP:function(e){var t="";if(this.headerSection&&(t+=this.headerSection),!0===e||void 0===e&&this._preAudioIndex<this._preVideoIndex)this.audioSection&&(t+=this.audioSection),this.videoSection&&(t+=this.videoSection);else{var n,r;if(!1===e&&this.videoSection&&this.audioSection)this.videoSection.replace(/a=mid:([^\r\n]+)/,function(e,t){return n=t,e}),this.audioSection.replace(/a=mid:([^\r\n]+)/,function(e,t){return r=t,e}),t=this.headerSection.replace(/a=group:BUNDLE [^\r\n]+/,"a=group:BUNDLE "+n+" "+r);this.videoSection&&(t+=this.videoSection),this.audioSection&&(t+=this.audioSection)}return t},parseMsidSemantic:function(e){var t=this._parseLine(e,/a=msid\-semantic:\s*WMS (\S+)/gi);return t&&2==t.length&&(this.msidSemantic={line:t[0],WMS:t[1]}),this.msidSemantic},ssrcSection:function(e,t,n,r){return["a=ssrc:"+e+" cname:"+t,"a=ssrc:"+e+" msid:"+n+" "+r,"a=ssrc:"+e+" mslabel:"+n,"a=ssrc:"+e+" label:"+r,""].join("\n")},parseSSRC:function(e){var t=new RegExp("a=(ssrc):(\\d+) (\\S+):(\\S+)","ig"),n=this._parseLine(e,t);if(n){for(var r={lines:[],updateSSRCSection:this.ssrcSection},i=0;i<n.length;i++){var o=n[i];if(o.indexOf("a=ssrc")>=0)r.lines.push(o);else switch(o){case"ssrc":case"cname":case"msid":case"mslabel":case"label":r[o]=n[++i]}}return r}},_parseLine:function(e,t){for(var n,r=[];null!=(n=t.exec(e));)for(var i=0;i<n.length;i++)r.push(n[i]);if(r.length>0)return r}},a=function(e,t){r.extend(this,s),this._webrtc=t,this.spiltSection(e)};a.isAudioVideo=function(e){return e.indexOf("m=audio")<e.indexOf("m=video")},a.isVideoPreAudio=function(e){var t=e.indexOf("m=audio"),n=e.indexOf("m=video");return t>=0&&n>=0&&n<t};var c=emedia.__rtc_globalCount=0,u=r.prototypeExtend({closed:!1,sdpConstraints:{mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0}},offerOptions:{offerToReceiveAudio:!0,offerToReceiveVideo:!0},optimalVideoCodecs:null,optimalAudioCodecs:null,__init__:function(){this._rtcId||(this._rtcId="RTC"+c++),this.__id="_i_"+c++,this.__setRemoteSDP=!1,this.__tmpRemoteCands=[],this.__tmpLocalCands=[],this._rtcPeerConnection=null,this.cctx=this.__id,i.info("Webrtc created.",this._rtcId,this.__id)},getRtcId:function(){return this._rtcId},iceState:function(){return this._rtcPeerConnection.iceConnectionState},setSubArgs:function(e){this.subArgs=e},getReceiversOfPeerConnection:function(){if(this._rtcPeerConnection&&"closed"!=this._rtcPeerConnection.iceConnectionState)return this._rtcPeerConnection.getReceivers()},updateRemoteBySubArgs:function(){this.subArgs&&this._remoteStream&&(emedia.enableVideoTracks(this._remoteStream,!(this.subArgs&&!1===this.subArgs.subSVideo)),emedia.enableAudioTracks(this._remoteStream,!(this.subArgs&&!1===this.subArgs.subSAudio)),i.info("enable tracks remote stream",this._remoteStream,this.subArgs,this._rtcId,this.__id,this.closed))},createRtcPeerConnection:function(e){var t=this;i.debug("begin create peer connection ......",t._rtcId,t.__id,t.closed),e||(e=t.iceServerConfig),e||emedia.isEdge?(e||(e={}),!e.iceServers&&(e.iceServers=[]),e.rtcpMuxPolicy="require",e.bundlePolicy="max-bundle",e.relayOnly&&(e.iceTransportPolicy="relay")):e=null,i.info("create pc, set config:",e,t._rtcId,t.__id,t.closed);var n=t._rtcPeerConnection=new RTCPeerConnection(e);function r(e){i.info("states: conn",n.connectionState||n.iceConnectionState,", ice",n.iceConnectionState,"@",t._rtcId,t.__id,t.closed);try{t.onIceStateChange(n.iceConnectionState)}finally{}}n.__peerId=t._rtcId,i.debug("created local peer connection object",n,t._rtcId),n.onicecandidate=function(e){var n=e.candidate;if("icecandidate"!=e.type||n&&("string"!=typeof n.protocol||"tcp"!==n.protocol.toLowerCase())&&!/ TCP /.test(n.candidate)){if(!n.candidate)throw i.error("Not found candidate. candidate is error"),"Not found candidate. candidate is error,";if(n.cctx=t.cctx,!t.__setRemoteSDP)return(t.__tmpLocalCands||(t.__tmpLocalCands={})).push(n),void i.debug("On ICE candidate ok: but tmp buffer caused by not set remote sdp: ",n,t._rtcId,t.__id,t.closed);i.debug("On ICE candidate ok: ",n,t._rtcId,t.__id,t.closed),t._onIceCandidate(n)}else i.debug("On ICE candidate: drop",n,t._rtcId,t.__id,t.closed)},n.onconnectionstatechange=r.bind(t),n.onicestatechange=r.bind(t),n.oniceconnectionstatechange=r.bind(t),n.onsignalingstatechange=function(e){i.info("states: signaling",n.signalingState,"@",t._rtcId,t.__id,t.closed)},null===n.ontrack&&t._onTrack&&(n.ontrack=function(e){t._onTrack(e)}),n.onaddstream=function(e){t._onGotRemoteStream(e)}},addTrack:function(e,t){var n=this;e.forEach(function(e){n._rtcPeerConnection.addTrack(e,t)})},setLocalStream:function(e){var t=this;t._localStream=e,t._rtcPeerConnection.addTrack?e.getTracks().forEach(function(n){t._rtcPeerConnection.addTrack(n,e)}):t._rtcPeerConnection.addStream(e),i.debug("Added local stream to RtcPeerConnection",e,t._rtcId,t.__id,this.closed)},removeStream:function(e){this._rtcPeerConnection.removeStream(e),i.debug("Remove stream from RtcPeerConnection",e,self._rtcId,self.__id,this.closed)},getLocalStream:function(){return this._localStream},getRemoteStream:function(){return this._remoteStream},createOffer:function(e,t){var n=this;i.debug("createOffer start...",n.offerOptions);var o=r.extend({},n.offerOptions);return n.subArgs&&(o={offerToReceiveAudio:!0,offerToReceiveVideo:!0}),n._rtcPeerConnection.createOffer(o).then(function(t){var r;if(n.offerDescription=t,emedia.isEdge&&(t.sdp=t.sdp.replace(/profile-level-id=[^;]+/,"profile-level-id=42e01f")),emedia.isFirefox?n.fireFoxOfferVideoPreAudio=n.__offerVideoPreAudio=a.isVideoPreAudio(t.sdp):n.__offerVideoPreAudio=a.isVideoPreAudio(t.sdp),t.sdp=t.sdp.replace(/m=video 0/g,"m=video 9"),i.warn("setLocalDescription. modify offer. if 'm=video 0' -> 'm=video 9'; if H264, 'profile-level-id=42e01f'",n._rtcId,n.__id),(r=n.optimalVideoCodecs&&("string"==typeof n.optimalVideoCodecs||n.optimalVideoCodecs.length>0))||n.offerOptions&&(!1===n.offerOptions.offerToReceiveVideo||!1===n.offerOptions.offerToReceiveAudio)){var o=new a(t.sdp,n);r&&o.updateVCodes(n.optimalVideoCodecs),n.offerOptions&&!1===n.offerOptions.offerToReceiveVideo&&o.updateVideoSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),n.offerOptions&&!1===n.offerOptions.offerToReceiveAudio&&o.updateAudioSection(/a=sendrecv|a=recvonly/g,"a=sendonly"),t.sdp=o.getUpdatedSDP()}i.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed,n.optimalVideoCodecs),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n)).then(function(){t.cctx=n.cctx,(e||n.onCreateOfferSuccess.bind(n))(t)})},t||n._onCreateSessionDescriptionError.bind(n))},createPRAnswer:function(e,t){var n=this;return i.info(" createPRAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then(function(t){i.debug("_____________PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),t.type="pranswer",t.sdp=t.sdp.replace(/a=recvonly/g,"a=inactive"),n.__prAnswerDescription=t,i.debug("inactive PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),i.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n)).then(function(){var r=new a(t.sdp);r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP(),i.debug("Send PRAnswer ",t.sdp,n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreatePRAnswerSuccess.bind(n))(t)})},t||n._onCreateSessionDescriptionError.bind(n))},createAnswer:function(e,t){var n=this;return i.info("createAnswer start",n.closed,n.sdpConstraints),n._rtcPeerConnection.createAnswer(n.sdpConstraints).then(function(t){i.debug("_____________________Answer ",n._rtcId,n.__id,n.closed),t.type="answer",emedia.supportPRAnswer&&function(){var e=new a(t.sdp),n=e.parseMsidSemantic(e.headerSection);if(n){"*"==n.WMS&&e.updateHeaderMsidSemantic(n.WMS="MS_0000");var r=e.parseSSRC(e.audioSection),i=e.parseSSRC(e.videoSection);r&&e.updateAudioSSRCSection(1e3,"CHROME0000",n.WMS,r.label||"LABEL_AUDIO_1000"),i&&e.updateVideoSSRCSection(2e3,"CHROME0000",n.WMS,i.label||"LABEL_VIDEO_2000"),t.sdp=e.getUpdatedSDP()}}(),n.__answerDescription=t,i.debug("Answer ",n._rtcId,n.__id,n.closed),i.debug("setLocalDescription start",t,n._rtcId,n.__id,n.closed),n._rtcPeerConnection.setLocalDescription(t).then(n._onSetLocalSessionDescriptionSuccess.bind(n),n._onSetSessionDescriptionError.bind(n)).then(function(){if(emedia.supportPRAnswer){var r=new a(t.sdp);r.updateHeaderMsidSemantic("MS_0000"),r.updateAudioSSRCSection(1e3,"CHROME0000","MS_0000","LABEL_AUDIO_1000"),r.updateVideoSSRCSection(2e3,"CHROME0000","MS_0000","LABEL_VIDEO_2000"),t.sdp=r.getUpdatedSDP()}i.debug("Send Answer ",n._rtcId,n.__id,n.closed),n.cctx&&(t.cctx=n.cctx),(e||n.onCreateAnswerSuccess.bind(n))(t)})},t||n._onCreateSessionDescriptionError.bind(n))},close:function(e,t){if(i.warn("webrtc closing",this._rtcId,this.__id,this.closed),!this.closed){t=!0===t,this.closed=!0;try{this._rtcPeerConnection&&this._rtcPeerConnection.close()}catch(n){i.warn(n)}finally{this._localStream&&!1===e&&emedia.stopTracks(this._localStream),this._remoteStream&&emedia.stopTracks(this._remoteStream),this._remoteStream=null,t||this.onClose&&this.onClose(),i.warn("webrtc closed. closed:",this._rtcId,this.__id,this.closed)}}},addIceCandidate:function(e){if(this._rtcPeerConnection){i.debug("Add ICE candidate: ",e,this._rtcId,this.__id,this.closed);var t=r.isArray(e)?e:[];if(!r.isArray(e)&&t.push(e),!this.__setRemoteSDP)return Array.prototype.push.apply(this.__tmpRemoteCands||(this.__tmpRemoteCands={}),t),void i.debug("Add ICE candidate but tmp buffer caused by not set remote sdp: ",e,this._rtcId,this.__id,this.closed);for(var n=0;n<t.length;n++)if((e=t[n]).cctx&&e.cctx!=this.cctx)i.warn("addIceCandidate fail drop. cctx not equal. ",e,this._rtcId,this.__id,this.closed);else{if(!0===this.fireFoxOfferVideoPreAudio){var o=e.sdpMLineIndex;e.sdpMLineIndex=parseInt(e.sdpMid.replace(/[^0-9]*/,"")),i.warn("Firefox sdp section video pre audio, sdp mline index update ",o,"->",e.sdpMLineIndex)}e.candidate&&""!==e.candidate?this._rtcPeerConnection.addIceCandidate(new RTCIceCandidate(e)).then(this.onAddIceCandidateSuccess.bind(this),this._onAddIceCandidateError.bind(this)):i.warn("Add ICE candidate fail. drop it ",e,this._rtcId,this.__id,this.closed)}}},setRemoteDescription:function(e){var t=this;if(i.debug("setRemoteDescription start. ",t._rtcId,t.__id,t.closed),t.offerDescription){if(e.cctx&&e.cctx!=t.cctx)return void i.warn("setRemoteDescription fail drop. cctx not equal. ",e,t._rtcId,t.__id,t.closed);if(!0===t.fireFoxOfferVideoPreAudio||!0===t.__offerVideoPreAudio){var n=new a(e.sdp,t);e.sdp=n.getUpdatedSDP(!1),i.info("Remote sdp.2. switch audio video",e.sdp)}}else e.cctx&&(t.cctx=e.cctx);if(e.sdp=e.sdp.replace(/UDP\/TLS\/RTP\/SAVPF/g,"RTP/SAVPF"),i.warn("setRemoteDescription. UDP/TLS/RTP/SAVPF -> RTP/SAVPF; if firefox: switch audio video;",t._rtcId,t.__id),i.debug("setRemoteDescription.",e,t._rtcId,t.__id),t.vbitrate||t.abitrate){n=new a(e.sdp,t);t.vbitrate&&n.setVideoBitrate(t.vbitrate),t.abitrate&&n.setAudioBitrate(t.abitrate),i.warn("vbitrate = ",t.vbitrate,", abitrate = ",t.abitrate,t._rtcId,t.__id),e.sdp=n.getUpdatedSDP()}return e=t.__remoteDescription=new RTCSessionDescription(e),t._rtcPeerConnection.setRemoteDescription(e).then(function(){t.__setRemoteSDP=!0,t._onSetRemoteSuccess.apply(t,arguments),t.__tmpLocalCands&&t.__tmpLocalCands.length>0&&(i.debug("After setRemoteDescription. send cands",t._rtcId,t.__id,t.closed),t._onIceCandidate(t.__tmpLocalCands),t.__tmpLocalCands=[]),t.__tmpRemoteCands&&t.__tmpRemoteCands.length>0&&(i.debug("After setRemoteDescription. add tmp cands",t._rtcId,t.__id,t.closed),t.addIceCandidate(t.__tmpRemoteCands),t.__tmpRemoteCands=[])},t._onSetSessionDescriptionError.bind(t))},iceConnectionState:function(){return this._rtcPeerConnection.iceConnectionState},isConnected:function(){var e=this._rtcPeerConnection.iceConnectionState;return"connected"===e||"completed"===e},_onGotRemoteStream:function(e){i.debug("onGotRemoteStream.",this._rtcId,this.__id,e),this._remoteStream=e.stream||e.streams[0],this._remoteStream._rtcId=this._rtcId,this._remoteStream.__rtc_c_id=this.__id,this.updateRemoteBySubArgs(),this.onGotRemoteStream(this._remoteStream,e),i.debug("received remote stream, you will see the other.",this._rtcId,this.__id,this.closed)},_onSetRemoteSuccess:function(){i.info("onSetRemoteSuccess success",this._rtcId,this.__id),this.onSetRemoteSuccess.apply(this,arguments),this.offerDescription&&this.__remoteDescription&&this.__remoteDescription.sdp&&this._onAnswerCodes(this.__remoteDescription.sdp)},_onAnswerCodes:function(e){var t=new a(e,this);if(t.videoSection){var n=o.parseRtpParameters(t.videoSection);if(!n.codecs||0===n.codecs.length)return void i.info("not found any video codes. @ ",this._rtcId,this.__id);var s=[];r.forEach(n.codecs,function(e,t){s.push(t.name)}),this.finalVCodeChoices=s,this.onVCodeChoices&&this.onVCodeChoices(s)}},onSetRemoteSuccess:function(){},onAddIceCandidateSuccess:function(){i.debug("addIceCandidate success",this._rtcId,this.__id)},_onAddIceCandidateError:function(e){i.error("failed to add ICE Candidate: "+e.toString(),this._rtcId,this.__id),this.onAddIceCandidateError(e)},onAddIceCandidateError:function(e){},_onIceCandidate:function(e){i.debug("onIceCandidate:",e,this._rtcId,this.__id),this.onIceCandidate(e)},onIceCandidate:function(e){},onIceStateChange:function(e){i.debug("onIceStateChange : ICE state ",e)},_onCreateSessionDescriptionError:function(e){i.error("Failed to create session description: "+e.toString(),this._rtcId,this.__id),this.onCreateSessionDescriptionError(e)},onCreateSessionDescriptionError:function(e){},onCreateOfferSuccess:function(e){i.debug("create offer success",this._rtcId,this.__id)},onCreatePRAnswerSuccess:function(e){i.debug("create answer success",this._rtcId,this.__id)},onCreateAnswerSuccess:function(e){i.debug("create answer success",this._rtcId,this.__id)},_onSetSessionDescriptionError:function(e){i.error("onSetSessionDescriptionError : Failed to set session description: "+e.toString(),this._rtcId,this.__id),this.onSetSessionDescriptionError(e)},onSetSessionDescriptionError:function(e){},_onSetLocalSessionDescriptionSuccess:function(){i.debug("onSetLocalSessionDescriptionSuccess : setLocalDescription complete",this._rtcId,this.__id),this.onSetLocalSessionDescriptionSuccess(),this.__answerDescription&&this.__answerDescription.sdp&&this._onAnswerCodes(this.__answerDescription.sdp)},onSetLocalSessionDescriptionSuccess:function(){},onGotRemoteStream:function(e){i.debug("Got remote stream. ",e,this._rtcId,this.__id)}});e.exports=u},function(e,t,n){"use strict";var r={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};r.localCName=r.generateIdentifier(),r.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},r.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},r.getDescription=function(e){var t=r.splitSections(e);return t&&t[0]},r.getMediaSections=function(e){var t=r.splitSections(e);return t.shift(),t},r.matchPrefix=function(e,t){return r.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},r.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;case"ufrag":n.ufrag=t[r+1],n.usernameFragment=t[r+1];break;default:n[t[r]]=t[r+1]}return n},r.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},r.parseIceOptions=function(e){return e.substr(14).split(" ")},r.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},r.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},r.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},r.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},r.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},r.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var r=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)}),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},r.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},r.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},r.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},r.getMid=function(e){var t=r.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},r.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},r.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:r.matchPrefix(e+t,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},r.getIceParameters=function(e,t){var n=r.splitLines(e);return{usernameFragment:(n=n.concat(r.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},r.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},r.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=r.splitLines(e)[0].split(" "),i=3;i<n.length;i++){var o=n[i],s=r.matchPrefix(e,"a=rtpmap:"+o+" ")[0];if(s){var a=r.parseRtpMap(s),c=r.matchPrefix(e,"a=fmtp:"+o+" ");switch(a.parameters=c.length?r.parseFmtp(c[0]):{},a.rtcpFeedback=r.matchPrefix(e,"a=rtcp-fb:"+o+" ").map(r.parseRtcpFb),t.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(a.name.toUpperCase())}}}return r.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(r.parseExtmap(e))}),t},r.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=t.codecs.length>0?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=r.writeRtpMap(e),n+=r.writeFmtp(e),n+=r.writeRtcpFb(e)});var i=0;return t.codecs.forEach(function(e){e.maxptime>i&&(i=e.maxptime)}),i>0&&(n+="a=maxptime:"+i+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions&&t.headerExtensions.forEach(function(e){n+=r.writeExtmap(e)}),n},r.parseRtpEncodingParameters=function(e){var t,n=[],i=r.parseRtpParameters(e),o=-1!==i.fecMechanisms.indexOf("RED"),s=-1!==i.fecMechanisms.indexOf("ULPFEC"),a=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,u=r.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});u.length>0&&u[0].length>1&&u[0][0]===c&&(t=u[0][1]),i.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var r={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&t&&(r.rtx={ssrc:t}),n.push(r),o&&((r=JSON.parse(JSON.stringify(r))).fec={ssrc:t,mechanism:s?"red+ulpfec":"red"},n.push(r))}}),0===n.length&&c&&n.push({ssrc:c});var d=r.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substr(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substr(5),10)*.95-16e3:void 0,n.forEach(function(e){e.maxBitrate=d})),n},r.parseRtcpParameters=function(e){var t={},n=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var i=r.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=i.length>0,t.compound=0===i.length;var o=r.matchPrefix(e,"a=rtcp-mux");return t.mux=o.length>0,t},r.parseMsid=function(e){var t,n=r.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var i=r.matchPrefix(e,"a=ssrc:").map(function(e){return r.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return i.length>0?{stream:(t=i[0].value.split(" "))[0],track:t[1]}:void 0},r.generateSessionId=function(){return Math.random().toString().substr(2,21)},r.writeSessionBoilerplate=function(e,t){var n=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||r.generateSessionId())+" "+n+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},r.writeMediaSection=function(e,t,n,i){var o=r.writeRtpDescription(e.kind,t);if(o+=r.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=r.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),o+="a=mid:"+e.mid+"\r\n",e.direction?o+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var s="msid:"+i.id+" "+e.rtpSender.track.id+"\r\n";o+="a="+s,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+s,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+s,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+r.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+r.localCName+"\r\n"),o},r.getDirection=function(e,t){for(var n=r.splitLines(e),i=0;i<n.length;i++)switch(n[i]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[i].substr(2)}return t?r.getDirection(t):"sendrecv"},r.getKind=function(e){return r.splitLines(e)[0].split(" ")[0].substr(2)},r.isRejected=function(e){return"0"===e.split(" ",2)[1]},r.parseMLine=function(e){var t=r.splitLines(e)[0].substr(2).split(" ");return{kind:t[0],port:parseInt(t[1],10),protocol:t[2],fmt:t.slice(3).join(" ")}},r.parseOLine=function(e){var t=r.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:t[0],sessionId:t[1],sessionVersion:parseInt(t[2],10),netType:t[3],addressType:t[4],address:t[5]}},e.exports=r},function(e,t,n){var r=n(15),i=n(27);emedia.subscribed=function(e){return!!e._located||(2===e.type?!(e._located||!e._webrtc):void 0!==e._webrtc)};var o=r.prototypeExtend({voff:0,aoff:0,__init__:function(){var e=this;if(!e._mediaStream)throw _logger.error("_mediaStream empty"),"_mediaStream empty";if(e.hasEnabledTracks(e._mediaStream)){if(!e.__audioContext)throw _logger.error("require audioContext"),"require audioContext";e.__soundMeter=new i(e.__audioContext),e.__soundMeter.connectToSource(e._mediaStream,function(t){if(t)throw t;e.__worked=e.__soundMeter.__worked=!0})}},hasEnabledTracks:function(e){return emedia.hasEnabledTracks(e)},getSoundMeters:function(){if(this.__soundMeter&&this.__worked)if(this._mediaStream.active){if(this.hasEnabledTracks(this._mediaStream))return{instant:this.__soundMeter.instant,slow:this.__soundMeter.slow,clip:this.__soundMeter.clip}}else this.__worked&&this._finally()},_finally:function(){this.__soundMeter&&(this.__soundMeter.stop(),this.__worked=this.__soundMeter.__worked=!1)}});e.exports=r.prototypeExtend({__undefinedEQDelete:!0,Update:r.prototypeExtend({ifAoff:function(e){this.if("aoff",e)},ifVoff:function(e){this.if("voff",e)},ifMediaStream:function(e){this.if("mediaStream",e)},if:function(e,t){void 0!==this[e]&&t(this[e])}}),located:function(){return this._located||!1},webrtc:function(e){return e&&(this._webrtc=e),this},getMediaStream:function(){return void 0!==this.mediaStream?this.mediaStream:this._located?this._localMediaStream:this._webrtc&&(this._webrtc.getRemoteStream()||this._webrtc.getLocalStream())},requestFrame:function(){this._localMediaStream&&this._localMediaStream.getVideoTracks().forEach(function(e){"function"==typeof e.requestFrame&&e.requestFrame()})},getLocalMediaStream:function(){return this._localMediaStream},getRemoteMediaStream:function(){if(this._webrtc&&void 0!==this._webrtc.getRemoteStream())return this._webrtc.getRemoteStream()},mutedNeed:function(){return this.mutedMuted||!1},ifMediaStream:function(e){void 0===this.mediaStream?this._located&&void 0!==this._localMediaStream?e(this._localMediaStream):this._located||!this._webrtc||void 0===this._webrtc.getRemoteStream()||e(this._webrtc.getRemoteStream()):e(this.mediaStream)},subscribed:function(){return emedia.subscribed(this)},getHtmlDOMID:function(){return"_m_"+this.owner.id+"_s_"+this.id},MediaSoundMeter:o,StreamSoundMeter:r.prototypeExtend({__init__:function(){if(!this._stream||"function"!=typeof this._stream.getMediaStream)throw _logger.error("_stream empty or not found method getMediaStream"),"_stream empty or not found method getMediaStream";if(this._streamId=this._stream.id,this._streamCreateId=this._stream.__create_id,this._mediaStream=this._mediaStream,2===this._stream.type&&!this._stream.located()&&!this._webrtc)throw _logger.error("require webrtc. when type = 2 and not located"),"require webrtc. when type = 2 and not located";this.__mediaSoundMeter=this.__mediaSoundMeter||new o({__audioContext:this.__audioContext,_mediaStream:this._mediaStream}),this.__mediaSoundMeter.useCount=(this.__mediaSoundMeter.useCount||0)+1},onSoundMeters:function(e){var t={instant:0,slow:0,clip:0};if(this._stream.aoff)return this._finally(),e(t),t;if(2!==this._stream.type&&this._stream.subArgs&&void 0!==this._stream.subArgs.subSAudio&&!this._stream.subArgs.subSAudio)return this._finally(),e(t),t;if(0==this._stream.id||2===this._stream.type&&!this._stream.located()&&(!this._stream.subArgs||!this._stream.subArgs.subSAudio)){var n,i=this._webrtc.getReceiversOfPeerConnection();if(!i||0===i.length)return e(t),t;for(var o in i)"audio"===i[o].track.kind&&(n=i[o]);if(!n)return e(t),t;if("function"==typeof n.getContributingSources){var s,a=n.getContributingSources();if(emedia.config._printSoundData&&r.logger.debug(this._stream.id,this._stream.csrc,"rtpContributingSources ",a),!a||0===a.length)return e(t),t;for(var o in a)a[o].source==this._stream.csrc&&(s=this._stream.csrc);if(emedia.config._printSoundData&&r.logger.debug(this._stream.id,this._stream.csrc,"source ",s),void 0===s)return e(t),t}}var c=this.__mediaSoundMeter.getSoundMeters()||t,u=2===this._stream.type?this._webrtc:this._stream._webrtc;(emedia.meterWithTrackAudioLevel||0===c.instant)&&u&&!u.closed&&u._rtcPeerConnection&&u._rtcPeerConnection.getStats().then(function(t){t.size>0&&t.forEach(function(t){"track"!==t.type||"audio"!==t.kind&&"audio"!==t.trackIdentifier||(c.trackAudioLevel=t.audioLevel,c.trackTotalAudioEnergy=t.totalAudioEnergy,e(c))})}),e(c)},_finally:function(){2===this._stream.type&&this._stream.located()&&this._remoteMediaSoundMeters&&this._remoteMediaSoundMeters._finally(),this.__mediaSoundMeter.useCount--,0===this.__mediaSoundMeter.useCount&&this.__mediaSoundMeter._finally()}})})},function(e,t,n){"use strict";function r(e){this.context=e,this.instant=0,this.slow=0,this.clip=0,this.script=e.createScriptProcessor(2048,1,1);var t=this;this.script.onaudioprocess=function(e){var n,r=e.inputBuffer.getChannelData(0),i=0,o=0;for(n=0;n<r.length;++n)i+=r[n]*r[n],Math.abs(r[n])>.99&&(o+=1);t.instant=Math.sqrt(i/r.length),t.slow=.95*t.slow+.05*t.instant,t.clip=o/r.length}}r.prototype.connectToSource=function(e,t){console.log("SoundMeter connecting");try{this.mic=this.context.createMediaStreamSource(e),this.mic.connect(this.script),this.script.connect(this.context.destination),void 0!==t&&t(null)}catch(n){console.error(n),void 0!==t&&t(n)}},r.prototype.stop=function(){this.mic.disconnect(),this.script.disconnect()},e.exports=r},function(e,t,n){var r=n(15),i=r.tagLogger("Handler"),o=n(21),s=r.prototypeExtend({onEvent:function(e){var t=this;function n(){try{t.handleEvent(e)}catch(n){i.warn(n)}}if(e&&i.info("[EVT]",e.message(),e.hidden||""),e instanceof o.ServerRefuseEnter&&e.failed&&-95270===e.failed&&(e.failed=-9527),e instanceof emedia.event.StreamState&&e.stream&&e.stream.located())n();else try{e.hidden||t.onNotifyEvent&&t.onNotifyEvent(e)}finally{n()}},handleEvent:function(e){var t=this;if(e instanceof o.RecvResponse)t._onRecvResponse(e);else if(e instanceof o.ServerRefuseEnter)i.warn("Server refuse, ",e.failed,e.msg),t.onServerRefuseEnter(e);else if(e instanceof o.EnterFail)i.warn("Enter fail, result = ",e.failed),t.onEnterFail();else if(e instanceof o.WSClose)t.onWSClose();else if(e instanceof o.WSConnected)i.warn("Websocket connected");else if(e instanceof o.ICEConnected){var n=e.webrtc;t.onICEConnected(n)}else if(e instanceof o.ICEConnectFail){n=e.webrtc;t.onICEConnectFail(n)}else if(e instanceof o.ICEDisconnected){n=e.webrtc;t.onICEDisconnected(n)}else if(e instanceof o.ICEClosed){n=e.webrtc;t.onICEClosed(n)}else if(e instanceof o.ICERemoteMediaStream)t.onICERemoteMediaStream(e.webrtc);else if(e instanceof o.PushSuccess){t._cacheStreams[e.stream.id]=t._linkedStreams[e.stream.id]=e.stream;var s=t.newStream(e.stream);if(e.hidden&&!t._maybeNotExistStreams[e.stream.id]&&!s.isRepublished)return void t._onAddStream(s);t.isSafari()&&(emedia._isSafariYetPushedStream=!0);try{s&&t.onUpdateStream(s,new s.Update({voff:s.voff,aoff:s.aoff,mediaStream:s.getMediaStream()}))}finally{t.isSafari()&&r.forEach(t._cacheStreams,function(e,n){!0===n._autoSubWhenPushStream&&(r.removeAttribute(n,"_autoSubWhenPushStream"),t.createWebrtcAndSubscribeStream(n.id))})}}else if(e instanceof o.SubSuccess)t._linkedStreams[e.stream.id]=e.stream,e.stream._zoom=1;else if(e instanceof o.PushFail){if(!0!==e.hidden){var a=r.removeAttribute(t._linkedStreams,e.stream.id);if(i.warn("PushFail remove from _linkedStreams",e.stream.id,a),a){s=t.newStream(e.stream);t.onRemoveStream(s)}}}else if(e instanceof o.SubFail){if(!0!==e.hidden)r.removeAttribute(t._linkedStreams,e.stream.id),i.warn("SubFail remove from _linkedStreams",e.stream.id),(s=t.newStream(e.stream)).rtcId=void 0,s._webrtc=void 0,s.mediaStream=void 0,t.onUpdateStream(s,new s.Update(s))}else if(e instanceof o.SubFailNotSupportVCodes){var c=e.stream;i.warn("Rtc donot support pub VCodes. close. sub fail.",c.rtcId," -> ",c.id);try{t.onNotSupportPublishVideoCodecs&&t.onNotSupportPublishVideoCodecs(c)}catch(d){i.warn(d)}}else if(e instanceof o.EnterSuccess)t.onEnterSuccess();else if(e instanceof o.SwitchVCodes){c=e.stream;var u=e.useVCodes;n=c._webrtc;if(i.warn("Rtc switch VCodes. ",c.id,u),u&&0!=u.length||i.warn("Rtc switch VCodes. error! useVCodes is empty ",c.id,u),n&&n.optimalVideoCodecs){if("string"==typeof n.optimalVideoCodecs&&n.optimalVideoCodecs==u[0])return void i.warn("Rtc switch VCodes. igrone . useVCodes == optimalVideoCodecs ",c.id,n._rtcId,u);if(r.isArray(n.optimalVideoCodecs)&&n.optimalVideoCodecs.length>0&&n.optimalVideoCodecs[0]==u[0])return void i.warn("Rtc switch VCodes. igrone ddd . useVCodes == optimalVideoCodecs ",c.id,n._rtcId,u)}c.optimalVideoCodecs=u,n&&t.closeWebrtc(n.getRtcId(),!0),setTimeout(function(){c.iceRebuildCount=1,t.iceRebuild(c),i.warn("Rtc switch VCodes. iceRebuild end.",c.id,u)},300)}},_onRecvResponse:function(e){var t=e.request,n=e.response;if(t&&n&&200!==t.op&&1002!==t.op&&0!==n.result){i.warn("Server refuse. when request = ",t);var r=e.failed;switch(r){case-9527:case-95270:break;case-500:case-502:case-504:case-508:case-510:this.close(4,r);break;case-506:this.close(11,r);break;case-501:this.close(11,r)}}},onServerRefuseEnter:function(e){var t=e.failed;switch(t){case-9527:case-95270:this.close(4,-9527);break;case-500:case-502:case-504:case-508:case-510:this.close(4,t);break;case-506:this.close(11,t);break;default:this.close(2)}},onEnterFail:function(){this.__getCopyInterval&&clearInterval(this.__getCopyInterval)},onEnterSuccess:function(){var e=this;setTimeout(function(){e._failIcesRebuild()},200),e.getCopyIntervalMillis&&e.getCopyIntervalMillis>0&&(i.warn("Run interval get copy. interval = ",e.getCopyIntervalMillis),e.__getCopyInterval&&clearInterval(e.__getCopyInterval),e.__getCopyInterval=setInterval(function(){e._session.connected()?e._sysCopy.apply(e):(i.warn("Warn! cannot get copy. cause offline."),e.__getCopyInterval&&clearInterval(e.__getCopyInterval))},e.getCopyIntervalMillis)),e.getMediaMeterIntervalMillis&&e.getMediaMeterIntervalMillis>0&&e._intervalGetMediaMeters()},_intervalGetMediaMeters:function(){var e=this;!function t(){e.__getMediaMetersIntervalFlag&&emedia.cancelAnimationFrame(e.__getMediaMetersIntervalFlag),e.getMediaMeterIntervalMillis?e.__getMediaMetersIntervalFlag=emedia.requestAnimationFrame(function(n){"function"==typeof emedia.AudioContext&&e._flushMediaMetersByAudioContext.apply(e),!1===e.closed&&t()},e.getMediaMeterIntervalMillis):i.warn("Ontalking closed. please use getMediaMeterIntervalMillis")}()},_flushMediaMetersByAudioContext:function(){var e=this;r.forEach(e._cacheStreams,function(t,n){e._monitSoundChanagedStreams&&!e._monitSoundChanagedStreams[t]||"0"!=n.id&&e._updateMetersOrNewOne.call(e,t,n)});var t=[];r.forEach(e._mediaMeters,function(n,r){var i=e._cacheStreams[n];i&&e._updateMetersOrNewOne.call(e,n,i),i||t.push(n)}),r.forEach(t,function(t,n){r.removeAttribute(e._mediaMeters,n)})},_updateMetersOrNewOne:function(e,t){var n=this,i=n._mediaMeters[e];if(!(2!==t.type||t.located()||t.subArgs&&t.subArgs.subSAudio)){var o=n._oneAudioMixers();if(!o||i&&i._webrtc&&o._webrtc.__id!=i._webrtc.__id)return i&&i._finally(),r.removeAttribute(n._mediaMeters,e),void n._onSoundChanage.call(n,t.owner,t)}return i&&i._streamCreateId===t.__create_id&&i.__mediaSoundMeter.__worked?(i.onSoundMeters(function(e){n._onSoundChanage.call(n,t.owner,t,e)}),i):(i&&(i._streamCreateId!==t.__create_id||i.__mediaSoundMeter.__worked)&&(i&&i._finally(),r.removeAttribute(n._mediaMeters,e),n._onSoundChanage.call(n,t.owner,t)),t.aoff?void 0:((i=n._newMediaMeters(t))&&(n._mediaMeters[e]&&n._mediaMeters[e]._finally(),n._mediaMeters[e]=i),i))},_newAudioContext:function(){if(emedia.__usingWebAudio)return emedia.__audioContext},_newMediaMeters:function(e){var t;if(2===e.type&&e.subArgs&&e.subArgs.subSAudio&&e._webrtc&&e._webrtc.getRemoteStream())return new e.StreamSoundMeter({_stream:e,_mediaStream:e._webrtc.getRemoteStream(),_webrtc:e._webrtc,__audioContext:this._newAudioContext()});if(2===e.type&&e.located())return new e.StreamSoundMeter({_stream:e,_mediaStream:e._localMediaStream,__audioContext:this._newAudioContext()});if(2===e.type&&!e.located()){var n=this._oneAudioMixers();if(!n||!n._webrtc||n._webrtc.closed)return;if(n&&(void 0===n._remoteMediaSoundMeters||!n._remoteMediaSoundMeters.__worked)&&n._webrtc&&n._webrtc.getRemoteStream()&&(n._remoteMediaSoundMeters=new n.MediaSoundMeter({_mediaStream:n._webrtc.getRemoteStream(),__audioContext:this._newAudioContext()})),!n._remoteMediaSoundMeters)return;return new e.StreamSoundMeter({_stream:e,_webrtc:n._webrtc,__mediaSoundMeter:n._remoteMediaSoundMeters})}return!e.aoff&&(t=e.getMediaStream())?new e.StreamSoundMeter({_stream:e,_mediaStream:t,__audioContext:this._newAudioContext()}):void 0},_oneAudioMixers:function(){var e=this._cacheStreams[0];if(e&&e._webrtc&&!e._webrtc.closed)return e;for(var t in this.audioMixers){var n=this.audioMixers[t];if(n.located())return n}},onWSClose:function(){this.__getCopyInterval&&clearInterval(this.__getCopyInterval),i.info("Websocket closed.")},onICEDisconnected:function(e){var t=this;t.__networkWeakInterval&&clearTimeout(t.__networkWeakInterval),t.__networkWeakInterval=setTimeout(function(){t.onNetworkWeak&&t.onNetworkWeak()},1e3),r.forEach(t._linkedStreams,function(n,o){o.rtcId==e.getRtcId()&&(t._maybeNotExistStreams[n]||((t._maybeNotExistStreams[n]=r.extend({},o)).iceRebuildCount=1),i.info("Stream maybe not exist. caused by disconnected",o.id))})},onICEConnectFail:function(e){var t=this;for(var n in t._linkedStreams){var s=t._linkedStreams[n];if(s.rtcId==e.getRtcId()){if(s._webrtc&&s._webrtc.__id!==e.__id){i.warn("Stream use other webrtc rtcId = ",s.rtcId,", id: ",s._webrtc.__id,e.__id);continue}var a;if((a=t._maybeNotExistStreams[n])||((a=t._maybeNotExistStreams[n]=r.extend({},s)).iceRebuildCount=1),a){var c=new o.StreamState({stream:a});c.iceFail(),t.onEvent(c)}if(i.info("ice fail. webrtc = ",e.getRtcId()," problem stream is ",a.iceRebuildCount,a.id),a.iceRebuildCount>emedia.config.iceRebuildCount)i.info("ice fail. webrtc = ",e.getRtcId()," rebuild fail. problem stream is ",a.id),a.located()?t.onEvent(new o.PushFail({stream:s,cause:"pub ice rebuild failed."})):t.onEvent(new o.SubFail({stream:s,cause:"sub ice rebuild failed."})),t.closeWebrtc(e.getRtcId(),!1);else{var u=t._records[a.id];a._localMediaStream?i.info("ice fail. webrtc = ",e.getRtcId()," will rebuild. remain local stream. ",a.id):i.info("ice fail. webrtc = ",e.getRtcId()," will rebuild.",a.id),t.closeWebrtc(e.getRtcId(),!0),u&&(t._records[a.id]=u),function(e){setTimeout(function(){t.iceRebuild(e)},emedia.config.iceRebuildIntervalMillis)}(a),i.info("ice fail. webrtc = ",e.getRtcId()," will rebuilding. problem stream is ",a.id)}2===s.type&&r.removeAttribute(t.audioMixers,s.id)}}},onICEClosed:function(e){if(e.closed){i.warn("Webrtc will be removed. by __id = ",e.__id,", rtcId = ",e.getRtcId());var t=r.removeAttribute(this._ices,e.__id);t?i.warn("Webrtc removed. by id = ",t.__id,", rtcId = ",t.getRtcId()):i.warn("Webrtc removed. by id = ",e.__id,", rtcId = ",e.getRtcId());var n=this._ices[e.getRtcId()];n&&n.__id===t.__id&&(t=r.removeAttribute(this._ices,e.getRtcId()),i.warn("Webrtc removed. by rtcId = ",t.getRtcId(),", __id = ",t.__id))}else i.info("ICE self closed. not allow. will rebuild",e.getRtcId()),this.onICEConnectFail(e)},onICEConnected:function(e){var t=this;r.forEach(t._cacheStreams,function(n,s){if(s.rtcId==e.getRtcId()){if(s.finalVCodeChoices=e.finalVCodeChoices,t._maybeNotExistStreams[n]){r.removeAttribute(t._maybeNotExistStreams,s.id),t._linkedStreams[n]=s,i.info("ice reconnected. webrtc = ",e.getRtcId(),"will update stream = ",s.id);var a=t._records[s.id];a&&a.rtcId!==s.rtcId&&(t.startRecord(s),i.warn("Re record. for ",s.id,", after rebuild ice.",a.rtcId,"->",s.rtcId))}else i.info("ice connected. webrtc = ",e.getRtcId(),s.id),s.located()&&t.onEvent(new o.PushSuccess({stream:s})),s.located()||t.onEvent(new o.SubSuccess({stream:s}));2===s.type&&(t.audioMixers[s.id]=s)}})},onICERemoteMediaStream:function(e){var t=this;r.forEach(t._cacheStreams,function(n,r){if(r.rtcId==e.getRtcId()&&(!r.located()||2===r.type)){var i=e.getRemoteStream();if(t._updateRemoteStream(r,i),r.onGotRemoteMediaStream)r.onGotRemoteMediaStream.call(r,i);else(r=t.newStream(r)).mediaStream=e.getRemoteStream(),t.onUpdateStream(r,new r.Update({mediaStream:r.mediaStream}))}})},_failIcesRebuild:function(){var e=this;r.forEach(e._maybeNotExistStreams,function(t,n){setTimeout(function(){e.iceRebuild(n)},100)})},iceRebuild:function(e){return this.connected()?this._linkedStreams[e.id]&&this._cacheStreams[e.id]?void(e.iceRebuildCount>emedia.config.iceRebuildCount?(i.info("ice rebuild fail. count too many. stream is ",e.id),e.located()?this.onEvent(new o.PushFail({stream:e,cause:"pub ice rebuild failed."})):this.onEvent(new o.SubFail({stream:e,cause:"sub ice rebuild failed."}))):this.connected()?(i.info("ice try rebuild. count",e.iceRebuildCount,". stream is ",e.id),this.rebuildIce(e),e.iceRebuildCount++):i.warn("ice rebuild. stop. cause by not websocket disconnect",e.id)):(i.info("ice rebuild fail. it yet closed. stream is ",e.id,e.rtcId),r.removeAttribute(this._maybeNotExistStreams,e.id),r.removeAttribute(this._linkedStreams,e.id),void i.warn("iceRebuild, remvoe from _linkedStreams",e.id)):(e.iceRebuildCount=1,void i.warn("Websocket disconnect. waiting. rebuild count reset",e.iceRebuildCount,e.id))},rebuildIce:function(e){this._cacheStreams[e.id]?(i.warn("Begin rebuild ice ",e.iceRebuildCount,e.id),e.located()?(e.isRepublished=!0,this.push(e,void 0,void 0,!0)):this.createWebrtcAndSubscribeStream(e.id),i.warn("Finish rebuild ice ",e.iceRebuildCount,e.id,this._cacheStreams[e.id].rtcId)):i.warn("Begin rebuild ice. not found stream at local",e.iceRebuildCount,e.id)},_sysCopy:function(){var e=this,t=e.newMessage().setOp(1e3).setCver(e._cver||0);e.postMessage(t,function(t){0==t.result?(e._cver||0)<t.cver&&(e._cver=t.cver,e.onMembers(t.cver,t.mems||{}),e.onStreams(t.cver,t.streams||{}),i.info("Got copy success.")):i.warn("Get copy fail. result = ",t.result)})}});e.exports=s},function(e,t,n){var r=n(15),i=r.tagLogger("Desktop"),o=n(21);window.__shareDesktopMessageCount__=0,e.exports=r.prototypeExtend({__RTC_PAGE_MSG_TYPE__:"RTC-SD-PAGE",__RTC_EXT_MSG_TYPE__:"RTC-SD-EXT",__init__:function(){var e=this;e.__extLoaded=e.rsdExtLoaded(),e.__extLoaded&&e.__onRsdExtLoad(),window.addEventListener("load",function(t){if(!e.__extLoaded){var n=e.rsdExtLoaded();e.__extLoaded=n}}),window.addEventListener("message",function(t){if(t.data){var n=t.data;n.type&&n.type===e.__RTC_EXT_MSG_TYPE__&&n.evname&&(i.info("got ext-msg: ",n),"extLoaded"!==n.evname?e.__onMessage(n):e.__extLoaded||(e.__extLoaded=!0,setTimeout(e.__onRsdExtLoad(),50)))}})},rsdExtLoaded:function(){var e=document.getElementById("RTC-Share-Deskto-installed-ele-rat1abrr");return!(!emedia.isElectron&&!e)},__sendMessage:function(e,t){var n=this,o="tsx_"+__shareDesktopMessageCount__+++"_"+Math.random().toString(36).substr(2,4);if(!n.__extLoaded)throw i.error("Rtc share desktop not loaded"),"Rtc share desktop not loaded";e.tsxId=o,n["on_"+o]=function(){t&&t.apply(n,arguments),r.removeAttribute(n,"on_"+o)},window.postMessage&&window.postMessage(e,"*")},__onMessage:function(e){var t=e.tsxId;this["on_"+t]&&this["on_"+t](e)},__onRsdExtLoad:function(){this.onExtLoaded&&this.onExtLoaded()},openDesktopMedia:function(e,t){if(emedia.isElectron)this.openDesktopMediaInElectron(e,t);else if(this.__extLoaded&&this.rsdExtLoaded()){var n={type:this.__RTC_PAGE_MSG_TYPE__,evname:"chooseDesktopMedia",screenOptions:e};this.__sendMessage(n,function(e){"onAccessApproved"===e.evname&&e.streamId?t(new o.OpenDesktopMedia({desktopStreamId:e.streamId})):t(new o.OpenDesktopMediaAccessDenied)})}else t(new o.ShareDesktopExtensionNotFound)},openDesktopMediaInElectron:function(e,t){e||(e=["screen","window"]),emedia.electron.desktopCapturer.getSources({types:e},function(e,n){if(e)t(new o.OpenDesktopMediaAccessDenied({error:e}));else if("function"==typeof emedia.chooseElectronDesktopMedia){for(var r=0;r<n.length;r++){i.debug("desktop capturer. ",n[r]);var s=n[r];s.easemobThumbDataURL=s.thumbnail.toDataURL()}emedia.chooseElectronDesktopMedia(n,function(e){var n;n=e&&e.id?e.id:e,t(new o.OpenDesktopMedia({desktopStreamId:n}))},function(){t(new o.OpenDesktopMediaAccessDenied({message:"User denied access"}))})}else t(new o.OpenDesktopMedia({desktopStreamId:n[0].id}))})}})},function(e,t,n){var r,i=n(15).tagLogger("DefaultTrack"),o=n(31);e.exports=r=o.extend({__init__:function(){var e,t;this._canvas||(this._canvas=(e=this._target,t=document.createElement("canvas"),e.appendChild(t),t.style.cssText="position: absolute; background: transparent; width: 100%; height: 100%",t.width=e.offsetWidth,t.height=e.offsetHeight,i.warn("Canvas",t.width,t.height),t)),this._canvasContext||(this._canvasContext=this._canvas.getContext("2d"))},resizeCanvas:function(){},_calPosition:function(){var e=o.prototype._calPosition.apply(this,arguments);return e.x=Math.floor(e.x*this._canvas.width/e.width),e.y=Math.floor(e.y*this._canvas.height/e.height),e},_draw:function(e,t,n,r,i,o){var s=this._canvasContext;(!t||t<=1)&&(t=2);var a=s.getImageData(e.x-t/2,e.y-t/2,t,t);a&&function(e,t,n,r,i){for(var o=0,s=e.data;o<s.length;o+=4){var a={r:void 0===t?s[o]:t,g:void 0===n?s[o+1]:n,b:void 0===r?s[o+2]:r,alpha:void 0===i?s[o+3]:i};s[o]=a.r,s[o+1]=a.g,s[o+2]=a.b,s[o+3]=a.alpha}}(a,n,r,i,o),s.putImageData(a,e.x,e.y)},redraw:function(e,t,n,i,o,s){r.prototype._draw.bind(this)({x:e,y:t},2)},onMouseTrigger:function(e,t){e.isLeftKey()&&this._draw(e.xy,8,189,56,51,255),e.isRightKey()&&this._draw(e.xy,8,45,23,189,255),e.isWheelKey()&&this._draw(e.xy,8,58,189,76,255)},onMouseTrack:function(e,t,n){this._draw(e,2,227,18,247,255)}})},function(e,t,n){var r=n(15),i=(r.tagLogger("MouseTrack"),n(32));e.exports=r.prototypeExtend({_scale:1,__init__:function(){},getTargetPageXY:function(){return this._target&&r.extend({},r.getDomPageRect(this._target))},onMouseTrack:function(e,t,n){},onMouseTrigger:function(e,t){},_onMouseTrack:function(e,t,n){this.onMouseTrack&&this.onMouseTrack(e,t,n)},_onMouseTrigger:function(e,t){this.onMouseTrigger&&this.onMouseTrigger(e,t)},track:function(e){var t=e=r.extend({},e),n=this.getTargetPageXY();n&&(t={x:(e=this._calPosition(e)).x,y:e.y,pageX:n.x+e.x,pageY:n.y+e.y}),this._onMouseTrack(t,this._lastPageXY,this._lastTrigger),this._lastPageXY=t},trigger:function(e){e=new i(e);var t,n=this.getTargetPageXY();n&&(t=this._calPosition(e.xy),e.xy={x:t.x,y:t.y,pageX:n.x+t.x,pageY:n.y+t.y}),e._time||(e._time=(new Date).getTime()),this._onMouseTrigger(e,this._lastTrigger),this._lastTrigger=e},releaseTrigger:function(){this._lastTrigger=void 0,this._lastPageXY=void 0,this.onReleaseTrigger&&this.onReleaseTrigger(this._lastTrigger)},_calPosition:function(e){this._referenceVideo&&(e=emedia.Service.prototype.eventXYAtVideo.call(null,e,this._referenceVideo));var t=this.getTargetPageXY();if(!t)return e;r.isFloat(e.x)&&void 0!==e.width&&(e.x=e.x*e.width*this._scale*(t.width/e.width)),r.isFloat(e.y)&&void 0!==e.height&&(e.y=e.y*e.height*this._scale*(t.height/e.height)),r.isFloat(e.x)&&void 0===e.width&&(e.x=e.x*this._scale*t.width),r.isFloat(e.y)&&void 0===e.height&&(e.y=e.y*this._scale*t.height),r.isInt(e.x)&&void 0!==e.width&&(e.x=e.x*this._scale*(t.width/e.width)),r.isInt(e.y)&&void 0!==e.height&&(e.y=e.y*this._scale*(t.height/e.height)),r.isInt(e.x)&&void 0===e.width&&(e.x=e.x*this._scale),r.isInt(e.y)&&void 0===e.height&&(e.y=e.y*this._scale);var n=Math.floor(e.x),i=Math.floor(e.y);return n<0&&(n=t.width+n),i<0&&(i=t.width+i),{x:n,y:i,width:t.width,height:t.height}}})},function(e,t,n){var r=n(15),i=(r.tagLogger("MouseTrigger"),{LEFT:1,WHEEL:2,RIGHT:4,WHEEL_ROLL_UP:8,WHEEL_ROLL_DOWN:16,KEY_UP:0,KEY_DOWN:1,MOVE:2,KEYBOARD_DOWN:3,KEYBOARD_UP:4});e.exports=r.prototypeExtend({_timeoutMillis:500,_time:(new Date).getTime(),isKeyup:function(){return i.KEY_UP==this.oper},isKeydown:function(){return i.KEY_DOWN==this.oper},isWheelup:function(){return i.WHEEL_ROLL_UP==this.btn},isWheeldown:function(){return i.WHEEL_ROLL_DOWN==this.btn},isLeftKey:function(){return i.LEFT==this.btn},isRightKey:function(){return i.RIGHT==this.btn},isWheelKey:function(){return i.WHEEL==this.btn},isWheelRoll:function(){return this.isWheeldown()||this.isWheelup()},timeout:function(){return(new Date).getTime()-this._time>=this._timeoutMillis},_toString:function(){return r.list("btn:",this.btn,", oper:",this.oper,", timeout:",this.timeout(),", at (",this.xy.x,", ",this.xy.y,")").join("")}}),e.exports.BTN=i},function(e,t,n){var r=n(15),i=r.tagLogger("AddonsP2P"),o=n(21);e.exports=function(e){return function(e,t,n){return e.extend({Session:t,Attendee:n,__init__:function(){e.prototype.__init__.call(this),void 0!==this.useRTCCfg&&!1!==this.useRTCCfg&&null!==this.useRTCCfg||(this.useRTCCfg=emedia.config.forceUseRTCCfgIfServerReturnWhenP2P)},push:function(t,n,r){if(this.current&&this.current.isP2P()){if(2===t.type)throw i.error("P2P do not allow audio_mixer"),"P2P do not allow audio_mixer";t instanceof this.AVPubstream&&!t.rtcId&&(this.current._cacheStreams["rtc-"+this.current.ticket.confrId+"__Caller"]||this.current._cacheStreams["rtc-"+this.current.ticket.confrId+"__Callee"]||(t.rtcId="rtc-"+this.current.ticket.confrId))}e.prototype.push.call(this,t,n,r)},newSession:function(t,n){var s=this,a=e.prototype.newSession.call(s,t,n),c=a.onTermC,u=a.onAnsC;return r.extend(a,{onInitC:function(e){if(t.isP2P()){if(e.rtcId==="rtc-"+t.ticket.confrId){var n=e.rtcId+(t.isCaller()?"__Callee":"__Caller");if((i=t._cacheStreams[n])&&i.owner&&i.owner.id!==e.memId)return t.rejectAnswer(e.memId,e.rtcId,10),void t.postMessage(t.newMessage({op:1001,memId:e.memId,tsxId:e.tsxId,result:-554,msg:"Other device call it. you no."}))}var i;e.pubS.sdp=e.sdp,e.pubS.cands=e.cands,e.pubS.id=e.rtcId+(t.isCaller()?"__Callee":"__Caller"),e.pubS._located=!1,e.pubS.memId=e.memId,e.pubS.rtcId=e.rtcId,e.pubS.sver=0,(i=t._cacheStreams[e.pubS.id])&&(e.pubS.sver=i.sver+1,r.removeAttribute(t._maybeNotExistStreams,e.pubS.id)),t.onPub.call(t,++t._cver,e.memId,e.pubS)}},onTermC:function(e){if(t.isP2P()){if(-20===e.endReason){var n=t._cacheStreams[e.rtcId+"__Caller"];return i.warn("Begin re-publish. 20",n),void(n&&s._republish(n))}if(e.memId&&e.memId!==t.getMemberId()){var a=[];return r.forEach(t._cacheStreams,function(e,t){a.push(t)}),a=a.sort(function(e,n){var r=-1;return e.id>n.id&&(r=1),t.isCallee()?0-r:r}),void r.forEach(a,function(n,r){r&&r.owner&&r.owner.id===e.memId&&e.rtcId===r.rtcId&&(-10!==e.endReason&&c.call(t,e),e.rtcId==="rtc-"+t.ticket.confrId&&t.onUnpub(++t._cver,e.memId,r.id),10===e.endReason&&t.onEvent(new o.OtherDeviceAnswer({rtcId:e.rtcId,stream:r}))),r&&r.owner&&r.owner.id===t.getMemberId()&&e.rtcId===r.rtcId&&(t.closeWebrtc(e.rtcId),t.onUnpub(++t._cver,r.owner.id,r.id))})}-10!==e.endReason&&c.call(t,e),10===e.endReason&&t.onEvent(new o.OtherDeviceAnswer({rtcId:e.rtcId}))}else c.call(t,e)},onAnsC:function(e){if(t.isP2P())if(t.__cache_[e.rtcId]){if(!0===t.__cache_[e.rtcId].answered)return i.warn("Webrtc ",e.rtcId,"had been ansC"),t.rejectAnswer(e.memId,e.rtcId,10),void t.postMessage(t.newMessage({op:1001,memId:e.memId,tsxId:e.tsxId,result:-554,msg:"Other device sub it. you no."}));try{if(e.pubS){var n=t.newStream(e.pubS);n._webrtc=t._ices[e.rtcId],n.rtcId=e.rtcId,n.id=e.rtcId+(t.isCaller()?"__Callee":"__Caller"),n.owner=t._cacheMembers[e.memId],t._cacheStreams[n.id]?t._cacheStreams[n.id]=n:t.onPub.call(t,++t._cver,e.memId,n),t.onEvent(new o.SubSuccess({stream:n,hidden:!0}))}var s=t._cacheMembers[e.memId];u.call(t,e),r.forEach(t._cacheMembers,function(n,r){n!==e.memId&&s.memName===r.memName&&t.rejectAnswer(n,e.rtcId,10)})}finally{t.__cache_[e.rtcId].answered=!0}}else i.warn("Webrtc ",e.rtcId,"not created. drop the answer");else u.call(t,e)}})}})}(e,function(e){var t=e.extend({postMessage:function(t,n){var r=this,i=t.tsxId;t.tsxId||(i=t.tsxId="MSG"+Date.now()+"-"+emedia.__session_globalCount++),e.prototype.postMessage.call(r,t,n),function(e){r.owner.isP2P()&&r._callbacks[e]&&setTimeout(function(){var t=r._callbacks[e];if(t&&1004===t.op){var n=r.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,result:0,msg:"3000ms not recv response. will success callback. "+t.tsxId});r.onMessage(n)}},3e3)}(i)},__modifyMessageForPost:function(t){var n=this;t=e.prototype.__modifyMessageForPost.call(n,t);var i=n.owner;if(i.isP2P()){if(102===t.op||105===t.op){var o=n.newMessage({op:1001,tsxId:t.tsxId,memId:t.memId,result:0,streamId:t.rtcId+(i.isCaller()?"__Caller":"__Callee"),sver:1});if(setTimeout(function(){n.onMessage(o)},100),!t._cached_){var s=r.extend({_cached_:!0},t);r.removeAttribute(s,"tsxId"),102===t.op&&(i.__cache_[t.rtcId]=[]).push(s),105===t.op&&i.__cache_[t.rtcId]&&i.__cache_[t.rtcId].push(s),i.__cache_[t.rtcId]&&(i.__cache_[t.rtcId].selfId=i.getMemberId())}}switch(r.removeAttribute(t,"_cached_"),t.memId&&(t=n.newMessage({op:1004,sessId:r.removeAttribute(t,"sessId"),memId:r.removeAttribute(t,"memId"),tsxId:r.removeAttribute(t,"tsxId"),arg:JSON.stringify(t)})),t.op){case 205:return o=n.newMessage({op:1001,tsxId:t.tsxId,result:0}),void setTimeout(function(){n.onMessage(o)},50);case 102:case 104:case 105:case 106:case 107:if(-10===t.endReason)return;case 1001:case 400:t=n.newMessage({op:1004,sessId:r.removeAttribute(t,"sessId"),tsxId:r.removeAttribute(t,"tsxId"),arg:JSON.stringify(t)});break;case 303:case 206:return}}return t},onP2PMessage:function(e){var t=this,n=t.owner;if(t.owner.isConfr())i.warn("Recv p2p ctrl message. when CONFR. ignore");else{var o=JSON.parse(e.arg);if(o.memId=e.memId,o.tsxId=e.tsxId,o.sessId=e.sessId,400===o.op&&(o.streamId=o.rtcId+(t.owner.isCaller()?"__Callee":"__Caller")),1001!==o.op){var s=t.newMessage({op:1001,tsxId:e.tsxId,memId:e.memId,sessId:e.sessId,result:0,msg:"Web sdk success recv"});102!==o.op&&105!==o.op||r.extend(s,{streamId:o.rtcId+(n.isCaller()?"__Callee":"__Caller"),sver:1}),t.postMessage(s)}!function(e){setTimeout(function(){t.onMessage(e)},10)}(o)}}});return r.extend(t.prototype._events,{1004:"onP2PMessage"}),t}((e.prototype.Session||n(20)).extend({})),function(e){return e.extend({__init__:function(){e.prototype.__init__.call(this),this.__cache_={};var t=this.iceRebuild;this.iceRebuild=function(e){this.isP2P()&&e.rtcId?e._webrtc&&!0===e._webrtc.answerWebrtc?i.warn("Stream not auto iceRebuild. caused by answer webrtc. it = ",e.id,e):e.located()?t.call(this,e):i.warn("Stream not auto iceRebuild. caused by not located. it = ",e.id,e):t.call(this,e)}},onEnter:function(t,n){var i=this;try{e.prototype.onEnter.call(i,t,n)}finally{if(!i.isP2P()||!(n=i._cacheMembers[n.id]))return;r.forEach(i.__cache_,function(e,t){!0!==t.answered&&r.forEach(t,function(e,t){!function(e){e.memId=n.id,i.postMessage(e)}(t)})})}},rejectAnswer:function(e,t,n,r){var i=this,s=i.newMessage().setOp(107).setRtcId(t).setMemId(e).setEndReason(n);i.postMessage(s,function(e){if(0!=e.result)return i.onEvent(new o.RspFail({request:s,response:e})),void(r&&r(new o.RspFail({request:s,response:e})))})},closeWebrtc:function(t,n,o){var s=this,a=!1;if(s.isP2P()){var c=s._ices[t];c&&(a=(a="failed"===c.iceConnectionState())&&c._rebuildCount<emedia.config.iceRebuildCount,i.warn("Webrtc state failed. it is ",t,c._rebuildCount,emedia.config.iceRebuildCount,c.__id))}if(e.prototype.closeWebrtc.call(s,t,n,o||a),s.isP2P()&&!o&&a&&r.forEach(s._cacheStreams,function(e,n){n.rtcId===t&&(s._linkedStreams[e]=n,i.warn("Reput stream to _linkedStreams",e))}),s.isP2P()&&!n){r.removeAttribute(s.__cache_,t);var u=r.extend({},s._cacheStreams);r.forEach(u,function(e,n){if(t===n.rtcId){r.removeAttribute(s._linkedStreams,n.id);var o=r.removeAttribute(s._cacheStreams,n.id);i.warn("P2P close webrtc. remove stream from _cacheStreams. it = ",n.id,n),o._localMediaStream&&s._service._stopTracks(o._localMediaStream),s.onRemoveStream&&(n=s.newStream(n),s.onRemoveStream(n))}})}},subscribeStream:function(t,n,r,s){if(this.isP2P()){var a=this._ices[t],c=this._cacheStreams[n];if(c._webrtc=a,c.rtcId=t,c.subArgs,s=s||{subSVideo:!0,subSAudio:!0},c.subArgs=c.subArgs||{subSVideo:!0,subSAudio:!0},c._webrtc&&(c._webrtc.subArgs=c._webrtc.subArgs||{subSVideo:!0,subSAudio:!0}),!c.subArgs.subSVideo&&s.subSVideo&&c.voff)throw i.error("Sub not allow. stream voff"),"Sub not allow. stream voff";if(!c.subArgs.subSAudio&&s.subSAudio&&c.aoff)throw i.error("Sub not allow. stream aoff"),"Sub not allow. stream aoff";if(c.subArgs.subSVideo&&!s.subSVideo&&!c.voff&&emedia.isSafari)throw i.error("Sub not allow. safari close sub video. will error"),"Sub not allow. safari close sub video. will error";s&&c._webrtc&&c._webrtc.setSubArgs(s),s&&(c.subArgs=s);var u=new o.SubSuccess({stream:c,hidden:!0});this._updateRemoteStream(c,c._webrtc.getRemoteStream()),this.onEvent(u)}else e.prototype.subscribeStream.call(this,t,n,r,s)},unsubscribeStream:function(t){this.isP2P()||e.prototype.unsubscribeStream.call(this,t)},onPub:function(t,n,r){if(this.isP2P())return e.prototype.onPub.call(this,t,n,r);e.prototype.onPub.call(this,t,n,r)},onStreams:function(t,n){this.isP2P()?i.warn("P2P ingrone the onStreams"):e.prototype.onStreams.call(this,t,n)},_howDoWebrtcWhenCrtExsitsWebrtc:function(t){this.isP2P()?this.closeWebrtc(t.getRtcId(),!0,!0):e.prototype._howDoWebrtcWhenCrtExsitsWebrtc.call(this,t)},createWebrtcAndSubscribeStream:function(t,n,s,a){if((c=this).isP2P()){var c;n||(n={});var u=(c=this)._cacheStreams[t],d=c._cacheMembers[u.owner.id],l=u;a=a||l.subArgs||{subSVideo:!0,subSAudio:!0};var f=u.vcodes,p=d.vcodes,h=c.supportVCodes,m=c._getOptimalVideoCodecsSubset(f,p,h);a=a||l.subArgs;var v=l.subArgs,b=!(l.vcodes&&l.vcodes.length>0),g={offerToReceiveAudio:!0,offerToReceiveVideo:a.subSVideo&&b};g.offerToReceiveAudio||g.offerToReceiveVideo||i.warn("offerToReceiveAudio == false and offerToReceiveVideo == false");var _=c.createWebrtc({_rtcId:l.rtcId,iceServerConfig:s,optimalVideoCodecs:m,offerOptions:g,onGotMediaStream:function(e){var t=new o.SubSuccess({stream:l,hidden:!0});n.onGotRemote&&n.onGotRemote(l),c.onEvent&&c.onEvent(t)}},l.iceRebuildCount),y=_.getRtcId();i.warn(y," sub stream ",t,m);var S=l._webrtc;if(l._webrtc=_,l.rtcId=y,l.owner=r.extend({},d),c._ices[y]=_,_.answerWebrtc=!0,a&&l._webrtc&&l._webrtc.setSubArgs(a),a&&(l.subArgs=a),y==="rtc-"+c.ticket.confrId){c.__lastCalleePub;var w=c._cacheStreams[y+(c.isCaller()?"__Caller":"__Callee")];w=new c._service.AVPubstream(w||{constaints:{audio:!l.aoff,video:!l.voff}}),S&&S.getLocalStream()&&c._service._stopTracks(S.getLocalStream()),c._service.openUserMedia(w).then(function(){var e=c.newStream(w);e._localMediaStream=w.localStream,e._webrtc=_,e.rtcId=_.getRtcId(),e.id=y+(c.isCaller()?"__Caller":"__Callee"),e.owner={id:c.getMemberId(),nickName:c.nickName,name:c.sysUserId,ext:c.extObj},c.onEvent(new o.PushSuccess({stream:e,hidden:!0})),C(w.localStream),c.answerCall(y,w,x)},x)}else C(),c.answer(y,x)}else e.prototype.createWebrtcAndSubscribeStream.call(c,t,n,s,a);function x(e){i.warn("sub stream error",t,e),v&&l._webrtc&&l._webrtc.setSubArgs(v),v&&(l.subArgs=v),e=new o.SubFail({stream:l,hidden:!0===e.hidden,cause:e}),n&&n.onEvent&&n.onEvent(e),c.onEvent&&c.onEvent(e)}function C(e){e&&_.setLocalStream(e),_.setRemoteDescription(l.sdp),l.cands&&l.cands.length>0&&_.addIceCandidate(l.cands)}}})}((e.prototype.Attendee||n(22)).extend({})))}},function(e,t,n){"use strict";n.r(t),n.d(t,"outer",function(){return u});var r=n(35),i=n(17),o=n.n(i),s=n(6),a=n.n(s),c={};r.single.onMemberJoin=function(e,t){emedia.decodeMemeberName(e),this.onMemberJoined(e,r.single._confr(t))},r.single.onMemberLeave=function(e,t,n){emedia.decodeMemeberName(e),this.onMemberExited(e,t,r.single._confr(n))},r.single._onRoleUpdated=function(e,t){this.onRoleChanged(e,r.single._confr(t))},r.single._onAddMemberStream=function(e,t){e&&emedia.decodeMemeberName(e.owner),this.onStreamAdded(e.owner,e,r.single._confr(t))},r.single._onRemoveMemberStream=function(e,t){e&&emedia.decodeMemeberName(e.owner),this.onStreamRemoved(e.owner,e,r.single._confr(t))},r.single._onUpdateMemberStream=function(e,t,n){e&&emedia.decodeMemeberName(e.owner),this.onStreamUpdated&&this.onStreamUpdated(e.owner,e,t,r.single._confr(n))},r.single.onExit=function(e,t,n){this.onConferenceExit(e,t,r.single._confr(n))},c.onMemberJoined=function(e){},c.onMemberExited=function(e,t){},c.onRoleChanged=function(e){},c.onStreamAdded=function(e,t){},c.onStreamRemoved=function(e,t){},c.onConferenceExit=function(e,t){},c.joinConferenceWithTicket=r.single.joinUseTicket,c.joinConference=r.single.joinUsePassword,c.getConferenceTkt=r.single.reqTkt,c.publish=function(e,t,n){return r.single.shareVideoWithAudio(e.video,e.audio,t,n)},c.unpublish=function(e){return r.single.hungup(e)},c.unsubscribe=function(e){return r.single.hungup(e)},c.exitConference=function(e){return r.single.exit(e||!1)},c.getConferenceInfo=function(e,t){return r.single.selectConfr(e,t)},c.createConference=r.single.createConfr,c.grantRole=function(e,t,n){return emedia.decodeMemeberName(t),r.single.chanageRoles(n,t,e.id)},c.kickMembersById=function(e,t){return emedia.decodeMemeberName(t),r.single.kickMember(t,e.id)},c.destroyConference=function(e){return r.single.disbandConfr(e,e.roleToken)},emedia.decodeMemeberName=function(e){if("function"!=typeof emedia.decodeMemeberNameString)return e;if("string"==typeof e)return emedia.decodeMemeberNameString(e);if(o.a.isArray(e)){for(var t=0;t<e.length;t++)e[t]=emedia.decodeMemeberName(e[t]);return e}return e.name?(e.globalName=e.name,void(e.memName=e.name=emedia.decodeMemeberName(e.name))):e.memName?(e.globalName=e.memName,void(e.memName=e.name=emedia.decodeMemeberName(e.memName))):void 0},emedia.ConfrType=r.single.ConfrType,emedia.Role=r.single.Role,a()(function(){var e=window.WebIM;if(e&&e.conn&&"function"==typeof e.conn.onOpened){var t=function(){emedia.decodeMemeberNameString=function(t){if("string"==typeof t){if(t.indexOf(e.conn.orgName)<0)return t;var n=t.indexOf("_");n<0?n=0:n++;var r=t.indexOf("@");return r<0&&(r=t.length),t.substring(n,r)}return t},r.single.setUrlCreator(function(t,n){return e.conn.apiUrl+t}),r.single.setIdentity(e.conn.orgName+"#"+e.conn.appName+"_"+e.conn.user+"@"+e.conn.domain,e.conn.token)},n=e.conn.onOpened;e.conn.onOpened=function(){n.apply(e.conn,arguments),t()},e.conn.token&&t()}});var u=o.a.extend(r.single,c)},function(e,t,n){"use strict";n.r(t),n.d(t,"single",function(){return R});var r=n(15),i=n.n(r),o=n(6),s=n.n(o),a=n(17),c=n.n(a),u=n(36),d=n(135),l=n(26),f=n.n(l),p=i.a.tagLogger("mgr");window.emedia=window.emedia||{};function h(){this._confrs={},this._services={},this._events={},this._videos={}}h.prototype.ConfrType={COMMUNICATION:10,COMMUNICATION_MIX:11,LIVE:12,P2P:13,INTERCOMM:14},h.prototype.Role={ADMIN:7,TALKER:3,AUDIENCE:1};var m;m={createConfr:"/easemob/rtc/req/ticket",reqTkt:"/easemob/rtc/req/ticket",chanageRoles:"/easemob/rtc/chanage/roles",disbandConfr:"/easemob/rtc/disband/conference",kickMember:"/easemob/rtc/kick/member",selectConfr:"/easemob/rtc/select/confr"},i.a.forEach(m,function(e,t){h.prototype[e]=function(n){return r=this.createUrl(t,e),o=n,function(e){s.a.ajax({type:"POST",url:r,data:JSON.stringify(o),contentType:"application/json",dataType:"json",success:function(t,n,s){p.debug("REST: ",t," -> ",o,r),0===t.error?(i.a.removeAttribute(t,"error"),e.next(t),e.complete()):(i.a.extend(t,{errorType:"server_refuse"}),e.error(t))},error:function(t,n,i){var s={errorType:"http_error",error:t.status,errorMessage:i};p.debug("REST: ",s," -> ",o,r),e.error({errorType:"http_error",error:t.status,errorMessage:i})}})};var r,o}}),h.prototype.createUrl=function(e,t){return e},h.prototype.setUrlCreator=function(e){this.createUrl=e.bind(this)},h.prototype.destroy=function(){},h.prototype.ZeroStream=f.a.extend({__init__:function(){this.type=2,this.id="0",this._located=!1,this.mutedMuted=!1},onGotRemoteMediaStream:function(e){if(!this.remotePlayAudioObject){this.id;var t=document.createElement("audio");t.style.display="none",t.id="__o_remote_play_audio_"+this.id,t.autoplay=!0,t.playsinline=!0,this.remotePlayAudioObject=t,document.body.appendChild(t)}this.remotePlayAudioObject.srcObject=e}}),h.prototype.setIdentity=function(e,t,n){this.identityName=e,this.identityToken=t,this.ext=n,this._terminalInfo={browser:emedia.browser,browserVersion:emedia.browserVersion,version:emedia.config.version,userAgent:emedia.config.userAgent},p.info("set identity: ",e,t),this.destroy(),emedia.config({autoSub:!1,onlyEnter:!0})},h.prototype.EventsObservable=n(235).default;var v=Object(d.catchError)(function(e,t){throw p.error(e),e});function b(e,t){var n=this,r={uid:n.identityName,token:n.identityToken,confrId:e,password:t,terminal:n._terminalInfo};return n._confrs[e]&&(r.roleToken=n._confrs[e].roleToken),u.Observable.create(h.prototype.reqTkt.call(n,r)).pipe(Object(d.map)(function(t){return t.mixed=11===t.type||12===t.type,t.id=t.serverConfrId=t.confrId=e,n._confrs[e]=i.a.extend(n._confrs[e]||{},t),i.a.removeAttribute(t,"rtcCfg"),t}),v)}function g(e,t){var n=this._confr(e),r={uid:this.identityName,token:this.identityToken,confrId:e,password:t};return n&&(r.password=t||n.password,r.roleToken=n.roleToken),u.Observable.create(h.prototype.selectConfr.call(this,r)).pipe(v)}function _(e,t,n){var r=this;if(r.joined(e))return Object(u.throwError)("had joined confr "+e+", if you want join again, please call exitConference");var o=r._events[e]=new r.EventsObservable(r,e,function(t){(function(e,t){}).call(r,e,t)});r.confrEventsObserver&&o.subscribe(r.confrEventsObserver);var s=r._service(e);return(s=r._services[e]=new emedia.XService({listeners:o})).setup(t,n),u.Observable.create(function(t){s.join(function(n){r.__current_confrId=e,r._confrs[e].joinId=n,r._confrs[e].role=s.current&&s.current.role,t.next(r._confrs[e]),t.complete()},function(e){s.exit(),t.error({errorType:"join_fail",error:-200,errorMessage:e.message()})})}).pipe(Object(d.concatMap)(function(t,n){return function(e,t,n){var r=this;return emedia.ctrl.support(n,function(t,n,i){r.onHasRemoteControl(t,n,i,e)},function(t,n,i){r.onRemoteFreeControl(t,n,i,e)}),p.info("support remote control. ",e,t),Object(u.of)(i.a.extend({},r._confrs[e]))}.call(r,e,t,s)}),Object(d.concatMap)(function(t,n){return function(e,t){var n=this,r=n._confr(e),o=n._service(e);switch(r.type){case 0:case 10:case 11:break;case 12:var s=new n.ZeroStream;if(o.current._cacheStreams[s.id]=s,o.current.role==R.Role.AUDIENCE)return T.call(n,e,s,!1,!0).pipe(Object(d.concatMap)(function(){return Object(u.of)(i.a.extend({},n._confrs[e]))}));break;case 13:case 14:default:return Object(u.throwError)("not support conf type: "+r.type)}return Object(u.of)(i.a.extend({},n._confrs[e]))}.call(r,e,t)}),v)}function y(e,t,n){var r=this;return g.call(r,e,t,n).pipe(Object(d.concatMap)(function(i,o){return function(e,t,n){var r=this;return b.call(r,e,t,n).pipe(Object(d.concatMap)(function(t,i){return _.call(r,e,t.ticket,n)}))}.call(r,e,t,n)}))}function S(e,t){var n=this._service(e);return u.Observable.create(function(e){n.openUserMedia(t).then(function(){e.next(t),e.complete()},function(t){e.error({errorType:"open_user_media_fail",error:-201,errorMessage:t.message()})})}).pipe(v)}function w(e,t){var n=this._service(e);return u.Observable.create(function(e){n.push(t,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"push_fail",error:-203,errorMessage:t.message()})})}).pipe(v)}function x(e,t,n){var r=this._confr(n),i=this._service(n);return(e="string"==typeof e?i.getStreamById(e):i.getStreamById(e.id))?"boolean"!=typeof t&&e.constaints&&c.a.isEqual(t,e.constaints.video)||t==!e.voff?Object(u.of)(c.a.extend({},r.av)):function(e,t,n){var r=this._service(e);return u.Observable.create(function(e){r._republishByVideoConstaints(t,n,function(t){e.error({errorType:"voff_fail",error:-203,errorMessage:t.message()})},function(){e.next(r.getStreamById(t.id)),e.complete()})}).pipe(v)}.call(this,n,e,t):Object(u.throwError)("pub stream not exsits. it is "+e)}function C(e,t,n){var r=this._confr(n),i=this._service(n);return(e="string"==typeof e?i.getStreamById(e):i.getStreamById(e.id))?r.type!==this.ConfrType.COMMUNICATION_MIX&&r.type!==this.ConfrType.LIVE||1!==e.type||t?function(e,t,n){var r=this._service(e);return u.Observable.create(function(e){r.aoff(t,n,function(t){e.error({errorType:"aoff_fail",error:-203,errorMessage:t.message()})},function(){e.next(r.getStreamById(t.id)),e.complete()})}).pipe(v)}.call(this,n,e,t):(p.warn("confr mix. not allow desktop with audio."),Object(u.throwError)("confr mix. not allow desktop with audio.")):Object(u.throwError)("pub stream not exsits. it is "+e)}function E(e){var t=this._confr(e),n=this._service(e);return n.current.role==this.Role.AUDIENCE?Object(u.throwError)("Audience not allow publish"):u.Observable.create(function(e){n.chanageCamera(t.av,function(t){e.error({errorType:"switch_camera_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(v)}function T(e,t,n,r,o){var s=this,a="string"==typeof t?t:t.id,c=s._confr(e),d=s._service(e);return 2===t.type&&1==r&&0!=t.id&&(r=!1,p.warn("Mixed audio stream. not allow repeat sub audio. force reset subSAudio = false")),o&&i.a.targetDOM(o)&&s.streamBindVideo(a,o),u.Observable.create(function(e){d.subscribe(a,function(t){try{if("0"!=a){var n=d.getStreamById(a),r={video:n.subArgs?n.subArgs.subSVideo:!n.voff,audio:n.subArgs?n.subArgs.subSAudio:!n.aoff};2===n.type&&(r.audio=!0),s._onMemberMediaChanaged(n.owner,n,r,c.confrId)}}finally{e.next(t),e.complete()}},function(t){e.error({errorType:"sub_fail",error:-203,errorMessage:t.message()})},{subSVideo:n,subSAudio:r})}).pipe(v)}var I=i.a.extend(new h,{_confr:function(e){return e||(e=this.__current_confrId),this._confrs[e]},_service:function(e){return e||(e=this.__current_confrId),this._services[e]},getStreamById:function(e,t){var n=this._service(t);return n&&n.getStreamById(e)},getMemberById:function(e,t){var n=this._service(t);return n&&n.getMemberById(e)},streamBindVideo:function(e,t,n){(function(e,t,n){var r=this,i=r._service(n);e=i.current._cacheStreams["string"==typeof e?e:e.id];var o=t||r.crtAndReturnVideo(e.owner,e);if(o){r._videos[e.id]=o,o.setAttribute("autoplay","autoplay"),o.setAttribute("playsinline","playsinline"),o.setAttribute("easemob_stream",e.id),e.aoff?o.setAttribute("aoff","aoff"):o.removeAttribute("aoff"),e.voff?o.setAttribute("voff","voff"):o.removeAttribute("voff"),e.ifMediaStream(function(e){o&&attachMediaStream(o,e),o.hasAttribute("flow")&&r.onMediaTransmission(o,function(e,t,n,r){s()(o).trigger("onMediaTransmission",[e,t,n,r])})});var a=s()(o);a.off("hungup"),a.on("hungup",function(t,i,o){r.hungup(e,n),o&&o()}),a.off("subscribe"),a.on("subscribe",function(t,i,o,s,a){e.located()?s&&s("local stream not allow sub"):(i=e.subArgs&&e.subArgs.subSVideo||!0,o=e.subArgs&&e.subArgs.subSAudio||!0,r.subscribe(e.owner,e,i,o,n).then(a).catch(s))}),a.off("pauseVideo"),a.on("pauseVideo",function(t,i,o){e.located()?r.pauseVideo(e,n).then(o).catch(i):r.subscribe(e.owner,e,!1,e.subArgs&&e.subArgs.subSAudio||!e.aoff,n).then(o).catch(i)}),a.off("resumeVideo"),a.on("resumeVideo",function(t,i,o){e.located()?r.resumeVideo(e,!0,n).then(o).catch(i):r.subscribe(e.owner,e,!0,e.subArgs&&e.subArgs.subSVideo||!e.voff,n).then(o).catch(i)}),a.off("pauseAudio"),a.on("pauseAudio",function(t,i,o){e.located()?r.pauseAudio(e,n).then(o).catch(i):r.subscribe(e.owner,e,e.subArgs.subSVideo,!1,n).then(o).catch(i)}),a.off("resumeAudio"),a.on("resumeAudio",function(t,i,o){e.located()?r.resumeAudio(e,n).then(o).catch(i):r.subscribe(e.owner,e,e.subArgs.subSVideo,!0,n).then(o).catch(i)}),a.off("remoteControl"),a.on("remoteControl",function(t,i,s,a,c,u,d,l){if(e.located())throw p.error("not allow remote control at local"),"not allow remote control at local";r.remoteControl(e,o,o,i,s,a,c,u,d,l,n)}),a.off("chanageCamera"),a.on("chanageCamera",function(e,t,i){r.chanageCamera(n).then(i).catch(t)}),a.off("captureVideo"),a.on("captureVideo",function(e,t,i,s){var a=r.captureVideo(o,i,s,n);t&&t(a)}),a.off("capturePictureRemote"),a.on("capturePictureRemote",function(t,i,o){r.capturePictureRemote(e,!1,n).then(o).catch(i)}),a.off("freezeFrameRemote"),a.on("freezeFrameRemote",function(t,i,o){r.freezeFrameRemote(e,n).then(o).catch(i)}),a.off("zoomRemote"),a.on("zoomRemote",function(t,i,o,s){r.zoomRemote(e,i,n).then(s).catch(o)}),a.off("torchRemote"),a.on("torchRemote",function(t,i,o,s){r.torchRemote(e,i,n).then(s).catch(o)}),a.off("freeRemoteControl"),a.on("freeRemoteControl",function(t,i,o){try{r.freeRemoteControl(e,n)}finally{o&&o()}});var c={video:!e.voff,audio:!e.aoff,voff:e.voff,aoff:e.aoff};e.located()||(c={video:e.subArgs?e.subArgs.subSVideo:!e.voff,audio:e.subArgs?e.subArgs.subSAudio:!e.aoff,voff:e.voff,aoff:e.aoff}),a.trigger("onMediaChanaged",[c,e,e.owner,n]),o.getAttribute("sound")&&(i.current._monitSoundChanagedStreams=i.current._monitSoundChanagedStreams||{},i.current._monitSoundChanagedStreams[e.id]=e.id)}}).call(this,e,t,n)},getBindVideoBy:function(e){if("string"!=typeof e&&e&&e.id&&(e=e.id),"string"!=typeof e)throw p.error("Bad stream ",e),"Bad stream "+e;return this._videos[e]},createConfr:function(e,t){return function(e,t){var n=this;return"string"==typeof e&&(e=parseInt(e)),u.Observable.create(h.prototype.createConfr.call(n,{uid:n.identityName,token:n.identityToken,confrType:e,password:t,terminal:n._terminalInfo})).pipe(Object(d.map)(function(e){return e.mixed=11===e.type||12===e.type,e.id=e.serverConfrId=e.confrId,n._confrs[e.confrId]=c.a.extend({},e),i.a.removeAttribute(e,"rtcCfg"),e}),v)}.apply(this,arguments).toPromise()},reqTkt:function(e,t){return b.apply(this,arguments).toPromise()},chanageRoles:function(e,t,n){return function(e,t,n){var r=this._confr(n),i=this._service(n),o={uids:t,role:e,roleToken:r.roleToken};return u.Observable.create(h.prototype.chanageRoles.call(this,o)).pipe(Object(d.map)(function(e){return i&&i.current&&i.current._sysCopy(),r.id}),v)}.apply(this,arguments).toPromise()},disbandConfr:function(e,t){return function(e,t){var n=this,r=n._confr(e),o={roleToken:r&&r.roleToken||t};return u.Observable.create(h.prototype.disbandConfr.call(n,o)).pipe(Object(d.map)(function(t){return i.a.removeAttribute(n._confrs,e),r.id}),v)}.apply(this,arguments).toPromise()},kickMember:function(e,t){return function(e,t){var n=this._confr(t),r={uids:e,roleToken:n.roleToken};return u.Observable.create(h.prototype.kickMember.call(this,r)).pipe(Object(d.map)(function(e){return n.id}),v)}.apply(this,arguments).toPromise()},selectConfr:function(e,t){return g.apply(this,arguments).toPromise()},joinUsePassword:function(e,t,n){return y.call(this,e,t,n).toPromise()},joinUseTicket:function(e,t,n){return _.call(this,e,t,n).toPromise()},joined:function(e){return e&&this._confrs[e]&&this._confrs[e].joinId||this.__current_confrId&&this.joined(this.__current_confrId)},shareDesktopWithAudio:function(e,t,n,r,o){return i.a.targetDOM(n)||(o=r,r=n,n=void 0),function(e,t,n,r){var o=this,s=o._confr(e),a=o._service(e);if(a.current.role==o.Role.AUDIENCE)return Object(u.throwError)("Audience not allow publish");if(s.desktop)return Object(u.throwError)("desktop stream has been published. not allow repeat publish.");if((s.type===o.ConfrType.COMMUNICATION_MIX||s.type===o.ConfrType.LIVE)&&t.audio)return p.warn("confr mix. not allow desktop with audio."),Object(u.throwError)("confr mix. not allow desktop with audio.");t.audio||!s.av||s.av.aoff||p.warn("repeat audio. desktop and av");var c=s.desktop=new a.ShareDesktopPubstream({screenOptions:t.video&&t.video.screenOptions||["screen","window","tab"],mandatory:t.video&&t.video.mandatory||{},vbitrate:t.video&&t.video.bitrate,abitrate:t.audio&&t.audio.bitrate,aoff:t.audio?0:1,ext:r});return S.call(o,s.id,c).pipe(Object(d.concatMap)(function(e){return n&&i.a.targetDOM(n)&&attachMediaStream(n,e.localStream),w.call(o,s.id,e,r)}),Object(d.map)(function(e){return s.desktop=e,n&&i.a.targetDOM(n)&&o.streamBindVideo(s.desktop,n),i.a.extend({},e)}),Object(d.catchError)(function(e,t){throw s.desktop=void 0,p.error(e),e}))}.call(this,o,{video:e,audio:t},n,r).toPromise()},chanageCamera:function(e){return E.call(this,e).toPromise()},switchCamera:function(e){return E.call(this,e).toPromise()},shareVideoWithAudio:function(e,t,n,r,o){return i.a.targetDOM(n)||(o=r,r=n,n=void 0),function(e,t,n,r){var o=this,s=o._confr(e),a=o._service(e);if(a.current.role==o.Role.AUDIENCE)return Object(u.throwError)("Audience not allow publish");if(s.av)return Object(u.throwError)("Audio and video stream has been published. not allow repeat publish.");var c=s.mixed?a.AudioMixerPubstream:a.AVPubstream,l=s.av=new c({constaints:t,aoff:0,voff:0,ext:r});return S.call(o,s.id,l).pipe(Object(d.concatMap)(function(e){return n&&i.a.targetDOM(n)&&attachMediaStream(n,e.localStream),w.call(o,s.id,e,r)}),Object(d.map)(function(e){return s.av=e,n&&o.streamBindVideo(s.av,n),s.type==o.ConfrType.LIVE&&o.hungup(0),i.a.extend({},e)}),Object(d.catchError)(function(e,t){throw s.av&&o.hungup(s.av),s.av=void 0,p.error(e),e}))}.call(this,o,{video:e,audio:t},n,r).toPromise()},captureVideo:function(e,t,n,r){return this._service(r).captureVideo(e,t,n)},openUserMedia:function(e,t){var n=this._service(t);return u.Observable.create(function(t){n.__getUserMedia(e,function(e,n){t.next(n),t.complete()},function(e){t.error(e)})}).pipe(v).toPromise()},mediaDevices:function(e){return"function"==typeof e&&(e=void 0),u.Observable.create(function(t){navigator.mediaDevices.enumerateDevices().then(function(n){for(var r=[],i=0;i!==n.length;++i){var o=n[i];o.deviceId;e||r.push(o),e&&e===o.kind?r.push(o):"audioinput"===o.kind||"audiooutput"===o.kind||"videoinput"===o.kind||p.info("Some other kind of source/device: ",o)}t.next(r),t.complete()}).catch(function(e){p.warn("navigator.getUserMedia error: ",e),t.error(e)})}).pipe(v).toPromise()},resumeVideo:function(e,t,n){return x.call(this,e,t||!0,n).toPromise()},pauseVideo:function(e,t){return x.call(this,e,!1,t).toPromise()},resumeAudio:function(e,t){return C.call(this,e,!1,t).toPromise()},pauseAudio:function(e,t){return C.call(this,e,!0,t).toPromise()},freezeFrameRemote:function(e,t){return function(e,t){"string"!=typeof t&&(t=t.id),this._confr(e);var n=this._service(e);return u.Observable.create(function(e){n.freezeFrameRemote(t,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"freeze_remote_fail",error:-203,errorMessage:t.message()})})}).pipe(v)}.call(this,t,e).toPromise()},torchRemote:function(e,t,n){return function(e,t,n){"string"!=typeof t&&(t=t.id),this._confr(e);var r=this._service(e);return u.Observable.create(function(e){r.torchRemote(t,n,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"torch_remote_fail",error:-203,errorMessage:t.message()})})}).pipe(v)}.call(this,n,e,t).toPromise()},zoomRemote:function(e,t,n){return function(e,t,n){"string"!=typeof t&&(t=t.id),this._confr(e);var r=this._service(e);return u.Observable.create(function(e){r.zoomRemote(t,n,function(t){e.error({errorType:"capture_remote_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(v)}.call(this,n,e,t).toPromise()},capturePictureRemote:function(e,t){return function(e,t,n){"string"!=typeof t&&(t=t.id),this._confr(e);var r=this._service(e);return u.Observable.create(function(e){r.capturePictureRemote(t,n,function(t){e.next(t),e.complete()},function(t){e.error({errorType:"capture_remote_fail",error:-203,errorMessage:t.message()})})}).pipe(v)}.call(this,t,e,!1).toPromise()},focusExpoRemote:function(e,t,n,r){return function(e,t,n,r){"string"!=typeof t&&(t=t.id),this._confr(e);var i=this._service(e);return u.Observable.create(function(e){i.focusExpoRemote(t,n,r,function(t){e.error({errorType:"focusexpo_remote_fail",error:-203,errorMessage:t.message()})},function(){e.complete()})}).pipe(v)}.call(this,r,e,t,n).toPromise()},onFocusExpoRemoteWhenClickVideo:function(e,t,n,r){var i=this;return"function"==typeof t&&(r=n,n=t,t=void 0),s()(e).off(t||"click"),s()(e).on(t||"click",function(t){var o=e.getAttribute("easemob_stream");i.focusExpoRemote(o,e,t).then(r).catch(n)}),t},offEventAtTag:function(e,t){t&&s()(e).off(t)},hungup:function(e,t){var n;n="string"==typeof e?e:e.id||e+"";var r=this._service(t),i=this._confr(t);if(i&&r){r.hungup(n);var o=!1;if(i.av&&(o=i.av.id===n)&&(i.av=void 0),i.desktop&&i.desktop.id===n&&(i.desktop=void 0),o&&i.type==this.ConfrType.LIVE&&r.current.role==R.Role.AUDIENCE){var s=r.current&&r.current._cacheStreams[0];this.subscribe(r.current,s,!1,!0,t)}}else p.warn("when hungup stream. not found confr and service.",e)},subscribe:function(e,t,n,r,o,s){return i.a.targetDOM(o)||(s=o,o=void 0),T.call(this,s,t,n,r,o).toPromise()},exit:function(e,t){var n=this._service(t);n?n.exit(e):p.warn("when exit. not found service.",t)},_onExit:function(e,t,n){try{this.__current_confrId=void 0,this.onExit(t,n,e)}finally{i.a.removeAttribute(this._confrs,e),i.a.removeAttribute(this._services,e),i.a.removeAttribute(this._videos,e),i.a.removeAttribute(this._events,e)}},onExit:function(e,t,n){},_onRoleUpdated:function(e,t){},onMemberJoin:function(e,t){},onMemberLeave:function(e,t,n){},_onRecvRemoteMessage:function(e,t,n){},crtAndReturnVideo:function(e,t,n){},unloadVideo:function(e,t,n,r){},remoteControl:function(e,t,n,r,i,o,s,a,c,u,d){var l=this._service(d);r=!!r;var f="string"==typeof e?e:e.id;r?emedia.ctrl.mirrorControlled(l,f,t,n,i,o,s,a,c,u):emedia.ctrl.controlled(l,f,t,n,i,o,s,a,c,u)},freeRemoteControl:function(e,t){var n=this._service(t),r="string"==typeof e?e:e.id;emedia.ctrl.disControlled(n,r)},zeptoTrigger:function(e,t){return u.Observable.create(function(n){s()(e).trigger(t,[function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])}).pipe(v).toPromise()},_onAddMemberStream:function(e,t){},_onRemoveMemberStream:function(e,t){},_onUpdateMemberStream:function(e,t,n){},_onMemberMediaChanaged:function(e,t,n,r){var i=this._videos[t.id];n&&(n.voff=t.voff,n.aoff=t.aoff),i&&s()(i).trigger("onMediaChanaged",[n,t,e,r])},onMediaChanaged:function(e,t){this.addVideoEventListener(e,"onMediaChanaged",t)},_onMemberSoundChanaged:function(e,t,n,r){var i=this._videos[t.id];i&&s()(i).trigger("onSoundChanaged",[n,t,e,r])},onSoundChanaged:function(e,t){if(!emedia.config.getMediaMeterIntervalMillis||emedia.config.getMediaMeterIntervalMillis<=0)throw p.error("monit sound chanaged not config. please config getMediaMeterIntervalMillis"),"monit sound chanaged not config. please config getMediaMeterIntervalMillis";e.setAttribute("sound","sound"),this.addVideoEventListener(e,"onSoundChanaged",t)},onMediaTransmission:function(e,t){if(emedia.helper&&"function"==typeof emedia.helper.inboundVideo){var n=this._service(),r=e.getAttribute("easemob_stream"),i=r&&n.getStreamById(r),o=e.getAttribute("flowWebrtc");i&&i._webrtc&&o==i._webrtc.__id||(e.hasAttribute("flow")&&i&&i._webrtc?(i.located()?emedia.helper.outboundVideo(i,t,1e3):emedia.helper.inboundVideo(i,t,1e3),e.setAttribute("flowWebrtc",i._webrtc.__id)):(this.addVideoEventListener(e,"onMediaTransmission",t),e.setAttribute("flow","flow")))}else p.warn("please import helper. <script>")},_onTalking:function(e,t,n,r){},_onNotSupportMemberPublishVideoCodecs:function(e,t,n){var r=this._videos[t.id];r&&s()(r).trigger("onNotSupportVideoCodecs",[t,e,n])},onNotSupportVideoCodecs:function(e,t){this.addVideoEventListener(e,"onNotSupportVideoCodecs",t)},_onStreamIceStateChanged:function(e,t,n,r){var i=this._videos[t.id];i&&s()(i).trigger("onIceStateChanged",[n,t,e,r])},onIceStateChanged:function(e,t){this.addVideoEventListener(e,"onIceStateChanged",t)},onHasRemoteControl:function(e,t,n,r){var i=this._videos[e.id];i&&s()(i).trigger("onRemoteControl",[t,n,e,r])},onRemoteControl:function(e,t){this.addVideoEventListener(e,"onRemoteControl",t)},onRemoteFreeControl:function(e,t,n,r){var i=this._videos[e.id];i&&s()(i).trigger("onFreeControl",[t,n,e,r])},onFreeControl:function(e,t){this.addVideoEventListener(e,"onFreeControl",t)},addVideoEventListener:function(e,t,n){s()(e).off(t),s()(e).on(t,function(){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);n&&n.apply(e,t)})}});c.a.each(["hungup","subscribe","pauseVideo","resumeVideo","pauseAudio","resumeAudio","chanageCamera","freeRemoteControl","capturePictureRemote","freezeFrameRemote"],function(e,t){var n=e.replace(/\b[a-z]/g,function(e){return e.toUpperCase()});I["trigger"+n]=function(t){return I.zeptoTrigger(t,e)}}),I.triggerTorchRemote=function(e,t){return u.Observable.create(function(n){s()(e).trigger("torchRemote",[t,function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])}).pipe(v).toPromise()},I.triggerZoomRemote=function(e,t){return u.Observable.create(function(n){s()(e).trigger("zoomRemote",[t,function(){n.error.apply(n,arguments)},function(){n.next.apply(n,arguments),n.complete()}])}).pipe(v).toPromise()},I.triggerSubscribe=function(e,t,n){return u.Observable.create(function(r){s()(e).trigger("subscribe",[t,n,function(){r.error.apply(r,arguments)},function(){r.next.apply(r,arguments),r.complete()}])}).pipe(v).toPromise()},I.triggerRemoteControl=function(e,t,n,r,i,o,a,c){s()(e).trigger("remoteControl",[t,n,r,i,o,a,c])},I.triggerCaptureVideo=function(e,t,n){return u.Observable.create(function(r){s()(e).trigger("captureVideo",[function(){r.next.apply(r,arguments),r.complete()},t,n])}).pipe(v).toPromise()};var R=I},function(e,t,n){"use strict";n.r(t);var r=n(37);n.d(t,"Observable",function(){return r.Observable});var i=n(55);n.d(t,"ConnectableObservable",function(){return i.ConnectableObservable});var o=n(60);n.d(t,"GroupedObservable",function(){return o.GroupedObservable});var s=n(52);n.d(t,"observable",function(){return s.observable});var a=n(56);n.d(t,"Subject",function(){return a.Subject});var c=n(61);n.d(t,"BehaviorSubject",function(){return c.BehaviorSubject});var u=n(62);n.d(t,"ReplaySubject",function(){return u.ReplaySubject});var d=n(79);n.d(t,"AsyncSubject",function(){return d.AsyncSubject});var l=n(80);n.d(t,"asapScheduler",function(){return l.asap});var f=n(84);n.d(t,"asyncScheduler",function(){return f.async});var p=n(63);n.d(t,"queueScheduler",function(){return p.queue});var h=n(85);n.d(t,"animationFrameScheduler",function(){return h.animationFrame});var m=n(88);n.d(t,"VirtualTimeScheduler",function(){return m.VirtualTimeScheduler}),n.d(t,"VirtualAction",function(){return m.VirtualAction});var v=n(69);n.d(t,"Scheduler",function(){return v.Scheduler});var b=n(45);n.d(t,"Subscription",function(){return b.Subscription});var g=n(39);n.d(t,"Subscriber",function(){return g.Subscriber});var _=n(71);n.d(t,"Notification",function(){return _.Notification});var y=n(53);n.d(t,"pipe",function(){return y.pipe});var S=n(54);n.d(t,"noop",function(){return S.noop});var w=n(89);n.d(t,"identity",function(){return w.identity});var x=n(90);n.d(t,"isObservable",function(){return x.isObservable});var C=n(91);n.d(t,"ArgumentOutOfRangeError",function(){return C.ArgumentOutOfRangeError});var E=n(92);n.d(t,"EmptyError",function(){return E.EmptyError});var T=n(57);n.d(t,"ObjectUnsubscribedError",function(){return T.ObjectUnsubscribedError});var I=n(50);n.d(t,"UnsubscriptionError",function(){return I.UnsubscriptionError});var R=n(93);n.d(t,"TimeoutError",function(){return R.TimeoutError});var k=n(94);n.d(t,"bindCallback",function(){return k.bindCallback});var O=n(96);n.d(t,"bindNodeCallback",function(){return O.bindNodeCallback});var M=n(97);n.d(t,"combineLatest",function(){return M.combineLatest});var A=n(108);n.d(t,"concat",function(){return A.concat});var P=n(118);n.d(t,"defer",function(){return P.defer});var j=n(72);n.d(t,"empty",function(){return j.empty});var N=n(119);n.d(t,"forkJoin",function(){return N.forkJoin});var D=n(109);n.d(t,"from",function(){return D.from});var L=n(120);n.d(t,"fromEvent",function(){return L.fromEvent});var V=n(121);n.d(t,"fromEventPattern",function(){return V.fromEventPattern});var F=n(122);n.d(t,"generate",function(){return F.generate});var U=n(123);n.d(t,"iif",function(){return U.iif});var W=n(124);n.d(t,"interval",function(){return W.interval});var B=n(126);n.d(t,"merge",function(){return B.merge});var z=n(127);n.d(t,"never",function(){return z.never});var $=n(73);n.d(t,"of",function(){return $.of});var q=n(128);n.d(t,"onErrorResumeNext",function(){return q.onErrorResumeNext});var G=n(129);n.d(t,"pairs",function(){return G.pairs});var H=n(130);n.d(t,"race",function(){return H.race});var Y=n(131);n.d(t,"range",function(){return Y.range});var J=n(78);n.d(t,"throwError",function(){return J.throwError});var K=n(132);n.d(t,"timer",function(){return K.timer});var X=n(133);n.d(t,"using",function(){return X.using});var Z=n(134);n.d(t,"zip",function(){return Z.zip}),n.d(t,"EMPTY",function(){return j.EMPTY}),n.d(t,"NEVER",function(){return z.NEVER});var Q=n(43);n.d(t,"config",function(){return Q.config})},function(e,t,n){"use strict";n.r(t),n.d(t,"Observable",function(){return a});var r=n(38),i=n(52),o=n(53),s=n(43),a=function(){function e(e){this._isScalar=!1,e&&(this._subscribe=e)}return e.prototype.lift=function(t){var n=new e;return n.source=this,n.operator=t,n},e.prototype.subscribe=function(e,t,n){var i=this.operator,o=Object(r.toSubscriber)(e,t,n);if(i?i.call(o,this.source):o.add(this.source||s.config.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),s.config.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},e.prototype._trySubscribe=function(e){try{return this._subscribe(e)}catch(t){s.config.useDeprecatedSynchronousErrorHandling&&(e.syncErrorThrown=!0,e.syncErrorValue=t),e.error(t)}},e.prototype.forEach=function(e,t){var n=this;return new(t=c(t))(function(t,r){var i;i=n.subscribe(function(t){try{e(t)}catch(n){r(n),i&&i.unsubscribe()}},r,t)})},e.prototype._subscribe=function(e){var t=this.source;return t&&t.subscribe(e)},e.prototype[i.observable]=function(){return this},e.prototype.pipe=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 0===e.length?this:Object(o.pipeFromArray)(e)(this)},e.prototype.toPromise=function(e){var t=this;return new(e=c(e))(function(e,n){var r;t.subscribe(function(e){return r=e},function(e){return n(e)},function(){return e(r)})})},e.create=function(t){return new e(t)},e}();function c(e){if(e||(e=s.config.Promise||Promise),!e)throw new Error("no Promise impl found");return e}},function(e,t,n){"use strict";n.r(t),n.d(t,"toSubscriber",function(){return s});var r=n(39),i=n(51),o=n(42);function s(e,t,n){if(e){if(e instanceof r.Subscriber)return e;if(e[i.rxSubscriber])return e[i.rxSubscriber]()}return e||t||n?new r.Subscriber(e,t,n):new r.Subscriber(o.empty)}},function(e,t,n){"use strict";n.r(t),n.d(t,"Subscriber",function(){return d});var r=n(40),i=n(41),o=n(42),s=n(45),a=n(51),c=n(43),u=n(44),d=function(e){function t(t,n,r){var i=e.call(this)||this;switch(i.syncErrorValue=null,i.syncErrorThrown=!1,i.syncErrorThrowable=!1,i.isStopped=!1,arguments.length){case 0:i.destination=o.empty;break;case 1:if(!t){i.destination=o.empty;break}if("object"==typeof t){if(f(t)){var s=t[a.rxSubscriber]();i.syncErrorThrowable=s.syncErrorThrowable,i.destination=s,s.add(i)}else i.syncErrorThrowable=!0,i.destination=new l(i,t);break}default:i.syncErrorThrowable=!0,i.destination=new l(i,t,n,r)}return i}return r.__extends(t,e),t.prototype[a.rxSubscriber]=function(){return this},t.create=function(e,n,r){var i=new t(e,n,r);return i.syncErrorThrowable=!1,i},t.prototype.next=function(e){this.isStopped||this._next(e)},t.prototype.error=function(e){this.isStopped||(this.isStopped=!0,this._error(e))},t.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},t.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},t.prototype._next=function(e){this.destination.next(e)},t.prototype._error=function(e){this.destination.error(e),this.unsubscribe()},t.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},t.prototype._unsubscribeAndRecycle=function(){var e=this._parent,t=this._parents;return this._parent=null,this._parents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parent=e,this._parents=t,this},t}(s.Subscription),l=function(e){function t(t,n,r,s){var a,c=e.call(this)||this;c._parentSubscriber=t;var u=c;return Object(i.isFunction)(n)?a=n:n&&(a=n.next,r=n.error,s=n.complete,n!==o.empty&&(u=Object.create(n),Object(i.isFunction)(u.unsubscribe)&&c.add(u.unsubscribe.bind(u)),u.unsubscribe=c.unsubscribe.bind(c))),c._context=u,c._next=a,c._error=r,c._complete=s,c}return r.__extends(t,e),t.prototype.next=function(e){if(!this.isStopped&&this._next){var t=this._parentSubscriber;c.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?this.__tryOrSetError(t,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}},t.prototype.error=function(e){if(!this.isStopped){var t=this._parentSubscriber,n=c.config.useDeprecatedSynchronousErrorHandling;if(this._error)n&&t.syncErrorThrowable?(this.__tryOrSetError(t,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(t.syncErrorThrowable)n?(t.syncErrorValue=e,t.syncErrorThrown=!0):Object(u.hostReportError)(e),this.unsubscribe();else{if(this.unsubscribe(),n)throw e;Object(u.hostReportError)(e)}}},t.prototype.complete=function(){var e=this;if(!this.isStopped){var t=this._parentSubscriber;if(this._complete){var n=function(){return e._complete.call(e._context)};c.config.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(e,t){try{e.call(this._context,t)}catch(n){if(this.unsubscribe(),c.config.useDeprecatedSynchronousErrorHandling)throw n;Object(u.hostReportError)(n)}},t.prototype.__tryOrSetError=function(e,t,n){if(!c.config.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,n)}catch(r){return c.config.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=r,e.syncErrorThrown=!0,!0):(Object(u.hostReportError)(r),!0)}return!1},t.prototype._unsubscribe=function(){var e=this._parentSubscriber;this._context=null,this._parentSubscriber=null,e.unsubscribe()},t}(d);function f(e){return e instanceof d||"syncErrorThrowable"in e&&e[a.rxSubscriber]}},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",function(){return i}),n.d(t,"__assign",function(){return o}),n.d(t,"__rest",function(){return s}),n.d(t,"__decorate",function(){return a}),n.d(t,"__param",function(){return c}),n.d(t,"__metadata",function(){return u}),n.d(t,"__awaiter",function(){return d}),n.d(t,"__generator",function(){return l}),n.d(t,"__exportStar",function(){return f}),n.d(t,"__values",function(){return p}),n.d(t,"__read",function(){return h}),n.d(t,"__spread",function(){return m}),n.d(t,"__await",function(){return v}),n.d(t,"__asyncGenerator",function(){return b}),n.d(t,"__asyncDelegator",function(){return g}),n.d(t,"__asyncValues",function(){return _}),n.d(t,"__makeTemplateObject",function(){return y}),n.d(t,"__importStar",function(){return S}),n.d(t,"__importDefault",function(){return w});var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&(n[r[i]]=e[r[i]])}return n}function a(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,n,r){return new(n||(n=Promise))(function(i,o){function s(e){try{c(r.next(e))}catch(t){o(t)}}function a(e){try{c(r.throw(e))}catch(t){o(t)}}function c(e){e.done?i(e.value):new n(function(t){t(e.value)}).then(s,a)}c((r=r.apply(e,t||[])).next())})}function l(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=(i=s.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(a){o=[6,a],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function f(e,t){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}function p(e){var t="function"==typeof Symbol&&e[Symbol.iterator],n=0;return t?t.call(e):{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}function h(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function m(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}function v(e){return this instanceof v?(this.v=e,this):new v(e)}function b(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||a(e,t)})})}function a(e,t){try{(n=i[e](t)).value instanceof v?Promise.resolve(n.value.v).then(c,u):d(o[0][2],n)}catch(r){d(o[0][3],r)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function g(e){var t,n;return t={},r("next"),r("throw",function(e){throw e}),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:v(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function _(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=p(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}function y(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function S(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function w(e){return e&&e.__esModule?e:{default:e}}},function(e,t,n){"use strict";function r(e){return"function"==typeof e}n.r(t),n.d(t,"isFunction",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"empty",function(){return o});var r=n(43),i=n(44),o={closed:!0,next:function(e){},error:function(e){if(r.config.useDeprecatedSynchronousErrorHandling)throw e;Object(i.hostReportError)(e)},complete:function(){}}},function(e,t,n){"use strict";n.r(t),n.d(t,"config",function(){return i});var r=!1,i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e&&(new Error).stack;r=e},get useDeprecatedSynchronousErrorHandling(){return r}}},function(e,t,n){"use strict";function r(e){setTimeout(function(){throw e})}n.r(t),n.d(t,"hostReportError",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"Subscription",function(){return u});var r=n(46),i=n(47),o=n(41),s=n(48),a=n(49),c=n(50),u=function(){function e(e){this.closed=!1,this._parent=null,this._parents=null,this._subscriptions=null,e&&(this._unsubscribe=e)}var t;return e.prototype.unsubscribe=function(){var e,t=!1;if(!this.closed){var n=this._parent,u=this._parents,l=this._unsubscribe,f=this._subscriptions;this.closed=!0,this._parent=null,this._parents=null,this._subscriptions=null;for(var p=-1,h=u?u.length:0;n;)n.remove(this),n=++p<h&&u[p]||null;if(Object(o.isFunction)(l))Object(s.tryCatch)(l).call(this)===a.errorObject&&(t=!0,e=e||(a.errorObject.e instanceof c.UnsubscriptionError?d(a.errorObject.e.errors):[a.errorObject.e]));if(Object(r.isArray)(f))for(p=-1,h=f.length;++p<h;){var m=f[p];if(Object(i.isObject)(m))if(Object(s.tryCatch)(m.unsubscribe).call(m)===a.errorObject){t=!0,e=e||[];var v=a.errorObject.e;v instanceof c.UnsubscriptionError?e=e.concat(d(v.errors)):e.push(v)}}if(t)throw new c.UnsubscriptionError(e)}},e.prototype.add=function(t){if(!t||t===e.EMPTY)return e.EMPTY;if(t===this)return this;var n=t;switch(typeof t){case"function":n=new e(t);case"object":if(n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if("function"!=typeof n._addParent){var r=n;(n=new e)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}return(this._subscriptions||(this._subscriptions=[])).push(n),n._addParent(this),n},e.prototype.remove=function(e){var t=this._subscriptions;if(t){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}},e.prototype._addParent=function(e){var t=this._parent,n=this._parents;t&&t!==e?n?-1===n.indexOf(e)&&n.push(e):this._parents=[e]:this._parent=e},e.EMPTY=((t=new e).closed=!0,t),e}();function d(e){return e.reduce(function(e,t){return e.concat(t instanceof c.UnsubscriptionError?t.errors:t)},[])}},function(e,t,n){"use strict";n.r(t),n.d(t,"isArray",function(){return r});var r=Array.isArray||function(e){return e&&"number"==typeof e.length}},function(e,t,n){"use strict";function r(e){return null!=e&&"object"==typeof e}n.r(t),n.d(t,"isObject",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"tryCatch",function(){return s});var r,i=n(49);function o(){try{return r.apply(this,arguments)}catch(e){return i.errorObject.e=e,i.errorObject}}function s(e){return r=e,o}},function(e,t,n){"use strict";n.r(t),n.d(t,"errorObject",function(){return r});var r={e:{}}},function(e,t,n){"use strict";n.r(t),n.d(t,"UnsubscriptionError",function(){return i});var r=n(40),i=function(e){function t(n){var r=e.call(this,n?n.length+" errors occurred during unsubscription:\n  "+n.map(function(e,t){return t+1+") "+e.toString()}).join("\n  "):"")||this;return r.errors=n,r.name="UnsubscriptionError",Object.setPrototypeOf(r,t.prototype),r}return r.__extends(t,e),t}(Error)},function(e,t,n){"use strict";n.r(t),n.d(t,"rxSubscriber",function(){return r}),n.d(t,"$$rxSubscriber",function(){return i});var r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("rxSubscriber"):"@@rxSubscriber",i=r},function(e,t,n){"use strict";n.r(t),n.d(t,"observable",function(){return r});var r="function"==typeof Symbol&&Symbol.observable||"@@observable"},function(e,t,n){"use strict";n.r(t),n.d(t,"pipe",function(){return i}),n.d(t,"pipeFromArray",function(){return o});var r=n(54);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return o(e)}function o(e){return e?1===e.length?e[0]:function(t){return e.reduce(function(e,t){return t(e)},t)}:r.noop}},function(e,t,n){"use strict";function r(){}n.r(t),n.d(t,"noop",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"ConnectableObservable",function(){return u}),n.d(t,"connectableObservableDescriptor",function(){return l});var r=n(40),i=n(56),o=n(37),s=n(39),a=n(45),c=n(59),u=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subjectFactory=n,r._refCount=0,r._isComplete=!1,r}return r.__extends(t,e),t.prototype._subscribe=function(e){return this.getSubject().subscribe(e)},t.prototype.getSubject=function(){var e=this._subject;return e&&!e.isStopped||(this._subject=this.subjectFactory()),this._subject},t.prototype.connect=function(){var e=this._connection;return e||(this._isComplete=!1,(e=this._connection=new a.Subscription).add(this.source.subscribe(new f(this.getSubject(),this))),e.closed?(this._connection=null,e=a.Subscription.EMPTY):this._connection=e),e},t.prototype.refCount=function(){return Object(c.refCount)()(this)},t}(o.Observable),d=u.prototype,l={operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:d._subscribe},_isComplete:{value:d._isComplete,writable:!0},getSubject:{value:d.getSubject},connect:{value:d.connect},refCount:{value:d.refCount}},f=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.__extends(t,e),t.prototype._error=function(t){this._unsubscribe(),e.prototype._error.call(this,t)},t.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._connection;e._refCount=0,e._subject=null,e._connection=null,t&&t.unsubscribe()}},t}(i.SubjectSubscriber);s.Subscriber},function(e,t,n){"use strict";n.r(t),n.d(t,"SubjectSubscriber",function(){return d}),n.d(t,"Subject",function(){return l}),n.d(t,"AnonymousSubject",function(){return f});var r=n(40),i=n(37),o=n(39),s=n(45),a=n(57),c=n(58),u=n(51),d=function(e){function t(t){var n=e.call(this,t)||this;return n.destination=t,n}return r.__extends(t,e),t}(o.Subscriber),l=function(e){function t(){var t=e.call(this)||this;return t.observers=[],t.closed=!1,t.isStopped=!1,t.hasError=!1,t.thrownError=null,t}return r.__extends(t,e),t.prototype[u.rxSubscriber]=function(){return new d(this)},t.prototype.lift=function(e){var t=new f(this,this);return t.operator=e,t},t.prototype.next=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;if(!this.isStopped)for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].next(e)},t.prototype.error=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;this.hasError=!0,this.thrownError=e,this.isStopped=!0;for(var t=this.observers,n=t.length,r=t.slice(),i=0;i<n;i++)r[i].error(e);this.observers.length=0},t.prototype.complete=function(){if(this.closed)throw new a.ObjectUnsubscribedError;this.isStopped=!0;for(var e=this.observers,t=e.length,n=e.slice(),r=0;r<t;r++)n[r].complete();this.observers.length=0},t.prototype.unsubscribe=function(){this.isStopped=!0,this.closed=!0,this.observers=null},t.prototype._trySubscribe=function(t){if(this.closed)throw new a.ObjectUnsubscribedError;return e.prototype._trySubscribe.call(this,t)},t.prototype._subscribe=function(e){if(this.closed)throw new a.ObjectUnsubscribedError;return this.hasError?(e.error(this.thrownError),s.Subscription.EMPTY):this.isStopped?(e.complete(),s.Subscription.EMPTY):(this.observers.push(e),new c.SubjectSubscription(this,e))},t.prototype.asObservable=function(){var e=new i.Observable;return e.source=this,e},t.create=function(e,t){return new f(e,t)},t}(i.Observable),f=function(e){function t(t,n){var r=e.call(this)||this;return r.destination=t,r.source=n,r}return r.__extends(t,e),t.prototype.next=function(e){var t=this.destination;t&&t.next&&t.next(e)},t.prototype.error=function(e){var t=this.destination;t&&t.error&&this.destination.error(e)},t.prototype.complete=function(){var e=this.destination;e&&e.complete&&this.destination.complete()},t.prototype._subscribe=function(e){return this.source?this.source.subscribe(e):s.Subscription.EMPTY},t}(l)},function(e,t,n){"use strict";n.r(t),n.d(t,"ObjectUnsubscribedError",function(){return i});var r=n(40),i=function(e){function t(){var n=e.call(this,"object unsubscribed")||this;return n.name="ObjectUnsubscribedError",Object.setPrototypeOf(n,t.prototype),n}return r.__extends(t,e),t}(Error)},function(e,t,n){"use strict";n.r(t),n.d(t,"SubjectSubscription",function(){return i});var r=n(40),i=function(e){function t(t,n){var r=e.call(this)||this;return r.subject=t,r.subscriber=n,r.closed=!1,r}return r.__extends(t,e),t.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var e=this.subject,t=e.observers;if(this.subject=null,t&&0!==t.length&&!e.isStopped&&!e.closed){var n=t.indexOf(this.subscriber);-1!==n&&t.splice(n,1)}}},t}(n(45).Subscription)},function(e,t,n){"use strict";n.r(t),n.d(t,"refCount",function(){return o});var r=n(40),i=n(39);function o(){return function(e){return e.lift(new s(e))}}var s=function(){function e(e){this.connectable=e}return e.prototype.call=function(e,t){var n=this.connectable;n._refCount++;var r=new a(e,n),i=t.subscribe(r);return r.closed||(r.connection=n.connect()),i},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.connectable=n,r}return r.__extends(t,e),t.prototype._unsubscribe=function(){var e=this.connectable;if(e){this.connectable=null;var t=e._refCount;if(t<=0)this.connection=null;else if(e._refCount=t-1,t>1)this.connection=null;else{var n=this.connection,r=e._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}else this.connection=null},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"groupBy",function(){return c}),n.d(t,"GroupedObservable",function(){return f});var r=n(40),i=n(39),o=n(45),s=n(37),a=n(56);function c(e,t,n,r){return function(i){return i.lift(new u(e,t,n,r))}}var u=function(){function e(e,t,n,r){this.keySelector=e,this.elementSelector=t,this.durationSelector=n,this.subjectSelector=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.keySelector,this.elementSelector,this.durationSelector,this.subjectSelector))},e}(),d=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.keySelector=n,s.elementSelector=r,s.durationSelector=i,s.subjectSelector=o,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}return r.__extends(t,e),t.prototype._next=function(e){var t;try{t=this.keySelector(e)}catch(n){return void this.error(n)}this._group(e,t)},t.prototype._group=function(e,t){var n=this.groups;n||(n=this.groups=new Map);var r,i=n.get(t);if(this.elementSelector)try{r=this.elementSelector(e)}catch(c){this.error(c)}else r=e;if(!i){i=this.subjectSelector?this.subjectSelector():new a.Subject,n.set(t,i);var o=new f(t,i,this);if(this.destination.next(o),this.durationSelector){var s=void 0;try{s=this.durationSelector(new f(t,i))}catch(c){return void this.error(c)}this.add(s.subscribe(new l(t,i,this)))}}i.closed||i.next(r)},t.prototype._error=function(e){var t=this.groups;t&&(t.forEach(function(t,n){t.error(e)}),t.clear()),this.destination.error(e)},t.prototype._complete=function(){var e=this.groups;e&&(e.forEach(function(e,t){e.complete()}),e.clear()),this.destination.complete()},t.prototype.removeGroup=function(e){this.groups.delete(e)},t.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,0===this.count&&e.prototype.unsubscribe.call(this))},t}(i.Subscriber),l=function(e){function t(t,n,r){var i=e.call(this,n)||this;return i.key=t,i.group=n,i.parent=r,i}return r.__extends(t,e),t.prototype._next=function(e){this.complete()},t.prototype._unsubscribe=function(){var e=this.parent,t=this.key;this.key=this.parent=null,e&&e.removeGroup(t)},t}(i.Subscriber),f=function(e){function t(t,n,r){var i=e.call(this)||this;return i.key=t,i.groupSubject=n,i.refCountSubscription=r,i}return r.__extends(t,e),t.prototype._subscribe=function(e){var t=new o.Subscription,n=this.refCountSubscription,r=this.groupSubject;return n&&!n.closed&&t.add(new p(n)),t.add(r.subscribe(e)),t},t}(s.Observable),p=function(e){function t(t){var n=e.call(this)||this;return n.parent=t,t.count++,n}return r.__extends(t,e),t.prototype.unsubscribe=function(){var t=this.parent;t.closed||this.closed||(e.prototype.unsubscribe.call(this),t.count-=1,0===t.count&&t.attemptedToUnsubscribe&&t.unsubscribe())},t}(o.Subscription)},function(e,t,n){"use strict";n.r(t),n.d(t,"BehaviorSubject",function(){return s});var r=n(40),i=n(56),o=n(57),s=function(e){function t(t){var n=e.call(this)||this;return n._value=t,n}return r.__extends(t,e),Object.defineProperty(t.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),t.prototype._subscribe=function(t){var n=e.prototype._subscribe.call(this,t);return n&&!n.closed&&t.next(this._value),n},t.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new o.ObjectUnsubscribedError;return this._value},t.prototype.next=function(t){e.prototype.next.call(this,this._value=t)},t}(i.Subject)},function(e,t,n){"use strict";n.r(t),n.d(t,"ReplaySubject",function(){return d});var r=n(40),i=n(56),o=n(63),s=n(45),a=n(70),c=n(57),u=n(58),d=function(e){function t(t,n,r){void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=Number.POSITIVE_INFINITY);var i=e.call(this)||this;return i.scheduler=r,i._events=[],i._infiniteTimeWindow=!1,i._bufferSize=t<1?1:t,i._windowTime=n<1?1:n,n===Number.POSITIVE_INFINITY?(i._infiniteTimeWindow=!0,i.next=i.nextInfiniteTimeWindow):i.next=i.nextTimeWindow,i}return r.__extends(t,e),t.prototype.nextInfiniteTimeWindow=function(t){var n=this._events;n.push(t),n.length>this._bufferSize&&n.shift(),e.prototype.next.call(this,t)},t.prototype.nextTimeWindow=function(t){this._events.push(new l(this._getNow(),t)),this._trimBufferThenGetEvents(),e.prototype.next.call(this,t)},t.prototype._subscribe=function(e){var t,n=this._infiniteTimeWindow,r=n?this._events:this._trimBufferThenGetEvents(),i=this.scheduler,o=r.length;if(this.closed)throw new c.ObjectUnsubscribedError;if(this.isStopped||this.hasError?t=s.Subscription.EMPTY:(this.observers.push(e),t=new u.SubjectSubscription(this,e)),i&&e.add(e=new a.ObserveOnSubscriber(e,i)),n)for(var d=0;d<o&&!e.closed;d++)e.next(r[d]);else for(d=0;d<o&&!e.closed;d++)e.next(r[d].value);return this.hasError?e.error(this.thrownError):this.isStopped&&e.complete(),t},t.prototype._getNow=function(){return(this.scheduler||o.queue).now()},t.prototype._trimBufferThenGetEvents=function(){for(var e=this._getNow(),t=this._bufferSize,n=this._windowTime,r=this._events,i=r.length,o=0;o<i&&!(e-r[o].time<n);)o++;return i>t&&(o=Math.max(o,i-t)),o>0&&r.splice(0,o),r},t}(i.Subject),l=function(){return function(e,t){this.time=e,this.value=t}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"queue",function(){return i});var r=n(64),i=new(n(67).QueueScheduler)(r.QueueAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"QueueAction",function(){return i});var r=n(40),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.__extends(t,e),t.prototype.schedule=function(t,n){return void 0===n&&(n=0),n>0?e.prototype.schedule.call(this,t,n):(this.delay=n,this.state=t,this.scheduler.flush(this),this)},t.prototype.execute=function(t,n){return n>0||this.closed?e.prototype.execute.call(this,t,n):this._execute(t,n)},t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0?e.prototype.requestAsyncId.call(this,t,n,r):t.flush(this)},t}(n(65).AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsyncAction",function(){return i});var r=n(40),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r.pending=!1,r}return r.__extends(t,e),t.prototype.schedule=function(e,t){if(void 0===t&&(t=0),this.closed)return this;this.state=e;var n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,t)),this.pending=!0,this.delay=t,this.id=this.id||this.requestAsyncId(r,this.id,t),this},t.prototype.requestAsyncId=function(e,t,n){return void 0===n&&(n=0),setInterval(e.flush.bind(e,this),n)},t.prototype.recycleAsyncId=function(e,t,n){if(void 0===n&&(n=0),null!==n&&this.delay===n&&!1===this.pending)return t;clearInterval(t)},t.prototype.execute=function(e,t){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;var n=this._execute(e,t);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))},t.prototype._execute=function(e,t){var n=!1,r=void 0;try{this.work(e)}catch(i){n=!0,r=!!i&&i||new Error(i)}if(n)return this.unsubscribe(),r},t.prototype._unsubscribe=function(){var e=this.id,t=this.scheduler,n=t.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=e&&(this.id=this.recycleAsyncId(t,e,null)),this.delay=null},t}(n(66).Action)},function(e,t,n){"use strict";n.r(t),n.d(t,"Action",function(){return i});var r=n(40),i=function(e){function t(t,n){return e.call(this)||this}return r.__extends(t,e),t.prototype.schedule=function(e,t){return void 0===t&&(t=0),this},t}(n(45).Subscription)},function(e,t,n){"use strict";n.r(t),n.d(t,"QueueScheduler",function(){return i});var r=n(40),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t}(n(68).AsyncScheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsyncScheduler",function(){return o});var r=n(40),i=n(69),o=function(e){function t(n,r){void 0===r&&(r=i.Scheduler.now);var o=e.call(this,n,function(){return t.delegate&&t.delegate!==o?t.delegate.now():r()})||this;return o.actions=[],o.active=!1,o.scheduled=void 0,o}return r.__extends(t,e),t.prototype.schedule=function(n,r,i){return void 0===r&&(r=0),t.delegate&&t.delegate!==this?t.delegate.schedule(n,r,i):e.prototype.schedule.call(this,n,r,i)},t.prototype.flush=function(e){var t=this.actions;if(this.active)t.push(e);else{var n;this.active=!0;do{if(n=e.execute(e.state,e.delay))break}while(e=t.shift());if(this.active=!1,n){for(;e=t.shift();)e.unsubscribe();throw n}}},t}(i.Scheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"Scheduler",function(){return r});var r=function(){function e(t,n){void 0===n&&(n=e.now),this.SchedulerAction=t,this.now=n}return e.prototype.schedule=function(e,t,n){return void 0===t&&(t=0),new this.SchedulerAction(this,e).schedule(n,t)},e.now=function(){return Date.now()},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"observeOn",function(){return s}),n.d(t,"ObserveOnOperator",function(){return a}),n.d(t,"ObserveOnSubscriber",function(){return c}),n.d(t,"ObserveOnMessage",function(){return u});var r=n(40),i=n(39),o=n(71);function s(e,t){return void 0===t&&(t=0),function(n){return n.lift(new a(e,t))}}var a=function(){function e(e,t){void 0===t&&(t=0),this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.scheduler,this.delay))},e}(),c=function(e){function t(t,n,r){void 0===r&&(r=0);var i=e.call(this,t)||this;return i.scheduler=n,i.delay=r,i}return r.__extends(t,e),t.dispatch=function(e){var t=e.notification,n=e.destination;t.observe(n),this.unsubscribe()},t.prototype.scheduleMessage=function(e){this.add(this.scheduler.schedule(t.dispatch,this.delay,new u(e,this.destination)))},t.prototype._next=function(e){this.scheduleMessage(o.Notification.createNext(e))},t.prototype._error=function(e){this.scheduleMessage(o.Notification.createError(e))},t.prototype._complete=function(){this.scheduleMessage(o.Notification.createComplete())},t}(i.Subscriber),u=function(){return function(e,t){this.notification=e,this.destination=t}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"Notification",function(){return s});var r=n(72),i=n(73),o=n(78),s=function(){function e(e,t,n){this.kind=e,this.value=t,this.error=n,this.hasValue="N"===e}return e.prototype.observe=function(e){switch(this.kind){case"N":return e.next&&e.next(this.value);case"E":return e.error&&e.error(this.error);case"C":return e.complete&&e.complete()}},e.prototype.do=function(e,t,n){switch(this.kind){case"N":return e&&e(this.value);case"E":return t&&t(this.error);case"C":return n&&n()}},e.prototype.accept=function(e,t,n){return e&&"function"==typeof e.next?this.observe(e):this.do(e,t,n)},e.prototype.toObservable=function(){switch(this.kind){case"N":return Object(i.of)(this.value);case"E":return Object(o.throwError)(this.error);case"C":return Object(r.empty)()}throw new Error("unexpected notification kind value")},e.createNext=function(t){return void 0!==t?new e("N",t):e.undefinedValueNotification},e.createError=function(t){return new e("E",void 0,t)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"EMPTY",function(){return i}),n.d(t,"empty",function(){return o}),n.d(t,"emptyScheduled",function(){return s});var r=n(37),i=new r.Observable(function(e){return e.complete()});function o(e){return e?s(e):i}function s(e){return new r.Observable(function(t){return e.schedule(function(){return t.complete()})})}},function(e,t,n){"use strict";n.r(t),n.d(t,"of",function(){return a});var r=n(74),i=n(75),o=n(72),s=n(77);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];switch(Object(r.isScheduler)(n)?e.pop():n=void 0,e.length){case 0:return Object(o.empty)(n);case 1:return n?Object(i.fromArray)(e,n):Object(s.scalar)(e[0]);default:return Object(i.fromArray)(e,n)}}},function(e,t,n){"use strict";function r(e){return e&&"function"==typeof e.schedule}n.r(t),n.d(t,"isScheduler",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"fromArray",function(){return s});var r=n(37),i=n(45),o=n(76);function s(e,t){return t?new r.Observable(function(n){var r=new i.Subscription,o=0;return r.add(t.schedule(function(){o!==e.length?(n.next(e[o++]),n.closed||r.add(this.schedule())):n.complete()})),r}):new r.Observable(Object(o.subscribeToArray)(e))}},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToArray",function(){return r});var r=function(e){return function(t){for(var n=0,r=e.length;n<r&&!t.closed;n++)t.next(e[n]);t.closed||t.complete()}}},function(e,t,n){"use strict";n.r(t),n.d(t,"scalar",function(){return i});var r=n(37);function i(e){var t=new r.Observable(function(t){t.next(e),t.complete()});return t._isScalar=!0,t.value=e,t}},function(e,t,n){"use strict";n.r(t),n.d(t,"throwError",function(){return i});var r=n(37);function i(e,t){return t?new r.Observable(function(n){return t.schedule(o,0,{error:e,subscriber:n})}):new r.Observable(function(t){return t.error(e)})}function o(e){var t=e.error;e.subscriber.error(t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"AsyncSubject",function(){return s});var r=n(40),i=n(56),o=n(45),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.value=null,t.hasNext=!1,t.hasCompleted=!1,t}return r.__extends(t,e),t.prototype._subscribe=function(t){return this.hasError?(t.error(this.thrownError),o.Subscription.EMPTY):this.hasCompleted&&this.hasNext?(t.next(this.value),t.complete(),o.Subscription.EMPTY):e.prototype._subscribe.call(this,t)},t.prototype.next=function(e){this.hasCompleted||(this.value=e,this.hasNext=!0)},t.prototype.error=function(t){this.hasCompleted||e.prototype.error.call(this,t)},t.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},t}(i.Subject)},function(e,t,n){"use strict";n.r(t),n.d(t,"asap",function(){return i});var r=n(81),i=new(n(83).AsapScheduler)(r.AsapAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AsapAction",function(){return o});var r=n(40),i=n(82),o=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.__extends(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=i.Immediate.setImmediate(t.flush.bind(t,null))))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(i.Immediate.clearImmediate(n),t.scheduled=void 0)},t}(n(65).AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"Immediate",function(){return o});var r=1,i={};var o={setImmediate:function(e){var t=r++;return i[t]=e,Promise.resolve().then(function(){return function(e){var t=i[e];t&&t()}(t)}),t},clearImmediate:function(e){delete i[e]}}},function(e,t,n){"use strict";n.r(t),n.d(t,"AsapScheduler",function(){return i});var r=n(40),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(68).AsyncScheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"async",function(){return i});var r=n(65),i=new(n(68).AsyncScheduler)(r.AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"animationFrame",function(){return i});var r=n(86),i=new(n(87).AnimationFrameScheduler)(r.AnimationFrameAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AnimationFrameAction",function(){return i});var r=n(40),i=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.scheduler=t,r.work=n,r}return r.__extends(t,e),t.prototype.requestAsyncId=function(t,n,r){return void 0===r&&(r=0),null!==r&&r>0?e.prototype.requestAsyncId.call(this,t,n,r):(t.actions.push(this),t.scheduled||(t.scheduled=requestAnimationFrame(function(){return t.flush(null)})))},t.prototype.recycleAsyncId=function(t,n,r){if(void 0===r&&(r=0),null!==r&&r>0||null===r&&this.delay>0)return e.prototype.recycleAsyncId.call(this,t,n,r);0===t.actions.length&&(cancelAnimationFrame(n),t.scheduled=void 0)},t}(n(65).AsyncAction)},function(e,t,n){"use strict";n.r(t),n.d(t,"AnimationFrameScheduler",function(){return i});var r=n(40),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.flush=function(e){this.active=!0,this.scheduled=void 0;var t,n=this.actions,r=-1,i=n.length;e=e||n.shift();do{if(t=e.execute(e.state,e.delay))break}while(++r<i&&(e=n.shift()));if(this.active=!1,t){for(;++r<i&&(e=n.shift());)e.unsubscribe();throw t}},t}(n(68).AsyncScheduler)},function(e,t,n){"use strict";n.r(t),n.d(t,"VirtualTimeScheduler",function(){return o}),n.d(t,"VirtualAction",function(){return s});var r=n(40),i=n(65),o=function(e){function t(t,n){void 0===t&&(t=s),void 0===n&&(n=Number.POSITIVE_INFINITY);var r=e.call(this,t,function(){return r.frame})||this;return r.maxFrames=n,r.frame=0,r.index=-1,r}return r.__extends(t,e),t.prototype.flush=function(){for(var e,t,n=this.actions,r=this.maxFrames;(t=n.shift())&&(this.frame=t.delay)<=r&&!(e=t.execute(t.state,t.delay)););if(e){for(;t=n.shift();)t.unsubscribe();throw e}},t.frameTimeFactor=10,t}(n(68).AsyncScheduler),s=function(e){function t(t,n,r){void 0===r&&(r=t.index+=1);var i=e.call(this,t,n)||this;return i.scheduler=t,i.work=n,i.index=r,i.active=!0,i.index=t.index=r,i}return r.__extends(t,e),t.prototype.schedule=function(n,r){if(void 0===r&&(r=0),!this.id)return e.prototype.schedule.call(this,n,r);this.active=!1;var i=new t(this.scheduler,this.work);return this.add(i),i.schedule(n,r)},t.prototype.requestAsyncId=function(e,n,r){void 0===r&&(r=0),this.delay=e.frame+r;var i=e.actions;return i.push(this),i.sort(t.sortActions),!0},t.prototype.recycleAsyncId=function(e,t,n){void 0===n&&(n=0)},t.prototype._execute=function(t,n){if(!0===this.active)return e.prototype._execute.call(this,t,n)},t.sortActions=function(e,t){return e.delay===t.delay?e.index===t.index?0:e.index>t.index?1:-1:e.delay>t.delay?1:-1},t}(i.AsyncAction)},function(e,t,n){"use strict";function r(e){return e}n.r(t),n.d(t,"identity",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"isObservable",function(){return i});var r=n(37);function i(e){return!!e&&(e instanceof r.Observable||"function"==typeof e.lift&&"function"==typeof e.subscribe)}},function(e,t,n){"use strict";n.r(t),n.d(t,"ArgumentOutOfRangeError",function(){return i});var r=n(40),i=function(e){function t(){var n=e.call(this,"argument out of range")||this;return n.name="ArgumentOutOfRangeError",Object.setPrototypeOf(n,t.prototype),n}return r.__extends(t,e),t}(Error)},function(e,t,n){"use strict";n.r(t),n.d(t,"EmptyError",function(){return i});var r=n(40),i=function(e){function t(){var n=e.call(this,"no elements in sequence")||this;return n.name="EmptyError",Object.setPrototypeOf(n,t.prototype),n}return r.__extends(t,e),t}(Error)},function(e,t,n){"use strict";n.r(t),n.d(t,"TimeoutError",function(){return i});var r=n(40),i=function(e){function t(){var n=e.call(this,"Timeout has occurred")||this;return n.name="TimeoutError",Object.setPrototypeOf(n,t.prototype),n}return r.__extends(t,e),t}(Error)},function(e,t,n){"use strict";n.r(t),n.d(t,"bindCallback",function(){return c});var r=n(37),i=n(79),o=n(95),s=n(46),a=n(74);function c(e,t,n){if(t){if(!Object(a.isScheduler)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return c(e,n).apply(void 0,r).pipe(Object(o.map)(function(e){return Object(s.isArray)(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var s,a=this,c={context:a,subject:s,callbackFunc:e,scheduler:n};return new r.Observable(function(r){if(n){var o={args:t,subscriber:r,params:c};return n.schedule(u,0,o)}if(!s){s=new i.AsyncSubject;try{e.apply(a,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];s.next(e.length<=1?e[0]:e),s.complete()}]))}catch(d){s.error(d)}}return s.subscribe(r)})}}function u(e){var t=this,n=e.args,r=e.subscriber,o=e.params,s=o.callbackFunc,a=o.context,c=o.scheduler,u=o.subject;if(!u){u=o.subject=new i.AsyncSubject;try{s.apply(a,n.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.length<=1?e[0]:e;t.add(c.schedule(d,0,{value:r,subject:u}))}]))}catch(l){u.error(l)}}this.add(u.subscribe(r))}function d(e){var t=e.value,n=e.subject;n.next(t),n.complete()}},function(e,t,n){"use strict";n.r(t),n.d(t,"map",function(){return o}),n.d(t,"MapOperator",function(){return s});var r=n(40),i=n(39);function o(e,t){return function(n){if("function"!=typeof e)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new s(e,t))}}var s=function(){function e(e,t){this.project=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.project,this.thisArg))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.project=n,i.count=0,i.thisArg=r||i,i}return r.__extends(t,e),t.prototype._next=function(e){var t;try{t=this.project.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"bindNodeCallback",function(){return c});var r=n(37),i=n(79),o=n(95),s=n(74),a=n(46);function c(e,t,n){if(t){if(!Object(s.isScheduler)(t))return function(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];return c(e,n).apply(void 0,r).pipe(Object(o.map)(function(e){return Object(a.isArray)(e)?t.apply(void 0,e):t(e)}))};n=t}return function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];var s={subject:void 0,args:t,callbackFunc:e,scheduler:n,context:this};return new r.Observable(function(r){var o=s.context,a=s.subject;if(n)return n.schedule(u,0,{params:s,subscriber:r,context:o});if(!a){a=s.subject=new i.AsyncSubject;try{e.apply(o,t.concat([function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.shift();n?a.error(n):(a.next(e.length<=1?e[0]:e),a.complete())}]))}catch(c){a.error(c)}}return a.subscribe(r)})}}function u(e){var t=this,n=e.params,r=e.subscriber,o=e.context,s=n.callbackFunc,a=n.args,c=n.scheduler,u=n.subject;if(!u){u=n.subject=new i.AsyncSubject;try{s.apply(o,a.concat([function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=e.shift();if(r)t.add(c.schedule(l,0,{err:r,subject:u}));else{var i=e.length<=1?e[0]:e;t.add(c.schedule(d,0,{value:i,subject:u}))}}]))}catch(f){this.add(c.schedule(l,0,{err:f,subject:u}))}}this.add(u.subscribe(r))}function d(e){var t=e.value,n=e.subject;n.next(t),n.complete()}function l(e){var t=e.err;e.subject.error(t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"combineLatest",function(){return d}),n.d(t,"CombineLatestOperator",function(){return l}),n.d(t,"CombineLatestSubscriber",function(){return f});var r=n(40),i=n(74),o=n(46),s=n(98),a=n(99),c=n(75),u={};function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null,r=null;return Object(i.isScheduler)(e[e.length-1])&&(r=e.pop()),"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(o.isArray)(e[0])&&(e=e[0]),Object(c.fromArray)(e,r).lift(new l(n))}var l=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.resultSelector))},e}(),f=function(e){function t(t,n){var r=e.call(this,t)||this;return r.resultSelector=n,r.active=0,r.values=[],r.observables=[],r}return r.__extends(t,e),t.prototype._next=function(e){this.values.push(u),this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{this.active=t,this.toRespond=t;for(var n=0;n<t;n++){var r=e[n];this.add(Object(a.subscribeToResult)(this,r,r,n))}}},t.prototype.notifyComplete=function(e){0==(this.active-=1)&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.values,s=o[n],a=this.toRespond?s===u?--this.toRespond:this.toRespond:0;o[n]=t,0===a&&(this.resultSelector?this._tryResultSelector(o):this.destination.next(o.slice()))},t.prototype._tryResultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"OuterSubscriber",function(){return i});var r=n(40),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e,t){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.destination.complete()},t}(n(39).Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToResult",function(){return o});var r=n(100),i=n(101);function o(e,t,n,o){var s=new r.InnerSubscriber(e,n,o);return Object(i.subscribeTo)(t)(s)}},function(e,t,n){"use strict";n.r(t),n.d(t,"InnerSubscriber",function(){return i});var r=n(40),i=function(e){function t(t,n,r){var i=e.call(this)||this;return i.parent=t,i.outerValue=n,i.outerIndex=r,i.index=0,i}return r.__extends(t,e),t.prototype._next=function(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)},t.prototype._error=function(e){this.parent.notifyError(e,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(n(39).Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeTo",function(){return p});var r=n(37),i=n(76),o=n(102),s=n(103),a=n(105),c=n(106),u=n(107),d=n(47),l=n(104),f=n(52),p=function(e){if(e instanceof r.Observable)return function(t){return e._isScalar?(t.next(e.value),void t.complete()):e.subscribe(t)};if(e&&"function"==typeof e[f.observable])return Object(a.subscribeToObservable)(e);if(Object(c.isArrayLike)(e))return Object(i.subscribeToArray)(e);if(Object(u.isPromise)(e))return Object(o.subscribeToPromise)(e);if(e&&"function"==typeof e[l.iterator])return Object(s.subscribeToIterable)(e);var t=Object(d.isObject)(e)?"an invalid object":"'"+e+"'";throw new TypeError("You provided "+t+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")}},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToPromise",function(){return i});var r=n(44),i=function(e){return function(t){return e.then(function(e){t.closed||(t.next(e),t.complete())},function(e){return t.error(e)}).then(null,r.hostReportError),t}}},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToIterable",function(){return i});var r=n(104),i=function(e){return function(t){for(var n=e[r.iterator]();;){var i=n.next();if(i.done){t.complete();break}if(t.next(i.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t}}},function(e,t,n){"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.r(t),n.d(t,"getSymbolIterator",function(){return r}),n.d(t,"iterator",function(){return i}),n.d(t,"$$iterator",function(){return o});var i=r(),o=i},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeToObservable",function(){return i});var r=n(52),i=function(e){return function(t){var n=e[r.observable]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"isArrayLike",function(){return r});var r=function(e){return e&&"number"==typeof e.length&&"function"!=typeof e}},function(e,t,n){"use strict";function r(e){return e&&"function"!=typeof e.subscribe&&"function"==typeof e.then}n.r(t),n.d(t,"isPromise",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"concat",function(){return a});var r=n(74),i=n(73),o=n(109),s=n(115);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length||2===e.length&&Object(r.isScheduler)(e[1])?Object(o.from)(e[0]):Object(s.concatAll)()(i.of.apply(void 0,e))}},function(e,t,n){"use strict";n.r(t),n.d(t,"from",function(){return p});var r=n(37),i=n(107),o=n(106),s=n(110),a=n(111),c=n(75),u=n(112),d=n(113),l=n(114),f=n(101);function p(e,t){if(!t)return e instanceof r.Observable?e:new r.Observable(Object(f.subscribeTo)(e));if(null!=e){if(Object(s.isInteropObservable)(e))return Object(l.fromObservable)(e,t);if(Object(i.isPromise)(e))return Object(u.fromPromise)(e,t);if(Object(o.isArrayLike)(e))return Object(c.fromArray)(e,t);if(Object(a.isIterable)(e)||"string"==typeof e)return Object(d.fromIterable)(e,t)}throw new TypeError((null!==e&&typeof e||e)+" is not observable")}},function(e,t,n){"use strict";n.r(t),n.d(t,"isInteropObservable",function(){return i});var r=n(52);function i(e){return e&&"function"==typeof e[r.observable]}},function(e,t,n){"use strict";n.r(t),n.d(t,"isIterable",function(){return i});var r=n(104);function i(e){return e&&"function"==typeof e[r.iterator]}},function(e,t,n){"use strict";n.r(t),n.d(t,"fromPromise",function(){return s});var r=n(37),i=n(45),o=n(102);function s(e,t){return t?new r.Observable(function(n){var r=new i.Subscription;return r.add(t.schedule(function(){return e.then(function(e){r.add(t.schedule(function(){n.next(e),r.add(t.schedule(function(){return n.complete()}))}))},function(e){r.add(t.schedule(function(){return n.error(e)}))})})),r}):new r.Observable(Object(o.subscribeToPromise)(e))}},function(e,t,n){"use strict";n.r(t),n.d(t,"fromIterable",function(){return a});var r=n(37),i=n(45),o=n(104),s=n(103);function a(e,t){if(!e)throw new Error("Iterable cannot be null");return t?new r.Observable(function(n){var r,s=new i.Subscription;return s.add(function(){r&&"function"==typeof r.return&&r.return()}),s.add(t.schedule(function(){r=e[o.iterator](),s.add(t.schedule(function(){if(!n.closed){var e,t;try{var i=r.next();e=i.value,t=i.done}catch(o){return void n.error(o)}t?n.complete():(n.next(e),this.schedule())}}))})),s}):new r.Observable(Object(s.subscribeToIterable)(e))}},function(e,t,n){"use strict";n.r(t),n.d(t,"fromObservable",function(){return a});var r=n(37),i=n(45),o=n(52),s=n(105);function a(e,t){return t?new r.Observable(function(n){var r=new i.Subscription;return r.add(t.schedule(function(){var i=e[o.observable]();r.add(i.subscribe({next:function(e){r.add(t.schedule(function(){return n.next(e)}))},error:function(e){r.add(t.schedule(function(){return n.error(e)}))},complete:function(){r.add(t.schedule(function(){return n.complete()}))}}))})),r}):new r.Observable(Object(s.subscribeToObservable)(e))}},function(e,t,n){"use strict";n.r(t),n.d(t,"concatAll",function(){return i});var r=n(116);function i(){return Object(r.mergeAll)(1)}},function(e,t,n){"use strict";n.r(t),n.d(t,"mergeAll",function(){return o});var r=n(117),i=n(89);function o(e){return void 0===e&&(e=Number.POSITIVE_INFINITY),Object(r.mergeMap)(i.identity,e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"mergeMap",function(){return c}),n.d(t,"MergeMapOperator",function(){return u}),n.d(t,"MergeMapSubscriber",function(){return d});var r=n(40),i=n(99),o=n(98),s=n(95),a=n(109);function c(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?function(r){return r.pipe(c(function(n,r){return Object(a.from)(e(n,r)).pipe(Object(s.map)(function(e,i){return t(n,e,r,i)}))},n))}:("number"==typeof t&&(n=t),function(t){return t.lift(new u(e,n))})}var u=function(){function e(e,t){void 0===t&&(t=Number.POSITIVE_INFINITY),this.project=e,this.concurrent=t}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.project,this.concurrent))},e}(),d=function(e){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var i=e.call(this,t)||this;return i.project=n,i.concurrent=r,i.hasCompleted=!1,i.buffer=[],i.active=0,i.index=0,i}return r.__extends(t,e),t.prototype._next=function(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){this.add(Object(i.subscribeToResult)(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(o.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"defer",function(){return s});var r=n(37),i=n(109),o=n(72);function s(e){return new r.Observable(function(t){var n;try{n=e()}catch(r){return void t.error(r)}return(n?Object(i.from)(n):Object(o.empty)()).subscribe(t)})}},function(e,t,n){"use strict";n.r(t),n.d(t,"forkJoin",function(){return d});var r=n(40),i=n(37),o=n(46),s=n(72),a=n(99),c=n(98),u=n(95);function d(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(o.isArray)(t[0])&&(t=t[0]),0===t.length?s.EMPTY:e?d(t).pipe(Object(u.map)(function(t){return e.apply(void 0,t)})):new i.Observable(function(e){return new l(e,t)})}var l=function(e){function t(t,n){var r=e.call(this,t)||this;r.sources=n,r.completed=0,r.haveValues=0;var i=n.length;r.values=new Array(i);for(var o=0;o<i;o++){var s=n[o],c=Object(a.subscribeToResult)(r,s,null,o);c&&r.add(c)}return r}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t,i._hasValue||(i._hasValue=!0,this.haveValues++)},t.prototype.notifyComplete=function(e){var t=this.destination,n=this.haveValues,r=this.values,i=r.length;e._hasValue?(this.completed++,this.completed===i&&(n===i&&t.next(r),t.complete())):t.complete()},t}(c.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"fromEvent",function(){return a});var r=n(37),i=n(46),o=n(41),s=n(95);Object.prototype.toString;function a(e,t,n,c){return Object(o.isFunction)(n)&&(c=n,n=void 0),c?a(e,t,n).pipe(Object(s.map)(function(e){return Object(i.isArray)(e)?c.apply(void 0,e):c(e)})):new r.Observable(function(r){!function e(t,n,r,i,o){var s;if(function(e){return e&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener}(t)){var a=t;t.addEventListener(n,r,o),s=function(){return a.removeEventListener(n,r,o)}}else if(function(e){return e&&"function"==typeof e.on&&"function"==typeof e.off}(t)){var c=t;t.on(n,r),s=function(){return c.off(n,r)}}else if(function(e){return e&&"function"==typeof e.addListener&&"function"==typeof e.removeListener}(t)){var u=t;t.addListener(n,r),s=function(){return u.removeListener(n,r)}}else{if(!t||!t.length)throw new TypeError("Invalid event target");for(var d=0,l=t.length;d<l;d++)e(t[d],n,r,i,o)}i.add(s)}(e,t,function(e){arguments.length>1?r.next(Array.prototype.slice.call(arguments)):r.next(e)},r,n)})}},function(e,t,n){"use strict";n.r(t),n.d(t,"fromEventPattern",function(){return a});var r=n(37),i=n(46),o=n(41),s=n(95);function a(e,t,n){return n?a(e,t).pipe(Object(s.map)(function(e){return Object(i.isArray)(e)?n.apply(void 0,e):n(e)})):new r.Observable(function(n){var r,i=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return n.next(1===e.length?e[0]:e)};try{r=e(i)}catch(s){return void n.error(s)}if(Object(o.isFunction)(t))return function(){return t(i,r)}})}},function(e,t,n){"use strict";n.r(t),n.d(t,"generate",function(){return s});var r=n(37),i=n(89),o=n(74);function s(e,t,n,s,c){var u,d;if(1==arguments.length){var l=e;d=l.initialState,t=l.condition,n=l.iterate,u=l.resultSelector||i.identity,c=l.scheduler}else void 0===s||Object(o.isScheduler)(s)?(d=e,u=i.identity,c=s):(d=e,u=s);return new r.Observable(function(e){var r=d;if(c)return c.schedule(a,0,{subscriber:e,iterate:n,condition:t,resultSelector:u,state:r});for(;;){if(t){var i=void 0;try{i=t(r)}catch(s){return void e.error(s)}if(!i){e.complete();break}}var o=void 0;try{o=u(r)}catch(s){return void e.error(s)}if(e.next(o),e.closed)break;try{r=n(r)}catch(s){return void e.error(s)}}})}function a(e){var t=e.subscriber,n=e.condition;if(!t.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(o){return void t.error(o)}else e.needIterate=!0;if(n){var r=void 0;try{r=n(e.state)}catch(o){return void t.error(o)}if(!r)return void t.complete();if(t.closed)return}var i;try{i=e.resultSelector(e.state)}catch(o){return void t.error(o)}if(!t.closed&&(t.next(i),!t.closed))return this.schedule(e)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"iif",function(){return o});var r=n(118),i=n(72);function o(e,t,n){return void 0===t&&(t=i.EMPTY),void 0===n&&(n=i.EMPTY),Object(r.defer)(function(){return e()?t:n})}},function(e,t,n){"use strict";n.r(t),n.d(t,"interval",function(){return s});var r=n(37),i=n(84),o=n(125);function s(e,t){return void 0===e&&(e=0),void 0===t&&(t=i.async),(!Object(o.isNumeric)(e)||e<0)&&(e=0),t&&"function"==typeof t.schedule||(t=i.async),new r.Observable(function(n){return n.add(t.schedule(a,e,{subscriber:n,counter:0,period:e})),n})}function a(e){var t=e.subscriber,n=e.counter,r=e.period;t.next(n),this.schedule({subscriber:t,counter:n+1,period:r},r)}},function(e,t,n){"use strict";n.r(t),n.d(t,"isNumeric",function(){return i});var r=n(46);function i(e){return!Object(r.isArray)(e)&&e-parseFloat(e)+1>=0}},function(e,t,n){"use strict";n.r(t),n.d(t,"merge",function(){return a});var r=n(37),i=n(74),o=n(116),s=n(75);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Number.POSITIVE_INFINITY,a=null,c=e[e.length-1];return Object(i.isScheduler)(c)?(a=e.pop(),e.length>1&&"number"==typeof e[e.length-1]&&(n=e.pop())):"number"==typeof c&&(n=e.pop()),null===a&&1===e.length&&e[0]instanceof r.Observable?e[0]:Object(o.mergeAll)(n)(Object(s.fromArray)(e,a))}},function(e,t,n){"use strict";n.r(t),n.d(t,"NEVER",function(){return o}),n.d(t,"never",function(){return s});var r=n(37),i=n(54),o=new r.Observable(i.noop);function s(){return o}},function(e,t,n){"use strict";n.r(t),n.d(t,"onErrorResumeNext",function(){return a});var r=n(37),i=n(109),o=n(46),s=n(72);function a(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(0===e.length)return s.EMPTY;var n=e[0],c=e.slice(1);return 1===e.length&&Object(o.isArray)(n)?a.apply(void 0,n):new r.Observable(function(e){var t=function(){return e.add(a.apply(void 0,c).subscribe(e))};return Object(i.from)(n).subscribe({next:function(t){e.next(t)},error:t,complete:t})})}},function(e,t,n){"use strict";n.r(t),n.d(t,"pairs",function(){return o}),n.d(t,"dispatch",function(){return s});var r=n(37),i=n(45);function o(e,t){return t?new r.Observable(function(n){var r=Object.keys(e),o=new i.Subscription;return o.add(t.schedule(s,0,{keys:r,index:0,subscriber:n,subscription:o,obj:e})),o}):new r.Observable(function(t){for(var n=Object.keys(e),r=0;r<n.length&&!t.closed;r++){var i=n[r];e.hasOwnProperty(i)&&t.next([i,e[i]])}t.complete()})}function s(e){var t=e.keys,n=e.index,r=e.subscriber,i=e.subscription,o=e.obj;if(!r.closed)if(n<t.length){var s=t[n];r.next([s,o[s]]),i.add(this.schedule({keys:t,index:n+1,subscriber:r,subscription:i,obj:o}))}else r.complete()}},function(e,t,n){"use strict";n.r(t),n.d(t,"race",function(){return c}),n.d(t,"RaceOperator",function(){return u}),n.d(t,"RaceSubscriber",function(){return d});var r=n(40),i=n(46),o=n(75),s=n(98),a=n(99);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(1===e.length){if(!Object(i.isArray)(e[0]))return e[0];e=e[0]}return Object(o.fromArray)(e,void 0).lift(new u)}var u=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new d(e))},e}(),d=function(e){function t(t){var n=e.call(this,t)||this;return n.hasFirst=!1,n.observables=[],n.subscriptions=[],n}return r.__extends(t,e),t.prototype._next=function(e){this.observables.push(e)},t.prototype._complete=function(){var e=this.observables,t=e.length;if(0===t)this.destination.complete();else{for(var n=0;n<t&&!this.hasFirst;n++){var r=e[n],i=Object(a.subscribeToResult)(this,r,r,n);this.subscriptions&&this.subscriptions.push(i),this.add(i)}this.observables=null}},t.prototype.notifyNext=function(e,t,n,r,i){if(!this.hasFirst){this.hasFirst=!0;for(var o=0;o<this.subscriptions.length;o++)if(o!==n){var s=this.subscriptions[o];s.unsubscribe(),this.remove(s)}this.subscriptions=null}this.destination.next(t)},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"range",function(){return i}),n.d(t,"dispatch",function(){return o});var r=n(37);function i(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),new r.Observable(function(r){var i=0,s=e;if(n)return n.schedule(o,0,{index:i,count:t,start:e,subscriber:r});for(;;){if(i++>=t){r.complete();break}if(r.next(s++),r.closed)break}})}function o(e){var t=e.start,n=e.index,r=e.count,i=e.subscriber;n>=r?i.complete():(i.next(t),i.closed||(e.index=n+1,e.start=t+1,this.schedule(e)))}},function(e,t,n){"use strict";n.r(t),n.d(t,"timer",function(){return a});var r=n(37),i=n(84),o=n(125),s=n(74);function a(e,t,n){void 0===e&&(e=0);var a=-1;return Object(o.isNumeric)(t)?a=Number(t)<1?1:Number(t):Object(s.isScheduler)(t)&&(n=t),Object(s.isScheduler)(n)||(n=i.async),new r.Observable(function(t){var r=Object(o.isNumeric)(e)?e:+e-n.now();return n.schedule(c,r,{index:0,period:a,subscriber:t})})}function c(e){var t=e.index,n=e.period,r=e.subscriber;if(r.next(t),!r.closed){if(-1===n)return r.complete();e.index=t+1,this.schedule(e,n)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"using",function(){return s});var r=n(37),i=n(109),o=n(72);function s(e,t){return new r.Observable(function(n){var r,s;try{r=e()}catch(c){return void n.error(c)}try{s=t(r)}catch(c){return void n.error(c)}var a=(s?Object(i.from)(s):o.EMPTY).subscribe(n);return function(){a.unsubscribe(),r&&r.unsubscribe()}})}},function(e,t,n){"use strict";n.r(t),n.d(t,"zip",function(){return d}),n.d(t,"ZipOperator",function(){return l}),n.d(t,"ZipSubscriber",function(){return f});var r=n(40),i=n(75),o=n(46),s=n(39),a=n(98),c=n(99),u=n(104);function d(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[e.length-1];return"function"==typeof n&&e.pop(),Object(i.fromArray)(e,void 0).lift(new l(n))}var l=function(){function e(e){this.resultSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.resultSelector))},e}(),f=function(e){function t(t,n,r){void 0===r&&(r=Object.create(null));var i=e.call(this,t)||this;return i.iterators=[],i.active=0,i.resultSelector="function"==typeof n?n:null,i.values=r,i}return r.__extends(t,e),t.prototype._next=function(e){var t=this.iterators;Object(o.isArray)(e)?t.push(new h(e)):"function"==typeof e[u.iterator]?t.push(new p(e[u.iterator]())):t.push(new m(this.destination,this,e))},t.prototype._complete=function(){var e=this.iterators,t=e.length;if(0!==t){this.active=t;for(var n=0;n<t;n++){var r=e[n];r.stillUnsubscribed?this.add(r.subscribe(r,n)):this.active--}}else this.destination.complete()},t.prototype.notifyInactive=function(){this.active--,0===this.active&&this.destination.complete()},t.prototype.checkIterators=function(){for(var e=this.iterators,t=e.length,n=this.destination,r=0;r<t;r++){if("function"==typeof(s=e[r]).hasValue&&!s.hasValue())return}var i=!1,o=[];for(r=0;r<t;r++){var s,a=(s=e[r]).next();if(s.hasCompleted()&&(i=!0),a.done)return void n.complete();o.push(a.value)}this.resultSelector?this._tryresultSelector(o):n.next(o),i&&n.complete()},t.prototype._tryresultSelector=function(e){var t;try{t=this.resultSelector.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(s.Subscriber),p=function(){function e(e){this.iterator=e,this.nextResult=e.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var e=this.nextResult;return this.nextResult=this.iterator.next(),e},e.prototype.hasCompleted=function(){var e=this.nextResult;return e&&e.done},e}(),h=function(){function e(e){this.array=e,this.index=0,this.length=0,this.length=e.length}return e.prototype[u.iterator]=function(){return this},e.prototype.next=function(e){var t=this.index++,n=this.array;return t<this.length?{value:n[t],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),m=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.parent=n,i.observable=r,i.stillUnsubscribed=!0,i.buffer=[],i.isComplete=!1,i}return r.__extends(t,e),t.prototype[u.iterator]=function(){return this},t.prototype.next=function(){var e=this.buffer;return 0===e.length&&this.isComplete?{value:null,done:!0}:{value:e.shift(),done:!1}},t.prototype.hasValue=function(){return this.buffer.length>0},t.prototype.hasCompleted=function(){return 0===this.buffer.length&&this.isComplete},t.prototype.notifyComplete=function(){this.buffer.length>0?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this.buffer.push(t),this.parent.checkIterators()},t.prototype.subscribe=function(e,t){return Object(c.subscribeToResult)(this,this.observable,this,t)},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t);var r=n(136);n.d(t,"audit",function(){return r.audit});var i=n(137);n.d(t,"auditTime",function(){return i.auditTime});var o=n(138);n.d(t,"buffer",function(){return o.buffer});var s=n(139);n.d(t,"bufferCount",function(){return s.bufferCount});var a=n(140);n.d(t,"bufferTime",function(){return a.bufferTime});var c=n(141);n.d(t,"bufferToggle",function(){return c.bufferToggle});var u=n(142);n.d(t,"bufferWhen",function(){return u.bufferWhen});var d=n(143);n.d(t,"catchError",function(){return d.catchError});var l=n(144);n.d(t,"combineAll",function(){return l.combineAll});var f=n(145);n.d(t,"combineLatest",function(){return f.combineLatest});var p=n(146);n.d(t,"concat",function(){return p.concat});var h=n(115);n.d(t,"concatAll",function(){return h.concatAll});var m=n(147);n.d(t,"concatMap",function(){return m.concatMap});var v=n(148);n.d(t,"concatMapTo",function(){return v.concatMapTo});var b=n(149);n.d(t,"count",function(){return b.count});var g=n(150);n.d(t,"debounce",function(){return g.debounce});var _=n(151);n.d(t,"debounceTime",function(){return _.debounceTime});var y=n(152);n.d(t,"defaultIfEmpty",function(){return y.defaultIfEmpty});var S=n(153);n.d(t,"delay",function(){return S.delay});var w=n(155);n.d(t,"delayWhen",function(){return w.delayWhen});var x=n(156);n.d(t,"dematerialize",function(){return x.dematerialize});var C=n(157);n.d(t,"distinct",function(){return C.distinct});var E=n(158);n.d(t,"distinctUntilChanged",function(){return E.distinctUntilChanged});var T=n(159);n.d(t,"distinctUntilKeyChanged",function(){return T.distinctUntilKeyChanged});var I=n(160);n.d(t,"elementAt",function(){return I.elementAt});var R=n(165);n.d(t,"endWith",function(){return R.endWith});var k=n(166);n.d(t,"every",function(){return k.every});var O=n(167);n.d(t,"exhaust",function(){return O.exhaust});var M=n(168);n.d(t,"exhaustMap",function(){return M.exhaustMap});var A=n(169);n.d(t,"expand",function(){return A.expand});var P=n(161);n.d(t,"filter",function(){return P.filter});var j=n(170);n.d(t,"finalize",function(){return j.finalize});var N=n(171);n.d(t,"find",function(){return N.find});var D=n(172);n.d(t,"findIndex",function(){return D.findIndex});var L=n(173);n.d(t,"first",function(){return L.first});var V=n(60);n.d(t,"groupBy",function(){return V.groupBy});var F=n(174);n.d(t,"ignoreElements",function(){return F.ignoreElements});var U=n(175);n.d(t,"isEmpty",function(){return U.isEmpty});var W=n(176);n.d(t,"last",function(){return W.last});var B=n(95);n.d(t,"map",function(){return B.map});var z=n(178);n.d(t,"mapTo",function(){return z.mapTo});var $=n(179);n.d(t,"materialize",function(){return $.materialize});var q=n(180);n.d(t,"max",function(){return q.max});var G=n(183);n.d(t,"merge",function(){return G.merge});var H=n(116);n.d(t,"mergeAll",function(){return H.mergeAll});var Y=n(117);n.d(t,"mergeMap",function(){return Y.mergeMap}),n.d(t,"flatMap",function(){return Y.mergeMap});var J=n(184);n.d(t,"mergeMapTo",function(){return J.mergeMapTo});var K=n(185);n.d(t,"mergeScan",function(){return K.mergeScan});var X=n(186);n.d(t,"min",function(){return X.min});var Z=n(187);n.d(t,"multicast",function(){return Z.multicast});var Q=n(70);n.d(t,"observeOn",function(){return Q.observeOn});var ee=n(188);n.d(t,"onErrorResumeNext",function(){return ee.onErrorResumeNext});var te=n(189);n.d(t,"pairwise",function(){return te.pairwise});var ne=n(190);n.d(t,"partition",function(){return ne.partition});var re=n(192);n.d(t,"pluck",function(){return re.pluck});var ie=n(193);n.d(t,"publish",function(){return ie.publish});var oe=n(194);n.d(t,"publishBehavior",function(){return oe.publishBehavior});var se=n(195);n.d(t,"publishLast",function(){return se.publishLast});var ae=n(196);n.d(t,"publishReplay",function(){return ae.publishReplay});var ce=n(197);n.d(t,"race",function(){return ce.race});var ue=n(181);n.d(t,"reduce",function(){return ue.reduce});var de=n(198);n.d(t,"repeat",function(){return de.repeat});var le=n(199);n.d(t,"repeatWhen",function(){return le.repeatWhen});var fe=n(200);n.d(t,"retry",function(){return fe.retry});var pe=n(201);n.d(t,"retryWhen",function(){return pe.retryWhen});var he=n(59);n.d(t,"refCount",function(){return he.refCount});var me=n(202);n.d(t,"sample",function(){return me.sample});var ve=n(203);n.d(t,"sampleTime",function(){return ve.sampleTime});var be=n(182);n.d(t,"scan",function(){return be.scan});var ge=n(204);n.d(t,"sequenceEqual",function(){return ge.sequenceEqual});var _e=n(205);n.d(t,"share",function(){return _e.share});var ye=n(206);n.d(t,"shareReplay",function(){return ye.shareReplay});var Se=n(207);n.d(t,"single",function(){return Se.single});var we=n(208);n.d(t,"skip",function(){return we.skip});var xe=n(209);n.d(t,"skipLast",function(){return xe.skipLast});var Ce=n(210);n.d(t,"skipUntil",function(){return Ce.skipUntil});var Ee=n(211);n.d(t,"skipWhile",function(){return Ee.skipWhile});var Te=n(212);n.d(t,"startWith",function(){return Te.startWith});var Ie=n(213);n.d(t,"subscribeOn",function(){return Ie.subscribeOn});var Re=n(215);n.d(t,"switchAll",function(){return Re.switchAll});var ke=n(216);n.d(t,"switchMap",function(){return ke.switchMap});var Oe=n(217);n.d(t,"switchMapTo",function(){return Oe.switchMapTo});var Me=n(164);n.d(t,"take",function(){return Me.take});var Ae=n(177);n.d(t,"takeLast",function(){return Ae.takeLast});var Pe=n(218);n.d(t,"takeUntil",function(){return Pe.takeUntil});var je=n(219);n.d(t,"takeWhile",function(){return je.takeWhile});var Ne=n(163);n.d(t,"tap",function(){return Ne.tap});var De=n(220);n.d(t,"throttle",function(){return De.throttle});var Le=n(221);n.d(t,"throttleTime",function(){return Le.throttleTime});var Ve=n(162);n.d(t,"throwIfEmpty",function(){return Ve.throwIfEmpty});var Fe=n(222);n.d(t,"timeInterval",function(){return Fe.timeInterval});var Ue=n(223);n.d(t,"timeout",function(){return Ue.timeout});var We=n(224);n.d(t,"timeoutWith",function(){return We.timeoutWith});var Be=n(225);n.d(t,"timestamp",function(){return Be.timestamp});var ze=n(226);n.d(t,"toArray",function(){return ze.toArray});var $e=n(227);n.d(t,"window",function(){return $e.window});var qe=n(228);n.d(t,"windowCount",function(){return qe.windowCount});var Ge=n(229);n.d(t,"windowTime",function(){return Ge.windowTime});var He=n(230);n.d(t,"windowToggle",function(){return He.windowToggle});var Ye=n(231);n.d(t,"windowWhen",function(){return Ye.windowWhen});var Je=n(232);n.d(t,"withLatestFrom",function(){return Je.withLatestFrom});var Ke=n(233);n.d(t,"zip",function(){return Ke.zip});var Xe=n(234);n.d(t,"zipAll",function(){return Xe.zipAll})},function(e,t,n){"use strict";n.r(t),n.d(t,"audit",function(){return c});var r=n(40),i=n(48),o=n(49),s=n(98),a=n(99);function c(e){return function(t){return t.lift(new u(e))}}var u=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.durationSelector))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r}return r.__extends(t,e),t.prototype._next=function(e){if(this.value=e,this.hasValue=!0,!this.throttled){var t=Object(i.tryCatch)(this.durationSelector)(e);if(t===o.errorObject)this.destination.error(o.errorObject.e);else{var n=Object(a.subscribeToResult)(this,t);!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}},t.prototype.clearThrottle=function(){var e=this.value,t=this.hasValue,n=this.throttled;n&&(this.remove(n),this.throttled=null,n.unsubscribe()),t&&(this.value=null,this.hasValue=!1,this.destination.next(e))},t.prototype.notifyNext=function(e,t,n,r){this.clearThrottle()},t.prototype.notifyComplete=function(){this.clearThrottle()},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"auditTime",function(){return s});var r=n(84),i=n(136),o=n(132);function s(e,t){return void 0===t&&(t=r.async),Object(i.audit)(function(){return Object(o.timer)(e,t)})}},function(e,t,n){"use strict";n.r(t),n.d(t,"buffer",function(){return s});var r=n(40),i=n(98),o=n(99);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.closingNotifier=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.closingNotifier))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.buffer=[],r.add(Object(o.subscribeToResult)(r,n)),r}return r.__extends(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.buffer;this.buffer=[],this.destination.next(o)},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"bufferCount",function(){return o});var r=n(40),i=n(39);function o(e,t){return void 0===t&&(t=null),function(n){return n.lift(new s(e,t))}}var s=function(){function e(e,t){this.bufferSize=e,this.startBufferEvery=t,this.subscriberClass=t&&e!==t?c:a}return e.prototype.call=function(e,t){return t.subscribe(new this.subscriberClass(e,this.bufferSize,this.startBufferEvery))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.bufferSize=n,r.buffer=[],r}return r.__extends(t,e),t.prototype._next=function(e){var t=this.buffer;t.push(e),t.length==this.bufferSize&&(this.destination.next(t),this.buffer=[])},t.prototype._complete=function(){var t=this.buffer;t.length>0&&this.destination.next(t),e.prototype._complete.call(this)},t}(i.Subscriber),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.bufferSize=n,i.startBufferEvery=r,i.buffers=[],i.count=0,i}return r.__extends(t,e),t.prototype._next=function(e){var t=this.bufferSize,n=this.startBufferEvery,r=this.buffers,i=this.count;this.count++,i%n==0&&r.push([]);for(var o=r.length;o--;){var s=r[o];s.push(e),s.length===t&&(r.splice(o,1),this.destination.next(s))}},t.prototype._complete=function(){for(var t=this.buffers,n=this.destination;t.length>0;){var r=t.shift();r.length>0&&n.next(r)}e.prototype._complete.call(this)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"bufferTime",function(){return a});var r=n(40),i=n(84),o=n(39),s=n(74);function a(e){var t=arguments.length,n=i.async;Object(s.isScheduler)(arguments[arguments.length-1])&&(n=arguments[arguments.length-1],t--);var r=null;t>=2&&(r=arguments[1]);var o=Number.POSITIVE_INFINITY;return t>=3&&(o=arguments[2]),function(t){return t.lift(new c(e,r,o,n))}}var c=function(){function e(e,t,n,r){this.bufferTimeSpan=e,this.bufferCreationInterval=t,this.maxBufferSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.bufferTimeSpan,this.bufferCreationInterval,this.maxBufferSize,this.scheduler))},e}(),u=function(){return function(){this.buffer=[]}}(),d=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;s.bufferTimeSpan=n,s.bufferCreationInterval=r,s.maxBufferSize=i,s.scheduler=o,s.contexts=[];var a=s.openContext();if(s.timespanOnly=null==r||r<0,s.timespanOnly){var c={subscriber:s,context:a,bufferTimeSpan:n};s.add(a.closeAction=o.schedule(l,n,c))}else{var u={subscriber:s,context:a},d={bufferTimeSpan:n,bufferCreationInterval:r,subscriber:s,scheduler:o};s.add(a.closeAction=o.schedule(p,n,u)),s.add(o.schedule(f,r,d))}return s}return r.__extends(t,e),t.prototype._next=function(e){for(var t,n=this.contexts,r=n.length,i=0;i<r;i++){var o=n[i],s=o.buffer;s.push(e),s.length==this.maxBufferSize&&(t=o)}t&&this.onBufferFull(t)},t.prototype._error=function(t){this.contexts.length=0,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts,n=this.destination;t.length>0;){var r=t.shift();n.next(r.buffer)}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.contexts=null},t.prototype.onBufferFull=function(e){this.closeContext(e);var t=e.closeAction;if(t.unsubscribe(),this.remove(t),!this.closed&&this.timespanOnly){e=this.openContext();var n=this.bufferTimeSpan,r={subscriber:this,context:e,bufferTimeSpan:n};this.add(e.closeAction=this.scheduler.schedule(l,n,r))}},t.prototype.openContext=function(){var e=new u;return this.contexts.push(e),e},t.prototype.closeContext=function(e){this.destination.next(e.buffer);var t=this.contexts;(t?t.indexOf(e):-1)>=0&&t.splice(t.indexOf(e),1)},t}(o.Subscriber);function l(e){var t=e.subscriber,n=e.context;n&&t.closeContext(n),t.closed||(e.context=t.openContext(),e.context.closeAction=this.schedule(e,e.bufferTimeSpan))}function f(e){var t=e.bufferCreationInterval,n=e.bufferTimeSpan,r=e.subscriber,i=e.scheduler,o=r.openContext();r.closed||(r.add(o.closeAction=i.schedule(p,n,{subscriber:r,context:o})),this.schedule(e,t))}function p(e){var t=e.subscriber,n=e.context;t.closeContext(n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"bufferToggle",function(){return a});var r=n(40),i=n(45),o=n(99),s=n(98);function a(e,t){return function(n){return n.lift(new c(e,t))}}var c=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.openings,this.closingSelector))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(Object(o.subscribeToResult)(i,n)),i}return r.__extends(t,e),t.prototype._next=function(e){for(var t=this.contexts,n=t.length,r=0;r<n;r++)t[r].buffer.push(e)},t.prototype._error=function(t){for(var n=this.contexts;n.length>0;){var r=n.shift();r.subscription.unsubscribe(),r.buffer=null,r.subscription=null}this.contexts=null,e.prototype._error.call(this,t)},t.prototype._complete=function(){for(var t=this.contexts;t.length>0;){var n=t.shift();this.destination.next(n.buffer),n.subscription.unsubscribe(),n.buffer=null,n.subscription=null}this.contexts=null,e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){e?this.closeBuffer(e):this.openBuffer(t)},t.prototype.notifyComplete=function(e){this.closeBuffer(e.context)},t.prototype.openBuffer=function(e){try{var t=this.closingSelector.call(this,e);t&&this.trySubscribe(t)}catch(n){this._error(n)}},t.prototype.closeBuffer=function(e){var t=this.contexts;if(t&&e){var n=e.buffer,r=e.subscription;this.destination.next(n),t.splice(t.indexOf(e),1),this.remove(r),r.unsubscribe()}},t.prototype.trySubscribe=function(e){var t=this.contexts,n=new i.Subscription,r={buffer:[],subscription:n};t.push(r);var s=Object(o.subscribeToResult)(this,e,r);!s||s.closed?this.closeBuffer(r):(s.context=r,this.add(s),n.add(s))},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"bufferWhen",function(){return u});var r=n(40),i=n(45),o=n(48),s=n(49),a=n(98),c=n(99);function u(e){return function(t){return t.lift(new d(e))}}var d=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.closingSelector))},e}(),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.closingSelector=n,r.subscribing=!1,r.openBuffer(),r}return r.__extends(t,e),t.prototype._next=function(e){this.buffer.push(e)},t.prototype._complete=function(){var t=this.buffer;t&&this.destination.next(t),e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.buffer=null,this.subscribing=!1},t.prototype.notifyNext=function(e,t,n,r,i){this.openBuffer()},t.prototype.notifyComplete=function(){this.subscribing?this.complete():this.openBuffer()},t.prototype.openBuffer=function(){var e=this.closingSubscription;e&&(this.remove(e),e.unsubscribe());var t=this.buffer;this.buffer&&this.destination.next(t),this.buffer=[];var n=Object(o.tryCatch)(this.closingSelector)();n===s.errorObject?this.error(s.errorObject.e):(e=new i.Subscription,this.closingSubscription=e,this.add(e),this.subscribing=!0,e.add(Object(c.subscribeToResult)(this,n)),this.subscribing=!1)},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"catchError",function(){return s});var r=n(40),i=n(98),o=n(99);function s(e){return function(t){var n=new a(e),r=t.lift(n);return n.caught=r}}var a=function(){function e(e){this.selector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.selector,this.caught))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.selector=n,i.caught=r,i}return r.__extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=void 0;try{n=this.selector(t,this.caught)}catch(r){return void e.prototype.error.call(this,r)}this._unsubscribeAndRecycle(),this.add(Object(o.subscribeToResult)(this,n))}},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"combineAll",function(){return i});var r=n(97);function i(e){return function(t){return t.lift(new r.CombineLatestOperator(e))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"combineLatest",function(){return s});var r=n(46),i=n(97),o=n(109);function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=null;return"function"==typeof e[e.length-1]&&(n=e.pop()),1===e.length&&Object(r.isArray)(e[0])&&(e=e[0].slice()),function(t){return t.lift.call(Object(o.from)([t].concat(e)),new i.CombineLatestOperator(n))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"concat",function(){return i});var r=n(108);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(r.concat.apply(void 0,[t].concat(e)))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"concatMap",function(){return i});var r=n(117);function i(e,t){return Object(r.mergeMap)(e,t,1)}},function(e,t,n){"use strict";n.r(t),n.d(t,"concatMapTo",function(){return i});var r=n(147);function i(e,t){return Object(r.concatMap)(function(){return e},t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"count",function(){return o});var r=n(40),i=n(39);function o(e){return function(t){return t.lift(new s(e,t))}}var s=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.source))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.count=0,i.index=0,i}return r.__extends(t,e),t.prototype._next=function(e){this.predicate?this._tryPredicate(e):this.count++},t.prototype._tryPredicate=function(e){var t;try{t=this.predicate(e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t&&this.count++},t.prototype._complete=function(){this.destination.next(this.count),this.destination.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"debounce",function(){return s});var r=n(40),i=n(98),o=n(99);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.durationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.durationSelector))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.durationSelector=n,r.hasValue=!1,r.durationSubscription=null,r}return r.__extends(t,e),t.prototype._next=function(e){try{var t=this.durationSelector.call(this,e);t&&this._tryNext(e,t)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){this.emitValue(),this.destination.complete()},t.prototype._tryNext=function(e,t){var n=this.durationSubscription;this.value=e,this.hasValue=!0,n&&(n.unsubscribe(),this.remove(n)),(n=Object(o.subscribeToResult)(this,t))&&!n.closed&&this.add(this.durationSubscription=n)},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){if(this.hasValue){var t=this.value,n=this.durationSubscription;n&&(this.durationSubscription=null,n.unsubscribe(),this.remove(n)),this.value=null,this.hasValue=!1,e.prototype._next.call(this,t)}},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"debounceTime",function(){return s});var r=n(40),i=n(39),o=n(84);function s(e,t){return void 0===t&&(t=o.async),function(n){return n.lift(new a(e,t))}}var a=function(){function e(e,t){this.dueTime=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.dueTime,this.scheduler))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.dueTime=n,i.scheduler=r,i.debouncedSubscription=null,i.lastValue=null,i.hasValue=!1,i}return r.__extends(t,e),t.prototype._next=function(e){this.clearDebounce(),this.lastValue=e,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(u,this.dueTime,this))},t.prototype._complete=function(){this.debouncedNext(),this.destination.complete()},t.prototype.debouncedNext=function(){if(this.clearDebounce(),this.hasValue){var e=this.lastValue;this.lastValue=null,this.hasValue=!1,this.destination.next(e)}},t.prototype.clearDebounce=function(){var e=this.debouncedSubscription;null!==e&&(this.remove(e),e.unsubscribe(),this.debouncedSubscription=null)},t}(i.Subscriber);function u(e){e.debouncedNext()}},function(e,t,n){"use strict";n.r(t),n.d(t,"defaultIfEmpty",function(){return o});var r=n(40),i=n(39);function o(e){return void 0===e&&(e=null),function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.defaultValue=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.defaultValue))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.defaultValue=n,r.isEmpty=!0,r}return r.__extends(t,e),t.prototype._next=function(e){this.isEmpty=!1,this.destination.next(e)},t.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"delay",function(){return c});var r=n(40),i=n(84),o=n(154),s=n(39),a=n(71);function c(e,t){void 0===t&&(t=i.async);var n=Object(o.isDate)(e)?+e-t.now():Math.abs(e);return function(e){return e.lift(new u(n,t))}}var u=function(){function e(e,t){this.delay=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.delay,this.scheduler))},e}(),d=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.delay=n,i.scheduler=r,i.queue=[],i.active=!1,i.errored=!1,i}return r.__extends(t,e),t.dispatch=function(e){for(var t=e.source,n=t.queue,r=e.scheduler,i=e.destination;n.length>0&&n[0].time-r.now()<=0;)n.shift().notification.observe(i);if(n.length>0){var o=Math.max(0,n[0].time-r.now());this.schedule(e,o)}else this.unsubscribe(),t.active=!1},t.prototype._schedule=function(e){this.active=!0,this.add(e.schedule(t.dispatch,this.delay,{source:this,destination:this.destination,scheduler:e}))},t.prototype.scheduleNotification=function(e){if(!0!==this.errored){var t=this.scheduler,n=new l(t.now()+this.delay,e);this.queue.push(n),!1===this.active&&this._schedule(t)}},t.prototype._next=function(e){this.scheduleNotification(a.Notification.createNext(e))},t.prototype._error=function(e){this.errored=!0,this.queue=[],this.destination.error(e)},t.prototype._complete=function(){this.scheduleNotification(a.Notification.createComplete())},t}(s.Subscriber),l=function(){return function(e,t){this.time=e,this.notification=t}}()},function(e,t,n){"use strict";function r(e){return e instanceof Date&&!isNaN(+e)}n.r(t),n.d(t,"isDate",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"delayWhen",function(){return c});var r=n(40),i=n(39),o=n(37),s=n(98),a=n(99);function c(e,t){return t?function(n){return new l(n,t).lift(new u(e))}:function(t){return t.lift(new u(e))}}var u=function(){function e(e){this.delayDurationSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.delayDurationSelector))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.delayDurationSelector=n,r.completed=!1,r.delayNotifierSubscriptions=[],r}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(e),this.removeSubscription(i),this.tryComplete()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){var t=this.removeSubscription(e);t&&this.destination.next(t),this.tryComplete()},t.prototype._next=function(e){try{var t=this.delayDurationSelector(e);t&&this.tryDelay(t,e)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){this.completed=!0,this.tryComplete()},t.prototype.removeSubscription=function(e){e.unsubscribe();var t=this.delayNotifierSubscriptions.indexOf(e);return-1!==t&&this.delayNotifierSubscriptions.splice(t,1),e.outerValue},t.prototype.tryDelay=function(e,t){var n=Object(a.subscribeToResult)(this,e,t);n&&!n.closed&&(this.add(n),this.delayNotifierSubscriptions.push(n))},t.prototype.tryComplete=function(){this.completed&&0===this.delayNotifierSubscriptions.length&&this.destination.complete()},t}(s.OuterSubscriber),l=function(e){function t(t,n){var r=e.call(this)||this;return r.source=t,r.subscriptionDelay=n,r}return r.__extends(t,e),t.prototype._subscribe=function(e){this.subscriptionDelay.subscribe(new f(e,this.source))},t}(o.Observable),f=function(e){function t(t,n){var r=e.call(this)||this;return r.parent=t,r.source=n,r.sourceSubscribed=!1,r}return r.__extends(t,e),t.prototype._next=function(e){this.subscribeToSource()},t.prototype._error=function(e){this.unsubscribe(),this.parent.error(e)},t.prototype._complete=function(){this.subscribeToSource()},t.prototype.subscribeToSource=function(){this.sourceSubscribed||(this.sourceSubscribed=!0,this.unsubscribe(),this.source.subscribe(this.parent))},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"dematerialize",function(){return o});var r=n(40),i=n(39);function o(){return function(e){return e.lift(new s)}}var s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype._next=function(e){e.observe(this.destination)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"distinct",function(){return s}),n.d(t,"DistinctSubscriber",function(){return c});var r=n(40),i=n(98),o=n(99);function s(e,t){return function(n){return n.lift(new a(e,t))}}var a=function(){function e(e,t){this.keySelector=e,this.flushes=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.keySelector,this.flushes))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=n,i.values=new Set,r&&i.add(Object(o.subscribeToResult)(i,r)),i}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values.clear()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype._next=function(e){this.keySelector?this._useKeySelector(e):this._finalizeNext(e,e)},t.prototype._useKeySelector=function(e){var t,n=this.destination;try{t=this.keySelector(e)}catch(r){return void n.error(r)}this._finalizeNext(t,e)},t.prototype._finalizeNext=function(e,t){var n=this.values;n.has(e)||(n.add(e),this.destination.next(t))},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"distinctUntilChanged",function(){return a});var r=n(40),i=n(39),o=n(48),s=n(49);function a(e,t){return function(n){return n.lift(new c(e,t))}}var c=function(){function e(e,t){this.compare=e,this.keySelector=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.compare,this.keySelector))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.keySelector=r,i.hasKey=!1,"function"==typeof n&&(i.compare=n),i}return r.__extends(t,e),t.prototype.compare=function(e,t){return e===t},t.prototype._next=function(e){var t=e;if(this.keySelector&&(t=Object(o.tryCatch)(this.keySelector)(e))===s.errorObject)return this.destination.error(s.errorObject.e);var n=!1;if(this.hasKey){if((n=Object(o.tryCatch)(this.compare)(this.key,t))===s.errorObject)return this.destination.error(s.errorObject.e)}else this.hasKey=!0;!1===Boolean(n)&&(this.key=t,this.destination.next(e))},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"distinctUntilKeyChanged",function(){return i});var r=n(158);function i(e,t){return Object(r.distinctUntilChanged)(function(n,r){return t?t(n[e],r[e]):n[e]===r[e]})}},function(e,t,n){"use strict";n.r(t),n.d(t,"elementAt",function(){return c});var r=n(91),i=n(161),o=n(162),s=n(152),a=n(164);function c(e,t){if(e<0)throw new r.ArgumentOutOfRangeError;var n=arguments.length>=2;return function(c){return c.pipe(Object(i.filter)(function(t,n){return n===e}),Object(a.take)(1),n?Object(s.defaultIfEmpty)(t):Object(o.throwIfEmpty)(function(){return new r.ArgumentOutOfRangeError}))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"filter",function(){return o});var r=n(40),i=n(39);function o(e,t){return function(n){return n.lift(new s(e,t))}}var s=function(){function e(e,t){this.predicate=e,this.thisArg=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.thisArg))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.thisArg=r,i.count=0,i}return r.__extends(t,e),t.prototype._next=function(e){var t;try{t=this.predicate.call(this.thisArg,e,this.count++)}catch(n){return void this.destination.error(n)}t&&this.destination.next(e)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"throwIfEmpty",function(){return o});var r=n(163),i=n(92),o=function(e){return void 0===e&&(e=s),Object(r.tap)({hasValue:!1,next:function(){this.hasValue=!0},complete:function(){if(!this.hasValue)throw e()}})};function s(){return new i.EmptyError}},function(e,t,n){"use strict";n.r(t),n.d(t,"tap",function(){return a});var r=n(40),i=n(39),o=n(54),s=n(41);function a(e,t,n){return function(r){return r.lift(new c(e,t,n))}}var c=function(){function e(e,t,n){this.nextOrObserver=e,this.error=t,this.complete=n}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.nextOrObserver,this.error,this.complete))},e}(),u=function(e){function t(t,n,r,i){var a=e.call(this,t)||this;return a._tapNext=o.noop,a._tapError=o.noop,a._tapComplete=o.noop,a._tapError=r||o.noop,a._tapComplete=i||o.noop,Object(s.isFunction)(n)?(a._context=a,a._tapNext=n):n&&(a._context=n,a._tapNext=n.next||o.noop,a._tapError=n.error||o.noop,a._tapComplete=n.complete||o.noop),a}return r.__extends(t,e),t.prototype._next=function(e){try{this._tapNext.call(this._context,e)}catch(t){return void this.destination.error(t)}this.destination.next(e)},t.prototype._error=function(e){try{this._tapError.call(this._context,e)}catch(e){return void this.destination.error(e)}this.destination.error(e)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"take",function(){return a});var r=n(40),i=n(39),o=n(91),s=n(72);function a(e){return function(t){return 0===e?Object(s.empty)():t.lift(new c(e))}}var c=function(){function e(e){if(this.total=e,this.total<0)throw new o.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.__extends(t,e),t.prototype._next=function(e){var t=this.total,n=++this.count;n<=t&&(this.destination.next(e),n===t&&(this.destination.complete(),this.unsubscribe()))},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"endWith",function(){return c});var r=n(75),i=n(77),o=n(72),s=n(108),a=n(74);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n=e[e.length-1];Object(a.isScheduler)(n)?e.pop():n=null;var c=e.length;return 1!==c||n?c>0?Object(s.concat)(t,Object(r.fromArray)(e,n)):Object(s.concat)(t,Object(o.empty)(n)):Object(s.concat)(t,Object(i.scalar)(e[0]))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"every",function(){return o});var r=n(40),i=n(39);function o(e,t){return function(n){return n.lift(new s(e,t,n))}}var s=function(){function e(e,t,n){this.predicate=e,this.thisArg=t,this.source=n}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.thisArg,this.source))},e}(),a=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.predicate=n,o.thisArg=r,o.source=i,o.index=0,o.thisArg=r||o,o}return r.__extends(t,e),t.prototype.notifyComplete=function(e){this.destination.next(e),this.destination.complete()},t.prototype._next=function(e){var t=!1;try{t=this.predicate.call(this.thisArg,e,this.index++,this.source)}catch(n){return void this.destination.error(n)}t||this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"exhaust",function(){return s});var r=n(40),i=n(98),o=n(99);function s(){return function(e){return e.lift(new a)}}var a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new c(e))},e}(),c=function(e){function t(t){var n=e.call(this,t)||this;return n.hasCompleted=!1,n.hasSubscription=!1,n}return r.__extends(t,e),t.prototype._next=function(e){this.hasSubscription||(this.hasSubscription=!0,this.add(Object(o.subscribeToResult)(this,e)))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"exhaustMap",function(){return c});var r=n(40),i=n(98),o=n(99),s=n(95),a=n(109);function c(e,t){return t?function(n){return n.pipe(c(function(n,r){return Object(a.from)(e(n,r)).pipe(Object(s.map)(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new u(e))}}var u=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.project))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.hasSubscription=!1,r.hasCompleted=!1,r.index=0,r}return r.__extends(t,e),t.prototype._next=function(e){this.hasSubscription||this.tryNext(e)},t.prototype.tryNext=function(e){var t=this.index++,n=this.destination;try{var r=this.project(e,t);this.hasSubscription=!0,this.add(Object(o.subscribeToResult)(this,r,e,t))}catch(i){n.error(i)}},t.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t.prototype.notifyError=function(e){this.destination.error(e)},t.prototype.notifyComplete=function(e){this.remove(e),this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"expand",function(){return c}),n.d(t,"ExpandOperator",function(){return u}),n.d(t,"ExpandSubscriber",function(){return d});var r=n(40),i=n(48),o=n(49),s=n(98),a=n(99);function c(e,t,n){return void 0===t&&(t=Number.POSITIVE_INFINITY),void 0===n&&(n=void 0),t=(t||0)<1?Number.POSITIVE_INFINITY:t,function(r){return r.lift(new u(e,t,n))}}var u=function(){function e(e,t,n){this.project=e,this.concurrent=t,this.scheduler=n}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.project,this.concurrent,this.scheduler))},e}(),d=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.project=n,o.concurrent=r,o.scheduler=i,o.index=0,o.active=0,o.hasCompleted=!1,r<Number.POSITIVE_INFINITY&&(o.buffer=[]),o}return r.__extends(t,e),t.dispatch=function(e){var t=e.subscriber,n=e.result,r=e.value,i=e.index;t.subscribeToProjection(n,r,i)},t.prototype._next=function(e){var n=this.destination;if(n.closed)this._complete();else{var r=this.index++;if(this.active<this.concurrent){n.next(e);var s=Object(i.tryCatch)(this.project)(e,r);if(s===o.errorObject)n.error(o.errorObject.e);else if(this.scheduler){var a={subscriber:this,result:s,value:e,index:r};this.add(this.scheduler.schedule(t.dispatch,0,a))}else this.subscribeToProjection(s,e,r)}else this.buffer.push(e)}},t.prototype.subscribeToProjection=function(e,t,n){this.active++,this.add(Object(a.subscribeToResult)(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,this.hasCompleted&&0===this.active&&this.destination.complete()},t.prototype.notifyNext=function(e,t,n,r,i){this._next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t&&t.length>0&&this._next(t.shift()),this.hasCompleted&&0===this.active&&this.destination.complete()},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"finalize",function(){return s});var r=n(40),i=n(39),o=n(45);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.callback=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.callback))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.add(new o.Subscription(n)),r}return r.__extends(t,e),t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"find",function(){return o}),n.d(t,"FindValueOperator",function(){return s}),n.d(t,"FindValueSubscriber",function(){return a});var r=n(40),i=n(39);function o(e,t){if("function"!=typeof e)throw new TypeError("predicate is not a function");return function(n){return n.lift(new s(e,n,!1,t))}}var s=function(){function e(e,t,n,r){this.predicate=e,this.source=t,this.yieldIndex=n,this.thisArg=r}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate,this.source,this.yieldIndex,this.thisArg))},e}(),a=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.predicate=n,s.source=r,s.yieldIndex=i,s.thisArg=o,s.index=0,s}return r.__extends(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){var t=this.predicate,n=this.thisArg,r=this.index++;try{t.call(n||this,e,r,this.source)&&this.notifyComplete(this.yieldIndex?r:e)}catch(i){this.destination.error(i)}},t.prototype._complete=function(){this.notifyComplete(this.yieldIndex?-1:void 0)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"findIndex",function(){return i});var r=n(171);function i(e,t){return function(n){return n.lift(new r.FindValueOperator(e,n,!0,t))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"first",function(){return u});var r=n(92),i=n(161),o=n(164),s=n(152),a=n(162),c=n(89);function u(e,t){var n=arguments.length>=2;return function(u){return u.pipe(e?Object(i.filter)(function(t,n){return e(t,n,u)}):c.identity,Object(o.take)(1),n?Object(s.defaultIfEmpty)(t):Object(a.throwIfEmpty)(function(){return new r.EmptyError}))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"ignoreElements",function(){return o});var r=n(40),i=n(39);function o(){return function(e){return e.lift(new s)}}var s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.__extends(t,e),t.prototype._next=function(e){},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"isEmpty",function(){return o});var r=n(40),i=n(39);function o(){return function(e){return e.lift(new s)}}var s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype.notifyComplete=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype._next=function(e){this.notifyComplete(!1)},t.prototype._complete=function(){this.notifyComplete(!0)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"last",function(){return u});var r=n(92),i=n(161),o=n(177),s=n(162),a=n(152),c=n(89);function u(e,t){var n=arguments.length>=2;return function(u){return u.pipe(e?Object(i.filter)(function(t,n){return e(t,n,u)}):c.identity,Object(o.takeLast)(1),n?Object(a.defaultIfEmpty)(t):Object(s.throwIfEmpty)(function(){return new r.EmptyError}))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"takeLast",function(){return a});var r=n(40),i=n(39),o=n(91),s=n(72);function a(e){return function(t){return 0===e?Object(s.empty)():t.lift(new c(e))}}var c=function(){function e(e){if(this.total=e,this.total<0)throw new o.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.total))},e}(),u=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.ring=new Array,r.count=0,r}return r.__extends(t,e),t.prototype._next=function(e){var t=this.ring,n=this.total,r=this.count++;t.length<n?t.push(e):t[r%n]=e},t.prototype._complete=function(){var e=this.destination,t=this.count;if(t>0)for(var n=this.count>=this.total?this.total:this.count,r=this.ring,i=0;i<n;i++){var o=t++%n;e.next(r[o])}e.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"mapTo",function(){return o});var r=n(40),i=n(39);function o(e){return function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.value=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.value))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.value=n,r}return r.__extends(t,e),t.prototype._next=function(e){this.destination.next(this.value)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"materialize",function(){return s});var r=n(40),i=n(39),o=n(71);function s(){return function(e){return e.lift(new a)}}var a=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new c(e))},e}(),c=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype._next=function(e){this.destination.next(o.Notification.createNext(e))},t.prototype._error=function(e){var t=this.destination;t.next(o.Notification.createError(e)),t.complete()},t.prototype._complete=function(){var e=this.destination;e.next(o.Notification.createComplete()),e.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"max",function(){return i});var r=n(181);function i(e){var t="function"==typeof e?function(t,n){return e(t,n)>0?t:n}:function(e,t){return e>t?e:t};return Object(r.reduce)(t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"reduce",function(){return a});var r=n(182),i=n(177),o=n(152),s=n(53);function a(e,t){return arguments.length>=2?function(n){return Object(s.pipe)(Object(r.scan)(e,t),Object(i.takeLast)(1),Object(o.defaultIfEmpty)(t))(n)}:function(t){return Object(s.pipe)(Object(r.scan)(function(t,n,r){return e(t,n,r+1)}),Object(i.takeLast)(1))(t)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"scan",function(){return o});var r=n(40),i=n(39);function o(e,t){var n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new s(e,t,n))}}var s=function(){function e(e,t,n){void 0===n&&(n=!1),this.accumulator=e,this.seed=t,this.hasSeed=n}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.accumulator,this.seed,this.hasSeed))},e}(),a=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o._seed=r,o.hasSeed=i,o.index=0,o}return r.__extends(t,e),Object.defineProperty(t.prototype,"seed",{get:function(){return this._seed},set:function(e){this.hasSeed=!0,this._seed=e},enumerable:!0,configurable:!0}),t.prototype._next=function(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)},t.prototype._tryNext=function(e){var t,n=this.index++;try{t=this.accumulator(this.seed,e,n)}catch(r){this.destination.error(r)}this.seed=t,this.destination.next(t)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"merge",function(){return i});var r=n(126);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(r.merge.apply(void 0,[t].concat(e)))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"mergeMapTo",function(){return i});var r=n(117);function i(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof t?Object(r.mergeMap)(function(){return e},t,n):("number"==typeof t&&(n=t),Object(r.mergeMap)(function(){return e},n))}},function(e,t,n){"use strict";n.r(t),n.d(t,"mergeScan",function(){return c}),n.d(t,"MergeScanOperator",function(){return u}),n.d(t,"MergeScanSubscriber",function(){return d});var r=n(40),i=n(48),o=n(49),s=n(99),a=n(98);function c(e,t,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),function(r){return r.lift(new u(e,t,n))}}var u=function(){function e(e,t,n){this.accumulator=e,this.seed=t,this.concurrent=n}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.accumulator,this.seed,this.concurrent))},e}(),d=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.accumulator=n,o.acc=r,o.concurrent=i,o.hasValue=!1,o.hasCompleted=!1,o.buffer=[],o.active=0,o.index=0,o}return r.__extends(t,e),t.prototype._next=function(e){if(this.active<this.concurrent){var t=this.index++,n=Object(i.tryCatch)(this.accumulator)(this.acc,e),r=this.destination;n===o.errorObject?r.error(o.errorObject.e):(this.active++,this._innerSub(n,e,t))}else this.buffer.push(e)},t.prototype._innerSub=function(e,t,n){this.add(Object(s.subscribeToResult)(this,e,t,n))},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t.prototype.notifyNext=function(e,t,n,r,i){var o=this.destination;this.acc=t,this.hasValue=!0,o.next(t)},t.prototype.notifyComplete=function(e){var t=this.buffer;this.remove(e),this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&(!1===this.hasValue&&this.destination.next(this.acc),this.destination.complete())},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"min",function(){return i});var r=n(181);function i(e){var t="function"==typeof e?function(t,n){return e(t,n)<0?t:n}:function(e,t){return e<t?e:t};return Object(r.reduce)(t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"multicast",function(){return i}),n.d(t,"MulticastOperator",function(){return o});var r=n(55);function i(e,t){return function(n){var i;if(i="function"==typeof e?e:function(){return e},"function"==typeof t)return n.lift(new o(i,t));var s=Object.create(n,r.connectableObservableDescriptor);return s.source=n,s.subjectFactory=i,s}}var o=function(){function e(e,t){this.subjectFactory=e,this.selector=t}return e.prototype.call=function(e,t){var n=this.selector,r=this.subjectFactory(),i=n(r).subscribe(e);return i.add(t.subscribe(r)),i},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"onErrorResumeNext",function(){return c}),n.d(t,"onErrorResumeNextStatic",function(){return u});var r=n(40),i=n(109),o=n(46),s=n(98),a=n(99);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return 1===e.length&&Object(o.isArray)(e[0])&&(e=e[0]),function(t){return t.lift(new d(e))}}function u(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n;return 1===e.length&&Object(o.isArray)(e[0])&&(e=e[0]),n=e.shift(),Object(i.from)(n,null).lift(new d(e))}var d=function(){function e(e){this.nextSources=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.nextSources))},e}(),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.nextSources=n,r}return r.__extends(t,e),t.prototype.notifyError=function(e,t){this.subscribeToNextSource()},t.prototype.notifyComplete=function(e){this.subscribeToNextSource()},t.prototype._error=function(e){this.subscribeToNextSource()},t.prototype._complete=function(){this.subscribeToNextSource()},t.prototype.subscribeToNextSource=function(){var e=this.nextSources.shift();e?this.add(Object(a.subscribeToResult)(this,e)):this.destination.complete()},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"pairwise",function(){return o});var r=n(40),i=n(39);function o(){return function(e){return e.lift(new s)}}var s=function(){function e(){}return e.prototype.call=function(e,t){return t.subscribe(new a(e))},e}(),a=function(e){function t(t){var n=e.call(this,t)||this;return n.hasPrev=!1,n}return r.__extends(t,e),t.prototype._next=function(e){this.hasPrev?this.destination.next([this.prev,e]):this.hasPrev=!0,this.prev=e},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"partition",function(){return o});var r=n(191),i=n(161);function o(e,t){return function(n){return[Object(i.filter)(e,t)(n),Object(i.filter)(Object(r.not)(e,t))(n)]}}},function(e,t,n){"use strict";function r(e,t){function n(){return!n.pred.apply(n.thisArg,arguments)}return n.pred=e,n.thisArg=t,n}n.r(t),n.d(t,"not",function(){return r})},function(e,t,n){"use strict";n.r(t),n.d(t,"pluck",function(){return i});var r=n(95);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e.length;if(0===n)throw new Error("list of properties cannot be empty.");return function(t){return Object(r.map)(function(e,t){return function(n){for(var r=n,i=0;i<t;i++){var o=r[e[i]];if(void 0===o)return;r=o}return r}}(e,n))(t)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"publish",function(){return o});var r=n(56),i=n(187);function o(e){return e?Object(i.multicast)(function(){return new r.Subject},e):Object(i.multicast)(new r.Subject)}},function(e,t,n){"use strict";n.r(t),n.d(t,"publishBehavior",function(){return o});var r=n(61),i=n(187);function o(e){return function(t){return Object(i.multicast)(new r.BehaviorSubject(e))(t)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"publishLast",function(){return o});var r=n(79),i=n(187);function o(){return function(e){return Object(i.multicast)(new r.AsyncSubject)(e)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"publishReplay",function(){return o});var r=n(62),i=n(187);function o(e,t,n,o){n&&"function"!=typeof n&&(o=n);var s="function"==typeof n?n:void 0,a=new r.ReplaySubject(e,t,o);return function(e){return Object(i.multicast)(function(){return a},s)(e)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"race",function(){return o});var r=n(46),i=n(130);function o(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return 1===e.length&&Object(r.isArray)(e[0])&&(e=e[0]),t.lift.call(i.race.apply(void 0,[t].concat(e)))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"repeat",function(){return s});var r=n(40),i=n(39),o=n(72);function s(e){return void 0===e&&(e=-1),function(t){return 0===e?Object(o.empty)():e<0?t.lift(new a(-1,t)):t.lift(new a(e-1,t))}}var a=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.count,this.source))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.__extends(t,e),t.prototype.complete=function(){if(!this.isStopped){var t=this.source,n=this.count;if(0===n)return e.prototype.complete.call(this);n>-1&&(this.count=n-1),t.subscribe(this._unsubscribeAndRecycle())}},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"repeatWhen",function(){return u});var r=n(40),i=n(56),o=n(48),s=n(49),a=n(98),c=n(99);function u(e){return function(t){return t.lift(new d(e))}}var d=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.notifier,t))},e}(),l=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i.sourceIsBeingSubscribedTo=!0,i}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.sourceIsBeingSubscribedTo=!0,this.source.subscribe(this)},t.prototype.notifyComplete=function(t){if(!1===this.sourceIsBeingSubscribedTo)return e.prototype.complete.call(this)},t.prototype.complete=function(){if(this.sourceIsBeingSubscribedTo=!1,!this.isStopped){if(this.retries||this.subscribeToRetries(),!this.retriesSubscription||this.retriesSubscription.closed)return e.prototype.complete.call(this);this._unsubscribeAndRecycle(),this.notifications.next()}},t.prototype._unsubscribe=function(){var e=this.notifications,t=this.retriesSubscription;e&&(e.unsubscribe(),this.notifications=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype._unsubscribeAndRecycle=function(){var t=this._unsubscribe;return this._unsubscribe=null,e.prototype._unsubscribeAndRecycle.call(this),this._unsubscribe=t,this},t.prototype.subscribeToRetries=function(){this.notifications=new i.Subject;var t=Object(o.tryCatch)(this.notifier)(this.notifications);if(t===s.errorObject)return e.prototype.complete.call(this);this.retries=t,this.retriesSubscription=Object(c.subscribeToResult)(this,t)},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"retry",function(){return o});var r=n(40),i=n(39);function o(e){return void 0===e&&(e=-1),function(t){return t.lift(new s(e,t))}}var s=function(){function e(e,t){this.count=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.count,this.source))},e}(),a=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.count=n,i.source=r,i}return r.__extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.source,r=this.count;if(0===r)return e.prototype.error.call(this,t);r>-1&&(this.count=r-1),n.subscribe(this._unsubscribeAndRecycle())}},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"retryWhen",function(){return u});var r=n(40),i=n(56),o=n(48),s=n(49),a=n(98),c=n(99);function u(e){return function(t){return t.lift(new d(e,t))}}var d=function(){function e(e,t){this.notifier=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.notifier,this.source))},e}(),l=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.notifier=n,i.source=r,i}return r.__extends(t,e),t.prototype.error=function(t){if(!this.isStopped){var n=this.errors,r=this.retries,a=this.retriesSubscription;if(r)this.errors=null,this.retriesSubscription=null;else{if(n=new i.Subject,(r=Object(o.tryCatch)(this.notifier)(n))===s.errorObject)return e.prototype.error.call(this,s.errorObject.e);a=Object(c.subscribeToResult)(this,r)}this._unsubscribeAndRecycle(),this.errors=n,this.retries=r,this.retriesSubscription=a,n.next(t)}},t.prototype._unsubscribe=function(){var e=this.errors,t=this.retriesSubscription;e&&(e.unsubscribe(),this.errors=null),t&&(t.unsubscribe(),this.retriesSubscription=null),this.retries=null},t.prototype.notifyNext=function(e,t,n,r,i){var o=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=o,this.source.subscribe(this)},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"sample",function(){return s});var r=n(40),i=n(98),o=n(99);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new c(e),r=t.subscribe(n);return r.add(Object(o.subscribeToResult)(n,this.notifier)),r},e}(),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.hasValue=!1,t}return r.__extends(t,e),t.prototype._next=function(e){this.value=e,this.hasValue=!0},t.prototype.notifyNext=function(e,t,n,r,i){this.emitValue()},t.prototype.notifyComplete=function(){this.emitValue()},t.prototype.emitValue=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.value))},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"sampleTime",function(){return s});var r=n(40),i=n(39),o=n(84);function s(e,t){return void 0===t&&(t=o.async),function(n){return n.lift(new a(e,t))}}var a=function(){function e(e,t){this.period=e,this.scheduler=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.period,this.scheduler))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.period=n,i.scheduler=r,i.hasValue=!1,i.add(r.schedule(u,n,{subscriber:i,period:n})),i}return r.__extends(t,e),t.prototype._next=function(e){this.lastValue=e,this.hasValue=!0},t.prototype.notifyNext=function(){this.hasValue&&(this.hasValue=!1,this.destination.next(this.lastValue))},t}(i.Subscriber);function u(e){var t=e.subscriber,n=e.period;t.notifyNext(),this.schedule(e,n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"sequenceEqual",function(){return a}),n.d(t,"SequenceEqualOperator",function(){return c}),n.d(t,"SequenceEqualSubscriber",function(){return u});var r=n(40),i=n(39),o=n(48),s=n(49);function a(e,t){return function(n){return n.lift(new c(e,t))}}var c=function(){function e(e,t){this.compareTo=e,this.comparor=t}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.compareTo,this.comparor))},e}(),u=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.compareTo=n,i.comparor=r,i._a=[],i._b=[],i._oneComplete=!1,i.add(n.subscribe(new d(t,i))),i}return r.__extends(t,e),t.prototype._next=function(e){this._oneComplete&&0===this._b.length?this.emit(!1):(this._a.push(e),this.checkValues())},t.prototype._complete=function(){this._oneComplete?this.emit(0===this._a.length&&0===this._b.length):this._oneComplete=!0},t.prototype.checkValues=function(){for(var e=this._a,t=this._b,n=this.comparor;e.length>0&&t.length>0;){var r=e.shift(),i=t.shift(),a=!1;n?(a=Object(o.tryCatch)(n)(r,i))===s.errorObject&&this.destination.error(s.errorObject.e):a=r===i,a||this.emit(!1)}},t.prototype.emit=function(e){var t=this.destination;t.next(e),t.complete()},t.prototype.nextB=function(e){this._oneComplete&&0===this._a.length?this.emit(!1):(this._b.push(e),this.checkValues())},t}(i.Subscriber),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.parent=n,r}return r.__extends(t,e),t.prototype._next=function(e){this.parent.nextB(e)},t.prototype._error=function(e){this.parent.error(e)},t.prototype._complete=function(){this.parent._complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"share",function(){return a});var r=n(187),i=n(59),o=n(56);function s(){return new o.Subject}function a(){return function(e){return Object(i.refCount)()(Object(r.multicast)(s)(e))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"shareReplay",function(){return i});var r=n(62);function i(e,t,n){return function(i){return i.lift(function(e,t,n){var i,o,s=0,a=!1,c=!1;return function(u){s++,i&&!a||(a=!1,i=new r.ReplaySubject(e,t,n),o=u.subscribe({next:function(e){i.next(e)},error:function(e){a=!0,i.error(e)},complete:function(){c=!0,i.complete()}}));var d=i.subscribe(this);return function(){s--,d.unsubscribe(),o&&0===s&&c&&o.unsubscribe()}}}(e,t,n))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"single",function(){return s});var r=n(40),i=n(39),o=n(92);function s(e){return function(t){return t.lift(new a(e,t))}}var a=function(){function e(e,t){this.predicate=e,this.source=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.predicate,this.source))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.predicate=n,i.source=r,i.seenValue=!1,i.index=0,i}return r.__extends(t,e),t.prototype.applySingleValue=function(e){this.seenValue?this.destination.error("Sequence contains more than one element"):(this.seenValue=!0,this.singleValue=e)},t.prototype._next=function(e){var t=this.index++;this.predicate?this.tryNext(e,t):this.applySingleValue(e)},t.prototype.tryNext=function(e,t){try{this.predicate(e,t,this.source)&&this.applySingleValue(e)}catch(n){this.destination.error(n)}},t.prototype._complete=function(){var e=this.destination;this.index>0?(e.next(this.seenValue?this.singleValue:void 0),e.complete()):e.error(new o.EmptyError)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"skip",function(){return o});var r=n(40),i=n(39);function o(e){return function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.total=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.total))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.total=n,r.count=0,r}return r.__extends(t,e),t.prototype._next=function(e){++this.count>this.total&&this.destination.next(e)},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"skipLast",function(){return s});var r=n(40),i=n(39),o=n(91);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){if(this._skipCount=e,this._skipCount<0)throw new o.ArgumentOutOfRangeError}return e.prototype.call=function(e,t){return 0===this._skipCount?t.subscribe(new i.Subscriber(e)):t.subscribe(new c(e,this._skipCount))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r._skipCount=n,r._count=0,r._ring=new Array(n),r}return r.__extends(t,e),t.prototype._next=function(e){var t=this._skipCount,n=this._count++;if(n<t)this._ring[n]=e;else{var r=n%t,i=this._ring,o=i[r];i[r]=e,this.destination.next(o)}},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"skipUntil",function(){return s});var r=n(40),i=n(98),o=n(99);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.notifier))},e}(),c=function(e){function t(t,n){var r=e.call(this,t)||this;return r.hasValue=!1,r.add(r.innerSubscription=Object(o.subscribeToResult)(r,n)),r}return r.__extends(t,e),t.prototype._next=function(t){this.hasValue&&e.prototype._next.call(this,t)},t.prototype.notifyNext=function(e,t,n,r,i){this.hasValue=!0,this.innerSubscription&&this.innerSubscription.unsubscribe()},t.prototype.notifyComplete=function(){},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"skipWhile",function(){return o});var r=n(40),i=n(39);function o(e){return function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.skipping=!0,r.index=0,r}return r.__extends(t,e),t.prototype._next=function(e){var t=this.destination;this.skipping&&this.tryCallPredicate(e),this.skipping||t.next(e)},t.prototype.tryCallPredicate=function(e){try{var t=this.predicate(e,this.index++);this.skipping=Boolean(t)}catch(n){this.destination.error(n)}},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"startWith",function(){return c});var r=n(75),i=n(77),o=n(72),s=n(108),a=n(74);function c(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n=e[e.length-1];Object(a.isScheduler)(n)?e.pop():n=null;var c=e.length;return 1!==c||n?c>0?Object(s.concat)(Object(r.fromArray)(e,n),t):Object(s.concat)(Object(o.empty)(n),t):Object(s.concat)(Object(i.scalar)(e[0]),t)}}},function(e,t,n){"use strict";n.r(t),n.d(t,"subscribeOn",function(){return i});var r=n(214);function i(e,t){return void 0===t&&(t=0),function(n){return n.lift(new o(e,t))}}var o=function(){function e(e,t){this.scheduler=e,this.delay=t}return e.prototype.call=function(e,t){return new r.SubscribeOnObservable(t,this.delay,this.scheduler).subscribe(e)},e}()},function(e,t,n){"use strict";n.r(t),n.d(t,"SubscribeOnObservable",function(){return a});var r=n(40),i=n(37),o=n(80),s=n(125),a=function(e){function t(t,n,r){void 0===n&&(n=0),void 0===r&&(r=o.asap);var i=e.call(this)||this;return i.source=t,i.delayTime=n,i.scheduler=r,(!Object(s.isNumeric)(n)||n<0)&&(i.delayTime=0),r&&"function"==typeof r.schedule||(i.scheduler=o.asap),i}return r.__extends(t,e),t.create=function(e,n,r){return void 0===n&&(n=0),void 0===r&&(r=o.asap),new t(e,n,r)},t.dispatch=function(e){var t=e.source,n=e.subscriber;return this.add(t.subscribe(n))},t.prototype._subscribe=function(e){var n=this.delayTime,r=this.source;return this.scheduler.schedule(t.dispatch,n,{source:r,subscriber:e})},t}(i.Observable)},function(e,t,n){"use strict";n.r(t),n.d(t,"switchAll",function(){return o});var r=n(216),i=n(89);function o(){return Object(r.switchMap)(i.identity)}},function(e,t,n){"use strict";n.r(t),n.d(t,"switchMap",function(){return c});var r=n(40),i=n(98),o=n(99),s=n(95),a=n(109);function c(e,t){return"function"==typeof t?function(n){return n.pipe(c(function(n,r){return Object(a.from)(e(n,r)).pipe(Object(s.map)(function(e,i){return t(n,e,r,i)}))}))}:function(t){return t.lift(new u(e))}}var u=function(){function e(e){this.project=e}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.project))},e}(),d=function(e){function t(t,n){var r=e.call(this,t)||this;return r.project=n,r.index=0,r}return r.__extends(t,e),t.prototype._next=function(e){var t,n=this.index++;try{t=this.project(e,n)}catch(r){return void this.destination.error(r)}this._innerSub(t,e,n)},t.prototype._innerSub=function(e,t,n){var r=this.innerSubscription;r&&r.unsubscribe(),this.add(this.innerSubscription=Object(o.subscribeToResult)(this,e,t,n))},t.prototype._complete=function(){var t=this.innerSubscription;t&&!t.closed||e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){this.innerSubscription=null},t.prototype.notifyComplete=function(t){this.remove(t),this.innerSubscription=null,this.isStopped&&e.prototype._complete.call(this)},t.prototype.notifyNext=function(e,t,n,r,i){this.destination.next(t)},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"switchMapTo",function(){return i});var r=n(216);function i(e,t){return t?Object(r.switchMap)(function(){return e},t):Object(r.switchMap)(function(){return e})}},function(e,t,n){"use strict";n.r(t),n.d(t,"takeUntil",function(){return s});var r=n(40),i=n(98),o=n(99);function s(e){return function(t){return t.lift(new a(e))}}var a=function(){function e(e){this.notifier=e}return e.prototype.call=function(e,t){var n=new c(e),r=Object(o.subscribeToResult)(n,this.notifier);return r&&!r.closed?(n.add(r),t.subscribe(n)):n},e}(),c=function(e){function t(t){return e.call(this,t)||this}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.complete()},t.prototype.notifyComplete=function(){},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"takeWhile",function(){return o});var r=n(40),i=n(39);function o(e){return function(t){return t.lift(new s(e))}}var s=function(){function e(e){this.predicate=e}return e.prototype.call=function(e,t){return t.subscribe(new a(e,this.predicate))},e}(),a=function(e){function t(t,n){var r=e.call(this,t)||this;return r.predicate=n,r.index=0,r}return r.__extends(t,e),t.prototype._next=function(e){var t,n=this.destination;try{t=this.predicate(e,this.index++)}catch(r){return void n.error(r)}this.nextOrComplete(e,t)},t.prototype.nextOrComplete=function(e,t){var n=this.destination;Boolean(t)?n.next(e):n.complete()},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"defaultThrottleConfig",function(){return s}),n.d(t,"throttle",function(){return a});var r=n(40),i=n(98),o=n(99),s={leading:!0,trailing:!1};function a(e,t){return void 0===t&&(t=s),function(n){return n.lift(new c(e,t.leading,t.trailing))}}var c=function(){function e(e,t,n){this.durationSelector=e,this.leading=t,this.trailing=n}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.durationSelector,this.leading,this.trailing))},e}(),u=function(e){function t(t,n,r,i){var o=e.call(this,t)||this;return o.destination=t,o.durationSelector=n,o._leading=r,o._trailing=i,o._hasValue=!1,o}return r.__extends(t,e),t.prototype._next=function(e){this._hasValue=!0,this._sendValue=e,this._throttled||(this._leading?this.send():this.throttle(e))},t.prototype.send=function(){var e=this._hasValue,t=this._sendValue;e&&(this.destination.next(t),this.throttle(t)),this._hasValue=!1,this._sendValue=null},t.prototype.throttle=function(e){var t=this.tryDurationSelector(e);t&&this.add(this._throttled=Object(o.subscribeToResult)(this,t))},t.prototype.tryDurationSelector=function(e){try{return this.durationSelector(e)}catch(t){return this.destination.error(t),null}},t.prototype.throttlingDone=function(){var e=this._throttled,t=this._trailing;e&&e.unsubscribe(),this._throttled=null,t&&this.send()},t.prototype.notifyNext=function(e,t,n,r,i){this.throttlingDone()},t.prototype.notifyComplete=function(){this.throttlingDone()},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"throttleTime",function(){return a});var r=n(40),i=n(39),o=n(84),s=n(220);function a(e,t,n){return void 0===t&&(t=o.async),void 0===n&&(n=s.defaultThrottleConfig),function(r){return r.lift(new c(e,t,n.leading,n.trailing))}}var c=function(){function e(e,t,n,r){this.duration=e,this.scheduler=t,this.leading=n,this.trailing=r}return e.prototype.call=function(e,t){return t.subscribe(new u(e,this.duration,this.scheduler,this.leading,this.trailing))},e}(),u=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.duration=n,s.scheduler=r,s.leading=i,s.trailing=o,s._hasTrailingValue=!1,s._trailingValue=null,s}return r.__extends(t,e),t.prototype._next=function(e){this.throttled?this.trailing&&(this._trailingValue=e,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(d,this.duration,{subscriber:this})),this.leading&&this.destination.next(e))},t.prototype._complete=function(){this._hasTrailingValue?(this.destination.next(this._trailingValue),this.destination.complete()):this.destination.complete()},t.prototype.clearThrottle=function(){var e=this.throttled;e&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),e.unsubscribe(),this.remove(e),this.throttled=null)},t}(i.Subscriber);function d(e){e.subscriber.clearThrottle()}},function(e,t,n){"use strict";n.r(t),n.d(t,"timeInterval",function(){return a}),n.d(t,"TimeInterval",function(){return c});var r=n(84),i=n(182),o=n(118),s=n(95);function a(e){return void 0===e&&(e=r.async),function(t){return Object(o.defer)(function(){return t.pipe(Object(i.scan)(function(t,n){var r=t.current;return{value:n,current:e.now(),last:r}},{current:e.now(),value:void 0,last:void 0}),Object(s.map)(function(e){var t=e.current,n=e.last,r=e.value;return new c(r,t-n)}))})}}var c=function(){return function(e,t){this.value=e,this.interval=t}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"timeout",function(){return a});var r=n(84),i=n(93),o=n(224),s=n(78);function a(e,t){return void 0===t&&(t=r.async),Object(o.timeoutWith)(e,Object(s.throwError)(new i.TimeoutError),t)}},function(e,t,n){"use strict";n.r(t),n.d(t,"timeoutWith",function(){return c});var r=n(40),i=n(84),o=n(154),s=n(98),a=n(99);function c(e,t,n){return void 0===n&&(n=i.async),function(r){var i=Object(o.isDate)(e),s=i?+e-n.now():Math.abs(e);return r.lift(new u(s,i,t,n))}}var u=function(){function e(e,t,n,r){this.waitFor=e,this.absoluteTimeout=t,this.withObservable=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new d(e,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),d=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;return s.absoluteTimeout=n,s.waitFor=r,s.withObservable=i,s.scheduler=o,s.action=null,s.scheduleTimeout(),s}return r.__extends(t,e),t.dispatchTimeout=function(e){var t=e.withObservable;e._unsubscribeAndRecycle(),e.add(Object(a.subscribeToResult)(e,t))},t.prototype.scheduleTimeout=function(){var e=this.action;e?this.action=e.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(t.dispatchTimeout,this.waitFor,this))},t.prototype._next=function(t){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,t)},t.prototype._unsubscribe=function(){this.action=null,this.scheduler=null,this.withObservable=null},t}(s.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"timestamp",function(){return o}),n.d(t,"Timestamp",function(){return s});var r=n(84),i=n(95);function o(e){return void 0===e&&(e=r.async),Object(i.map)(function(t){return new s(t,e.now())})}var s=function(){return function(e,t){this.value=e,this.timestamp=t}}()},function(e,t,n){"use strict";n.r(t),n.d(t,"toArray",function(){return o});var r=n(181);function i(e,t,n){return 0===n?[t]:(e.push(t),e)}function o(){return Object(r.reduce)(i,[])}},function(e,t,n){"use strict";n.r(t),n.d(t,"window",function(){return a});var r=n(40),i=n(56),o=n(98),s=n(99);function a(e){return function(t){return t.lift(new c(e))}}var c=function(){function e(e){this.windowBoundaries=e}return e.prototype.call=function(e,t){var n=new u(e),r=t.subscribe(n);return r.closed||n.add(Object(s.subscribeToResult)(n,this.windowBoundaries)),r},e}(),u=function(e){function t(t){var n=e.call(this,t)||this;return n.window=new i.Subject,t.next(n.window),n}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow()},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this._complete()},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e)},t.prototype._complete=function(){this.window.complete(),this.destination.complete()},t.prototype._unsubscribe=function(){this.window=null},t.prototype.openWindow=function(){var e=this.window;e&&e.complete();var t=this.destination,n=this.window=new i.Subject;t.next(n)},t}(o.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"windowCount",function(){return s});var r=n(40),i=n(39),o=n(56);function s(e,t){return void 0===t&&(t=0),function(n){return n.lift(new a(e,t))}}var a=function(){function e(e,t){this.windowSize=e,this.startWindowEvery=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.windowSize,this.startWindowEvery))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.destination=t,i.windowSize=n,i.startWindowEvery=r,i.windows=[new o.Subject],i.count=0,t.next(i.windows[0]),i}return r.__extends(t,e),t.prototype._next=function(e){for(var t=this.startWindowEvery>0?this.startWindowEvery:this.windowSize,n=this.destination,r=this.windowSize,i=this.windows,s=i.length,a=0;a<s&&!this.closed;a++)i[a].next(e);var c=this.count-r+1;if(c>=0&&c%t==0&&!this.closed&&i.shift().complete(),++this.count%t==0&&!this.closed){var u=new o.Subject;i.push(u),n.next(u)}},t.prototype._error=function(e){var t=this.windows;if(t)for(;t.length>0&&!this.closed;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){var e=this.windows;if(e)for(;e.length>0&&!this.closed;)e.shift().complete();this.destination.complete()},t.prototype._unsubscribe=function(){this.count=0,this.windows=null},t}(i.Subscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"windowTime",function(){return u});var r=n(40),i=n(56),o=n(84),s=n(39),a=n(125),c=n(74);function u(e){var t=o.async,n=null,r=Number.POSITIVE_INFINITY;return Object(c.isScheduler)(arguments[3])&&(t=arguments[3]),Object(c.isScheduler)(arguments[2])?t=arguments[2]:Object(a.isNumeric)(arguments[2])&&(r=arguments[2]),Object(c.isScheduler)(arguments[1])?t=arguments[1]:Object(a.isNumeric)(arguments[1])&&(n=arguments[1]),function(i){return i.lift(new d(e,n,r,t))}}var d=function(){function e(e,t,n,r){this.windowTimeSpan=e,this.windowCreationInterval=t,this.maxWindowSize=n,this.scheduler=r}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.windowTimeSpan,this.windowCreationInterval,this.maxWindowSize,this.scheduler))},e}(),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t._numberOfNextedValues=0,t}return r.__extends(t,e),t.prototype.next=function(t){this._numberOfNextedValues++,e.prototype.next.call(this,t)},Object.defineProperty(t.prototype,"numberOfNextedValues",{get:function(){return this._numberOfNextedValues},enumerable:!0,configurable:!0}),t}(i.Subject),f=function(e){function t(t,n,r,i,o){var s=e.call(this,t)||this;s.destination=t,s.windowTimeSpan=n,s.windowCreationInterval=r,s.maxWindowSize=i,s.scheduler=o,s.windows=[];var a=s.openWindow();if(null!==r&&r>=0){var c={subscriber:s,window:a,context:null},u={windowTimeSpan:n,windowCreationInterval:r,subscriber:s,scheduler:o};s.add(o.schedule(m,n,c)),s.add(o.schedule(h,r,u))}else{var d={subscriber:s,window:a,windowTimeSpan:n};s.add(o.schedule(p,n,d))}return s}return r.__extends(t,e),t.prototype._next=function(e){for(var t=this.windows,n=t.length,r=0;r<n;r++){var i=t[r];i.closed||(i.next(e),i.numberOfNextedValues>=this.maxWindowSize&&this.closeWindow(i))}},t.prototype._error=function(e){for(var t=this.windows;t.length>0;)t.shift().error(e);this.destination.error(e)},t.prototype._complete=function(){for(var e=this.windows;e.length>0;){var t=e.shift();t.closed||t.complete()}this.destination.complete()},t.prototype.openWindow=function(){var e=new l;return this.windows.push(e),this.destination.next(e),e},t.prototype.closeWindow=function(e){e.complete();var t=this.windows;t.splice(t.indexOf(e),1)},t}(s.Subscriber);function p(e){var t=e.subscriber,n=e.windowTimeSpan,r=e.window;r&&t.closeWindow(r),e.window=t.openWindow(),this.schedule(e,n)}function h(e){var t=e.windowTimeSpan,n=e.subscriber,r=e.scheduler,i=e.windowCreationInterval,o=n.openWindow(),s={action:this,subscription:null},a={subscriber:n,window:o,context:s};s.subscription=r.schedule(m,t,a),this.add(s.subscription),this.schedule(e,i)}function m(e){var t=e.subscriber,n=e.window,r=e.context;r&&r.action&&r.subscription&&r.action.remove(r.subscription),t.closeWindow(n)}},function(e,t,n){"use strict";n.r(t),n.d(t,"windowToggle",function(){return d});var r=n(40),i=n(56),o=n(45),s=n(48),a=n(49),c=n(98),u=n(99);function d(e,t){return function(n){return n.lift(new l(e,t))}}var l=function(){function e(e,t){this.openings=e,this.closingSelector=t}return e.prototype.call=function(e,t){return t.subscribe(new f(e,this.openings,this.closingSelector))},e}(),f=function(e){function t(t,n,r){var i=e.call(this,t)||this;return i.openings=n,i.closingSelector=r,i.contexts=[],i.add(i.openSubscription=Object(u.subscribeToResult)(i,n,n)),i}return r.__extends(t,e),t.prototype._next=function(e){var t=this.contexts;if(t)for(var n=t.length,r=0;r<n;r++)t[r].window.next(e)},t.prototype._error=function(t){var n=this.contexts;if(this.contexts=null,n)for(var r=n.length,i=-1;++i<r;){var o=n[i];o.window.error(t),o.subscription.unsubscribe()}e.prototype._error.call(this,t)},t.prototype._complete=function(){var t=this.contexts;if(this.contexts=null,t)for(var n=t.length,r=-1;++r<n;){var i=t[r];i.window.complete(),i.subscription.unsubscribe()}e.prototype._complete.call(this)},t.prototype._unsubscribe=function(){var e=this.contexts;if(this.contexts=null,e)for(var t=e.length,n=-1;++n<t;){var r=e[n];r.window.unsubscribe(),r.subscription.unsubscribe()}},t.prototype.notifyNext=function(e,t,n,r,c){if(e===this.openings){var d=this.closingSelector,l=Object(s.tryCatch)(d)(t);if(l===a.errorObject)return this.error(a.errorObject.e);var f=new i.Subject,p=new o.Subscription,h={window:f,subscription:p};this.contexts.push(h);var m=Object(u.subscribeToResult)(this,l,h);m.closed?this.closeWindow(this.contexts.length-1):(m.context=h,p.add(m)),this.destination.next(f)}else this.closeWindow(this.contexts.indexOf(e))},t.prototype.notifyError=function(e){this.error(e)},t.prototype.notifyComplete=function(e){e!==this.openSubscription&&this.closeWindow(this.contexts.indexOf(e.context))},t.prototype.closeWindow=function(e){if(-1!==e){var t=this.contexts,n=t[e],r=n.window,i=n.subscription;t.splice(e,1),r.complete(),i.unsubscribe()}},t}(c.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"windowWhen",function(){return u});var r=n(40),i=n(56),o=n(48),s=n(49),a=n(98),c=n(99);function u(e){return function(t){return t.lift(new d(e))}}var d=function(){function e(e){this.closingSelector=e}return e.prototype.call=function(e,t){return t.subscribe(new l(e,this.closingSelector))},e}(),l=function(e){function t(t,n){var r=e.call(this,t)||this;return r.destination=t,r.closingSelector=n,r.openWindow(),r}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.openWindow(i)},t.prototype.notifyError=function(e,t){this._error(e)},t.prototype.notifyComplete=function(e){this.openWindow(e)},t.prototype._next=function(e){this.window.next(e)},t.prototype._error=function(e){this.window.error(e),this.destination.error(e),this.unsubscribeClosingNotification()},t.prototype._complete=function(){this.window.complete(),this.destination.complete(),this.unsubscribeClosingNotification()},t.prototype.unsubscribeClosingNotification=function(){this.closingNotification&&this.closingNotification.unsubscribe()},t.prototype.openWindow=function(e){void 0===e&&(e=null),e&&(this.remove(e),e.unsubscribe());var t=this.window;t&&t.complete();var n=this.window=new i.Subject;this.destination.next(n);var r=Object(o.tryCatch)(this.closingSelector)();if(r===s.errorObject){var a=s.errorObject.e;this.destination.error(a),this.window.error(a)}else this.add(this.closingNotification=Object(c.subscribeToResult)(this,r))},t}(a.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"withLatestFrom",function(){return s});var r=n(40),i=n(98),o=n(99);function s(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){var n;"function"==typeof e[e.length-1]&&(n=e.pop());var r=e;return t.lift(new a(r,n))}}var a=function(){function e(e,t){this.observables=e,this.project=t}return e.prototype.call=function(e,t){return t.subscribe(new c(e,this.observables,this.project))},e}(),c=function(e){function t(t,n,r){var i=e.call(this,t)||this;i.observables=n,i.project=r,i.toRespond=[];var s=n.length;i.values=new Array(s);for(var a=0;a<s;a++)i.toRespond.push(a);for(a=0;a<s;a++){var c=n[a];i.add(Object(o.subscribeToResult)(i,c,c,a))}return i}return r.__extends(t,e),t.prototype.notifyNext=function(e,t,n,r,i){this.values[n]=t;var o=this.toRespond;if(o.length>0){var s=o.indexOf(n);-1!==s&&o.splice(s,1)}},t.prototype.notifyComplete=function(){},t.prototype._next=function(e){if(0===this.toRespond.length){var t=[e].concat(this.values);this.project?this._tryProject(t):this.destination.next(t)}},t.prototype._tryProject=function(e){var t;try{t=this.project.apply(this,e)}catch(n){return void this.destination.error(n)}this.destination.next(t)},t}(i.OuterSubscriber)},function(e,t,n){"use strict";n.r(t),n.d(t,"zip",function(){return i});var r=n(134);function i(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return function(t){return t.lift.call(r.zip.apply(void 0,[t].concat(e)))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"zipAll",function(){return i});var r=n(134);function i(e){return function(t){return t.lift(new r.ZipOperator(e))}}},function(e,t,n){"use strict";n.r(t);var r=n(15),i=n.n(r),o=n(36),s=n(6),a=n.n(s);t.default=function(e,t,n){this.mgr=e,this.confrId=t,function(){i.a.extend(this,{subscribe:function(e,t,n){return this.subject.subscribe(e,t,n)}},{onMeExit:function(e,t){this.mgr._onExit(this.confrId,e,t)},onAddMember:function(e){this.mgr.onMemberJoin(e,this.confrId)},onRemoveMember:function(e,t){this.mgr.onMemberLeave(e,t,this.confrId)},onAddStream:function(e){0!=e.id&&(e.located()||this.onRemoteStream&&this.onRemoteStream(e),this.mgr.streamBindVideo(e,void 0,this.confrId),this.mgr._onAddMemberStream(e,this.confrId))},onRemoveStream:function(e){if(0!=e.id){var t=this.mgr._confr(this.confrId);t&&e&&e.located()&&(t.av&&t.av.id===e.id&&(t.av=void 0),t.desktop&&t.desktop.id===e.id&&(t.desktop=void 0));var n=i.a.removeAttribute(this.mgr._videos,e.id);this.mgr._onRemoveMemberStream(e,this.confrId),n&&this.mgr.unloadVideo(e.owner,e,n)}},onUpdateStream:function(e,t){if(0!=e.id){var n=this,r=this.mgr._videos[e.id];r&&(t&&t.ifMediaStream(function(e){r&&attachMediaStream(r,e),r&&r.hasAttribute("flow")&&n.mgr.onMediaTransmission(r,function(e,t,n,i){a()(r).trigger("onMediaTransmission",[e,t,n,i])})}),e.aoff?r.setAttribute("aoff","aoff"):r.removeAttribute("aoff"),e.voff?r.setAttribute("voff","voff"):r.removeAttribute("voff"));var i={video:!e.voff,audio:!e.aoff};t&&t.ifVoff(function(t){i||(i={}),i.video=!t,e.located()||(i.video=e.subArgs?e.subArgs.subSVideo:!e.voff)}),t&&t.ifAoff(function(t){i||(i={}),i.audio=!t,e.located()||(i.audio=e.subArgs?e.subArgs.subSAudio:!e.aoff,2===e.type&&(i.audio=!0))}),i&&this.mgr._onMemberMediaChanaged(e.owner,e,i,this.confrId),i&&this.mgr._onUpdateMemberStream(e,i,this.confrId)}},onNetworkWeak:function(){},onNotSupportPublishVideoCodecs:function(e){this.mgr._onNotSupportMemberPublishVideoCodecs(e,this.confrId)},onRecvRemoteMessage:function(e,t){this.mgr._onRecvRemoteMessage(e,t,this.confrId)},onSoundChanage:function(e,t,n){this.mgr._onMemberSoundChanaged(e,t,n,this.confrId)},onTalking:function(e,t,n){this.mgr._onTalking(e,t,n,this.confrId)},onRoleUpdate:function(e,t){var n=this.mgr._confrs[this.confrId];t&&(n.roleToken=t),n.role=e,e==this.mgr.Role.AUDIENCE&&(n.av&&this.mgr.hungup(n.av),n.desktop&&this.mgr.hungup(n.desktop)),this.mgr._onRoleUpdated(e,this.confrId)},onNotifyEvent:function(e){var t=this;try{if(e instanceof emedia.event.ICEChanage){var n=e.webrtc,r=e.state;i.a.forEach(t._cacheStreams,function(e,o){if(o.rtcId==n.getRtcId()){var s=i.a.extend({},o),a=i.a.extend({},o.owner);t.mgr._onStreamIceStateChanged(a,s,r,t.confrId)}})}}finally{t.subject.next(e)}}})}.apply(this),this.subject=new o.Subject,this.onRemoteStream=n}},function(e,t,n){var r=n(15),i=r.tagLogger("PannelVideo"),o=n(237),s=n(238),a=(n(31),n(32)),c=n(239);function u(e){u._overrideCount++,u.overrideObj!==e&&(u.overrideObj=e,d.override=e.listeners.onRemoveMember,e.listeners.onRemoveMember=d)}function d(e,t){try{var n=e&&e.id&&function(e,t,n){var i=[];return e.current.__remoteControls&&r.forEach(e.current.__remoteControls,function(e,r){n&&r._ctrlStream.id!==n.id||t&&r._controller.id!==t||i.push(r)}),i}(this._service,e.id);n&&n.length&&r.forEach(n,function(t,n){i.warn("Remove member. free remote controller. it is ",n.id,n._ctrlStream.id,n._controller.memName,e.id),n._free(),n._callbacks&&n._callbacks.onRemoteFreeControl&&n._callbacks.onRemoteFreeControl(n._ctrlStream,n._controller,n._cId)})}finally{d.override&&d.override.apply(this,arguments)}}function l(e){l._overrideCount++,l.overrideObj!==e&&(l.overrideObj=e,f.override=e.listeners.onRemoveStream,e.listeners.onRemoveStream=f)}function f(e){p(this._service,e),f.override&&f.override.apply(this,arguments)}function p(e,t){C(e,t.id);var n=S(e,t);n&&r.forEach(n,function(e,t){t._free&&t._free()}),r.removeAttribute(e.current.__remoteControls,t.id)}function h(e){if(h._overrideCount++,h.overrideObj!==e){h.overrideObj=e;var t=e.onHungup;e.onHungup=function(n){p(e,n),t&&t.apply(this,arguments)}.bind(e)}}function m(e,t){if(m._overrideCount++,m.overrideObj!==e){m.overrideObj=e;var n=e._onRemotePannelControl;e._onRemotePannelControl=function(e){w(this,e,!1,t),n&&n.apply(this,arguments)}.bind(e)}}function v(e,t,n){var i=[];n&&r.forEach(n.actions,function(e,t){t.xy&&i.push({x:Math.round(1e4*t.xy.x),y:Math.round(1e4*t.xy.y),oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time}),t.xy||i.push({oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time})});var o={op2:30,evt:0,streamId:t.id,actions:i,cId:n.cId};return e.current.newMessage({op:1002,memId:t.owner.id,arg:JSON.stringify(o),_reqOps:[100230]})}u._overrideCount=0,l._overrideCount=0,h._overrideCount=0,m._overrideCount=0;var b=0,g=r.prototypeExtend({__init__:function(){this.id=b++},accept:function(e,t){var n=this;if(n.hasOtherControl())throw n.busy(),i.error("Other has been controled."),"Other has been controled.";var o=!1,s=S(this._service,this._ctrlStream,this._controller);(s&&r.forEach(s,function(e,t){t.id<n.id?t._free():o=!0}),o)?n._free():((this._service.current.__remoteControls||(this._service.current.__remoteControls={}))[n.id]=n,T(this,e,t),_(this._service,this._reqevt,0))},controlling:function(){var e=this,t=[],n=S(this._service,this._ctrlStream);return n&&r.forEach(n,function(n,r){r._controller.memName===e._controller.memName&&t.push(r)}),t&&t.length?t:void 0},hasOtherControl:function(){var e=this,t=!1,n=S(this._service,this._ctrlStream);return n&&r.forEach(n,function(n,r){r._controller.memName!=e._controller.memName&&(t=!0)}),t},busy:function(){_(this._service,this._reqevt,-403)},reject:function(){_(this._service,this._reqevt,-402)},_free:function(){r.removeAttribute(this._service.current.__remoteControls,this.id)},forceDisconnect:function(){var e=S(this._service,this._ctrlStream);e&&r.forEach(e,function(e,t){t._free&&t._free()}),i.info("remote control force disconnect")}});function _(e,t,n){e.current.message({op:1001,tsxId:t.tsxId,memId:t.memId,arg:JSON.stringify({cId:t.arg.cId}),result:n}).post()}function y(e,t){_(e,t,-405)}function S(e,t,n,i){var o=[];return e.current.__remoteControls&&r.forEach(e.current.__remoteControls,function(e,r){t&&r._ctrlStream.id!==t.id||n&&r._controller.memName!==n.memName||i&&r._cId!==i||o.push(r)}),o}function w(e,t,n,o){!function(e){"string"==typeof e.arg&&(e.arg=JSON.parse(e.arg));var t=e.arg,n=[],i=[];t&&t.actions&&r.forEach(t.actions,function(e,t){void 0!==t.x&&void 0!==t.y&&n.push({xy:{x:t.x/1e4,y:t.y/1e4},oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time}),(void 0===t.x||void 0===t.y)&&i.push({oper:t.oper,btn:t.btn,sn:t.sn,_time:t._time})}),t.mouse=n,t.keyboard=i}(t);var s=t.arg,c=s.cId,u=s.streamId,d=e.getMemberById(t.memId),l=e.getStreamById(u);if(n||!function(){if(!d||!l)return y(e,t),!0;if(1===s.evt){var n,i=new g({_service:e,_controller:d,_ctrlStream:l,_cId:c,_reqevt:t,_callbacks:o});return i.hasOtherControl()?(i.busy(),!0):(n=i.controlling())?(r.forEach(n,function(e,t){t._cId=c}),_(e,t,0),!0):(o&&o.onHasRemoteControl&&o.onHasRemoteControl(l,d,i),!0)}if(2===s.evt){var a=S(e,l,d,c);return a&&r.forEach(a,function(n,r){r._free&&r._free(),_(e,t,0)}),o&&o.onRemoteFreeControl&&o.onRemoteFreeControl(l,d,c),!0}}()){var f=S(e,l,d,c);if(n||f&&0!==f.length||y(e,t),f&&r.forEach(f,function(e,t){t._lastRecvTimestamp=(new Date).getTime()}),n){var p=e.current.__remoteControls[l.id];f=f||[],p&&f.push(p)}r.forEach(f,function(o,c){var u,d=0;if((u=s.mouse)&&u.length>0)try{r.forEach(u,function(e,t){t.sn>d&&(d=t.sn),t.oper===a.BTN.MOVE?c.mouseTrack&&c.mouseTrack.track(t.xy):c.mouseTrack&&c.mouseTrack.trigger(new a(t))})}catch(l){i.warn(l)}if((u=s.keyboard)&&u.length>0)try{r.forEach(u,function(e,t){t.sn>d&&(d=t.sn),c.keyboard&&(t.oper===a.BTN.KEYBOARD_DOWN?c.keyboard.onKeyDown(t.btn):t.oper===a.BTN.KEYBOARD_UP&&c.keyboard.onKeyUp(t.btn))})}catch(l){i.warn(l)}if(!0!==n)try{e.current.message({op:1001,tsxId:t.tsxId,memId:t.memId,arg:JSON.stringify({sn:d}),result:0}).post(function(e){i.debug("Send remote control response. the result = ",e.result,e.msg||"")})}catch(l){i.warn(l)}})}}function x(e,t,n){var o=t.sid,s=e.getStreamById(o);e.current.__remoteControls&&e.current.__remoteControls[o]&&w(e,v(e,s,{actions:[t]}),!0);var a=e.current.__pannelBuffers[o],c=a.getUnclearSize();if(a.put(t),c<emedia.config.allowSendWhenLessThan){!function t(){for(var c=a.getUnread(),u=0,d=0;c&&d<c.length;d++){var l=c[d];r.removeAttribute(l,"sid"),u<l.sn&&(u=l.sn)}c&&0!==c.length&&(i.debug(o,"buffer remain:",a.getUnclearSize(),", send evt:",c.length),e.current.postMessage(v(e,s,{actions:c,cId:a._cId}),function(e){if(-402!==e.result)if(-403!==e.result)if(-408!==e.result){if(-507===e.result||-405===e.result)return a.clearRead(u),void(n&&n.onNotAllowRemoteControl&&n.onNotAllowRemoteControl(s));0===e.result&&(a._lastRspTimestamp=(new Date).getTime());var c=e.arg;c&&(c=JSON.parse(c))&&!r.isInt(c.sn)?i.warn("rsp.sn not a Number.",c.sn,"for streamId",o):c&&void 0!==c.sn&&a.clearRead(c.sn),t()}else n&&n.onRemoteControlTimeout&&n.onRemoteControlTimeout(s);else n&&n.onBusy&&n.onBusy(s);else n&&n.onReject&&n.onReject(s)}))}()}}function C(e,t){var n,o=e.current.__pannelMouses&&r.removeAttribute(e.current.__pannelMouses,t),s=e.current.__pannelKeyboards&&r.removeAttribute(e.current.__pannelKeyboards,t);if(e.current.__pannelBuffers&&(n=r.removeAttribute(e.current.__pannelBuffers,t)),o&&o.ungrab(),s&&s.ungrab(),n){var a=e.getStreamById(t);if(n._callbacks&&n._callbacks.onDisControlled&&n._callbacks.onDisControlled(a),a){var c=e.current.newMessage({op:1002,memId:a.owner.id,arg:JSON.stringify({op2:30,streamId:a.id,evt:2,cId:n._cId}),_reqOps:[100230]});e.current.postMessage(c,function(e){0!==e.result&&i.warn("Unkown result：",e.result)})}}}function E(e,t,n,u,d,l){var f=Math.uuidFast();f=f.substr(f.length-6,6);var p=e.getStreamById(t);if(!p._webrtc)throw l&&l.onNotAllowRemoteControl&&l.onNotAllowRemoteControl(p),i.error("Not allow control. cause by the stream not sub"),"Not allow control. cause by the stream not sub";var h={op2:30,streamId:p.id,evt:1,cId:f},m=e.current.newMessage({op:1002,memId:p.owner.id,arg:JSON.stringify(h),_reqOps:[100230]});e.current.postMessage(m,function(h){if(-402!==h.result)if(-403!==h.result)if(-408!==h.result)if(-507!==h.result&&-405!==h.result){if(0===h.result)return function(e,t,n,u,d,l,f,p){void 0===d&&(d=n);var h=e.getStreamById(t),m=(e.current.__pannelMouses||(e.current.__pannelMouses={}))[t];m&&C(e,t);if(!h.located()&&!h.owner.acptOps[1003])throw i.error("which do not recv remote message, it is ",h.owner.memName),h.owner.memName+" do not recv remote message";m=new o({_target:d,_focused:!0,onMouseEnter:function(){(function(e,t,n,r,i){r&&r()}).call(m,e,t,n,l&&l.onMouseEnter,l),v&&v.grab()},onMouseExit:function(){(function(e,t,n,r,i){r&&r()}).call(m,e,t,n,l&&l.onMouseExit,l),v&&v.ungrab()},onMouseButton:function(i,o){!0===u&&(i.xy.x=-i.xy.x),function(e,t,n,i,o,s,a){i.xy=e.eventXYAtMedia(i.xy,n),i.xy&&(i.xy={x:i.xy.x/i.xy.width,y:i.xy.y/i.xy.height},r.extend(i,{sid:t}),x(e,i,a),s&&s(i,o))}.call(m,e,t,n,i,o,l&&l.onMouseButton,l)},onMouseMove:function(r,i){emedia.config.disableTrack||(!0===u&&(r.x=-r.x),function(e,t,n,r,i,o,s){var c=e.eventXYAtMedia(r,n);c&&(x(e,{xy:c={x:c.x/c.width,y:c.y/c.height},oper:a.BTN.MOVE,sid:t},s),o&&o(c,i))}.call(m,e,t,n,r,i,l&&l.onMouseMove,l))}});var v;(e.current.__pannelBuffers||(e.current.__pannelBuffers={}))[t]=new c({_cId:f,_callbacks:l,trackBufferSize:emedia.config.trackBufferSize||1e3});(e.current.__pannelMouses||(e.current.__pannelMouses={}))[t]=m,m.grab(),p&&(v=new s({_target:document,_focused:!0,onKeyPress:function(n,r){var i=r?a.BTN.KEYBOARD_DOWN:a.BTN.KEYBOARD_UP,o=n;(function(e,t,n,r,i,o){x(e,{oper:n,btn:r,sid:t},o),i&&i(n,r)}).call(v,e,t,i,o,l&&l.onKeyboard,l)}}),(e.current.__pannelKeyboards||(e.current.__pannelKeyboards={}))[t]=v)}(e,t,n,u,d,l,f,!0),void(l&&l.onAccept&&l.onAccept(p));i.warn("Unkown result：",h.result),l&&l.onNotAllowRemoteControl&&l.onNotAllowRemoteControl(p)}else l&&l.onNotAllowRemoteControl&&l.onNotAllowRemoteControl(p);else l&&l.onRemoteControlTimeout&&l.onRemoteControlTimeout(p);else l&&l.onBusy&&l.onBusy(p);else l&&l.onReject&&l.onReject(p)})}function T(e,t,n){var r=t;r&&(e.mouseTrack=r),e.keyboard=n}var I=function e(t){var n,o;(e.timeoutId&&clearTimeout(e.timeoutId),e.timeoutId=setTimeout(function(){e(t)},emedia.config.ctrlCheckIntervalMillis),t.current)&&((n=t.current.__remoteControls)&&r.forEach(n,function(e,t){if(void 0!==t.id&&e==t.id){var n=(new Date).getTime();t._lastRecvTimestamp&&n-t._lastRecvTimestamp>emedia.config.ctrlTimeoutMillis&&(i.warn("Timeout for remote controller. it is ",t.id,t._ctrlStream.id,t._controller.memName),t._free(),t._callbacks&&t._callbacks.onRemoteFreeControl&&t._callbacks.onRemoteFreeControl(t._ctrlStream,t._controller,t._cId))}}),(o=t.current.__pannelBuffers)&&r.forEach(o,function(e,n){var r=t.getStreamById(e);r&&!r.located()&&t.current.message({op:1002,memId:r.owner.id,arg:JSON.stringify({op2:30,streamId:r.id,evt:3,cId:n._cId}),_reqOps:[100230]}).post(function(e){})}))};e.exports={mirrorControlled:function(e,t,n,i){var o={};r.forEach(arguments,function(e,t){"function"==typeof t&&(o[t.name]=t)}),E(e,t,n,!0,i,o)},controlled:function(e,t,n,i){var o={};r.forEach(arguments,function(e,t){"function"==typeof t&&(o[t.name]=t)}),E(e,t,n,!1,i,o)},disControlled:C,controlling:T,graffiti:function(e,t,n,r){var i=new o({_target:e,_focused:!0,onMouseEnter:function(){},onMouseExit:function(){t.releaseTrigger()},onMouseButton:function(e,i){e.xy={x:e.xy.x/e.xy.width,y:e.xy.y/e.xy.height},!0===r&&(e.xy.x=-e.xy.x),n&&(e.xy=emedia.Service.prototype.eventXYAtMedia.call(null,e.xy,n)),e.xy&&t.trigger(e)},onMouseMove:function(e,i){e={x:e.x/e.width,y:e.y/e.height},!0===r&&(e.x=-e.x),n&&(e=emedia.Service.prototype.eventXYAtMedia.call(null,e,n)),e&&t.track(e)}});return i.grab(),i},echoControl:function(e,t,n,r){var i=e.getStreamById(t),o={_ctrlStream:i,_controller:i.owner,_service:e};T(o,n,r),(e.current.__remoteControls||(e.current.__remoteControls={}))[t]=o},disEchoControl:function(e,t){r.removeAttribute(e.current.__remoteControls,t)},support:function(e){var t={};r.forEach(arguments,function(e,n){0!=e&&"function"==typeof n&&(t[n.name]=n)}),h(e),l(e),u(e),m(e,t),I(e)},getController:function(e,t){var n=e.getStreamById(t),r=S(e,n);if(r&&0!==r.length)return r[0]._controller.memName}}},function(e,t,n){var r=n(15),i=(r.tagLogger("Mouse"),n(32));e.exports=r.prototypeExtend({__init__:function(){this._handlers=r.extend({mousedown:this._handleMouseDown.bind(this),mouseup:this._handleMouseUp.bind(this),mousemove:this._handleMouseMove.bind(this),mousewheel:this._handleMouseWheel.bind(this),mousedisable:this._handleMouseDisable.bind(this),mouseover:this._handleMouseOver.bind(this),mouseout:this._handleMouseOut.bind(this)},this._handlers||{})},onMouseButton:function(e,t){},onMouseMove:function(e,t){},onMouseEnter:function(){},onMouseExit:function(){},_onMouseButton:function(e,t,n){var r=(new Date).getTime(),o=new i({xy:e,oper:t,btn:n,_time:r});this.onMouseButton&&this.onMouseButton(o,this._lastTrigger),this._lastTrigger=o},_onMouseMove:function(e){this.onMouseMove&&this.onMouseMove(e,this._lastTrigger)},_captureMouse:function(){this._target.setCapture&&this._target.setCapture(),this._mouseCaptured=!0},_releaseMouse:function(){this._target.releaseCapture&&this._target.releaseCapture(),this._mouseCaptured=!1},_resetDoubleClickTimer:function(){this._doubleClickTimer=null},_handleMouseOver:function(e){!1!==this._mouseExit&&(this._mouseExit=!1,this.onMouseEnter&&this.onMouseEnter())},_handleMouseOut:function(e){!0!==this._mouseExit&&(this._mouseExit=!0,this.onMouseExit&&this.onMouseExit()),this._lastTrigger=void 0},_handleMouseDown:function(e){this._captureMouse(),this._handleMouseButton(e,i.BTN.KEY_DOWN)},_handleMouseUp:function(e){this._mouseCaptured&&(this._handleMouseButton(e,i.BTN.KEY_UP),this._releaseMouse())},_handleMouseWheel:function(e){if(this._focused){e=e||window.event;var t=r.getEventElementXY(e,this._target,this._scale),n=(e.detail?-1*e.detail:e.wheelDelta/40)>0?i.BTN.WHEEL_ROLL_UP:i.BTN.WHEEL_ROLL_DOWN;this._onMouseButton(t,i.BTN.KEY_DOWN,n),r.stopEvent(e)}},_handleMouseMove:function(e){if(this._focused){e=e||window.event;var t=r.getEventElementXY(e,this._target,this._scale);this._onMouseMove(t),r.stopEvent(e)}},_handleMouseDisable:function(e){if(this._focused){e=e||window.event;var t=r.getEventElementXY(e,this._target,this._scale);try{return!(t.realX>=0&&t.realY>=0&&t.realX<this._target.offsetWidth&&t.realY<this._target.offsetHeight)}finally{r.stopEvent(e)}}},_handleMouseButton:function(e,t){if(this._focused){e=e||window.event;var n,o=r.getEventElementXY(e,this._target,this._scale);if(e.touches||e.changedTouches){if(t==i.BTN.KEY_DOWN){if(null===this._doubleClickTimer)this._lastTouchPos=o;else{clearTimeout(this._doubleClickTimer);var s=this._lastTouchPos.x-o.x,a=this._lastTouchPos.y-o.y;Math.sqrt(s*s+a*a)<20*window.devicePixelRatio&&(o=this._lastTouchPos)}this._doubleClickTimer=setTimeout(this._resetDoubleClickTimer.bind(this),500)}n=i.BTN.LEFT}else n=e.which?1<<e.button:(1&e.button)+2*(2&e.button)+(4&e.button)/2;this._onMouseButton(o,t,n),r.stopEvent(e)}},grab:function(){var e=this._target;r.addEvent(e,"mouseover",this._handlers.mouseover),r.addEvent(e,"mouseout",this._handlers.mouseout),r.addEvent(e,"touchstart",this._handlers.mousedown),r.addEvent(e,"touchend",this._handlers.mouseup),r.addEvent(e,"touchmove",this._handlers.mousemove),r.addEvent(e,"mousedown",this._handlers.mousedown),r.addEvent(e,"mouseup",this._handlers.mouseup),r.addEvent(e,"mousemove",this._handlers.mousemove),r.addEvent(e,r.layoutEngine.gecko?"DOMMouseScroll":"mousewheel",this._handlers.mousewheel),r.addEvent(e,"contextmenu",this._handlers.mousedisable)},ungrab:function(){var e=this._target;r.removeEvent(e,"mouseover",this._handlers.mouseover),r.removeEvent(e,"mouseout",this._handlers.mouseout),r.removeEvent(e,"touchstart",this._handlers.mousedown),r.removeEvent(e,"touchend",this._handlers.mouseup),r.removeEvent(e,"touchmove",this._handlers.mousemove),r.removeEvent(e,"mousedown",this._handlers.mousedown),r.removeEvent(e,"mouseup",this._handlers.mouseup),r.removeEvent(e,"mousemove",this._handlers.mousemove),r.removeEvent(e,r.layoutEngine.gecko?"DOMMouseScroll":"mousewheel",this._handlers.mousewheel),r.removeEvent(e,"contextmenu",this._handlers.mousedisable)}})},function(e,t,n){var r=n(15),i=r.tagLogger("Keyboard");e.exports=r.prototypeExtend({__init__:function(){this._eventHandlers={keyup:this._handleKeyUp.bind(this),keydown:this._handleKeyDown.bind(this),keypress:this._handleKeyPress.bind(this),blur:this._allKeysUp.bind(this)}},getKey:function(e){return"keyCode"in e&&"key"in e?e.key+":"+e.keyCode:"keyCode"in e?e.keyCode:e.key},onKeyPress:function(e,t){},_onKeyPress:function(e,t){this.onKeyPress&&this.onKeyPress(e,t)},_handleRfbEvent:function(e,t){e.shiftKey,e.ctrlKey,e.altKey;var n=e.keyCode||e.which;this._onKeyPress(n,"keydown"==t)},_handleKeyDown:function(e){return!this._focused||!this._handleRfbEvent(e,"keydown")||(r.stopEvent(e),!1)},_handleKeyPress:function(e){return!this._focused||(r.stopEvent(e),!1)},_handleKeyUp:function(e){return!this._focused||!this._handleRfbEvent(e,"keyup")||(r.stopEvent(e),!1)},_allKeysUp:function(){},sync:function(e){},grab:function(){var e=this._target;r.addEvent(e,"keydown",this._eventHandlers.keydown),r.addEvent(e,"keyup",this._eventHandlers.keyup),r.addEvent(e,"keypress",this._eventHandlers.keypress),r.addEvent(e,"blur",this._eventHandlers.blur),i.info("keyboard grab at element")},ungrab:function(){var e=this._target;r.removeEvent(e,"keydown",this._eventHandlers.keydown),r.removeEvent(e,"keyup",this._eventHandlers.keyup),r.removeEvent(e,"keypress",this._eventHandlers.keypress),r.removeEvent(e,"blur",this._eventHandlers.blur),this._allKeysUp(),i.info("keyboard upgrab at element")}})},function(e,t,n){var r=n(15),i=(r.tagLogger("TotalBuffer"),n(240)),o=n(241),s=n(32);e.exports=r.prototypeExtend({trackBufferSize:100,_trackBufferCompRadio:.25,_sn:1,__init__:function(){this._eventBuffer=new i({_nextsn:this._nextsn.bind(this)}),this._trackBuffer=new o({_nextsn:this._nextsn.bind(this),_compRadio:this._trackBufferCompRadio,mouseTrackBufferSize:this.trackBufferSize})},_nextsn:function(){return this._sn++},put:function(e){e&&void 0!==e.oper&&(e.oper===s.BTN.MOVE?this._trackBuffer.put(e):this._eventBuffer.put(e))},getUnread1:function(e){function t(e,t){return e._time-t.time}var n;if(!e){var r=this._eventBuffer.getUnread(),i=this._trackBuffer.getUnread();return Array.prototype.push.apply(r,i),(n=r).sort(t),n}n=[];r=this._eventBuffer._getUnread(e),i=this._trackBuffer._getUnread(e);Array.prototype.push.apply(n,r),Array.prototype.push.apply(n,i),n.sort(t),n=n.slice(0,e>n.length?n.length:e);for(var o=0;o<n.length;o++)n[o].oper===s.BTN.MOVE?this._trackBuffer.getUnread(1):this._eventBuffer.getUnread(1);return n},getUnread:function(e){e||(e=this._eventBuffer.getUnreadSize()+this._trackBuffer.getUnreadSize());for(var t=[];t.length!==e;){var n=this._eventBuffer._getUnread(1),r=this._trackBuffer._getUnread(1);if(void 0===n&&r)t.push(this._trackBuffer.getUnread(1));else if(void 0===r&&n)t.push(this._eventBuffer.getUnread(1));else{if(void 0===r&&void 0===n)return t;n.sn<r.sn?t.push(this._eventBuffer.getUnread(1)):t.push(this._trackBuffer.getUnread(1))}}return t},getUnreadSize:function(){return this._trackBuffer.getUnreadSize()+this._eventBuffer.getUnreadSize()},getUnclearSize:function(){return this._trackBuffer.getUnclearSize()+this._eventBuffer.getUnclearSize()},clearRead:function(e){return this._eventBuffer.clearRead(e)+this._trackBuffer.clearRead(e)}})},function(e,t,n){var r=n(15);r.tagLogger("EventBuffer");e.exports=r.prototypeExtend({_buffer:[],_sn:1,_beginIndex:0,_readIndex:0,_endIndex:0,_nextsn:function(){return this._sn++},put:function(e){e&&(e.sn=this._nextsn(),this._buffer.push(e),this._endIndex++)},_getUnread:function(e){return this._readIndex===this._endIndex?1===e?void 0:[]:this._buffer[this._readIndex]},getUnread:function(e){var t;try{return t=this._getUnread(e)}finally{t&&(this._readIndex+=1===e?1:t.length)}},getUnreadSize:function(){return this._endIndex-this._readIndex},getUnclearSize:function(){return this._readIndex-this._beginIndex},clearRead:function(e){if(this._readIndex!==this._beginIndex){for(var t=0,n=this._beginIndex;n<this._readIndex&&this._buffer[n].sn<=e;n++)t++;if(0===t)return 0;for(n=0;n<t;n++)this._buffer.shift();return this._beginIndex=0,this._readIndex-=t,this._endIndex-=t,t}}})},function(e,t,n){var r=n(15);r.tagLogger("TrackBuffer");e.exports=r.prototypeExtend({mouseTrackBufferSize:1e3,_sn:1,_compRadio:.25,_beginIndex:0,_readIndex:0,_endIndex:0,__init__:function(){this._mouseTrackBuffer=new Array(this.mouseTrackBufferSize)},_nextsn:function(){return this._sn++},_index:function(e){return e%this.mouseTrackBufferSize},comp1:function(e){if(!(e>=1)){for(var t=Math.floor(1/e),n=this._beginIndex,r=n+1;n<this._endIndex;){for(var i=2;i<t&&n+i<this._endIndex;i++)this._mouseTrackBuffer[this._index(r++)]=this._mouseTrackBuffer[this._index(n+i)];n+=t}this._endIndex=r}},put1:function(e){if(e){e.sn=this._nextsn(),this._endIndex-this._readIndex===this.mouseTrackBufferSize&&(this.comp1(this._compRadio),this._readIndex=this._beginIndex);var t=this._index(this._beginIndex),n=(this._index(this._readIndex),this._index(this._endIndex));n<=t&&n>=0&&this._endIndex>this._beginIndex&&this._beginIndex++,this._mouseTrackBuffer[n]=e,this._endIndex++}},compHalfOfUnread:function(){for(var e=this._readIndex+2,t=this._readIndex+1;e<this._endIndex;)this._mouseTrackBuffer[this._index(t++)]=this._mouseTrackBuffer[this._index(e)],e+=2;this._endIndex=t},put:function(e){if(e){e.sn=this._nextsn(),this._endIndex-this._beginIndex===this.mouseTrackBufferSize&&this.compHalfOfUnread();var t=this._index(this._endIndex);this._mouseTrackBuffer[t]=e,this._endIndex++}},_interval:function(e,t){var n=this._index(e),r=this._index(t);if(n<r)return this._mouseTrackBuffer.slice(n,r);var i=this._mouseTrackBuffer.slice(n);return Array.prototype.push.apply(i,this._mouseTrackBuffer.slice(0,r)),i},_getUnread:function(e){return this._readIndex===this._endIndex?1===e?void 0:[]:this._mouseTrackBuffer[this._index(this._readIndex)]},getUnread:function(e){var t;try{return t=this._getUnread(e)}finally{t&&(this._readIndex+=1===e?1:t.length)}},getUnreadSize:function(){return this._endIndex-this._readIndex},getUnclearSize:function(){return this._readIndex-this._beginIndex},clearRead:function(e){if(this._readIndex!==this._beginIndex){for(var t=0,n=this._beginIndex;n<this._readIndex;n++){var r=this._index(n);if(!(this._mouseTrackBuffer[r].sn<=e))break;this._beginIndex++,t++}return t}}})},function(e,t,n){var r=n(15),i=r.tagLogger("CompositeCanvas");function o(){}for(var s in CanvasRenderingContext2D.prototype)!function(e){o.prototype[e]=function(){if("function"==typeof this._canvasContext[e])this._canvasContext[e].apply(this._canvasContext,arguments);else{var t=arguments.length>=1?arguments[0]:void 0;if(!t)return this._canvasContext[e];this._canvasContext[e]=t}}}(s);var a=r.prototypeExtend(o,{__init__:function(){this.compositeCanvasTag||(this.compositeCanvasTag=document.createElement("canvas")),this._canvasContext=this.compositeCanvasTag.getContext("2d"),this._canvasContext.globalAlpha=void 0!==this._globalAlpha?this._globalAlpha:1,this._compositeOperation=this._compositeOperation||c.source_over,this.globalCompositeOperation(this._compositeOperation)},setCanvas:function(){for(var e,t=this,n=0;n<arguments.length;n++)"function"==typeof(e=arguments[n])&&e(this.compositeCanvasTag,this._canvasContext),"function"!=typeof e&&r.isPlainObject(e)&&r.forEach(e,function(e,n){i.debug("Canvas set ",e," = ",n),t.compositeCanvasTag.setAttribute(e,n)});return t},getCanvasImageData:function(e,t){for(var n=[],r=1;r<arguments.length;r++)n.push(arguments[r]);var i=e.getContext("2d");return i.globalAlpha=t||0,i.getImageData.apply(i,n)},_composite:function(e){return new a(this,{_compositeOperation:e})},composite:function(e){return this.globalCompositeOperation(e),this},requestAnimationFrame:function(e){var t=this;return t.requestFrame(),t._requestAnimationFrameStart=window.requestAnimationFrame(function(e){t.requestAnimationFrame(e)}),t},cancelAnimationFrame:function(){return this._requestAnimationFrameStart&&window.cancelAnimationFrame(this._requestAnimationFrameStart),this},requestFrame:function(e){var t;if("function"!=typeof this.requestOneFrame)throw i.error("Pleas implement requestOneFrame()"),"Pleas implement requestOneFrame()";try{this.requestOneFrame()}catch(r){i.error(r)}if(e&&(t=Math.floor(1e3/e)),!t)return this;var n=this.requestFrame.bind(this);return this.intervalId=setInterval(function(){n(e)},t),this},stopRequestFrame:function(){return this.intervalId&&clearInterval(this.intervalId),this}});a.CompositeOperation=["source-atop","source-in","source-out","source-over","destination-atop","destination-in","destination-out","destination-over","lighter","darker","xor","copy"];var c=a.operation={source_atop:"source-atop",source_in:"source-in",source_out:"source-out",source_over:"source-over",destination_atop:"destination-atop",destination_in:"destination-in",destination_out:"destination-out",destination_over:"destination-over",lighter:"lighter",darker:"darker",xor:"xor",copy:"copy"};a.compositeVideoOverCanvas=function(e,t,n){var r;return(r=e.compositeCanvas)||(r=new a({compositeCanvasTag:e,requestOneFrame:function(){t&&r.drawImage(t,0,0,e.width,e.height),n&&r.drawImage(n,0,0,e.width,e.height)}}),e.compositeCanvas=r),r},e.exports=a},function(e,t,n){var r=n(15);r.tagLogger("Keyboard");e.exports=r.prototypeExtend({onKeyDown:function(e){},onKeyUp:function(e){}})},function(e,t,n){var r,i=n(15),o=i.tagLogger("PCStats");e.exports=r=i.prototypeExtend({__init__:function(){this._webrtc||this._stream&&(this._webrtc=this._stream._webrtc),this.samplesDatas={},this.gatherResults={},this._bysamples={},!1!==this._inbound_&&(this._bysamples["inbound-rtp"]=["bytesReceived","packetsLost","packetsReceived","packageLossRate"]),!1!==this._outbound_&&(this._bysamples["outbound-rtp"]=["bytesSent"])},onGatherResult:function(e,t,n,r){o.info(e,t,n,r)},stats:function(e){return this._webrtc&&this._webrtc._rtcPeerConnection||o.warn("not found webrtc or peer connection").return,this._webrtc._rtcPeerConnection.getStats(e)},statsOfTrack:function(e){if(!e instanceof window.MediaStreamTrack)throw o.error("selector not a MediaStreamTrack"),"selector not a MediaStreamTrack";return this.stats(e)},audioTrack:function(e){var t=e&&e.getAudioTracks();return t&&t.length?t[0]:void 0},videoTrack:function(e){var t=e&&e.getVideoTracks();return t&&t.length?t[0]:void 0},gatherTrack:function(e,t){var n=this;t=(t=e.kind||t)&&t.toLowerCase();var r=e.id;this.statsOfTrack(e).then(function(i){n.samplesDatas[r]||(n.samplesDatas[r]={});var s=n.samplesDatas[r];i.forEach(function(r,i){var a=n._bysamples[r.type],c=r.mediaType||i.indexOf("ideo")>=0&&"video"||i.indexOf("udio")>=0&&"audio"||void 0;if(a&&a.length&&(!0===emedia.config._printDebugStats&&o.debug(i,r,e,c,t),!c||c===t)){var u=s[r.type]||(s[r.type]={});a.forEach(function(n){var i=u[n]||(u[n]=[]),o={timestamp:r.timestamp,kind:r.mediaType||e.kind||t};o[n]="packageLossRate"===n?{packetsLost:r.packetsLost,packetsReceived:r.packetsReceived}:r[n],i.push(o)})}})})},gatherWebrtcMediaStream:function(e,t){var n=this;t?"audio"!==t.toLowerCase()?"video"!==t.toLowerCase()||e.getVideoTracks().forEach(function(e){n.gatherTrack(e,e.kind||t.toLowerCase())}):e.getAudioTracks().forEach(function(e){n.gatherTrack(e,e.kind||t.toLowerCase())}):e.getTracks().forEach(function(e){n.gatherTrack(e)})},gatherWebrtc:function(){this._webrtc._localStream&&this.gatherWebrtcMediaStream(this._webrtc._localStream),this._webrtc._remoteStream&&this.gatherWebrtcMediaStream(this._webrtc._remoteStream)},_gather_inbound_rtp_pliCount:function(e){var t=e.shift();return t&&t.pliCount||0},_gather_inbound_rtp_packetsLost:function(e){var t=e.shift();return t&&t.packetsLost||0},_gather_inbound_rtp_packetsReceived:function(e){var t=e.shift();return t&&t.packetsReceived||0},_gather_inbound_rtp_packageLossRate:function(e){if(!e||0===e.length)return 0;var t,n=e[e.length-1];return e.length<emedia.config.statsSeconds?0:(t=e.shift(),(n.packageLossRate.packetsLost-t.packageLossRate.packetsLost)/(n.packageLossRate.packetsReceived-t.packageLossRate.packetsReceived))},_gather:function(e,t,n){e=e.replace(/[^\w]/g,"_"),t=t.replace(/[^\w]/g,"_");var r=i.list("_gather",e,t).join("_");if("function"==typeof this[r])return this[r](n);var o=emedia.config.statsSeconds;if(n.length<o)return 0;var s=n[o-1][t]-n[0][t],a=n[o-1].timestamp-n[0].timestamp;return n.shift(),0===a?0:parseFloat(1e3*s/a).toFixed(2)},_statsCount:function(){var e=this;i.forEach(e.samplesDatas,function(t,n){!function(t,n,r){i.forEach(r,function(r,o){var s=n[r]||(n[r]={});!function(t,n,r,o){i.forEach(o,function(i,o){var s=n[i]=e._gather(r,i,o);e.onGatherResult(t,r,i,s)})}(t,s,r,o)})}(t,e.gatherResults[t]=e.gatherResults[t]||{},n)})},gather:function(){this.gatherWebrtc(),this._statsCount()},intervalGather:function(e){this._intervalId&&clearInterval(this._intervalId),this._intervalId=setInterval(this.gather.bind(this),e||1e3)},stopIntervalGather:function(){this._intervalId&&clearInterval(this._intervalId)}});var s={},a=r.echo=function(e){i.forEach(e,function(e,t){var n;!s[t.id]&&t._webrtc&&!t._webrtc.closed&&t.getMediaStream()?(s[t.id]=n=new r({_webrtc:t._webrtc}),n._mediaStream=t.getMediaStream()):!s[t.id]||t._webrtc&&!t._webrtc.closed&&t.getMediaStream()||i.removeAttribute(s,t.id)});var t=[];i.forEach(s,function(n,r){e&&e[n]?(r.gatherWebrtcMediaStream(r._mediaStream),r._statsCount()):t.push(n)}),i.forEach(t,function(e,t){i.removeAttribute(s,t)})};r.intervalEcho=function(e,t){return setInterval(function(){a(e)},t)},i.forEach(["inbound","outbound"],function(e,t){i.forEach(["Audio","Video"],function(e,n){!function(e,t){var n;r[e+t]=n=function(o,s,a){n.__intervalIds||(n.__intervalIds={});var c=n.__intervalIds&&n.__intervalIds[o.id];return c&&clearInterval(c),c=setInterval(function(){var a,u=n[o.id];(!u&&o&&o._webrtc&&!o._webrtc.closed&&o.getMediaStream()?(n[o.id]=u=new r({_webrtc:o._webrtc,_inbound_:"inbound"===e,_outbound_:"outbound"===e}),s&&(u.onGatherResult=s),u._mediaStream=o.getMediaStream()):!u||o&&o._webrtc&&!o._webrtc.closed&&o._webrtc.__id===u._webrtc.__id&&o.getMediaStream()&&u._mediaStream&&u._mediaStream.id===o.getMediaStream().id||(i.removeAttribute(n,o.id),u=null),u)?(u.gatherWebrtcMediaStream(u._mediaStream,t),u._statsCount()):o&&emedia.__easemob_current_mservice&&(a=emedia.__easemob_current_mservice.getStreamById(o.id))?o=a:c&&clearInterval(c)},a),n.__intervalIds[o.id]=c,c}}(t,n)})})},function(e,t,n){window.emedia=window.emedia||{};var r=n(15).tagLogger("electron");emedia.electron=window.require("electron"),emedia.chooseElectronDesktopMedia=function(e,t,n){r.info("Choose desktop. ",e[0]),t(e[0])}}])}),window._emediaVersion="2.1.1_Git.29f2187",console&&console.warn("EMedia version","2.1.1_Git.29f2187");
},{}],"yUjP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("easemob-emedia"),t=e.util;exports.default=t;
},{"easemob-emedia":"WNWS"}],"thlH":[function(require,module,exports) {
function t(a){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(a)}var a=require("./utils").default,e=a.logger,n={rtFlag:1,success:function(t){},fail:function(t){}},d=function t(e){if(!(this instanceof t)){var d=function(t){a.extend(!0,this,t||{})};return a.extend(!0,d.prototype,n,e||{}),d}a.extend(!0,this,n,e||{})};exports.RouteTo=d;var s={imConnection:null,rtcHandler:null,events:{0:"onReqP2P",1:"onNewCfr",2:"onDelCfr",3:"onReqTkt",100:"onPing",101:"onPong",102:"onInitC",103:"onReqC",104:"onAcptC",105:"onTcklC",106:"onAnsC",107:"onTermC",202:"onInvite",300:"onEvEnter",301:"onEvExit",302:"onEvPub",303:"onEvUnpub",304:"onEvMems",204:"onEvClose",400:"onStreamControl",401:"onEvJoin",onServerError:"onServerError"},register:function(a){if("object"===t(a))for(var e in a)this.bind(e,a[e])},bind:function(t,a){var e;(e=this.events[t])?this[e]=a:this[e=this.events[t]="on_"+t]=a},jid:function(t){return/^.+#.+_.+@.+$/g.test(t)?t:this.imConnection.context.appKey+"_"+t+"@"+this.imConnection.domain},reqP2P:function(t,a,n,d,s){e.debug("req p2p ...");var r={data:{op:0,video:a,audio:n,peer:d}};this.rtcHandler.sendRtcMessage(t,r,s)},newCfr:function(t,a,n,d){e.debug("newCfr ...");var s={data:{op:1}};a&&(s.data.reqTkt=a),n&&(s.data.password=n),this.rtcHandler.sendRtcMessage(t,s,d)},enter:function(t,a,n,d,s,r,o){e.debug("enter ...");var i={data:{op:200}};a&&(i.data.WebRTCId=a),n&&(i.data.reqMembers=n),d&&(i.data.tkt=d),s&&(i.data.nonce=s),r&&(i.data.digest=r),this.rtcHandler.sendRtcMessage(t,i,o)},ping:function(t,a,n){e.debug("ping ...");var d={data:{op:100}};a&&(d.data.sessId=a),this.rtcHandler.sendRtcMessage(t,d,n)},streamControl:function(t,a,n,d,s,r){e.debug("streamControl ...");var o={data:{op:400}},i=0==d||3==d;0==d||1==d?emedia.enableAudioTracks(s,i):emedia.enableVideoTracks(s,i),a&&(o.data.sessId=a),n&&(o.data.rtcId=n),void 0!==d&&null!=d&&(o.data.controlType=d),this.rtcHandler.sendRtcMessage(t,o,r)},reqTkt:function(t,a,n,d,s){e.debug("reqTkt ...");var r={data:{op:3}};a&&(r.data.isCreate=a),n&&(r.data.confrId=n),"string"==typeof d&&(r.data.password=d),this.rtcHandler.sendRtcMessage(t,r,s)},invite:function(t,a,n,d,s){e.debug("reqTkt ...");var r={data:{op:202}};a&&(r.data.confrId=a),"string"==typeof n&&(r.data.password=n),d&&(r.data.gid=d),this.rtcHandler.sendRtcMessage(t,r,s)},initC:function(t,a,n,d,s,r,o,i,c,u,l,p,f){e.debug("initC ..."),t.to=t.to.split("_")[1].split("@")[0];var g={data:{op:102}};g.streamType=a||"VIDEO",n&&(g.data.WebRTCId=n),d&&(g.data.tkt=d),s&&(g.data.sessId=s),r&&(g.data.rtcId=r),o&&(g.data.pubS=o),i&&(g.data.subS=i),c&&(g.data.sdp=c),u&&(g.data.cands=u),l&&(g.data.rtcCfg=l),p&&(g.data.WebRTC=p),g.data.expr=emedia.supportPRAnswer?1:0,this.rtcHandler.sendRtcMessage(t,g,f)},tcklC:function(t,a,n,d,s,r){e.debug("tcklC ...");var o={data:{op:105}};a&&(o.data.sessId=a),n&&(o.data.rtcId=n),d&&(o.data.sdp=d),s&&(o.data.cands=s),this.rtcHandler.sendRtcMessage(t,o,r)},ansC:function(t,a,n,d,s,r,o,i){e.debug("ansC ...");var c={data:{op:106}};a&&(c.data.sessId=a),n&&(c.data.rtcId=n),d&&(c.data.sdp=d),s&&(c.data.cands=s),!1===o&&(c.data.enableVoice=o),!1===i&&(c.data.enableVideo=i),this.rtcHandler.sendRtcMessage(t,c,r)},acptC:function(t,a,n,d,s,r,o,i,c){e.debug("acptC ...");var u={data:{op:104}};a&&(u.data.sessId=a),n&&(u.data.rtcId=n),d&&(u.data.sdp=d),s&&(u.data.cands=s),r&&(u.data.ans=r),!1===i&&(u.data.enableVoice=i),!1===c&&(u.data.enableVideo=c),this.rtcHandler.sendRtcMessage(t,u,o)},getMems:function(t,a,n,d){e.debug("getMems ...");var s={data:{op:203}};a&&(s.data.WebRTCId=a),n&&(s.data.sessId=n),this.rtcHandler.sendRtcMessage(t,s,d)},subC:function(t,a,n,d,s){e.debug("subC ...");var r={data:{op:205}};a&&(r.data.sessId=a),n&&(r.data.rtcId=n),d&&(r.data.subS=d),this.rtcHandler.sendRtcMessage(t,r,s)},usubC:function(t,a,n,d){e.debug("usubC ...");var s={data:{op:206}};a&&(s.data.sessId=a),n&&(s.data.rtcId=n),this.rtcHandler.sendRtcMessage(t,s,d)},termC:function(t,a,n,d,s){e.debug("termC ...");var r={data:{op:107,reason:d}};a&&(r.data.sessId=a),n&&(r.data.rtcId=n),d&&(r.reason=d),this.rtcHandler.sendRtcMessage(t,r,s)},exit:function(t,a,n,d){e.debug("exit ...");var s={data:{op:201}};a&&(s.data.WebRTCId=a),n&&(s.data.sessId=n),this.rtcHandler.sendRtcMessage(t,s,d)},delCfr:function(t,a,n,d){e.debug("delCfr ...");var s={data:{op:2}};a&&(s.data.WebRTCId=a),n&&(s.data.admtok=n),this.rtcHandler.sendRtcMessage(t,s,d)}};exports.Api=function(t){var n=this;a.extend(!0,this,s,t||{}),this.rtcHandler.onRecvRtcMessage=function(t,a,d,s,r){var o;0!=a.result&&n.onServerError?n.onServerError.call(n,t,a,d,s,r):n.events[a.op]&&(o=n[n.events[a.op]])?o.call(n,t,a,d,s,r):e.info("can not handle(recvRtcMessage) the op: "+a.op,a)}};
},{"./utils":"yUjP"}],"7BK3":[function(require,module,exports) {
var e=require("./utils").default,t=e.logger,n=require("./api"),o=n.RouteTo,s="urn:xmpp:media-conference",d={_apiCallbacks:{},imConnection:null,_connectedSid:"",init:function(){var e=this;e.imConnection.registerConfrIQHandler=function(n,o,s){try{e.handleRtcMessage(n)}catch(d){t.error(d)}}},handleRtcMessage:function(n,s,d){var a=this;if(n){var i=WebIM.conn.context.root.lookup("easemob.pb.ConferenceBody").decode(n.payload);console.log("%c"+JSON.stringify(i),"color: blue");n.id;var r=n.from.name||"";r.lastIndexOf("/")>=0&&(r=r.substring(0,r.lastIndexOf("/")));var c=i.routeKey,p=i.sessionId;(a._fromSessionID||(a._fromSessionID={}))[r]=p;var f=e.parseJSON(i.content),l=f,y=1==i.type?"VIDEO":"VOICE";""==y&&(y="VOICE"),l.streamType=y,102==l.op&&(a.singalStreamType=y);var g=f.tsxId;if(a.ctx=f.ctx,t.debug("Recv [op = "+l.op+"] [tsxId="+g+"]\r\n json :",n),""!=a._connectedSid||0!=l.result&&102!=l.op&&202!=l.op){if(a._connectedSid!=p){if(t.debug("Error recv [op = "+l.op+"] [tsxId="+g+"]. caused by _connectedSid != fromSessionId :",a._connectedSid,p),102==l.op&&p&&a._connectedSid){var m=new o({to:r,rtKey:c,sid:p,success:function(e){t.debug("iq to server success",e)},fail:function(e){t.debug("iq to server error",e),a.onError(e)}}),u={data:{op:107,sessId:l.sessId,rtcId:l.rtcId,reason:"busy"},reason:"busy"};a.sendRtcMessage(m,u)}return}}else a._connectedSid=p;if(107==l.op){a._connectedSid="",_fromSessionID={};var v=i.endReason;l.reason=null!=v&&{0:"hangup",1:"noresponse",2:"reject",3:"busy",4:"fail",5:"unsupported",6:"offline"}[v]}if(l.sdp&&("string"==typeof l.sdp&&(l.sdp=e.parseJSON(l.sdp)),l.sdp.type&&(l.sdp.type=l.sdp.type.toLowerCase())),l.cands){"string"==typeof l.cands&&(l.cands=e.parseJSON(l.cands));for(var I=0;I<l.cands.length;I++){if("string"==typeof l.cands[I])try{l.cands[I]=e.parseJSON(l.cands[I])}catch(S){l.cands[I]={candidate:l.cands[I]}}l.cands[I].sdpMLineIndex=void 0!==l.cands[I].sdpMLineIndex?l.cands[I].sdpMLineIndex:l.cands[I].mlineindex,l.cands[I].sdpMid=void 0!==l.cands[I].sdpMid?l.cands[I].sdpMid:l.cands[I].mid,delete l.cands[I].mlineindex,delete l.cands[I].mid}}if(l.rtcCfg&&"string"==typeof l.rtcCfg&&(l.rtcCfg=e.parseJSON(l.rtcCfg)),l.rtcCfg2&&"string"==typeof l.rtcCfg2&&(l.rtcCfg2=e.parseJSON(l.rtcCfg2)),l.WebRTC&&"string"==typeof l.WebRTC&&(l.WebRTC=e.parseJSON(l.WebRTC)),l.confrId&&(l.conferenceId=l.confrId),g&&a._apiCallbacks[g])try{a._apiCallbacks[g].callback&&a._apiCallbacks[g].callback(r,l)}catch(b){throw b}finally{delete a._apiCallbacks[g]}else a.onRecvRtcMessage(r,l,c,g,p);return!0}},onRecvRtcMessage:function(n,o,s,d,a){t.debug(" form : "+n+" \r\n json :"+e.stringifyJSON(rtcJSON))},convertRtcOptions:function(t){var n=t.data.sdp;n&&((n={type:n.type,sdp:n.sdp}).type=n.type.toUpperCase(),n=e.stringifyJSON(n),t.data.sdp=n);var o=t.data.cands;if(o){if(e.isArray(o));else{var s=[];s.push(o),o=s}for(var d in o){var a=o[d];if(void 0!==a.candidate&&void 0!==a.sdpMLineIndex&&void 0!==a.sdpMid){var i={type:"candidate",candidate:a.candidate,mlineindex:a.sdpMLineIndex,mid:a.sdpMid};o[d]=e.stringifyJSON(i)}}t.data.cands=o}var r=t.data.rtcCfg;r&&"string"!=typeof r&&(t.data.rtcCfg=e.stringifyJSON(r));var c=t.data.WebRTC;c&&"string"!=typeof c&&(t.data.WebRTC=e.stringifyJSON(c))},getShortId:function(e){var t,n;return(t=e.indexOf("_")+1)<1&&(t=0),(n=e.indexOf("@",-1))<0&&(n=e.length),e.substring(t,n)},sendRtcMessage:function(t,n,o){var s=this.imConnection,d=s.getUniqueId(),a=t.to&&t.to||s.domain;a.indexOf("@")>=0&&(a=a.split("_")[1].split("@")[0],""==this._connectedSid&&102==n.data.op&&(this._connectedSid=i));var i=t.sid||this._fromSessionID&&this._fromSessionID[a];i=i||((this._fromSessionID||(this._fromSessionID={}))[a]=s.getUniqueId("CONFR_")),(this._fromSessionID||(this._fromSessionID={}))[a]=i;var r=t.rtKey||t.rtkey;r||(r="");var c=t.rtflag;!isNaN(c)||(c=1),n.data||(n.data={}),n.data.tsxId=d,this.ctx&&(n.data.ctx=this.ctx),this.convertRtcOptions(n);var p=n.streamType||this.singalStreamType||"VIDEO";102==n.data.op&&(this.singalStreamType=p);var f=t.id||s.getUniqueId("CONFR_");o&&(this._apiCallbacks[d]={callback:o});var l={id:f,to:a,from:s.context.jid,type:"VIDEO"==p?1:0,rtflag:c,stream_type:p,sid:i,content:n.data,reason:n.reason,rtKey:r};if(202!=n.data.op&&this._sendMessage(l,WebIM.conn),107==n.data.op&&this._connectedSid&&(t.sid&&this._connectedSid!=t.sid||(this._connectedSid="",this._fromSessionID={})),202==n.data.op){var y=e.list("Invite",this.getShortId(a),"join conference:",n.data.confrId).join(" "),g={msg:y,id:f=s.getUniqueId("CONFR_INVITE"),to:a,from:s.context.jid,contents:[{contenttype:"TEXT",text:y}],gid:n.data.gid,password:n.data.password,exts:{key:"conferenceId",type:7,value:n.data.confrId}};return this._sendGroupInviteMsg(g,WebIM.conn)}},_sendGroupInviteMsg:function(e,t){var n=[],o=t.context.root.lookup("easemob.pb.MessageBody.Content").decode(n);o.type=0,o.text=e.msg;var s=t.context.root.lookup("easemob.pb.MessageBody"),d=s.decode(n);d.from={name:e.from.name},d.to={name:e.to},d.contents=[o];var a=t.context.root.lookup("easemob.pb.KeyValue"),i=a.decode(n),r=a.decode(n),c=a.decode(n);i.key="conferenceId",i.type=7,i.stringValue=e.exts.value,r.key="msg_extension",r.type=7,r.stringValue=JSON.stringify({inviter:e.from.name,group_id:e.gid}),c.key="password",c.type=7,c.stringValue=e.password,d.ext=[i,r,c],d.type=1,d=s.encode(d).finish();var p=t.context.root.lookup("easemob.pb.Meta").decode(n);p.id=e.id,p.from=e.from,p.to={appKey:t.appKey,name:e.to,domain:"easemob.com"},p.ns=1,p.type=1,p.payload=d;var f=t.context.root.lookup("easemob.pb.CommSyncUL"),l=f.decode(n);l.meta=p,l=f.encode(l).finish();var y=t.context.root.lookup("easemob.pb.MSync"),g=y.decode(n);g.version=t.version,g.encryptType=t.encryptType,g.command=0,g.guid=t.context.jid,g.payload=l,g=y.encode(g).finish(),t.sendMSync(g)},_sendMessage:function(e,t){var n,o=[],s=t.context.root.lookup("easemob.pb.ConferenceBody"),d=s.decode(o);e.content.video;0==e.content.op?n={op:e.content.op,callVersion:"2.0.0",audio:e.content.audio,video:e.content.video,tsxId:String(e.content.tsxId),peer:e.content.peer+"/",push:0}:400==e.content.op?n=e.content:(n=e.content).tsxId=String(e.content.tsxId);var a=e.content.op;if(d.content=JSON.stringify(n),d.routeFlag=e.rtflag,d.operation=7,d.sessionId=String(e.sid),d.type=e.type,102!=a&&104!=a&&105!=a&&107!=a&&400!=a||(d.routeKey=e.rtKey,d.routeFlag=e.rtflag,d.peerName=e.from.name),107==a){d.endReason={success:0,ok:0,timeout:1,decline:2,busy:3,"failed-transport":4,unsupported:5,offline:6}[e.reason]}console.log("%c"+JSON.stringify(d),"color: pink"),d=s.encode(d).finish();var i=t.context.root.lookup("easemob.pb.Meta").decode(o);i.id=String(e.id),i.ns=4,i.to={appKey:e.from.appKey,domain:e.from.domain,name:e.to},102==e.content.op&&(i.from=e.from),i.payload=d;var r=t.context.root.lookup("easemob.pb.CommSyncUL"),c=r.decode(o);c.meta=i,c=r.encode(c).finish();var p=t.context.root.lookup("easemob.pb.MSync"),f=p.decode(o);f.version=t.version,f.encryptType=t.encryptType,f.command=0,f.guid=t.context.jid,f.payload=c,f=p.encode(f).finish(),t.sendMSync(f)}},a=function(t){e.extend(!0,this,d,t||{}),this.init()};module.exports=a;
},{"./utils":"yUjP","./api":"thlH"}],"GTpD":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e,t=require("easemob-emedia");t.Webrtc.prototype.AVPubstream=t.Service.prototype.AVPubstream,t.Webrtc.prototype._openCamera=function(){t.Service.prototype._openCamera.apply(this,arguments)},t.Webrtc.prototype.__getUserMedia=function(){t.Service.prototype.__getUserMedia.apply(this,arguments)},t.Webrtc.prototype.__controlStream=function(){t.Service.prototype.__controlStream.apply(this,arguments)},t.Webrtc.prototype.__sysGetUserMedia=function(){t.Service.prototype.__sysGetUserMedia.apply(this,arguments)},t.Webrtc.prototype.createMedia=function(e,o){var r=this,i=new r.AVPubstream({constaints:e,aoff:0,voff:0});t.Service.prototype.openUserMedia.bind(this)(i).then(function(e,t){WebIM.__alreadyOpenMedias.push(t),o&&o(r,t)},function(e){t.util.logger.debug("[WebRTC-API] getUserMedia() error: ",e),r.onError(e)})},t.Webrtc.prototype.createMedia=e=function(o,r){var i=this,a=new MediaStream;function s(){0==--s.count&&(WebIM.__alreadyOpenMedias.push(a),r&&r(i,a))}function n(e){e&&e.getTracks().forEach(function(e){a.addTrack(e)})}var c=!o||o.audio,p=!o||o.video;if(!c&&!p)return s.count=0,s();if(c&&p)return s.count=2,e.call(this,{video:o.video,audio:!1},function(e,t){n(t),s()}),void e.call(this,{video:!1,audio:o.audio},function(e,t){n(t),s()});s.count=1;var u=new i.AVPubstream({constaints:o});t.Service.prototype.openUserMedia.bind(this)(u).then(function(e,t){n(t),s()},function(e){s(),t.util.logger.debug("[WebRTC-API] getUserMedia() error: ",e),"function"==typeof e.message?e.message=e.message():"string"==typeof e.message&&""!==e.message?e.message=e.message:e.message="open media error. "+e.name,e.message=e.message+" when get "+(p?"carma":"microphone"),i.onError(e)})},t.Webrtc.prototype.setLocalVideoSrcObject=function(e){this._localStream=e,this.onGotLocalStream(e,this.streamType),this.setLocalStream(e),t.util.logger.debug("[WebRTC-API] you can see yourself !")};var o=t.Webrtc.prototype.setRemoteDescription;t.Webrtc.prototype.setRemoteDescription=function(e){var t,r,i,a,s;if("VOICE"===this.streamType){t=/a=sendrecv|a=sendonly/g,r="a=inactive",i=e.sdp.indexOf("m=video"),a=e.sdp.indexOf("m=audio"),s=a>i?a:e.sdp.length,e.sdp=e.sdp.replace(t,function(e,t,o){return t>=i&&t<s?r:e})}return o.call(this,e)};var r=t.Webrtc;exports.default=r;
},{"easemob-emedia":"WNWS"}],"3mO+":[function(require,module,exports) {
var e=require("./utils").default,n=require("./api").RouteTo,t=e.logger,i=n({success:function(e){t.debug("iq to server success",e)},fail:function(e){t.debug("iq to server error",e)}}),s={_pingIntervalId:null,_p2pConfig:null,_rtcCfg:null,_rtcCfg2:null,_rtKey:null,_rtFlag:null,webRtc:null,api:null,callee:null,isCaller:!1,accepted:!1,setLocalSDP:!1,setRemoteSDP:!1,hangup:!1,init:function(){var e=this;e.api.onPing=function(){e._onPing.apply(e,arguments)},e.api.onTcklC=function(){e._onTcklC.apply(e,arguments)},e.api.onAcptC=function(){e._onAcptC.apply(e,arguments)},e.api.onAnsC=function(){e._onAnsC.apply(e,arguments)},e.api.onTermC=function(){e._onTermC.apply(e,arguments)},e.api.onEvJoin=function(){e._onEvJoin.apply(e,arguments)},e.api.onStreamControl=function(){e._onStreamControl.apply(e,arguments)},e.webRtc.onIceCandidate=function(){e._onIceCandidate.apply(e,arguments)},e.webRtc.onIceStateChange=function(){e._onIceStateChange.apply(e,arguments)}},_ping:function(){var e=this;e._pingIntervalId=window.setInterval(function(){var n=new i({to:e.callee,rtKey:e._rtKey});e.api.ping(n,e._sessId,function(e,n){t.debug("ping result",n)})},5e4)},_onPing:function(e,n,i,s,o){t.debug("_onPing from",o)},initC:function(e,n){this.sid=n,this.isCaller=!0,this.accepted=!1,this.setLocalSDP=!1,this.setRemoteSDP=!1,this.hangup=!1,this.streamType=e.audio&&e.video?"VIDEO":"VOICE",this.createLocalMedia(e)},createLocalMedia:function(e){var n=this;this.webRtc.createMedia(e,function(e,t){n.webRtc.createRtcPeerConnection(n._rtcCfg),e.setLocalVideoSrcObject(t),e.localStream=t,n.webRtc.createOffer(function(e){n._onGotWebRtcOffer(e)})})},_onGotWebRtcOffer:function(e){var n=new i({to:this.callee,rtKey:this._rtKey});this.api.initC(n,this.streamType,null,null,this._sessId,this._rtcId,null,null,e,null,this._rtcCfg2,null,function(e,n){t.debug("initc result",n)}),this.setLocalSDP=!0,this._ping()},_onAcptC:function(e,n){n.ans&&1==n.ans?(t.info("[WebRTC-API] _onAcptC : 104, ans = 1, it is a answer. will onAcceptCall"),this.onAcceptCall(e,n,!1!==n.enableVoice,!1!==n.enableVideo),this._onAnsC(e,n)):WebIM.WebRTC.supportPRAnswer?(t.info("[WebRTC-API] _onAcptC : recv pranswer. "),(n.sdp||n.cands)&&(n.sdp&&this.webRtc.setRemoteDescription(n.sdp),this.setRemoteSDP=!0,this._handRecvCandsOrSend(e,n),this.onAcceptCall(e,n,!1!==n.enableVoice,!1!==n.enableVideo))):(t.info("[WebRTC-API] _onAcptC : not supported pranswer. drop it. will onAcceptCall"),this.setRemoteSDP=!1,this._handRecvCandsOrSend(e,n),this.onAcceptCall(e,n,!1!==n.enableVoice,!1!==n.enableVideo))},_onEvJoin:function(e,n,i,s,o){t.debug("_onEvJoin from",o,e),this.onAcceptCall(e,n,!1!==n.enableVoice,!1!==n.enableVideo)},onAcceptCall:function(e,n,t,i){},__onVoiceOrVideo:function(e,n,t){!1===n.enableVoice?this.onOtherUserOpenVoice(e,!1):this.onOtherUserOpenVoice(e,!0),!1===n.enableVideo?this.onOtherUserOpenVideo(e,!1):this.onOtherUserOpenVideo(e,!0)},_onStreamControl:function(e,n,t,i,s){var o=n.controlType;0===o&&this.onOtherUserOpenVoice(e,!1),1===o&&this.onOtherUserOpenVoice(e,!0),2===o&&this.onOtherUserOpenVideo(e,!1),3===o&&this.onOtherUserOpenVideo(e,!0),this.onStreamControl(e,n,t,i,s)},onStreamControl:function(e,n,t,i,s){},onOtherUserOpenVoice:function(e,n){t.debug("from open:",n," voice .",e)},onOtherUserOpenVideo:function(e,n){t.debug("from open:",n," voideo .",e)},_onAnsC:function(e,n){t.info("[WebRTC-API] _onAnsC : recv answer. "),this.accepted=!0,n.sdp&&this.webRtc.setRemoteDescription(n.sdp),this.setRemoteSDP=!0,this._handRecvCandsOrSend(e,n),this.__onVoiceOrVideo(e,n)},_onInitC:function(e,n,i,s,o){var a=this;a.isCaller=!1,a.accepted=!1,a.setLocalSDP=!1,a.setRemoteSDP=!1,a.hangup=!1,a.callee=e,a._rtcCfg2=n.rtcCfg,a._rtKey=i,a._tsxId=s,a._fromSid=o,a._rtcId=n.rtcId,a._sessId=n.sessId,a.streamType=n.streamType,a.webRtc.createRtcPeerConnection(a._rtcCfg2),a.callerNotPranswer=0===n.expr,t.warn("caller not pranswer ",a.callerNotPranswer),n.sdp&&t.debug(n.sdp.sdp),n.sdp&&a.webRtc.setRemoteDescription(n.sdp).then(function(){a.setRemoteSDP=!0,a._handRecvCandsOrSend(e,n),WebIM.WebRTC.supportPRAnswer?a.webRtc.createPRAnswer(function(e){a._onGotWebRtcPRAnswer(e),setTimeout(function(){t.info("[WebRTC-API] onRinging : after send pranswer. ",a.callee),a.onRinging(a.callee,a.streamType)},500)}):(setTimeout(function(){t.info("[WebRTC-API] onRinging : After iniC, cause by: not supported pranswer. ",a.callee),a.onRinging(a.callee,a.streamType)},500),a._ping())})},_onGotWebRtcPRAnswer:function(e){var n=new i({to:this.callee,rtKey:this._rtKey});this.api.acptC(n,this._sessId,this._rtcId,e),this.setLocalSDP=!0,this._handRecvCandsOrSend(),this._ping()},onRinging:function(e,n){},accept:function(){var e=this;var n={audio:!0};"VIDEO"==e.streamType&&(n.video=!0),e.webRtc.createMedia(n,function(n,s){n.setLocalVideoSrcObject(s),t.info("createAndSendAnswer : ...... "),e.webRtc.createAnswer(function(n){var s=new i({to:e.callee,rtKey:e._rtKey});WebIM.WebRTC.supportPRAnswer?e.webRtc.isConnected()||e.callerNotPranswer?(t.info("[WebRTC-API] ice connected or caller not pranswer, may send answer"),e.api.ansC(s,e._sessId,e._rtcId,n)):(t.info("[WebRTC-API] ice state not connected, send answer waiting."),e.webRtc._hookWhenICEReady=function(){t.info("[WebRTC-API] ice connected, send answer"),e.api.ansC(s,e._sessId,e._rtcId,n)}):e.api.acptC(s,e._sessId,e._rtcId,n,null,1),WebIM.WebRTC.supportPRAnswer||(e.setLocalSDP=!0),e._handRecvCandsOrSend(),e.accepted=!0})})},_handRecvCandsOrSend:function(e,n){var t=this;setTimeout(function(){t._onTcklC(e,n)},50),setTimeout(function(){t._onIceCandidate()},50)},_onTcklC:function(e,n){if(this.setRemoteSDP)t.info("[WebRTC-API] recv and add cands."),this._recvCands&&this._recvCands.length>0&&this.webRtc.addIceCandidate(this._recvCands),this._recvCands&&this._recvCands.length>0&&(this._recvCands=[]),n&&n.cands&&this.webRtc.addIceCandidate(n.cands);else if(n&&n.cands&&n.cands.length>0){for(var i=0;i<n.cands.length;i++)(this._recvCands||(this._recvCands=[])).push(n.cands[i]);t.debug("[_onTcklC] temporary memory[recv] ice candidate. util setRemoteSDP = true")}},_onIceStateChange:function(e){t.debug("[WebRTC-API] ice state is "+e),this.webRtc.isConnected()&&(this.webRtc._hookWhenICEReady&&this.webRtc._hookWhenICEReady(),this.webRtc._hookWhenICEReady=void 0),"closed"===e&&(this.setLocalSDP=!1,this.setRemoteSDP=!1),this.api.onIceConnectionStateChange(e)},_onIceCandidate:function(e){var n=this;if(n.setLocalSDP){var s=function(e){t.debug("send ice candidate...");var s=new i({to:n.callee,rtKey:n._rtKey});e&&n.api.tcklC(s,n._sessId,n._rtcId,null,e)};n._cands&&n._cands.length>0&&(s(n._cands),n._cands=[]),e&&s(e)}else e&&(n._cands||(n._cands=[])).push(e),t.debug("[_onIceCandidate] temporary memory[send] ice candidate. util setLocalSDP = true")},__termCall1:function(e){this._pingIntervalId&&window.clearInterval(this._pingIntervalId);var n,t=new i({to:this.callee,rtKey:this._rtKey});e||!this.isCaller&&!this.accepted&&(n="decline")||(n="success"),this.hangup||this.api.termC(t,this._sessId,this._rtcId,n),this.webRtc.close(),this.hangup=!0,this.setLocalSDP=!1,this.setRemoteSDP=!1,this.onTermCall(e)},termCall:function(e){try{this.__termCall1(e)}finally{if(WebIM.__alreadyOpenMedias&&WebIM.__alreadyOpenMedias.length>0){for(var n in WebIM.__alreadyOpenMedias){var t=WebIM.__alreadyOpenMedias[n];try{emedia.stopTracks(t)}catch(i){}}WebIM.__alreadyOpenMedias=[]}}},_onTermC:function(e,n){t.debug("[_onTermC] options.reason = "+n.reason);this.hangup=!0,this.setLocalSDP=!1,this.setRemoteSDP=!1,this.termCall(n.reason)},onTermCall:function(){}};module.exports=function(n){e.extend(!0,this,s,n||{}),this.init()};
},{"./utils":"yUjP","./api":"thlH"}],"J9kn":[function(require,module,exports) {
var t=require("./utils").default,e=require("./iq"),n=require("./api"),i=require("./webrtc").default,o=require("./p2p"),r=n.RouteTo,a=n.Api,s=t.logger,c={api:null,caller:"",connection:null,pattern:null,listener:{onAcceptCall:function(t,e){},onRinging:function(t){},onTermCall:function(){},onIceConnectionStateChange:function(t){}},mediaStreamConstaints:{audio:!0,video:!0},init:function(){var t=this;if(void 0===t.connection)throw"Caller need a instance of Easemob.im.Connection";t.api=t.api||new a({imConnection:t.connection,rtcHandler:new e({imConnection:t.connection})}),t.api.onInitC=function(){t._onInitC.apply(t,arguments)},t.api.onInvite=function(){t.listener.onInvite.apply(t,arguments)},t.api.onIceConnectionStateChange=function(){t.listener.onIceConnectionStateChange.apply(t,arguments)}},createConference:function(t,e){var n=new r({rtKey:""});this.api.reqTkt(n,!0,void 0,t,function(t,n){n.ticket;n.conferenceId=n.confrId,e&&e(t,n)})},inviteConference:function(t,e,n,i,o){var a=new r({to:n,rtKey:"",rtflag:0});this.api.invite(a,t,e,i,function(t,e){o&&o(t,e)})},getConferenceTkt:function(t,e,n){var i=new r({rtKey:""});this.api.reqTkt(i,!1,t,e,function(t,e){n&&n(t,e)})},makeVideoCall:function(e,n){t.extend({},this.mediaStreamConstaints),this.mediaStreamConstaints.video=!0,this.call(e,this.mediaStreamConstaints,n)},makeVoiceCall:function(e,n){console.log("ScareCrow");t.extend({},this.mediaStreamConstaints),this.mediaStreamConstaints.video=!1,this.call(e,this.mediaStreamConstaints,n)},acceptCall:function(){this.pattern.accept()},endCall:function(t){this.caller="",this.pattern.termCall()},call:function(t,e,n){var i=this;this.callee=this.api.jid(t);var o=new r({rtKey:"",sid:n,to:t,success:function(t){s.debug("iq to server success",t)},fail:function(t){s.debug("iq to server error",t),i.onError(t)}});this.api.reqP2P(o,e.video?1:0,e.audio?1:0,this.api.jid(t),function(t,e){"0"!=e.online?(i._onGotServerP2PConfig(t,e),i.pattern.initC(i.mediaStreamConstaints,n)):i.listener.onError({message:"callee is not online!"})})},controlStream:function(t,e){var n=new r({to:e,rtKey:"",rtflag:0});this.api.streamControl(n,null,this.rtcId,t,this.localStream)},_onInitC:function(t,e,n,i,o){this.callee=t,this._rtcCfg=e.rtcCfg,this._WebRTCCfg=e.WebRTC,this.sessId=e.sessId,this.rtcId=e.rtcId,this.switchPattern("VIDEO"==e.streamType?"VIDEO":"VOICE"),this.pattern._onInitC(t,e,n,i,o)},_onInvite:function(){},_onGotServerP2PConfig:function(t,e){0==e.result&&(this._p2pConfig=e,this._rtcCfg=e.rtcCfg,this._rtcCfg2=e.rtcCfg2,this.sessId=e.sessId,this.rtcId="RTCID"+e.sessId,this._rtKey=this._rtkey=e.rtKey||e.rtkey,this._rtFlag=this._rtflag=e.rtFlag||e.rtflag,this._WebRTCCfg=e.WebRTC,this.admtok=e.admtok,this.tkt=e.tkt,this.switchPattern(this.mediaStreamConstaints.audio&&this.mediaStreamConstaints.video?"VIDEO":"VOICE"))},switchPattern:function(t){var e=this;!e._WebRTCCfg&&(e.pattern=new o({callee:e.callee,_p2pConfig:e._p2pConfig,_rtcCfg:e._rtcCfg,_rtcCfg2:e._rtcCfg2,_rtKey:e._rtKey||e._rtkey,_rtFlag:e._rtFlag||e._rtflag,_sessId:e.sessId,_rtcId:e.rtcId,webRtc:new i({streamType:t,subArgs:{subSVideo:"VIDEO"===t,subSAudio:!0},onGotLocalStream:function(n,i){e.listener.onGotLocalStream(n,t),e.localStream=n,console.log("self.localStreamself.localStream",e.localStream)},onGotRemoteStream:function(n,i){e.listener.onGotRemoteStream(n,t),e.remoteStream=n,console.log("self.remoteStream.remoteStream",e.remoteStream)},onError:e.listener.onError}),api:e.api,onAcceptCall:e.listener&&e.listener.onAcceptCall||function(){},onRinging:e.listener&&e.listener.onRinging||function(){},onTermCall:e.listener&&e.listener.onTermCall||function(){},onOtherUserOpenVoice:e.listener&&e.listener.onOtherUserOpenVoice||function(){},onOtherUserOpenVideo:e.listener&&e.listener.onOtherUserOpenVideo||function(){}}))}};module.exports=function(e){t.extend(!0,this,c,e||{}),this.init()};
},{"./utils":"yUjP","./iq":"7BK3","./api":"thlH","./webrtc":"GTpD","./p2p":"3mO+"}],"JWwv":[function(require,module,exports) {
var define;
var e;function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var n=require("./components/utils").default,t=require("./components/call"),r=require("easemob-emedia");console.log("emedia",r),window.WebIM="undefined"!=typeof WebIM?WebIM:{},WebIM.WebRTC=WebIM.WebRTC||{},WebIM.WebRTC.Call=t,WebIM.WebRTC.Util=n,WebIM.__alreadyOpenMedias=[],"object"===("undefined"==typeof module?"undefined":o(module))&&"object"===o(module.exports)?module.exports=WebIM.WebRTC:"function"==typeof e&&e.amd&&e([],function(){return WebIM.WebRTC}),WebIM.WebRTC.supportPRAnswer=r.supportPRAnswer,console&&console.warn("Webrtc version","Git.e4f0006");
},{"./components/utils":"yUjP","./components/call":"J9kn","easemob-emedia":"WNWS"}],"Focm":[function(require,module,exports) {
module.exports=require("./src/entry");
},{"./src/entry":"JWwv"}]},{},["Focm"], "webrtc")
//# sourceMappingURL=/EMedia_x1v1.js.map